import{e as w,r as l,d as p,j as e,H as _}from"./app-uhljFjo-.js";import{P as k}from"./PrimaryButton-DxAD7fVD.js";import{A as g}from"./AuthenticatedLayout-CkxDWoZ8.js";import{c as x}from"./createLucideIcon-Cyf_CMDd.js";import{X as C,I as S}from"./x-CwveuG5H.js";import"./transition-uFJtBX_F.js";const $=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],R=x("arrow-right",$);const z=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],D=x("heart",z);const A=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],I=x("message-circle",A);const L=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],M=x("reply",L);function V({id:a}){const{auth:n}=w().props,[t,i]=l.useState(null),[c,N]=l.useState(!0),[m,f]=l.useState(""),[r,j]=l.useState(null),[o,h]=l.useState(null);l.useEffect(()=>{u()},[a]);const u=async()=>{try{const s=await p.get(`/api/portal/discussions/${a}`);i(s.data)}catch(s){console.error(s)}finally{N(!1)}},v=async()=>{if(!n.user)return alert("يرجى تسجيل الدخول");i(s=>({...s,votes_count:s.current_user_vote?s.votes_count-1:s.votes_count+1,current_user_vote:!s.current_user_vote}));try{await p.post(`/api/portal/discussions/${a}/vote`)}catch{u()}},y=async s=>{if(s.preventDefault(),!m.trim()&&!r)return;const d=new FormData;d.append("body",m),r&&d.append("image",r),o&&d.append("parent_id",o.id);try{await p.post(`/api/portal/discussions/${a}/reply`,d,{headers:{"Content-Type":"multipart/form-data"}}),f(""),j(null),h(null),u()}catch{alert("فشل إضافة الرد")}};return c?e.jsx(g,{header:e.jsx("div",{className:"h-6 w-32 animate-pulse rounded bg-slate-200"}),children:e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl px-6",children:"Loading..."})})}):t?e.jsxs(g,{header:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:"/community",className:"rounded-full p-2 text-slate-500 transition-colors hover:bg-slate-100",children:e.jsx(R,{className:"rotate-180",size:20})}),e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"النقاشات"})]}),children:[e.jsx(_,{title:t.title}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-4xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden border border-slate-200 bg-white shadow-sm sm:rounded-2xl",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full border border-slate-200 bg-slate-100 text-lg font-bold text-slate-500",children:t.user.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h1",{className:"mb-1 text-2xl font-black text-slate-900",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[e.jsx("span",{className:"font-bold text-slate-700",children:t.user.name}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(t.created_at).toLocaleDateString("ar-SY")}),e.jsx("span",{className:"rounded-md bg-slate-100 px-2 py-0.5 text-xs font-bold text-slate-500",children:t.category})]})]})]}),e.jsxs("div",{className:"prose prose-slate mb-8 max-w-none",children:[e.jsx("p",{className:"whitespace-pre-wrap text-lg leading-relaxed text-slate-700",children:t.body}),t.image_url&&e.jsx("div",{className:"mt-6 overflow-hidden rounded-2xl border border-slate-200 bg-slate-50",children:e.jsx("img",{src:t.image_url,alt:"",className:"h-auto max-w-full"})})]}),e.jsxs("div",{className:"flex items-center gap-6 border-b border-t border-slate-100 py-6",children:[e.jsxs("button",{onClick:v,className:`flex items-center gap-2 text-base font-bold transition-all ${t.current_user_vote?"rounded-xl bg-red-50 px-4 py-2 text-red-500":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(D,{size:20,className:t.current_user_vote?"fill-current":""}),e.jsxs("span",{children:[t.votes_count," تأييد"]})]}),e.jsxs("div",{className:"flex items-center gap-2 font-bold text-slate-500",children:[e.jsx(I,{size:20}),e.jsxs("span",{children:[t.replies_count," تعليق"]})]})]}),e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"الردود"}),t.replies.map(s=>e.jsx(b,{reply:s,onReply:h},s.id))]}),e.jsxs("div",{className:"mt-10 rounded-2xl border border-slate-100 bg-slate-50 p-6",children:[e.jsx("h4",{className:"mb-4 flex items-center justify-between font-bold text-slate-700",children:o?e.jsxs("span",{className:"flex items-center gap-2 rounded-lg bg-emerald-50 px-3 py-1 text-emerald-600",children:[e.jsx(M,{size:16}),"الرد على ",o.user.name,e.jsx("button",{onClick:()=>h(null),className:"hover:text-red-500",children:e.jsx(C,{size:16})})]}):"أضف تعليقاً"}),e.jsxs("form",{onSubmit:y,children:[e.jsx("textarea",{value:m,onChange:s=>f(s.target.value),className:"mb-4 h-32 w-full rounded-xl border-slate-200 focus:border-emerald-500 focus:ring-emerald-500",placeholder:"اكتب تعليقك هنا...",required:!0}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 text-sm font-bold text-slate-500 transition-colors hover:text-slate-700",children:[e.jsx("div",{className:"rounded-lg border border-slate-200 bg-white p-2",children:e.jsx(S,{size:20})}),e.jsx("span",{children:r?r.name:"إرفاق صورة"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>s.target.files&&j(s.target.files[0])})]}),e.jsx(k,{children:"إرسال الرد"})]})]})]})]})})})})]}):e.jsx("div",{children:"Not Found"})}function b({reply:a,onReply:n,depth:t=0}){const i=t>0;return e.jsx("div",{className:`group ${i?"mr-12 mt-4":""}`,children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full border border-slate-200 bg-slate-100 font-bold text-slate-500",children:a.user.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"ro-tr-none rounded-2xl bg-slate-50 p-4",children:[e.jsx("div",{className:"mb-2 flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-900",children:a.user.name}),e.jsx("span",{className:"text-xs font-medium text-slate-400",children:"منذ فترة"})]})}),e.jsx("p",{className:"whitespace-pre-wrap text-sm leading-relaxed text-slate-700",children:a.body}),a.image_path&&e.jsx("div",{className:"mt-3 max-w-sm overflow-hidden rounded-lg",children:e.jsx("img",{src:`/storage/${a.image_path}`,alt:"",className:"h-auto w-full"})})]}),e.jsx("button",{onClick:()=>n(a),className:"mt-1 px-2 py-1 text-xs font-bold text-slate-500 opacity-0 transition-colors hover:text-emerald-600 group-hover:opacity-100",children:"رد"}),a.replies&&a.replies.length>0&&e.jsx("div",{className:"mt-2 border-r-2 border-slate-100 pr-4",children:a.replies.map(c=>e.jsx(b,{reply:c,onReply:n,depth:t+1},c.id))})]})]})})}export{V as default};
