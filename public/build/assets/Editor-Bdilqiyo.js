import{g as ze,r as I,d as ne,j as l,H as Qt,L as en}from"./app-D8KvjWtk.js";import{A as tn}from"./AdminLayout-CUoQYiuf.js";import{m as tt}from"./maplibre-gl-QQc0gOLL.js";import{P as nn}from"./phone-DWgXfvZr.js";import{c as Y}from"./createLucideIcon-BYbfVwB1.js";import{Z as rn,D as on}from"./zap-DqmVnTXk.js";import{C as sn,a as an}from"./circle-check-KIq_Ns8w.js";import{I as ln}from"./info-BJqwxNxN.js";import{A as cn}from"./activity-otahktFQ.js";import{M as un}from"./message-square-CbH237Sb.js";import{T as dn}from"./trash-2-BivJtPye.js";const U={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},j={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},x={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},G={POLYGON:"polygon",LINE:"line_string",POINT:"point"},m={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},b={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},D={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},pe={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},F={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},L={ACTIVE:"true",INACTIVE:"false"},Et=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],pn=-90,ke=-85,fn=90,Ue=85,hn=-270,gn=270,bt=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:fn,LAT_MIN:pn,LAT_RENDERED_MAX:Ue,LAT_RENDERED_MIN:ke,LNG_MAX:gn,LNG_MIN:hn,activeStates:L,classes:U,cursors:x,events:D,geojsonTypes:m,interactions:Et,meta:F,modes:b,sources:j,types:G,updateActions:pe},Symbol.toStringTag,{value:"Module"}));function _e(e){return function(t){const n=t.featureTarget;return!n||!n.properties?!1:n.properties.meta===e}}function Ct(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function re(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===L.ACTIVE&&e.featureTarget.properties.meta===F.FEATURE}function He(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===L.INACTIVE&&e.featureTarget.properties.meta===F.FEATURE}function Se(e){return e.featureTarget===void 0}function qe(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===F.FEATURE}function fe(e){const t=e.featureTarget;return!t||!t.properties?!1:t.properties.meta===F.VERTEX}function Ce(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function ve(e){return e.key==="Escape"||e.keyCode===27}function Ne(e){return e.key==="Enter"||e.keyCode===13}function Ge(e){return e.key==="Backspace"||e.keyCode===8}function Ve(e){return e.key==="Delete"||e.keyCode===46}function Tt(e){return e.key==="1"||e.keyCode===49}function _t(e){return e.key==="2"||e.keyCode===50}function St(e){return e.key==="3"||e.keyCode===51}function vt(e){const t=e.key||String.fromCharCode(e.keyCode);return t>="0"&&t<="9"}function mn(){return!0}const yn=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:re,isBackspaceKey:Ge,isDeleteKey:Ve,isDigit1Key:Tt,isDigit2Key:_t,isDigit3Key:St,isDigitKey:vt,isEnterKey:Ne,isEscapeKey:ve,isFeature:qe,isInactiveFeature:He,isOfMetaType:_e,isShiftDown:Ce,isShiftMousedown:Ct,isTrue:mn,isVertex:fe,noTarget:Se},Symbol.toStringTag,{value:"Module"}));var me={},ue={},nt;function En(){return nt||(nt=1,ue.RADIUS=6378137,ue.FLATTENING=1/298.257223563,ue.POLAR_RADIUS=63567523142e-4),ue}var rt;function bn(){if(rt)return me;rt=1;var e=En();me.geometry=t,me.ring=r;function t(i){var s=0,c;switch(i.type){case"Polygon":return n(i.coordinates);case"MultiPolygon":for(c=0;c<i.coordinates.length;c++)s+=n(i.coordinates[c]);return s;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(c=0;c<i.geometries.length;c++)s+=t(i.geometries[c]);return s}}function n(i){var s=0;if(i&&i.length>0){s+=Math.abs(r(i[0]));for(var c=1;c<i.length;c++)s-=Math.abs(r(i[c]))}return s}function r(i){var s,c,u,f,y,g,a,p=0,h=i.length;if(h>2){for(a=0;a<h;a++)a===h-2?(f=h-2,y=h-1,g=0):a===h-1?(f=h-1,y=0,g=1):(f=a,y=a+1,g=a+2),s=i[f],c=i[y],u=i[g],p+=(o(u[0])-o(s[0]))*Math.sin(o(c[1]));p=p*e.RADIUS*e.RADIUS/2}return p}function o(i){return i*Math.PI/180}return me}var Cn=bn();const Tn=ze(Cn),ot={Point:0,LineString:1,MultiLineString:1,Polygon:2};function _n(e,t){const n=ot[e.geometry.type]-ot[t.geometry.type];return n===0&&e.geometry.type===m.POLYGON?e.area-t.area:n}function Nt(e){return e.map(t=>(t.geometry.type===m.POLYGON&&(t.area=Tn.geometry({type:m.FEATURE,property:{},geometry:t.geometry})),t)).sort(_n).map(t=>(delete t.area,t))}function xt(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function $(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}$.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};$.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};$.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};$.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((t,n)=>t.v-n.v).map(t=>t.k)};$.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const Sn=[F.FEATURE,F.MIDPOINT,F.VERTEX],oe={click:vn,touch:Nn};function vn(e,t,n){return It(e,t,n,n.options.clickBuffer)}function Nn(e,t,n){return It(e,t,n,n.options.touchBuffer)}function It(e,t,n,r){if(n.map===null)return[];const o=e?xt(e,r):t,i={};n.options.styles&&(i.layers=n.options.styles.map(f=>f.id).filter(f=>n.map.getLayer(f)!=null));const s=n.map.queryRenderedFeatures(o,i).filter(f=>Sn.indexOf(f.properties.meta)!==-1),c=new $,u=[];return s.forEach(f=>{const y=f.properties.id;c.has(y)||(c.add(y),u.push(f))}),Nt(u)}function be(e,t){const n=oe.click(e,null,t),r={mouse:x.NONE};return n[0]&&(r.mouse=n[0].properties.active===L.ACTIVE?x.MOVE:x.POINTER,r.feature=n[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(r.mouse=x.ADD),t.ui.queueMapClasses(r),t.ui.updateMapClasses(),n[0]}function Je(e,t){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}const xn=4,In=12,Mn=500;function je(e,t,n={}){const r=n.fineTolerance!=null?n.fineTolerance:xn,o=n.grossTolerance!=null?n.grossTolerance:In,i=n.interval!=null?n.interval:Mn;e.point=e.point||t.point,e.time=e.time||t.time;const s=Je(e.point,t.point);return s<r||s<o&&t.time-e.time<i}const On=25,Ln=250;function $e(e,t,n={}){const r=n.tolerance!=null?n.tolerance:On,o=n.interval!=null?n.interval:Ln;return e.point=e.point||t.point,e.time=e.time||t.time,Je(e.point,t.point)<r&&t.time-e.time<o}const Be=function(e,t){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},r={on(i,s,c){if(n[i]===void 0)throw new Error(`Invalid event type: ${i}`);n[i].push({selector:s,fn:c})},render(i){t.store.featureChanged(i)}},o=function(i,s){const c=n[i];let u=c.length;for(;u--;){const f=c[u];if(f.selector(s)){f.fn.call(r,s)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(r),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(i){o("drag",i)},click(i){o("click",i)},mousemove(i){o("mousemove",i)},mousedown(i){o("mousedown",i)},mouseup(i){o("mouseup",i)},mouseout(i){o("mouseout",i)},keydown(i){o("keydown",i)},keyup(i){o("keyup",i)},touchstart(i){o("touchstart",i)},touchmove(i){o("touchmove",i)},touchend(i){o("touchend",i)},tap(i){o("tap",i)}}};let wn=(e,t=21)=>(n=t)=>{let r="",o=n|0;for(;o--;)r+=e[Math.random()*e.length|0];return r};const An=wn("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function Ye(){return An()}const k=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||Ye(),this.type=t.geometry.type};k.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};k.prototype.incomingCoords=function(e){this.setCoordinates(e)};k.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};k.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};k.prototype.setProperty=function(e,t){this.properties[e]=t};k.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:m.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};k.prototype.internal=function(e){const t={id:this.id,meta:F.FEATURE,"meta:type":this.type,active:L.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const n in this.properties)t[`user_${n}`]=this.properties[n];return{type:m.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const ee=function(e,t){k.call(this,e,t)};ee.prototype=Object.create(k.prototype);ee.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};ee.prototype.updateCoordinate=function(e,t,n){arguments.length===3?this.coordinates=[t,n]:this.coordinates=[e,t],this.changed()};ee.prototype.getCoordinate=function(){return this.getCoordinates()};const W=function(e,t){k.call(this,e,t)};W.prototype=Object.create(k.prototype);W.prototype.isValid=function(){return this.coordinates.length>1};W.prototype.addCoordinate=function(e,t,n){this.changed();const r=parseInt(e,10);this.coordinates.splice(r,0,[t,n])};W.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};W.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};W.prototype.updateCoordinate=function(e,t,n){const r=parseInt(e,10);this.coordinates[r]=[t,n],this.changed()};const V=function(e,t){k.call(this,e,t),this.coordinates=this.coordinates.map(n=>n.slice(0,-1))};V.prototype=Object.create(k.prototype);V.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};V.prototype.incomingCoords=function(e){this.coordinates=e.map(t=>t.slice(0,-1)),this.changed()};V.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};V.prototype.addCoordinate=function(e,t,n){this.changed();const r=e.split(".").map(i=>parseInt(i,10));this.coordinates[r[0]].splice(r[1],0,[t,n])};V.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(r=>parseInt(r,10)),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))};V.prototype.getCoordinate=function(e){const t=e.split(".").map(r=>parseInt(r,10)),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))};V.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};V.prototype.updateCoordinate=function(e,t,n){this.changed();const r=e.split("."),o=parseInt(r[0],10),i=parseInt(r[1],10);this.coordinates[o]===void 0&&(this.coordinates[o]=[]),this.coordinates[o][i]=[t,n]};const Pn={MultiPoint:ee,MultiLineString:W,MultiPolygon:V},xe=(e,t,n,r,o)=>{const i=n.split("."),s=parseInt(i[0],10),c=i[1]?i.slice(1).join("."):null;return e[s][t](c,r,o)},R=function(e,t){if(k.call(this,e,t),delete this.coordinates,this.model=Pn[t.geometry.type],this.model===void 0)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};R.prototype=Object.create(k.prototype);R.prototype._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(n=>new t(this.ctx,{id:Ye(),type:m.FEATURE,properties:{},geometry:{coordinates:n,type:this.type.replace("Multi","")}}))};R.prototype.isValid=function(){return this.features.every(e=>e.isValid())};R.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};R.prototype.getCoordinate=function(e){return xe(this.features,"getCoordinate",e)};R.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===m.POLYGON?e.getCoordinates():e.coordinates)))};R.prototype.updateCoordinate=function(e,t,n){xe(this.features,"updateCoordinate",e,t,n),this.changed()};R.prototype.addCoordinate=function(e,t,n){xe(this.features,"addCoordinate",e,t,n),this.changed()};R.prototype.removeCoordinate=function(e){xe(this.features,"removeCoordinate",e),this.changed()};R.prototype.getFeatures=function(){return this.features};function E(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}E.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};E.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((t,n)=>(t[n.feature_id]===void 0&&(t[n.feature_id]=!0,this._ctx.store.get(n.feature_id).changed()),t),{})};E.prototype.getSelected=function(){return this._ctx.store.getSelected()};E.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};E.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};E.prototype.getFeature=function(e){return this._ctx.store.get(e)};E.prototype.select=function(e){return this._ctx.store.select(e)};E.prototype.deselect=function(e){return this._ctx.store.deselect(e)};E.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)};E.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)};E.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};E.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};E.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)};E.prototype.changeMode=function(e,t={},n={}){return this._ctx.events.changeMode(e,t,n)};E.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)};E.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};E.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};E.prototype.featuresAt=function(e,t,n="click"){if(n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return oe[n](e,t,this._ctx)};E.prototype.newFeature=function(e){const t=e.geometry.type;return t===m.POINT?new ee(this._ctx,e):t===m.LINE_STRING?new W(this._ctx,e):t===m.POLYGON?new V(this._ctx,e):new R(this._ctx,e)};E.prototype.isInstanceOf=function(e,t){if(e===m.POINT)return t instanceof ee;if(e===m.LINE_STRING)return t instanceof W;if(e===m.POLYGON)return t instanceof V;if(e==="MultiFeature")return t instanceof R;throw new Error(`Unknown feature class: ${e}`)};E.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};E.prototype.onSetup=function(){};E.prototype.onDrag=function(){};E.prototype.onClick=function(){};E.prototype.onMouseMove=function(){};E.prototype.onMouseDown=function(){};E.prototype.onMouseUp=function(){};E.prototype.onMouseOut=function(){};E.prototype.onKeyUp=function(){};E.prototype.onKeyDown=function(){};E.prototype.onTouchStart=function(){};E.prototype.onTouchMove=function(){};E.prototype.onTouchEnd=function(){};E.prototype.onTap=function(){};E.prototype.onStop=function(){};E.prototype.onTrash=function(){};E.prototype.onCombineFeature=function(){};E.prototype.onUncombineFeature=function(){};E.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const Mt={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Fn=Object.keys(Mt);function Rn(e){const t=Object.keys(e);return function(n,r={}){let o={};const i=t.reduce((c,u)=>(c[u]=e[u],c),new E(n));function s(c){return u=>i[c](o,u)}return{start(){o=i.onSetup(r),Fn.forEach(c=>{const u=Mt[c];let f=()=>!1;e[u]&&(f=()=>!0),this.on(c,f,s(u))})},stop(){i.onStop(o)},trash(){i.onTrash(o)},combineFeatures(){i.onCombineFeatures(o)},uncombineFeatures(){i.onUncombineFeatures(o)},render(c,u){i.toDisplayFeatures(o,c,u)}}}}function Dn(e){const t=Object.keys(e.options.modes).reduce((a,p)=>(a[p]=Rn(e.options.modes[p]),a),{});let n={},r={};const o={};let i=null,s=null;o.drag=function(a,p){p({point:a.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:x.DRAG}),s.drag(a)):a.originalEvent.stopPropagation()},o.mousedrag=function(a){o.drag(a,p=>!je(n,p))},o.touchdrag=function(a){o.drag(a,p=>!$e(r,p))},o.mousemove=function(a){if((a.originalEvent.buttons!==void 0?a.originalEvent.buttons:a.originalEvent.which)===1)return o.mousedrag(a);const h=be(a,e);a.featureTarget=h,s.mousemove(a)},o.mousedown=function(a){n={time:new Date().getTime(),point:a.point};const p=be(a,e);a.featureTarget=p,s.mousedown(a)},o.mouseup=function(a){const p=be(a,e);a.featureTarget=p,je(n,{point:a.point,time:new Date().getTime()})?s.click(a):s.mouseup(a)},o.mouseout=function(a){s.mouseout(a)},o.touchstart=function(a){if(!e.options.touchEnabled)return;r={time:new Date().getTime(),point:a.point};const p=oe.touch(a,null,e)[0];a.featureTarget=p,s.touchstart(a)},o.touchmove=function(a){if(e.options.touchEnabled)return s.touchmove(a),o.touchdrag(a)},o.touchend=function(a){if(a.originalEvent.preventDefault(),!e.options.touchEnabled)return;const p=oe.touch(a,null,e)[0];a.featureTarget=p,$e(r,{time:new Date().getTime(),point:a.point})?s.tap(a):s.touchend(a)};const c=a=>{const p=Ge(a),h=Ve(a),T=vt(a);return!(p||h||T)};o.keydown=function(a){(a.srcElement||a.target).classList.contains(U.CANVAS)&&((Ge(a)||Ve(a))&&e.options.controls.trash?(a.preventDefault(),s.trash()):c(a)?s.keydown(a):Tt(a)&&e.options.controls.point?u(b.DRAW_POINT):_t(a)&&e.options.controls.line_string?u(b.DRAW_LINE_STRING):St(a)&&e.options.controls.polygon&&u(b.DRAW_POLYGON))},o.keyup=function(a){c(a)&&s.keyup(a)},o.zoomend=function(){e.store.changeZoom()},o.data=function(a){if(a.dataType==="style"){const{setup:p,map:h,options:T,store:w}=e;T.styles.some(B=>h.getLayer(B.id))||(p.addLayers(),w.setDirty(),w.render())}};function u(a,p,h={}){s.stop();const T=t[a];if(T===void 0)throw new Error(`${a} is not valid`);i=a;const w=T(e,p);s=Be(w,e),h.silent||e.map.fire(D.MODE_CHANGE,{mode:a}),e.store.setDirty(),e.store.render()}const f={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function y(a){let p=!1;Object.keys(a).forEach(h=>{if(f[h]===void 0)throw new Error("Invalid action type");f[h]!==a[h]&&(p=!0),f[h]=a[h]}),p&&e.map.fire(D.ACTIONABLE,{actions:f})}return{start(){i=e.options.defaultMode,s=Be(t[i](e),e)},changeMode:u,actionable:y,currentModeName(){return i},currentModeRender(a,p){return s.render(a,p)},fire(a,p){e.map&&e.map.fire(a,p)},addEventListeners(){e.map.on("mousemove",o.mousemove),e.map.on("mousedown",o.mousedown),e.map.on("mouseup",o.mouseup),e.map.on("data",o.data),e.map.on("touchmove",o.touchmove),e.map.on("touchstart",o.touchstart),e.map.on("touchend",o.touchend),e.container.addEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",o.keydown),e.container.addEventListener("keyup",o.keyup))},removeEventListeners(){e.map.off("mousemove",o.mousemove),e.map.off("mousedown",o.mousedown),e.map.off("mouseup",o.mouseup),e.map.off("data",o.data),e.map.off("touchmove",o.touchmove),e.map.off("touchstart",o.touchstart),e.map.off("touchend",o.touchend),e.container.removeEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",o.keydown),e.container.removeEventListener("keyup",o.keyup))},trash(a){s.trash(a)},combineFeatures(){s.combineFeatures()},uncombineFeatures(){s.uncombineFeatures()},getMode(){return i}}}function he(e){return[].concat(e).filter(t=>t!==void 0)}function kn(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(j.HOT)!==void 0))return u();const n=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:n});let r=[],o=[];e.isDirty?o=e.getAllIds():(r=e.getChangedIds().filter(f=>e.get(f)!==void 0),o=e.sources.hot.filter(f=>f.properties.id&&r.indexOf(f.properties.id)===-1&&e.get(f.properties.id)!==void 0).map(f=>f.properties.id)),e.sources.hot=[];const i=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(f=>{const y=f.properties.id||f.properties.parent;return r.indexOf(y)===-1});const s=i!==e.sources.cold.length||o.length>0;r.forEach(f=>c(f,"hot")),o.forEach(f=>c(f,"cold"));function c(f,y){const a=e.get(f).internal(n);e.ctx.events.currentModeRender(a,p=>{p.properties.mode=n,e.sources[y].push(p)})}s&&e.ctx.map.getSource(j.COLD).setData({type:m.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(j.HOT).setData({type:m.FEATURE_COLLECTION,features:e.sources.hot}),u();function u(){e.isDirty=!1,e.clearChangedIds()}}function N(e){this._features={},this._featureIds=new $,this._selectedFeatureIds=new $,this._selectedCoordinates=[],this._changedFeatureIds=new $,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let t;this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,kn.call(this),this._emitSelectionChange&&(this.ctx.events.fire(D.SELECTION_CHANGE,{features:this.getSelected().map(n=>n.toGeoJSON()),points:this.getSelectedCoordinates().map(n=>({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:n.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(D.RENDER,{})}))},this.isDirty=!1}N.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}};N.prototype.setDirty=function(){return this.isDirty=!0,this};N.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0){const r=this.get(e);this.ctx.events.fire(D.CREATE,{features:[r.toGeoJSON()]})}return this};N.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),(t.silent!=null?t.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(D.UPDATE,{action:t.action?t.action:pe.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};N.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};N.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};N.prototype.getAllIds=function(){return this._featureIds.values()};N.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this};N.prototype.delete=function(e,t={}){const n=[];return he(e).forEach(r=>{this._featureIds.has(r)&&(this._featureIds.delete(r),this._selectedFeatureIds.delete(r),t.silent||n.indexOf(this._features[r])===-1&&n.push(this._features[r].toGeoJSON()),delete this._features[r],this.isDirty=!0)}),n.length&&this.ctx.events.fire(D.DELETE,{features:n}),Ot(this,t),this};N.prototype.get=function(e){return this._features[e]};N.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};N.prototype.select=function(e,t={}){return he(e).forEach(n=>{this._selectedFeatureIds.has(n)||(this._selectedFeatureIds.add(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),this};N.prototype.deselect=function(e,t={}){return he(e).forEach(n=>{this._selectedFeatureIds.has(n)&&(this._selectedFeatureIds.delete(n),this._changedFeatureIds.add(n),t.silent||(this._emitSelectionChange=!0))}),Ot(this,t),this};N.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};N.prototype.setSelected=function(e,t={}){return e=he(e),this.deselect(this._selectedFeatureIds.values().filter(n=>e.indexOf(n)===-1),{silent:t.silent}),this.select(e.filter(n=>!this._selectedFeatureIds.has(n)),{silent:t.silent}),this};N.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};N.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};N.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};N.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};N.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(t=>({coordinates:this.get(t.feature_id).getCoordinate(t.coord_path)}))};N.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};N.prototype.setFeatureProperty=function(e,t,n,r={}){this.get(e).setProperty(t,n),this.featureChanged(e,{silent:r.silent,action:pe.CHANGE_PROPERTIES})};function Ot(e,t={}){const n=e._selectedCoordinates.filter(r=>e._selectedFeatureIds.has(r.feature_id));e._selectedCoordinates.length!==n.length&&!t.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=n}N.prototype.storeMapConfig=function(){Et.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};N.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};N.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const Un=["mode","feature","mouse"];function Gn(e){const t={};let n=null,r={mode:null,feature:null,mouse:null},o={mode:null,feature:null,mouse:null};function i(){s({mode:null,feature:null,mouse:null}),c()}function s(p){o=Object.assign(o,p)}function c(){if(!e.container)return;const p=[],h=[];Un.forEach(T=>{o[T]!==r[T]&&(p.push(`${T}-${r[T]}`),o[T]!==null&&h.push(`${T}-${o[T]}`))}),p.length>0&&e.container.classList.remove(...p),h.length>0&&e.container.classList.add(...h),r=Object.assign(r,o)}function u(p,h={}){const T=document.createElement("button");return T.className=`${U.CONTROL_BUTTON} ${h.className}`,T.setAttribute("title",h.title),h.container.appendChild(T),T.addEventListener("click",w=>{if(w.preventDefault(),w.stopPropagation(),w.target===n){f(),h.onDeactivate();return}y(p),h.onActivate()},!0),T}function f(){n&&(n.classList.remove(U.ACTIVE_BUTTON),n=null)}function y(p){f();const h=t[p];h&&h&&p!=="trash"&&(h.classList.add(U.ACTIVE_BUTTON),n=h)}function g(){const p=e.options.controls,h=document.createElement("div");return h.className=`${U.CONTROL_GROUP} ${U.CONTROL_BASE}`,p&&(p[G.POINT]&&(t[G.POINT]=u(G.POINT,{container:h,className:U.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(1)":""}`,onActivate:()=>e.events.changeMode(b.DRAW_POINT),onDeactivate:()=>e.events.trash()})),p[G.LINE]&&(t[G.LINE]=u(G.LINE,{container:h,className:U.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(2)":""}`,onActivate:()=>e.events.changeMode(b.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),p[G.POLYGON]&&(t[G.POLYGON]=u(G.POLYGON,{container:h,className:U.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(3)":""}`,onActivate:()=>e.events.changeMode(b.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),p.trash&&(t.trash=u("trash",{container:h,className:U.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),p.combine_features&&(t.combine_features=u("combineFeatures",{container:h,className:U.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),p.uncombine_features&&(t.uncombine_features=u("uncombineFeatures",{container:h,className:U.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),h}function a(){Object.keys(t).forEach(p=>{const h=t[p];h.parentNode&&h.parentNode.removeChild(h),delete t[p]})}return{setActiveButton:y,queueMapClasses:s,updateMapClasses:c,clearMapClasses:i,addButtons:g,removeButtons:a}}function Vn(e){let t=null,n=null;const r={onRemove(){return e.map.off("load",r.connect),clearInterval(n),r.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",r.connect),clearInterval(n),r.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(o){if(e.map=o,e.events=Dn(e),e.ui=Gn(e),e.container=o.getContainer(),e.store=new N(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=o.boxZoom.isEnabled(),o.boxZoom.disable();const i=o.dragPan.isEnabled();o.dragPan.disable(),o.dragPan.enable(),i||o.dragPan.disable()}return o.loaded()?r.connect():(o.on("load",r.connect),n=setInterval(()=>{o.loaded()&&r.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(j.COLD,{data:{type:m.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(j.HOT,{data:{type:m.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(o=>{e.map.addLayer(o)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(o=>{e.map.getLayer(o.id)&&e.map.removeLayer(o.id)}),e.map.getSource(j.COLD)&&e.map.removeSource(j.COLD),e.map.getSource(j.HOT)&&e.map.removeSource(j.HOT)}};return e.setup=r,r}const Pe="#3bb2d0",de="#fbb03b",it="#fff",Lt=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],de,Pe],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],de,Pe],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":it}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],de,Pe]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":it}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":de}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":de}}];function Q(e,t){this.x=e,this.y=t}Q.prototype={clone(){return new Q(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,o=n*this.x+t*this.y;return this.x=r,this.y=o,this},_rotateAround(e,t){const n=Math.cos(e),r=Math.sin(e),o=t.x+n*(this.x-t.x)-r*(this.y-t.y),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=o,this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Q};Q.convert=function(e){if(e instanceof Q)return e;if(Array.isArray(e))return new Q(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new Q(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function Ke(e,t){const n=t.getBoundingClientRect();return new Q(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function ie(e,t,n,r){return{type:m.FEATURE,properties:{meta:F.VERTEX,parent:e,coord_path:n,active:r?L.ACTIVE:L.INACTIVE},geometry:{type:m.POINT,coordinates:t}}}function jn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function wt(e,t,n){if(e!==null)for(var r,o,i,s,c,u,f,y=0,g=0,a,p=e.type,h=p==="FeatureCollection",T=p==="Feature",w=h?e.features.length:1,A=0;A<w;A++){f=h?e.features[A].geometry:T?e.geometry:e,a=f?f.type==="GeometryCollection":!1,c=a?f.geometries.length:1;for(var B=0;B<c;B++){var P=0,z=0;if(s=a?f.geometries[B]:f,s!==null){u=s.coordinates;var K=s.type;switch(y=0,K){case null:break;case"Point":if(t(u,g,A,P,z)===!1)return!1;g++,P++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(t(u[r],g,A,P,z)===!1)return!1;g++,K==="MultiPoint"&&P++}K==="LineString"&&P++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(o=0;o<u[r].length-y;o++){if(t(u[r][o],g,A,P,z)===!1)return!1;g++}K==="MultiLineString"&&P++,K==="Polygon"&&z++}K==="Polygon"&&P++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(z=0,o=0;o<u[r].length;o++){for(i=0;i<u[r][o].length-y;i++){if(t(u[r][o][i],g,A,P,z)===!1)return!1;g++}z++}P++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(wt(s.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $n(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return At(e);case"FeatureCollection":return Bn(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Xe(e);default:throw new Error("unknown GeoJSON type")}}function At(e){const t={type:"Feature"};return Object.keys(e).forEach(n=>{switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}}),t.properties=Pt(e.properties),e.geometry==null?t.geometry=null:t.geometry=Xe(e.geometry),t}function Pt(e){const t={};return e&&Object.keys(e).forEach(n=>{const r=e[n];typeof r=="object"?r===null?t[n]=null:Array.isArray(r)?t[n]=r.map(o=>o):t[n]=Pt(r):t[n]=r}),t}function Bn(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach(n=>{switch(n){case"type":case"features":return;default:t[n]=e[n]}}),t.features=e.features.map(n=>At(n)),t}function Xe(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),e.type==="GeometryCollection"?(t.geometries=e.geometries.map(n=>Xe(n)),t):(t.coordinates=Ft(e.coordinates),t)}function Ft(e){const t=e;return typeof t[0]!="object"?t.slice():t.map(n=>Ft(n))}function st(e,t={}){return Rt(e,"mercator",t)}function zn(e,t={}){return Rt(e,"wgs84",t)}function Rt(e,t,n={}){n=n||{};var r=n.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&jn(e[0])?e=t==="mercator"?at(e):lt(e):(r!==!0&&(e=$n(e)),wt(e,function(o){var i=t==="mercator"?at(o):lt(o);o[0]=i[0],o[1]=i[1]})),e}function at(e){var t=Math.PI/180,n=6378137,r=20037508342789244e-9,o=Math.abs(e[0])<=180?e[0]:e[0]-Hn(e[0])*360,i=[n*o*t,n*Math.log(Math.tan(Math.PI*.25+.5*e[1]*t))];return i[0]>r&&(i[0]=r),i[0]<-r&&(i[0]=-r),i[1]>r&&(i[1]=r),i[1]<-r&&(i[1]=-r),i}function lt(e){var t=180/Math.PI,n=6378137;return[e[0]*t/n,(Math.PI*.5-2*Math.atan(Math.exp(-e[1]/n)))*t]}function Hn(e){return e<0?-1:e>0?1:0}function Dt(e,t,n){const r=t.geometry.coordinates,o=n.geometry.coordinates;if(r[1]>Ue||r[1]<ke||o[1]>Ue||o[1]<ke)return null;const i=st(r),s=st(o),c=g=>Number(g.toFixed(8)),u=(g,a)=>(g+a)/2,f=zn([u(i[0],s[0]),u(i[1],s[1])]),y=[c(f[0]),c(f[1])];return{type:m.FEATURE,properties:{meta:F.MIDPOINT,parent:e,lng:y[0],lat:y[1],coord_path:n.properties.coord_path},geometry:{type:m.POINT,coordinates:y}}}function Ie(e,t={},n=null){const{type:r,coordinates:o}=e.geometry,i=e.properties&&e.properties.id;let s=[];r===m.POINT?s.push(ie(i,o,n,u(n))):r===m.POLYGON?o.forEach((y,g)=>{c(y,n!==null?`${n}.${g}`:String(g))}):r===m.LINE_STRING?c(o,n):r.indexOf(m.MULTI_PREFIX)===0&&f();function c(y,g){let a="",p=null;y.forEach((h,T)=>{const w=g!=null?`${g}.${T}`:String(T),A=ie(i,h,w,u(w));if(t.midpoints&&p){const P=Dt(i,p,A);P&&s.push(P)}p=A;const B=JSON.stringify(h);a!==B&&s.push(A),T===0&&(a=B)})}function u(y){return t.selectedPaths?t.selectedPaths.indexOf(y)!==-1:!1}function f(){const y=r.replace(m.MULTI_PREFIX,"");o.forEach((g,a)=>{const p={type:m.FEATURE,properties:e.properties,geometry:{type:y,coordinates:g}};s=s.concat(Ie(p,t,a))})}return s}const H={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:ye,LAT_MAX:Ee,LAT_RENDERED_MIN:ct,LAT_RENDERED_MAX:ut,LNG_MIN:dt,LNG_MAX:pt}=bt;function qn(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],n=[e.geometry.coordinates].flat(t),r=n.map(c=>c[0]),o=n.map(c=>c[1]),i=c=>Math.min.apply(null,c),s=c=>Math.max.apply(null,c);return[i(r),i(o),s(r),s(o)]}function We(e,t){let n=ye,r=Ee,o=ye,i=Ee,s=pt,c=dt;e.forEach(f=>{const y=qn(f),g=y[1],a=y[3],p=y[0],h=y[2];g>n&&(n=g),a<r&&(r=a),a>o&&(o=a),g<i&&(i=g),p<s&&(s=p),h>c&&(c=h)});const u=t;return n+u.lat>ut&&(u.lat=ut-n),o+u.lat>Ee&&(u.lat=Ee-o),r+u.lat<ct&&(u.lat=ct-r),i+u.lat<ye&&(u.lat=ye-i),s+u.lng<=dt&&(u.lng+=Math.ceil(Math.abs(u.lng)/360)*360),c+u.lng>=pt&&(u.lng-=Math.ceil(Math.abs(u.lng)/360)*360),u}function Ze(e,t){const n=We(e.map(r=>r.toGeoJSON()),t);e.forEach(r=>{const o=r.getCoordinates(),i=f=>{const y={lng:f[0]+n.lng,lat:f[1]+n.lat};return[y.lng,y.lat]},s=f=>f.map(y=>i(y)),c=f=>f.map(y=>s(y));let u;r.type===m.POINT?u=i(o):r.type===m.LINE_STRING||r.type===m.MULTI_POINT?u=o.map(i):r.type===m.POLYGON||r.type===m.MULTI_LINE_STRING?u=o.map(s):r.type===m.MULTI_POLYGON&&(u=o.map(c)),r.incomingCoords(u)})}const _={};_.onSetup=function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(n=>this.getFeature(n)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};_.fireUpdate=function(){this.fire(D.UPDATE,{action:pe.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};_.fireActionable=function(){const e=this.getSelected(),t=e.filter(i=>this.isInstanceOf("MultiFeature",i));let n=!1;if(e.length>1){n=!0;const i=e[0].type.replace("Multi","");e.forEach(s=>{s.type.replace("Multi","")!==i&&(n=!1)})}const r=t.length>0,o=e.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:r,trash:o})};_.getUniqueIds=function(e){return e.length?e.map(n=>n.properties.id).filter(n=>n!==void 0).reduce((n,r)=>(n.add(r),n),new $).values():[]};_.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};_.onStop=function(){H.enable(this)};_.onMouseMove=function(e,t){return qe(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};_.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};_.onTap=_.onClick=function(e,t){if(Se(t))return this.clickAnywhere(e,t);if(_e(F.VERTEX)(t))return this.clickOnVertex(e,t);if(qe(t))return this.clickOnFeature(e,t)};_.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(n=>this.doRender(n))),H.enable(this),this.stopExtendedInteractions(e)};_.clickOnVertex=function(e,t){this.changeMode(b.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:x.MOVE})};_.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};_.clickOnFeature=function(e,t){H.disable(this),this.stopExtendedInteractions(e);const n=Ce(t),r=this.getSelectedIds(),o=t.featureTarget.properties.id,i=this.isSelected(o);if(!n&&i&&this.getFeature(o).type!==m.POINT)return this.changeMode(b.DIRECT_SELECT,{featureId:o});i&&n?(this.deselect(o),this.updateUIClasses({mouse:x.POINTER}),r.length===1&&H.enable(this)):!i&&n?(this.select(o),this.updateUIClasses({mouse:x.MOVE})):!i&&!n&&(r.forEach(s=>this.doRender(s)),this.setSelected(o),this.updateUIClasses({mouse:x.MOVE})),this.doRender(o)};_.onMouseDown=function(e,t){if(e.initialDragPanState=this.map.dragPan.isEnabled(),re(t))return this.startOnActiveFeature(e,t);if(this.drawConfig.boxSelect&&Ct(t))return this.startBoxSelect(e,t)};_.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Ke(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};_.onTouchStart=function(e,t){if(re(t))return this.startOnActiveFeature(e,t)};_.onDrag=function(e,t){if(e.canDragMove)return this.dragMove(e,t);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,t)};_.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:x.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(U.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const n=Ke(t.originalEvent,this.map.getContainer()),r=Math.min(e.boxSelectStartLocation.x,n.x),o=Math.max(e.boxSelectStartLocation.x,n.x),i=Math.min(e.boxSelectStartLocation.y,n.y),s=Math.max(e.boxSelectStartLocation.y,n.y),c=`translate(${r}px, ${i}px)`;e.boxSelectElement.style.transform=c,e.boxSelectElement.style.WebkitTransform=c,e.boxSelectElement.style.width=`${o-r}px`,e.boxSelectElement.style.height=`${s-i}px`};_.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};Ze(this.getSelected(),n),e.dragMoveLocation=t.lngLat};_.onTouchEnd=_.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const n=[e.boxSelectStartLocation,Ke(t.originalEvent,this.map.getContainer())],r=this.featuresAt(null,n,"click"),o=this.getUniqueIds(r).filter(i=>!this.isSelected(i));o.length&&(this.select(o),o.forEach(i=>this.doRender(i)),this.updateUIClasses({mouse:x.MOVE}))}this.stopExtendedInteractions(e)};_.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?L.ACTIVE:L.INACTIVE,n(t),this.fireActionable(),!(t.properties.active!==L.ACTIVE||t.geometry.type===m.POINT)&&Ie(t).forEach(n)};_.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};_.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const t=[],n=[],r=e[0].type.replace("Multi","");for(let o=0;o<e.length;o++){const i=e[o];if(i.type.replace("Multi","")!==r)return;i.type.includes("Multi")?i.getCoordinates().forEach(s=>{t.push(s)}):t.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){const o=this.newFeature({type:m.FEATURE,properties:n[0].properties,geometry:{type:`Multi${r}`,coordinates:t}});this.addFeature(o),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([o.id]),this.fire(D.COMBINE_FEATURES,{createdFeatures:[o.toGeoJSON()],deletedFeatures:n})}this.fireActionable()};_.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const t=[],n=[];for(let r=0;r<e.length;r++){const o=e[r];this.isInstanceOf("MultiFeature",o)&&(o.getFeatures().forEach(i=>{this.addFeature(i),i.properties=o.properties,t.push(i.toGeoJSON()),this.select([i.id])}),this.deleteFeature(o.id,{silent:!0}),n.push(o.toGeoJSON()))}t.length>1&&this.fire(D.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:n}),this.fireActionable()};const kt=_e(F.VERTEX),Ut=_e(F.MIDPOINT),S={};S.fireUpdate=function(){this.fire(D.UPDATE,{action:pe.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};S.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};S.startDragging=function(e,t){e.initialDragPanState==null&&(e.initialDragPanState=this.map.dragPan.isEnabled()),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat};S.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.initialDragPanState=null,e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};S.onVertex=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties,r=e.selectedCoordPaths.indexOf(n.coord_path);!Ce(t)&&r===-1?e.selectedCoordPaths=[n.coord_path]:Ce(t)&&r===-1&&e.selectedCoordPaths.push(n.coord_path);const o=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(o)};S.onMidpoint=function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]};S.pathsToCoordinates=function(e,t){return t.map(n=>({feature_id:e,coord_path:n}))};S.onFeature=function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)};S.dragFeature=function(e,t,n){Ze(this.getSelected(),n),e.dragMoveLocation=t.lngLat};S.dragVertex=function(e,t,n){const r=e.selectedCoordPaths.map(s=>e.feature.getCoordinate(s)),o=r.map(s=>({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:s}})),i=We(o,n);for(let s=0;s<r.length;s++){const c=r[s];e.feature.updateCoordinate(e.selectedCoordPaths[s],c[0]+i.lng,c[1]+i.lat)}};S.clickNoTarget=function(){this.changeMode(b.SIMPLE_SELECT)};S.clickInactive=function(){this.changeMode(b.SIMPLE_SELECT)};S.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};S.onSetup=function(e){const t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===m.POINT)throw new TypeError("direct_select mode doesn't handle point features");const r={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,r.selectedCoordPaths)),this.setSelected(t),H.disable(this),this.setActionableState({trash:!0}),r};S.onStop=function(){H.enable(this),this.clearSelectedCoordinates()};S.toDisplayFeatures=function(e,t,n){e.featureId===t.properties.id?(t.properties.active=L.ACTIVE,n(t),Ie(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=L.INACTIVE,n(t)),this.fireActionable(e)};S.onTrash=function(e){e.selectedCoordPaths.sort((t,n)=>n.localeCompare(t,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(b.SIMPLE_SELECT,{}))};S.onMouseMove=function(e,t){const n=re(t),r=kt(t),o=Ut(t),i=e.selectedCoordPaths.length===0;return n&&i?this.updateUIClasses({mouse:x.MOVE}):r&&!i?this.updateUIClasses({mouse:x.MOVE}):this.updateUIClasses({mouse:x.NONE}),(r||n||o)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};S.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};S.onTouchStart=S.onMouseDown=function(e,t){if(kt(t))return this.onVertex(e,t);if(re(t))return this.onFeature(e,t);if(Ut(t))return this.onMidpoint(e,t)};S.onDrag=function(e,t){if(e.canDragMove!==!0)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat};S.onClick=function(e,t){if(Se(t))return this.clickNoTarget(e,t);if(re(t))return this.clickActiveFeature(e,t);if(He(t))return this.clickInactive(e,t);this.stopDragging(e)};S.onTap=function(e,t){if(Se(t))return this.clickNoTarget(e,t);if(re(t))return this.clickActiveFeature(e,t);if(He(t))return this.clickInactive(e,t)};S.onTouchEnd=S.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const X={};X.onSetup=function(){const e=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:x.ADD}),this.activateUIButton(G.POINT),this.setActionableState({trash:!0}),{point:e}};X.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(b.SIMPLE_SELECT)};X.onTap=X.onClick=function(e,t){this.updateUIClasses({mouse:x.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(D.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(b.SIMPLE_SELECT,{featureIds:[e.point.id]})};X.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};X.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.point.id;if(t.properties.active=r?L.ACTIVE:L.INACTIVE,!r)return n(t)};X.onTrash=X.stopDrawingAndRemove;X.onKeyUp=function(e,t){if(ve(t)||Ne(t))return this.stopDrawingAndRemove(e,t)};function Te(e,t){return e.lngLat?e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]:!1}const q={};q.onSetup=function(){const e=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),H.disable(this),this.updateUIClasses({mouse:x.ADD}),this.activateUIButton(G.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};q.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&Te(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(b.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:x.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)};q.clickOnVertex=function(e){return this.changeMode(b.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};q.onMouseMove=function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),fe(t)&&this.updateUIClasses({mouse:x.POINTER})};q.onTap=q.onClick=function(e,t){return fe(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)};q.onKeyUp=function(e,t){ve(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(b.SIMPLE_SELECT)):Ne(t)&&this.changeMode(b.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};q.onStop=function(e){this.updateUIClasses({mouse:x.NONE}),H.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(D.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(b.SIMPLE_SELECT,{},{silent:!0})))};q.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.polygon.id;if(t.properties.active=r?L.ACTIVE:L.INACTIVE,!r)return n(t);if(t.geometry.coordinates.length===0)return;const o=t.geometry.coordinates[0].length;if(!(o<3)){if(t.properties.meta=F.FEATURE,n(ie(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),o>3){const i=t.geometry.coordinates[0].length-3;n(ie(e.polygon.id,t.geometry.coordinates[0][i],`0.${i}`,!1))}if(o<=4){const i=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:m.FEATURE,properties:t.properties,geometry:{coordinates:i,type:m.LINE_STRING}}),o===3)return}return n(t)}};q.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(b.SIMPLE_SELECT)};const J={};J.onSetup=function(e){e=e||{};const t=e.featureId;let n,r,o="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let i=e.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");const s=n.coordinates.length-1;if(n.coordinates[s][0]===i[0]&&n.coordinates[s][1]===i[1])r=s+1,n.addCoordinate(r,...n.coordinates[s]);else if(n.coordinates[0][0]===i[0]&&n.coordinates[0][1]===i[1])o="backwards",r=0,n.addCoordinate(r,...n.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else n=this.newFeature({type:m.FEATURE,properties:{},geometry:{type:m.LINE_STRING,coordinates:[]}}),r=0,this.addFeature(n);return this.clearSelectedFeatures(),H.disable(this),this.updateUIClasses({mouse:x.ADD}),this.activateUIButton(G.LINE),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:r,direction:o}};J.clickAnywhere=function(e,t){if(e.currentVertexPosition>0&&Te(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&Te(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(b.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:x.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};J.clickOnVertex=function(e){return this.changeMode(b.SIMPLE_SELECT,{featureIds:[e.line.id]})};J.onMouseMove=function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),fe(t)&&this.updateUIClasses({mouse:x.POINTER})};J.onTap=J.onClick=function(e,t){if(fe(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)};J.onKeyUp=function(e,t){Ne(t)?this.changeMode(b.SIMPLE_SELECT,{featureIds:[e.line.id]}):ve(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(b.SIMPLE_SELECT))};J.onStop=function(e){H.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(D.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(b.SIMPLE_SELECT,{},{silent:!0})))};J.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(b.SIMPLE_SELECT)};J.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.line.id;if(t.properties.active=r?L.ACTIVE:L.INACTIVE,!r)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=F.FEATURE,n(ie(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],`${e.direction==="forward"?t.geometry.coordinates.length-2:1}`,!1)),n(t))};const Gt={simple_select:_,direct_select:S,draw_point:X,draw_polygon:q,draw_line_string:J},Jn={defaultMode:b.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Lt,modes:Gt,controls:{},userProperties:!1,suppressAPIEvents:!0},Yn={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Kn={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ft(e,t){return e.map(n=>n.source?n:Object.assign({},n,{id:`${n.id}.${t}`,source:t==="hot"?j.HOT:j.COLD}))}function Xn(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),e.displayControlsDefault===!1?t.controls=Object.assign({},Kn,e.controls):t.controls=Object.assign({},Yn,e.controls),t=Object.assign({},Jn,t),t.styles=ft(t.styles,"cold").concat(ft(t.styles,"hot")),t}var Fe,ht;function Wn(){return ht||(ht=1,Fe=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,o,i;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(o=r;o--!==0;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(i=Object.keys(t),r=i.length,r!==Object.keys(n).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[o]))return!1;for(o=r;o--!==0;){var s=i[o];if(!e(t[s],n[s]))return!1}return!0}return t!==t&&n!==n}),Fe}var Zn=Wn();const gt=ze(Zn);var Re,mt;function Qn(){if(mt)return Re;mt=1,Re=t;var e={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function t(n){if(!n||!n.type)return null;var r=e[n.type];if(!r)return null;if(r==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:n}]};if(r==="feature")return{type:"FeatureCollection",features:[n]};if(r==="featurecollection")return n}return Re}var er=Qn();const tr=ze(er);function Vt(e,t){return e.length!==t.length?!1:JSON.stringify(e.map(n=>n).sort())===JSON.stringify(t.map(n=>n).sort())}const nr={Polygon:V,LineString:W,Point:ee,MultiPolygon:R,MultiLineString:R,MultiPoint:R};function rr(e,t){t.modes=b;const n=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return t.getFeatureIdsAt=function(r){return oe.click({point:r},null,e).map(i=>i.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:m.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(r=>e.store.get(r)).map(r=>r.toGeoJSON())}},t.getSelectedPoints=function(){return{type:m.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(r=>({type:m.FEATURE,properties:{},geometry:{type:m.POINT,coordinates:r.coordinates}}))}},t.set=function(r){if(r.type===void 0||r.type!==m.FEATURE_COLLECTION||!Array.isArray(r.features))throw new Error("Invalid FeatureCollection");const o=e.store.createRenderBatch();let i=e.store.getAllIds().slice();const s=t.add(r),c=new $(s);return i=i.filter(u=>!c.has(u)),i.length&&t.delete(i),o(),s},t.add=function(r){const i=JSON.parse(JSON.stringify(tr(r))).features.map(s=>{if(s.id=s.id||Ye(),s.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(s.id)===void 0||e.store.get(s.id).type!==s.geometry.type){const c=nr[s.geometry.type];if(c===void 0)throw new Error(`Invalid geometry type: ${s.geometry.type}.`);const u=new c(e,s);e.store.add(u,{silent:n})}else{const c=e.store.get(s.id),u=c.properties;c.properties=s.properties,gt(u,s.properties)||e.store.featureChanged(c.id,{silent:n}),gt(c.getCoordinates(),s.geometry.coordinates)||c.incomingCoords(s.geometry.coordinates)}return s.id});return e.store.render(),i},t.get=function(r){const o=e.store.get(r);if(o)return o.toGeoJSON()},t.getAll=function(){return{type:m.FEATURE_COLLECTION,features:e.store.getAll().map(r=>r.toGeoJSON())}},t.delete=function(r){return e.store.delete(r,{silent:n}),t.getMode()===b.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(b.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:n}),t.getMode()===b.DIRECT_SELECT?e.events.changeMode(b.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.changeMode=function(r,o={}){return r===b.SIMPLE_SELECT&&t.getMode()===b.SIMPLE_SELECT?(Vt(o.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(o.featureIds,{silent:n}),e.store.render()),t):(r===b.DIRECT_SELECT&&t.getMode()===b.DIRECT_SELECT&&o.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(r,o,{silent:n}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:n}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:n}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:n}),t},t.setFeatureProperty=function(r,o,i){return e.store.setFeatureProperty(r,o,i,{silent:n}),t},t}const or=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:yn,ModeHandler:Be,StringSet:$,constrainFeatureMovement:We,createMidPoint:Dt,createSupplementaryPoints:Ie,createVertex:ie,doubleClickZoom:H,euclideanDistance:Je,featuresAt:oe,getFeatureAtAndSetCursors:be,isClick:je,isEventAtCoordinates:Te,isTap:$e,mapEventToBoundingBox:xt,moveFeatures:Ze,sortFeatures:Nt,stringSetsAreEqual:Vt,theme:Lt,toDenseArray:he},Symbol.toStringTag,{value:"Module"})),ir=function(e,t){e=Xn(e);const n={options:e};t=rr(n,t),n.api=t;const r=Vn(n);return t.onAdd=r.onAdd,t.onRemove=r.onRemove,t.types=G,t.options=e,t};function Me(e){ir(e,this)}Me.modes=Gt;Me.constants=bt;Me.lib=or;const sr=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],yt=Y("check",sr);const ar=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],lr=Y("clipboard-list",ar);const cr=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],ur=Y("globe",cr);const dr=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],pr=Y("hash",dr);const fr=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],hr=Y("house",fr);const gr=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],mr=Y("mouse-pointer-2",gr);const yr=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],Er=Y("pen-tool",yr);const br=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],Cr=Y("redo-2",br);const Tr=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],_r=Y("save",Tr);const Sr=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],vr=Y("undo-2",Sr);const Nr=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],xr=Y("wind",Nr),De={water:{label:" ",color:"#3b82f6",icon:on,nodeTypes:[{type:"water_tank",label:" ",icon:"",canFeedNeighborhood:!0},{type:"pump",label:" ",icon:"",canFeedNeighborhood:!0},{type:"valve",label:" ()",icon:""}],lineTypes:[{type:"water_pipe_main",label:" ",icon:""},{type:"water_pipe_distribution",label:" ",icon:""}]},electricity:{label:" ",color:"#eab308",icon:rn,nodeTypes:[{type:"transformer",label:" ",icon:"",canFeedNeighborhood:!0},{type:"pole",label:" ",icon:""},{type:"generator",label:"",icon:"",canFeedNeighborhood:!0}],lineTypes:[{type:"power_cable_underground",label:" ",icon:""},{type:"power_line_overhead",label:" ",icon:""}]},sewage:{label:" ",color:"#78350f",icon:xr,nodeTypes:[{type:"manhole",label:" (Manhole)",icon:""}],lineTypes:[{type:"sewage_pipe",label:" ",icon:""}]},phone:{label:"",color:"#10b981",icon:nn,nodeTypes:[{type:"exchange",label:"",icon:""},{type:"cabinet",label:" ",icon:""}],lineTypes:[{type:"telecom_cable",label:" ",icon:""}]}},Ir=["","","","","","","",""];function Gr({auth:e,sector:t}){const n=I.useRef(null),r=I.useRef(null),o=I.useRef(null),[i,s]=I.useState("select"),[c,u]=I.useState(""),[f,y]=I.useState(!1),[g,a]=I.useState(null),[p,h]=I.useState(""),[T,w]=I.useState(""),[A,B]=I.useState("good"),[P,z]=I.useState(""),[K,Qe]=I.useState([]),[se,Oe]=I.useState([]),[ae,Le]=I.useState([]),[et,jt]=I.useState(!1),we=I.useRef(c),ge=I.useRef(i);I.useEffect(()=>{we.current=c},[c]),I.useEffect(()=>{ge.current=i},[i]);const O=De[t]||De.water;I.useEffect(()=>{O&&!c&&u(O.nodeTypes[0].type)},[t]),I.useEffect(()=>{g?(h(g.properties.meta?.assigned_neighborhood||""),w(g.properties.serial_number||""),B(g.properties.status||"active"),z(g.properties.meta?.notes||""),$t(g)):(w(""),z(""),Qe([]))},[g]);const $t=async d=>{try{const C=await ne.get("/admin/api/infrastructure/asset-reports",{params:{type:d.layer.includes("nodes")?"node":"line",id:d.id}});Qe(C.data)}catch(C){console.error("Failed to fetch reports",C)}};I.useEffect(()=>{r.current||n.current&&(r.current=new tt.Map({container:n.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap"}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:[36.236,33.456],zoom:15}),o.current=new Me({displayControlsDefault:!1,styles:[{id:"gl-draw-line",type:"line",filter:["all",["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":O?.color||"#333","line-dasharray":["case",["==",["get","is_published"],!1],["literal",[2,2]],["literal",[1,0]]],"line-width":4}},{id:"gl-draw-point",type:"circle",filter:["all",["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":8,"circle-color":O?.color||"#333","circle-stroke-width":2,"circle-stroke-color":"#fff","circle-opacity":.7}}]}),r.current.addControl(o.current,"top-left"),r.current.addControl(new tt.NavigationControl,"bottom-right"),r.current.on("load",()=>le()),r.current.on("draw.create",d=>{Ae(),Jt(d.features[0])}),r.current.on("draw.update",()=>{Ae()}),r.current.on("draw.delete",()=>{Ae()}),r.current.on("click",d=>{const C=r.current?.queryRenderedFeatures(d.point);if(C&&C.length>0&&C[0].properties?.id){const v=C[0].properties;a({id:v.id,type:v.type,layer:C[0].layer.id,properties:v})}}))},[t]);const Ae=()=>{if(!o.current)return;const d=o.current.getAll();Oe(C=>[...C.slice(-19),d]),Le([])},Bt=()=>{if(se.length===0||!o.current)return;const d=o.current.getAll(),C=se[se.length-1];Le(v=>[...v,d]),Oe(v=>v.slice(0,-1)),o.current.set(C)},zt=()=>{if(ae.length===0||!o.current)return;o.current.getAll();const d=ae[ae.length-1];Oe(C=>[...C,d]),Le(C=>C.slice(0,-1)),o.current.set(d)},le=async()=>{try{y(!0);const{data:d}=await ne.get("/admin/api/infrastructure"),C=d.nodes.filter(M=>O.nodeTypes.some(te=>te.type===M.type)),v=d.lines.filter(M=>O.lineTypes.some(te=>te.type===M.type)),Z=d.nodes.some(M=>!M.is_published&&O.nodeTypes.some(te=>te.type===M.type))||d.lines.some(M=>!M.is_published&&O.lineTypes.some(te=>te.type===M.type));jt(Z),Ht(v,C)}catch(d){console.error("Failed to fetch data",d)}finally{y(!1)}},Ht=(d,C)=>{if(!r.current)return;const v=`net-${t}`,Z={type:"FeatureCollection",features:[...d.map(M=>({type:"Feature",geometry:{type:"LineString",coordinates:M.coordinates},properties:{id:M.id,type:M.type,meta:M.meta,is_published:M.is_published}})),...C.map(M=>({type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(M.longitude),parseFloat(M.latitude)]},properties:{id:M.id,type:M.type,meta:M.meta,is_published:M.is_published}}))]};r.current.getSource(v)?r.current.getSource(v).setData(Z):(r.current.addSource(v,{type:"geojson",data:Z}),r.current.addLayer({id:`${v}-lines`,type:"line",source:v,filter:["==","$type","LineString"],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":O?.color||"#333","line-width":4,"line-opacity":.8,"line-dasharray":["case",["==",["get","is_published"],!1],["literal",[2,2]],["literal",[1,0]]]}}),r.current.addLayer({id:`${v}-nodes`,type:"circle",source:v,filter:["==","$type","Point"],paint:{"circle-radius":6,"circle-color":O?.color||"#333","circle-stroke-width":2,"circle-stroke-color":"#fff","circle-opacity":["case",["==",["get","is_published"],!1],.5,1]}}))},ce=(d,C)=>{s(d),C&&u(C),o.current&&(d==="select"?o.current.changeMode("simple_select"):d==="line"?o.current.changeMode("draw_line_string"):d==="point"&&o.current.changeMode("draw_point"))},qt=()=>{o.current&&o.current.changeMode("simple_select")},Jt=async d=>{const C=we.current;if(!C){alert("       "),o.current?.delete(d.id);return}try{if(d.geometry.type==="Point")await ne.post("/admin/api/infrastructure/nodes",{type:C,latitude:d.geometry.coordinates[1],longitude:d.geometry.coordinates[0],status:"active"});else{if(d.geometry.coordinates.length<2){o.current?.delete(d.id);return}await ne.post("/admin/api/infrastructure/lines",{type:C,coordinates:d.geometry.coordinates,status:"active"})}o.current?.deleteAll(),ge.current==="point"||ge.current==="line"?ce(ge.current,we.current):ce("select"),le()}catch(v){const Z=v.response?.data?.message||v.message||"  ";alert(` : ${Z}`),console.error(v),o.current?.delete(d.id)}},Yt=async()=>{if(confirm("          "))try{y(!0),await ne.post("/admin/api/infrastructure/publish-all",{sector:t}),alert("    "),le()}catch{alert("  ")}finally{y(!1)}},Kt=()=>{alert("   .     .")},Xt=async()=>{if(g)try{y(!0);const d=g.layer.includes("nodes")?"nodes":"lines",v={...typeof g.properties.meta=="string"?JSON.parse(g.properties.meta||"{}"):g.properties.meta||{},assigned_neighborhood:p,notes:P};await ne.put(`/admin/api/infrastructure/${d}/${g.id}`,{serial_number:T,status:A,meta:v}),alert("   "),le()}catch(d){const C=d.response?.data?.message||d.message||"  ";alert(` : ${C}`),console.error(d)}finally{y(!1)}},Wt=async()=>{if(!(!g||!confirm("    ")))try{y(!0);const d=g.layer.includes("nodes")?"nodes":"lines";await ne.delete(`/admin/api/infrastructure/${d}/${g.id}`),a(null),le()}catch{alert(" ")}finally{y(!1)}},Zt=I.useMemo(()=>{if(!g)return!1;const d=g.properties.type;return(g.layer.includes("nodes")?O.nodeTypes:O.lineTypes).find(Z=>Z.type===d)?.canFeedNeighborhood||!1},[g,O]);return l.jsxs(tn,{user:e.user,children:[l.jsx(Qt,{title:` ${O.label}`}),l.jsxs("div",{className:"relative flex h-[calc(100vh-64px)] w-full overflow-hidden bg-slate-100",dir:"rtl",children:[l.jsx("div",{className:"absolute top-4 left-4 z-20 flex gap-2",children:Object.entries(De).map(([d,C])=>{const v=C.icon;return l.jsxs(en,{href:route("admin.infrastructure.sector.editor",{sector:d}),className:`flex items-center gap-2 px-4 py-2 rounded-xl border shadow-sm transition-all ${t===d?"bg-slate-900 border-slate-900 text-white shadow-lg":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50"}`,children:[l.jsx(v,{size:16}),l.jsx("span",{className:"text-sm font-bold",children:C.label})]},d)})}),l.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 z-20 flex items-center gap-3",children:l.jsxs("div",{className:"bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-slate-200 p-2 flex items-center gap-2",children:[l.jsx("button",{onClick:Bt,disabled:se.length===0,className:`p-3 rounded-xl transition-all ${se.length===0?"text-slate-300":"text-slate-700 hover:bg-slate-100"}`,title:" (Undo)",children:l.jsx(vr,{size:20})}),l.jsx("button",{onClick:zt,disabled:ae.length===0,className:`p-3 rounded-xl transition-all ${ae.length===0?"text-slate-300":"text-slate-700 hover:bg-slate-100"}`,title:" (Redo)",children:l.jsx(Cr,{size:20})}),l.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("button",{onClick:Kt,className:"flex items-center gap-2 px-6 py-3 rounded-xl font-bold text-sm bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 transition-all shadow-sm",children:[l.jsx(_r,{size:18,className:"text-slate-400"})," "]}),l.jsxs("button",{onClick:Yt,disabled:!et,className:`flex items-center gap-2 px-6 py-3 rounded-xl font-black text-sm transition-all ${et?"bg-emerald-600 text-white shadow-lg shadow-emerald-200 hover:bg-emerald-700":"bg-slate-100 text-slate-400 cursor-not-allowed"}`,children:[l.jsx(ur,{size:18}),"   (Live)"]})]})]})}),l.jsxs("div",{className:"absolute top-4 right-4 z-10 flex flex-col gap-3",children:[l.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-slate-200 p-3 flex flex-col gap-3 w-64",children:[l.jsxs("div",{className:"p-3 border-b border-slate-100 mb-1 flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:O.color}}),l.jsx("h3",{className:"font-bold text-slate-800",children:O.label})]}),l.jsx("button",{onClick:()=>ce("select"),className:`p-1.5 rounded-lg ${i==="select"?"bg-slate-100 text-slate-900":"text-slate-400 hover:bg-slate-50"}`,children:l.jsx(mr,{size:18})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-[10px] font-bold text-slate-400 mb-3 block px-1 uppercase tracking-wider",children:"  (Nodes)"}),l.jsx("div",{className:"grid grid-cols-1 gap-2",children:O.nodeTypes.map(d=>l.jsxs("button",{onClick:()=>ce("point",d.type),className:`flex items-center gap-3 p-3 rounded-xl text-right transition-all border ${i==="point"&&c===d.type?"bg-emerald-50 text-emerald-700 border-emerald-200 shadow-sm":"bg-white border-transparent hover:border-slate-200 text-slate-600"}`,children:[l.jsx("span",{className:"text-2xl filter drop-shadow-sm",children:d.icon}),l.jsx("span",{className:"text-sm font-bold flex-1",children:d.label}),i==="point"&&c===d.type&&l.jsx(sn,{size:14,className:"text-emerald-500"})]},d.type))})]}),l.jsxs("div",{className:"mt-2",children:[l.jsx("label",{className:"text-[10px] font-bold text-slate-400 mb-3 block px-1 uppercase tracking-wider",children:"  (Lines)"}),l.jsx("div",{className:"grid grid-cols-1 gap-2",children:O.lineTypes.map(d=>l.jsxs("button",{onClick:()=>ce("line",d.type),className:`flex items-center gap-3 p-3 rounded-xl text-right transition-all border ${i==="line"&&c===d.type?"bg-blue-50 text-blue-700 border-blue-200 shadow-sm":"bg-white border-transparent hover:border-slate-200 text-slate-600"}`,children:[l.jsx("span",{className:"text-2xl filter drop-shadow-sm",children:d.icon}),l.jsx("span",{className:"text-sm font-bold flex-1",children:d.label}),i==="line"&&c===d.type&&l.jsx(Er,{size:14,className:"text-blue-500"})]},d.type))})]})]}),i!=="select"&&l.jsxs("button",{onClick:qt,className:"bg-emerald-600 text-white rounded-xl shadow-lg border border-emerald-500 p-4 font-bold flex items-center justify-center gap-2 hover:bg-emerald-700 animate-in slide-in-from-bottom-5",children:[l.jsx(yt,{size:20}),"  "]})]}),l.jsx("div",{ref:n,className:"relative h-full flex-1"}),g&&l.jsxs("div",{className:"animate-in slide-in-from-left-4 absolute left-4 bottom-4 z-10 w-80 rounded-2xl border border-slate-200 bg-white/95 backdrop-blur-md p-5 shadow-2xl",children:[l.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[l.jsxs("h3",{className:"flex items-center gap-2 font-bold text-slate-800",children:[l.jsx(ln,{size:18,className:"text-blue-500"})," "]}),l.jsx("button",{onClick:()=>a(null),className:"text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded-lg",children:""})]}),l.jsxs("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-1 custom-scrollbar",children:[l.jsxs("div",{className:"bg-slate-50/50 p-4 rounded-xl border border-slate-100 flex justify-between items-center",children:[l.jsxs("div",{children:[l.jsx("div",{className:"text-[10px] font-bold text-slate-400 mb-1 uppercase",children:" "}),l.jsx("div",{className:"font-bold text-slate-800",children:g.properties.type})]}),l.jsxs("div",{className:"text-right",children:[l.jsx("div",{className:"text-[10px] font-bold text-slate-400 mb-1 uppercase",children:" "}),l.jsxs("div",{className:"text-xs font-mono bg-white px-2 py-0.5 rounded border",children:["ID-",g.id]})]})]}),l.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[l.jsxs("div",{children:[l.jsxs("label",{className:"block text-xs font-bold text-slate-700 mb-2 flex items-center gap-1",children:[l.jsx(pr,{size:14,className:"text-slate-400"}),"  (Serial No.)"]}),l.jsx("input",{type:"text",value:T,onChange:d=>w(d.target.value),placeholder:": TR-2024-001",className:"w-full rounded-xl border-slate-200 text-sm py-2.5 focus:ring-slate-900 focus:border-slate-900 shadow-sm bg-white"})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-xs font-bold text-slate-700 mb-2 flex items-center gap-1",children:[l.jsx(cn,{size:14,className:"text-slate-400"})," "]}),l.jsxs("select",{value:A,onChange:d=>B(d.target.value),className:"w-full rounded-xl border-slate-200 text-sm py-2.5 focus:ring-slate-900 focus:border-slate-900 shadow-sm bg-white",children:[l.jsx("option",{value:"active",children:" (Active)"}),l.jsx("option",{value:"maintenance",children:"  (Maintenance)"}),l.jsx("option",{value:"broken",children:" (Broken)"}),l.jsx("option",{value:"planned",children:"  (Planned)"})]})]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-xs font-bold text-slate-700 mb-2 flex items-center gap-1",children:[l.jsx(un,{size:14,className:"text-slate-400"}),"  "]}),l.jsx("textarea",{value:P,onChange:d=>z(d.target.value),placeholder:"     ...",className:"w-full rounded-xl border-slate-200 text-sm py-2.5 focus:ring-slate-900 focus:border-slate-900 shadow-sm bg-white min-h-[80px]"})]}),Zt&&l.jsxs("div",{children:[l.jsxs("label",{className:"block text-xs font-bold text-slate-700 mb-2 flex items-center gap-1",children:[l.jsx(hr,{size:14,className:"text-slate-400"})," "]}),l.jsxs("select",{value:p,onChange:d=>h(d.target.value),className:"w-full rounded-xl border-slate-200 text-sm py-2.5 focus:ring-slate-900 focus:border-slate-900 shadow-sm bg-white",children:[l.jsx("option",{value:"",children:" ..."}),Ir.map(d=>l.jsx("option",{value:d,children:d},d))]})]}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-xs font-bold text-slate-700 mb-3 flex items-center gap-1",children:[l.jsx(lr,{size:14,className:"text-slate-400"}),"  (",K.length,")"]}),l.jsxs("div",{className:"space-y-2",children:[K.map(d=>l.jsxs("div",{className:"p-3 bg-amber-50 rounded-xl border border-amber-100 flex gap-2 items-start",children:[l.jsx(an,{size:14,className:"text-amber-500 mt-0.5 shrink-0"}),l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"text-[10px] font-bold text-amber-800 mb-1",children:new Date(d.created_at).toLocaleDateString("ar-SY")}),l.jsx("div",{className:"text-xs text-amber-900 leading-snug",children:d.description})]})]},d.id)),K.length===0&&l.jsx("div",{className:"text-center py-4 text-slate-400 text-xs italic bg-slate-50 rounded-xl border border-dashed",children:"   "})]})]}),l.jsxs("div",{className:"pt-2 flex flex-col gap-2",children:[l.jsxs("button",{onClick:Xt,className:"w-full py-4 bg-slate-900 text-white font-black rounded-xl hover:bg-slate-800 flex items-center justify-center gap-2 shadow-lg shadow-slate-200",children:[l.jsx(yt,{size:20}),"   "]}),l.jsxs("button",{onClick:Wt,className:"w-full py-3 bg-rose-50 text-rose-600 font-bold rounded-xl hover:bg-rose-100 flex items-center justify-center gap-2 transition-colors border border-rose-100 mt-2",children:[l.jsx(dn,{size:18}),"   "]})]})]})]}),f&&l.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-white/40 backdrop-blur-[2px]",children:l.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-slate-200 border-t-slate-800"})})]})]})}export{Gr as default};
