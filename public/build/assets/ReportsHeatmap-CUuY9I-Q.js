import{r,d as m,j as e,H as u}from"./app-uhljFjo-.js";import{A as x}from"./AdminLayout-BVqxDbRV.js";import{m as g}from"./maplibre-gl-CURxyQ9M.js";function f({auth:l}){const a=r.useRef(null),t=r.useRef(null),[n,i]=r.useState(!0);r.useEffect(()=>{if(a.current)return t.current=new g.Map({container:a.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap"}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:[36.236,33.456],zoom:14}),t.current.on("load",()=>{c()}),()=>{t.current?.remove()}},[]);const c=async()=>{try{const d=(await m.get("/api/reports/heatmap")).data;if(!t.current)return;const p=d.map(s=>({type:"Feature",geometry:{type:"Point",coordinates:[s[1],s[0]]},properties:{intensity:s[2]}}));t.current.addSource("reports",{type:"geojson",data:{type:"FeatureCollection",features:p}}),t.current.addLayer({id:"reports-heatmap",type:"heatmap",source:"reports",maxzoom:18,paint:{"heatmap-weight":["interpolate",["linear"],["get","intensity"],0,0,1,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,15,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,18,1]}}),t.current.addLayer({id:"reports-point",type:"circle",source:"reports",minzoom:14,paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,["interpolate",["linear"],["get","intensity"],1,1,6,4],16,["interpolate",["linear"],["get","intensity"],1,5,6,50]],"circle-color":["interpolate",["linear"],["get","intensity"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"circle-stroke-color":"white","circle-stroke-width":1,"circle-opacity":["interpolate",["linear"],["zoom"],7,0,8,1]}}),i(!1)}catch(o){console.error("Failed to fetch heatmap data",o),i(!1)}};return e.jsxs(x,{user:l.user,header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:"خريطة البلاغات الحرارية"}),children:[e.jsx(u,{title:"خريطة البلاغات"}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"relative overflow-hidden bg-white shadow-sm dark:bg-gray-800 sm:rounded-lg",children:e.jsxs("div",{className:"relative h-[600px] p-6 text-gray-900 dark:text-gray-100",children:[e.jsx("div",{ref:a,className:"absolute inset-0 h-full w-full"}),n&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-white/50 backdrop-blur dark:bg-black/50",children:e.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-b-2 border-emerald-600"})}),e.jsxs("div",{className:"absolute right-4 top-4 z-10 max-w-xs rounded-xl border border-slate-200 bg-white/90 p-4 shadow-lg backdrop-blur dark:border-slate-700 dark:bg-slate-800/90",children:[e.jsx("h3",{className:"mb-2 text-sm font-bold",children:"مؤشر الكثافة"}),e.jsx("div",{className:"mb-1 flex items-center gap-2",children:e.jsx("div",{className:"h-2 w-full rounded-full bg-gradient-to-r from-blue-200 via-orange-300 to-red-600"})}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500",children:[e.jsx("span",{children:"منخفض"}),e.jsx("span",{children:"عالي"})]}),e.jsx("p",{className:"mt-2 text-[10px] leading-relaxed text-slate-400",children:"تعرض الخريطة أماكن تركز البلاغات المقدمة من المواطنين. المناطق الحمراء تشير إلى عدد كبير من البلاغات أو بلاغات ذات خطورة عالية."})]})]})})})})]})}export{f as default};
