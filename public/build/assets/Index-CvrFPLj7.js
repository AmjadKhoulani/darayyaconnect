import{r as u,j as e,H as F,L as T}from"./app-uhljFjo-.js";import{P as H}from"./PortalLayout-D8Lm2wRy.js";import{m as b}from"./maplibre-gl-CURxyQ9M.js";import{M as E}from"./map-DLc5hxBr.js";import{E as I,L as z,W}from"./wifi-DRdxOBEq.js";import{I as O}from"./info-BEIQ35LX.js";import{Z as A,D as Z}from"./zap-CMQhP716.js";import{P as D}from"./phone-ezYU4sGD.js";import{c as R}from"./createLucideIcon-Cyf_CMDd.js";import"./transition-uFJtBX_F.js";import"./dialog-BN7N_xnT.js";import"./with-selector-BonvddMt.js";const B=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],J=R("shield-alert",B),g=["water","electricity","sewage","phone"],C={water:"#3b82f6",electricity:"#f59e0b",sewage:"#78350f",phone:"#10b981"};function ie({auth:o,points:i}){const d=u.useRef(null),r=u.useRef(null),[n,f]=u.useState(null),[l,P]=u.useState(["points","crowd-status"]),[k,y]=u.useState(!0);u.useEffect(()=>{if(d.current)return r.current=new b.Map({container:d.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:[36.2366,33.4593],zoom:14,maxZoom:18,minZoom:12}),r.current.addControl(new b.NavigationControl,"bottom-right"),r.current.on("load",()=>{r.current&&(fetch("/api/infrastructure").then(t=>t.json()).then(t=>{if(!r.current)return;const a=[];t.lines.forEach(s=>{const m=L(s.type);a.push({type:"Feature",geometry:{type:"LineString",coordinates:s.coordinates},properties:{id:s.id,type:s.type,sector:m,label:$(s.type),status:s.status,meta:s.meta}})}),t.nodes.forEach(s=>{const m=L(s.type);a.push({type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(s.longitude),parseFloat(s.latitude)]},properties:{id:s.id,type:s.type,sector:m,label:$(s.type),icon:j(s.type),status:s.status,meta:s.meta}})}),r.current.addSource("infra-source",{type:"geojson",data:{type:"FeatureCollection",features:a}}),g.forEach(s=>{r.current.addLayer({id:`infra-${s}-lines`,type:"line",source:"infra-source",filter:["all",["==","$type","LineString"],["==","sector",s]],layout:{"line-join":"round","line-cap":"round",visibility:l.includes(s)?"visible":"none"},paint:{"line-color":C[s],"line-width":4,"line-opacity":.8}})}),g.forEach(s=>{r.current.addLayer({id:`infra-${s}-nodes-bg`,type:"circle",source:"infra-source",filter:["all",["==","$type","Point"],["==","sector",s]],layout:{visibility:l.includes(s)?"visible":"none"},paint:{"circle-radius":12,"circle-color":"#fff","circle-stroke-width":2,"circle-stroke-color":C[s]}}),r.current.addLayer({id:`infra-${s}-nodes-icon`,type:"symbol",source:"infra-source",filter:["all",["==","$type","Point"],["==","sector",s]],layout:{"text-field":["get","icon"],"text-size":14,"text-allow-overlap":!0,visibility:l.includes(s)?"visible":"none"}})});const h=new b.Popup({closeButton:!1,closeOnClick:!1,className:"infra-popup"});[...g.map(s=>`infra-${s}-lines`),...g.map(s=>`infra-${s}-nodes-bg`)].forEach(s=>{r.current.on("mouseenter",s,m=>{r.current.getCanvas().style.cursor="pointer";const w=m.features[0],c=w.properties,S=w.geometry.type==="Point"?w.geometry.coordinates.slice():m.lngLat;let _="";if(c.meta)try{const N=typeof c.meta=="string"?JSON.parse(c.meta):c.meta;N.served_neighborhood&&(_=`<div class="text-[10px] font-bold text-emerald-600 mt-1">ğŸ  ÙŠØ®Ø¯Ù… Ø­Ø§Ø±Ø©: ${N.served_neighborhood}</div>`)}catch{}const M=`
                                <div class="p-2 text-right" dir="rtl">
                                    <div class="font-black text-slate-800 text-sm">${c.label}</div>
                                    <div class="text-[10px] text-slate-400 uppercase tracking-tighter">${c.type}</div>
                                    <div class="mt-2 flex items-center gap-1">
                                        <div class="w-2 h-2 rounded-full ${c.status==="active"?"bg-emerald-500":"bg-rose-500"}"></div>
                                        <span class="text-[10px] font-bold">${c.status==="active"?"ÙŠØ¹Ù…Ù„":"ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©"}</span>
                                    </div>
                                    ${_}
                                </div>
                            `;h.setLngLat(S).setHTML(M).addTo(r.current)}),r.current.on("mouseleave",s,()=>{r.current.getCanvas().style.cursor="",h.remove()})})}),fetch("/api/infrastructure/status-heatmap?type=electricity").then(t=>t.json()).then(t=>{r.current&&(r.current.addSource("status-zones-source",{type:"geojson",data:t}),r.current.addLayer({id:"status-zones-fill",type:"fill",source:"status-zones-source",layout:{visibility:l.includes("crowd-status")?"visible":"none"},paint:{"fill-color":["match",["get","status"],"available","#10b981","unstable","#f59e0b","cutoff","#ef4444","#94a3b8"],"fill-opacity":.2}}))}),i.forEach(t=>{const a=document.createElement("div");a.className="marker-icon",a.innerHTML=`<div class="bg-white p-1 rounded-full shadow-md border-2 border-emerald-500 cursor-pointer hover:scale-110 transition-transform">${j(t.type)}</div>`,new b.Marker({element:a}).setLngLat([t.longitude,t.latitude]).addTo(r.current),a.addEventListener("click",()=>{f(t),y(!0)})}))}),()=>r.current?.remove()},[]),u.useEffect(()=>{r.current&&(["water","electricity","sewage","phone"].forEach(t=>{const a=l.includes(t)?"visible":"none";r.current.getLayer(`infra-${t}-lines`)&&r.current.setLayoutProperty(`infra-${t}-lines`,"visibility",a),r.current.getLayer(`infra-${t}-nodes-bg`)&&r.current.setLayoutProperty(`infra-${t}-nodes-bg`,"visibility",a),r.current.getLayer(`infra-${t}-nodes-icon`)&&r.current.setLayoutProperty(`infra-${t}-nodes-icon`,"visibility",a)}),r.current.getLayer("status-zones-fill")&&r.current.setLayoutProperty("status-zones-fill","visibility",l.includes("crowd-status")?"visible":"none"))},[l]);const x=t=>{P(a=>a.includes(t)?a.filter(h=>h!==t):[...a,t])},j=t=>({water_tank:"ğŸ¯",pump:"âš™ï¸",valve:"ğŸ”§",water_well:"ğŸ’§",transformer:"âš¡",pole:"ğŸ’¡",generator:"ğŸ”‹",manhole:"ğŸ•³ï¸",exchange:"ğŸ¢",cabinet:"ğŸ“¦",school:"ğŸ“",health_center:"ğŸ¥",park:"ğŸŒ³",government:"ğŸ›ï¸"})[t]||"ğŸ“",L=t=>t.startsWith("water")||["pump","valve","water_well"].includes(t)?"water":t.startsWith("power")||["transformer","pole","generator"].includes(t)?"electricity":t.startsWith("sewage")||["manhole"].includes(t)?"sewage":t.startsWith("telecom")||["exchange","cabinet"].includes(t)?"phone":"other",$=t=>({water_tank:"Ø®Ø²Ø§Ù† Ù…ÙŠØ§Ù‡",pump:"Ù…Ø¶Ø®Ø© Ù…ÙŠØ§Ù‡",valve:"ØµÙ…Ø§Ù… Ø£ØºÙ„Ø§Ù‚",water_well:"Ø¨Ø¦Ø± Ù…ÙŠØ§Ù‡",water_pipe_main:"Ø£Ù†Ø¨ÙˆØ¨ Ø±Ø¦ÙŠØ³ÙŠ",water_pipe_distribution:"Ø£Ù†Ø¨ÙˆØ¨ ÙØ±Ø¹ÙŠ",transformer:"Ù…Ø­ÙˆÙ„Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡",pole:"Ø¹Ø§Ù…ÙˆØ¯ Ø¥Ù†Ø§Ø±Ø©",generator:"Ù…ÙˆÙ„Ø¯Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡",power_cable_underground:"ÙƒØ¨Ù„ Ø£Ø±Ø¶ÙŠ",power_line_overhead:"ÙƒØ¨Ù„ Ù‡ÙˆØ§Ø¦ÙŠ",manhole:"Ø±ÙŠÙƒØ§Ø± (Manhole)",sewage_pipe:"Ù‚Ø³Ø·Ù„ ØµØ±Ù",exchange:"Ù…Ù‚Ø³Ù… Ù‡Ø§ØªÙ",cabinet:"ÙƒØ§Ø¨ÙŠÙ†Ø© ØªÙˆØ²ÙŠØ¹",telecom_cable:"ÙƒØ¨Ù„ Ù‡Ø§ØªÙ"})[t]||t;return e.jsxs(H,{auth:o,children:[e.jsx(F,{title:"Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø°ÙƒÙŠØ©"}),e.jsxs("div",{className:"relative flex h-[85vh] w-full overflow-hidden bg-slate-50",dir:"rtl",children:[e.jsx("div",{className:`absolute bottom-4 right-4 top-4 z-20 w-80 transform transition-transform duration-300 ${k?"translate-x-0":"translate-x-[calc(100%+16px)]"}`,children:e.jsxs("div",{className:"flex h-full flex-col overflow-hidden rounded-2xl border border-slate-200 bg-white/95 shadow-2xl backdrop-blur-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 bg-slate-50/50 p-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-black text-slate-800",children:[e.jsx(E,{className:"text-emerald-500",size:20}),"Ù…Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"]}),e.jsx("button",{onClick:()=>y(!1),className:"rounded-lg p-1 transition hover:bg-slate-200",children:e.jsx(I,{size:18,className:"text-slate-400"})})]}),e.jsxs("div",{className:"custom-scrollbar flex-1 space-y-6 overflow-y-auto p-4",children:[n?e.jsxs("div",{className:"animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-emerald-100 text-2xl shadow-inner",children:j(n.type)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold leading-tight text-slate-900",children:n.name}),e.jsxs("span",{className:"rounded bg-slate-100 px-1.5 py-0.5 text-[10px] font-bold uppercase tracking-tighter text-slate-400",children:["ID: asset-",n.id]})]})]}),e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-2",children:[e.jsx("div",{className:"mb-1 text-[10px] font-bold uppercase text-slate-400",children:"Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„"}),e.jsx("span",{className:`text-xs font-bold ${n.status==="active"?"text-emerald-600":"text-rose-600"}`,children:n.status==="active"?"â— ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø©":"â— Ù…ØªÙˆÙ‚Ù Ù„Ù„ØµÙŠØ§Ù†Ø©"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-100 bg-slate-50 p-2",children:[e.jsx("div",{className:"mb-1 text-[10px] font-bold uppercase text-slate-400",children:"Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«"}),e.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Ù…Ù†Ø° Ø³Ø§Ø¹ØªÙŠÙ†"})]})]}),n.details&&e.jsxs("p",{className:"mb-4 rounded-xl border border-emerald-100/50 bg-emerald-50/50 p-3 text-xs leading-relaxed text-slate-600",children:[e.jsx(O,{size:14,className:"mr-1 inline text-emerald-600"})," ",n.details]}),e.jsx("button",{className:"w-full rounded-xl bg-slate-900 py-2.5 text-xs font-bold text-white shadow-lg shadow-emerald-900/10 transition hover:bg-emerald-600",children:"ÙØªØ­ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ù…Ù„"})]}):e.jsxs("div",{className:"py-8 text-center opacity-50",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-16 w-16 items-center justify-center rounded-full bg-slate-100",children:e.jsx(V,{size:24,className:"text-slate-300"})}),e.jsxs("p",{className:"text-xs font-bold text-slate-400",children:["Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù†Ù‚Ø·Ø© ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø©",e.jsx("br",{}),"Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„"]})]}),e.jsx("hr",{className:"border-slate-100"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"mb-4 flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-slate-400",children:[e.jsx(z,{size:14})," Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{active:l.includes("electricity"),onClick:()=>x("electricity"),icon:e.jsx(A,{size:16}),label:"Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡",color:"amber"}),e.jsx(p,{active:l.includes("water"),onClick:()=>x("water"),icon:e.jsx(Z,{size:16}),label:"Ø´Ø¨ÙƒØ© Ø§Ù„Ù…ÙŠØ§Ù‡",color:"blue"}),e.jsx(p,{active:l.includes("sewage"),onClick:()=>x("sewage"),icon:e.jsx(W,{size:16,className:"rotate-90"}),label:"Ø§Ù„ØµØ±Ù Ø§Ù„ØµØ­ÙŠ",color:"stone"}),e.jsx(p,{active:l.includes("phone"),onClick:()=>x("phone"),icon:e.jsx(D,{size:16}),label:"Ø´Ø¨ÙƒØ© Ø§Ù„Ù‡Ø§ØªÙ",color:"emerald"}),e.jsx("div",{className:"my-2 h-px bg-slate-100"}),e.jsx(p,{active:l.includes("crowd-status"),onClick:()=>x("crowd-status"),icon:e.jsx(J,{size:16}),label:"Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙˆØ§ÙØ± (Ù…Ø¬ØªÙ…Ø¹ÙŠ)",color:"rose"})]})]})]}),e.jsx("div",{className:"border-t border-slate-100 bg-slate-50 p-4",children:e.jsx(T,{href:route("community.index"),className:"block text-center text-[10px] font-bold text-slate-400 transition hover:text-emerald-600",children:"Ù‡Ù„ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø¯Ù‚ÙŠÙ‚Ø©ØŸ Ø¨Ù„ØºÙ†Ø§ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø¬ØªÙ…Ø¹"})})]})}),!k&&e.jsx("button",{onClick:()=>y(!0),className:"animate-in fade-in absolute right-4 top-4 z-20 rounded-2xl border border-slate-200 bg-white p-3 shadow-xl transition hover:bg-slate-50",children:e.jsx(z,{className:"text-emerald-600",size:20})}),e.jsx("div",{ref:d,className:"h-full flex-1 shadow-inner"}),e.jsx("div",{className:"absolute bottom-6 left-6 z-10 flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-slate-200 bg-white/90 px-4 py-2 shadow-xl backdrop-blur-md",children:[e.jsx("div",{className:"h-2 w-2 animate-pulse rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-[10px] font-bold tracking-tight text-slate-600",children:"Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø°ÙƒÙŠ Ù…ØªØµÙ„"})]})})]}),e.jsx("div",{className:"mx-auto max-w-7xl px-4 py-12",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(v,{icon:"âš¡",title:"Ù…Ø­ÙˆÙ„Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡",count:i.filter(t=>t.type==="transformer").length,status:"75%"}),e.jsx(v,{icon:"ğŸ’§",title:"Ø¢Ø¨Ø§Ø± Ø§Ù„Ù…ÙŠØ§Ù‡",count:i.filter(t=>t.type==="water_well").length,status:"92%"}),e.jsx(v,{icon:"ğŸ¥",title:"Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø·Ø¨ÙŠØ©",count:i.filter(t=>t.type==="health_center").length,status:"100%"}),e.jsx(v,{icon:"ğŸ›ï¸",title:"Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©",count:i.filter(t=>t.type==="government").length,status:"100%"})]})})]})}function p({active:o,onClick:i,icon:d,label:r,color:n}){const f={amber:"bg-amber-500",blue:"bg-blue-500",stone:"bg-stone-500",emerald:"bg-emerald-500",rose:"bg-rose-500"};return e.jsxs("button",{onClick:i,className:`flex w-full items-center justify-between rounded-xl border p-3 transition-all ${o?"border-slate-200 bg-slate-50 shadow-inner":"border-transparent bg-white hover:bg-slate-50/80"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`rounded-lg p-2 ${o?f[n]+" text-white shadow-md":"bg-slate-100 text-slate-400"} transition-all`,children:d}),e.jsx("span",{className:`text-[11px] font-bold transition-colors ${o?"text-slate-800":"text-slate-500"}`,children:r})]}),e.jsx("div",{className:`h-3 w-3 rounded-full border-2 border-white shadow-sm transition-all ${o?f[n]:"bg-slate-200"}`})]})}function v({icon:o,title:i,count:d,status:r}){return e.jsxs("div",{className:"group rounded-2xl border border-slate-100 bg-white p-5 shadow-sm transition hover:shadow-md",children:[e.jsx("div",{className:"mb-3 inline-block text-3xl transition-transform group-hover:scale-110",children:o}),e.jsx("h4",{className:"mb-1 font-bold text-slate-800",children:i}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx("span",{className:"text-2xl font-black leading-none text-slate-900",children:d}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"mb-1 block text-[10px] font-bold uppercase tracking-tighter text-slate-400",children:"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©"}),e.jsx("div",{className:"h-1.5 w-16 overflow-hidden rounded-full bg-slate-100",children:e.jsx("div",{className:"h-full rounded-full bg-emerald-500",style:{width:r}})})]})]})]})}function V({size:o,className:i}){return e.jsx(E,{size:o,className:i})}export{ie as default};
