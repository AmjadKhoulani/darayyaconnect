(function(){const k=document.createElement("link").relList;if(k&&k.supports&&k.supports("modulepreload"))return;for(const I of document.querySelectorAll('link[rel="modulepreload"]'))P(I);new MutationObserver(I=>{for(const R of I)if(R.type==="childList")for(const T of R.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&P(T)}).observe(document,{childList:!0,subtree:!0});function w(I){const R={};return I.integrity&&(R.integrity=I.integrity),I.referrerPolicy&&(R.referrerPolicy=I.referrerPolicy),I.crossOrigin==="use-credentials"?R.credentials="include":I.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function P(I){if(I.ep)return;I.ep=!0;const R=w(I);fetch(I.href,R)}})();function Rb(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var d0={exports:{}},Dp={},h0={exports:{}},jr={};var Nx;function Lb(){if(Nx)return jr;Nx=1;var b=Symbol.for("react.element"),k=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),P=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),T=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),W=Symbol.for("react.memo"),se=Symbol.for("react.lazy"),ee=Symbol.iterator;function ne(Ce){return Ce===null||typeof Ce!="object"?null:(Ce=ee&&Ce[ee]||Ce["@@iterator"],typeof Ce=="function"?Ce:null)}var ke={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},je=Object.assign,re={};function H(Ce,Ye,qt){this.props=Ce,this.context=Ye,this.refs=re,this.updater=qt||ke}H.prototype.isReactComponent={},H.prototype.setState=function(Ce,Ye){if(typeof Ce!="object"&&typeof Ce!="function"&&Ce!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ce,Ye,"setState")},H.prototype.forceUpdate=function(Ce){this.updater.enqueueForceUpdate(this,Ce,"forceUpdate")};function Ze(){}Ze.prototype=H.prototype;function Pe(Ce,Ye,qt){this.props=Ce,this.context=Ye,this.refs=re,this.updater=qt||ke}var ze=Pe.prototype=new Ze;ze.constructor=Pe,je(ze,H.prototype),ze.isPureReactComponent=!0;var lt=Array.isArray,Nt=Object.prototype.hasOwnProperty,zt={current:null},Ft={key:!0,ref:!0,__self:!0,__source:!0};function Vt(Ce,Ye,qt){var Yt,wt={},Ht=null,At=null;if(Ye!=null)for(Yt in Ye.ref!==void 0&&(At=Ye.ref),Ye.key!==void 0&&(Ht=""+Ye.key),Ye)Nt.call(Ye,Yt)&&!Ft.hasOwnProperty(Yt)&&(wt[Yt]=Ye[Yt]);var er=arguments.length-2;if(er===1)wt.children=qt;else if(1<er){for(var Sr=Array(er),Jr=0;Jr<er;Jr++)Sr[Jr]=arguments[Jr+2];wt.children=Sr}if(Ce&&Ce.defaultProps)for(Yt in er=Ce.defaultProps,er)wt[Yt]===void 0&&(wt[Yt]=er[Yt]);return{$$typeof:b,type:Ce,key:Ht,ref:At,props:wt,_owner:zt.current}}function Zt(Ce,Ye){return{$$typeof:b,type:Ce.type,key:Ye,ref:Ce.ref,props:Ce.props,_owner:Ce._owner}}function mt(Ce){return typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===b}function fr(Ce){var Ye={"=":"=0",":":"=2"};return"$"+Ce.replace(/[=:]/g,function(qt){return Ye[qt]})}var Kt=/\/+/g;function Wt(Ce,Ye){return typeof Ce=="object"&&Ce!==null&&Ce.key!=null?fr(""+Ce.key):Ye.toString(36)}function Me(Ce,Ye,qt,Yt,wt){var Ht=typeof Ce;(Ht==="undefined"||Ht==="boolean")&&(Ce=null);var At=!1;if(Ce===null)At=!0;else switch(Ht){case"string":case"number":At=!0;break;case"object":switch(Ce.$$typeof){case b:case k:At=!0}}if(At)return At=Ce,wt=wt(At),Ce=Yt===""?"."+Wt(At,0):Yt,lt(wt)?(qt="",Ce!=null&&(qt=Ce.replace(Kt,"$&/")+"/"),Me(wt,Ye,qt,"",function(Jr){return Jr})):wt!=null&&(mt(wt)&&(wt=Zt(wt,qt+(!wt.key||At&&At.key===wt.key?"":(""+wt.key).replace(Kt,"$&/")+"/")+Ce)),Ye.push(wt)),1;if(At=0,Yt=Yt===""?".":Yt+":",lt(Ce))for(var er=0;er<Ce.length;er++){Ht=Ce[er];var Sr=Yt+Wt(Ht,er);At+=Me(Ht,Ye,qt,Sr,wt)}else if(Sr=ne(Ce),typeof Sr=="function")for(Ce=Sr.call(Ce),er=0;!(Ht=Ce.next()).done;)Ht=Ht.value,Sr=Yt+Wt(Ht,er++),At+=Me(Ht,Ye,qt,Sr,wt);else if(Ht==="object")throw Ye=String(Ce),Error("Objects are not valid as a React child (found: "+(Ye==="[object Object]"?"object with keys {"+Object.keys(Ce).join(", ")+"}":Ye)+"). If you meant to render a collection of children, use an array instead.");return At}function Ct(Ce,Ye,qt){if(Ce==null)return Ce;var Yt=[],wt=0;return Me(Ce,Yt,"","",function(Ht){return Ye.call(qt,Ht,wt++)}),Yt}function it(Ce){if(Ce._status===-1){var Ye=Ce._result;Ye=Ye(),Ye.then(function(qt){(Ce._status===0||Ce._status===-1)&&(Ce._status=1,Ce._result=qt)},function(qt){(Ce._status===0||Ce._status===-1)&&(Ce._status=2,Ce._result=qt)}),Ce._status===-1&&(Ce._status=0,Ce._result=Ye)}if(Ce._status===1)return Ce._result.default;throw Ce._result}var Tt={current:null},nt={transition:null},ht={ReactCurrentDispatcher:Tt,ReactCurrentBatchConfig:nt,ReactCurrentOwner:zt};function pt(){throw Error("act(...) is not supported in production builds of React.")}return jr.Children={map:Ct,forEach:function(Ce,Ye,qt){Ct(Ce,function(){Ye.apply(this,arguments)},qt)},count:function(Ce){var Ye=0;return Ct(Ce,function(){Ye++}),Ye},toArray:function(Ce){return Ct(Ce,function(Ye){return Ye})||[]},only:function(Ce){if(!mt(Ce))throw Error("React.Children.only expected to receive a single React element child.");return Ce}},jr.Component=H,jr.Fragment=w,jr.Profiler=I,jr.PureComponent=Pe,jr.StrictMode=P,jr.Suspense=V,jr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ht,jr.act=pt,jr.cloneElement=function(Ce,Ye,qt){if(Ce==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ce+".");var Yt=je({},Ce.props),wt=Ce.key,Ht=Ce.ref,At=Ce._owner;if(Ye!=null){if(Ye.ref!==void 0&&(Ht=Ye.ref,At=zt.current),Ye.key!==void 0&&(wt=""+Ye.key),Ce.type&&Ce.type.defaultProps)var er=Ce.type.defaultProps;for(Sr in Ye)Nt.call(Ye,Sr)&&!Ft.hasOwnProperty(Sr)&&(Yt[Sr]=Ye[Sr]===void 0&&er!==void 0?er[Sr]:Ye[Sr])}var Sr=arguments.length-2;if(Sr===1)Yt.children=qt;else if(1<Sr){er=Array(Sr);for(var Jr=0;Jr<Sr;Jr++)er[Jr]=arguments[Jr+2];Yt.children=er}return{$$typeof:b,type:Ce.type,key:wt,ref:Ht,props:Yt,_owner:At}},jr.createContext=function(Ce){return Ce={$$typeof:T,_currentValue:Ce,_currentValue2:Ce,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ce.Provider={$$typeof:R,_context:Ce},Ce.Consumer=Ce},jr.createElement=Vt,jr.createFactory=function(Ce){var Ye=Vt.bind(null,Ce);return Ye.type=Ce,Ye},jr.createRef=function(){return{current:null}},jr.forwardRef=function(Ce){return{$$typeof:c,render:Ce}},jr.isValidElement=mt,jr.lazy=function(Ce){return{$$typeof:se,_payload:{_status:-1,_result:Ce},_init:it}},jr.memo=function(Ce,Ye){return{$$typeof:W,type:Ce,compare:Ye===void 0?null:Ye}},jr.startTransition=function(Ce){var Ye=nt.transition;nt.transition={};try{Ce()}finally{nt.transition=Ye}},jr.unstable_act=pt,jr.useCallback=function(Ce,Ye){return Tt.current.useCallback(Ce,Ye)},jr.useContext=function(Ce){return Tt.current.useContext(Ce)},jr.useDebugValue=function(){},jr.useDeferredValue=function(Ce){return Tt.current.useDeferredValue(Ce)},jr.useEffect=function(Ce,Ye){return Tt.current.useEffect(Ce,Ye)},jr.useId=function(){return Tt.current.useId()},jr.useImperativeHandle=function(Ce,Ye,qt){return Tt.current.useImperativeHandle(Ce,Ye,qt)},jr.useInsertionEffect=function(Ce,Ye){return Tt.current.useInsertionEffect(Ce,Ye)},jr.useLayoutEffect=function(Ce,Ye){return Tt.current.useLayoutEffect(Ce,Ye)},jr.useMemo=function(Ce,Ye){return Tt.current.useMemo(Ce,Ye)},jr.useReducer=function(Ce,Ye,qt){return Tt.current.useReducer(Ce,Ye,qt)},jr.useRef=function(Ce){return Tt.current.useRef(Ce)},jr.useState=function(Ce){return Tt.current.useState(Ce)},jr.useSyncExternalStore=function(Ce,Ye,qt){return Tt.current.useSyncExternalStore(Ce,Ye,qt)},jr.useTransition=function(){return Tt.current.useTransition()},jr.version="18.3.1",jr}var Ex;function U0(){return Ex||(Ex=1,h0.exports=Lb()),h0.exports}var Cx;function Fb(){if(Cx)return Dp;Cx=1;var b=U0(),k=Symbol.for("react.element"),w=Symbol.for("react.fragment"),P=Object.prototype.hasOwnProperty,I=b.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,R={key:!0,ref:!0,__self:!0,__source:!0};function T(c,V,W){var se,ee={},ne=null,ke=null;W!==void 0&&(ne=""+W),V.key!==void 0&&(ne=""+V.key),V.ref!==void 0&&(ke=V.ref);for(se in V)P.call(V,se)&&!R.hasOwnProperty(se)&&(ee[se]=V[se]);if(c&&c.defaultProps)for(se in V=c.defaultProps,V)ee[se]===void 0&&(ee[se]=V[se]);return{$$typeof:k,type:c,key:ne,ref:ke,props:ee,_owner:I.current}}return Dp.Fragment=w,Dp.jsx=T,Dp.jsxs=T,Dp}var Px;function Ob(){return Px||(Px=1,d0.exports=Fb()),d0.exports}var i=Ob(),qf={},p0={exports:{}},ii={},f0={exports:{}},m0={};var Mx;function Bb(){return Mx||(Mx=1,(function(b){function k(nt,ht){var pt=nt.length;nt.push(ht);e:for(;0<pt;){var Ce=pt-1>>>1,Ye=nt[Ce];if(0<I(Ye,ht))nt[Ce]=ht,nt[pt]=Ye,pt=Ce;else break e}}function w(nt){return nt.length===0?null:nt[0]}function P(nt){if(nt.length===0)return null;var ht=nt[0],pt=nt.pop();if(pt!==ht){nt[0]=pt;e:for(var Ce=0,Ye=nt.length,qt=Ye>>>1;Ce<qt;){var Yt=2*(Ce+1)-1,wt=nt[Yt],Ht=Yt+1,At=nt[Ht];if(0>I(wt,pt))Ht<Ye&&0>I(At,wt)?(nt[Ce]=At,nt[Ht]=pt,Ce=Ht):(nt[Ce]=wt,nt[Yt]=pt,Ce=Yt);else if(Ht<Ye&&0>I(At,pt))nt[Ce]=At,nt[Ht]=pt,Ce=Ht;else break e}}return ht}function I(nt,ht){var pt=nt.sortIndex-ht.sortIndex;return pt!==0?pt:nt.id-ht.id}if(typeof performance=="object"&&typeof performance.now=="function"){var R=performance;b.unstable_now=function(){return R.now()}}else{var T=Date,c=T.now();b.unstable_now=function(){return T.now()-c}}var V=[],W=[],se=1,ee=null,ne=3,ke=!1,je=!1,re=!1,H=typeof setTimeout=="function"?setTimeout:null,Ze=typeof clearTimeout=="function"?clearTimeout:null,Pe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ze(nt){for(var ht=w(W);ht!==null;){if(ht.callback===null)P(W);else if(ht.startTime<=nt)P(W),ht.sortIndex=ht.expirationTime,k(V,ht);else break;ht=w(W)}}function lt(nt){if(re=!1,ze(nt),!je)if(w(V)!==null)je=!0,it(Nt);else{var ht=w(W);ht!==null&&Tt(lt,ht.startTime-nt)}}function Nt(nt,ht){je=!1,re&&(re=!1,Ze(Vt),Vt=-1),ke=!0;var pt=ne;try{for(ze(ht),ee=w(V);ee!==null&&(!(ee.expirationTime>ht)||nt&&!fr());){var Ce=ee.callback;if(typeof Ce=="function"){ee.callback=null,ne=ee.priorityLevel;var Ye=Ce(ee.expirationTime<=ht);ht=b.unstable_now(),typeof Ye=="function"?ee.callback=Ye:ee===w(V)&&P(V),ze(ht)}else P(V);ee=w(V)}if(ee!==null)var qt=!0;else{var Yt=w(W);Yt!==null&&Tt(lt,Yt.startTime-ht),qt=!1}return qt}finally{ee=null,ne=pt,ke=!1}}var zt=!1,Ft=null,Vt=-1,Zt=5,mt=-1;function fr(){return!(b.unstable_now()-mt<Zt)}function Kt(){if(Ft!==null){var nt=b.unstable_now();mt=nt;var ht=!0;try{ht=Ft(!0,nt)}finally{ht?Wt():(zt=!1,Ft=null)}}else zt=!1}var Wt;if(typeof Pe=="function")Wt=function(){Pe(Kt)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,Ct=Me.port2;Me.port1.onmessage=Kt,Wt=function(){Ct.postMessage(null)}}else Wt=function(){H(Kt,0)};function it(nt){Ft=nt,zt||(zt=!0,Wt())}function Tt(nt,ht){Vt=H(function(){nt(b.unstable_now())},ht)}b.unstable_IdlePriority=5,b.unstable_ImmediatePriority=1,b.unstable_LowPriority=4,b.unstable_NormalPriority=3,b.unstable_Profiling=null,b.unstable_UserBlockingPriority=2,b.unstable_cancelCallback=function(nt){nt.callback=null},b.unstable_continueExecution=function(){je||ke||(je=!0,it(Nt))},b.unstable_forceFrameRate=function(nt){0>nt||125<nt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<nt?Math.floor(1e3/nt):5},b.unstable_getCurrentPriorityLevel=function(){return ne},b.unstable_getFirstCallbackNode=function(){return w(V)},b.unstable_next=function(nt){switch(ne){case 1:case 2:case 3:var ht=3;break;default:ht=ne}var pt=ne;ne=ht;try{return nt()}finally{ne=pt}},b.unstable_pauseExecution=function(){},b.unstable_requestPaint=function(){},b.unstable_runWithPriority=function(nt,ht){switch(nt){case 1:case 2:case 3:case 4:case 5:break;default:nt=3}var pt=ne;ne=nt;try{return ht()}finally{ne=pt}},b.unstable_scheduleCallback=function(nt,ht,pt){var Ce=b.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?Ce+pt:Ce):pt=Ce,nt){case 1:var Ye=-1;break;case 2:Ye=250;break;case 5:Ye=1073741823;break;case 4:Ye=1e4;break;default:Ye=5e3}return Ye=pt+Ye,nt={id:se++,callback:ht,priorityLevel:nt,startTime:pt,expirationTime:Ye,sortIndex:-1},pt>Ce?(nt.sortIndex=pt,k(W,nt),w(V)===null&&nt===w(W)&&(re?(Ze(Vt),Vt=-1):re=!0,Tt(lt,pt-Ce))):(nt.sortIndex=Ye,k(V,nt),je||ke||(je=!0,it(Nt))),nt},b.unstable_shouldYield=fr,b.unstable_wrapCallback=function(nt){var ht=ne;return function(){var pt=ne;ne=ht;try{return nt.apply(this,arguments)}finally{ne=pt}}}})(m0)),m0}var Ix;function Vb(){return Ix||(Ix=1,f0.exports=Bb()),f0.exports}var zx;function $b(){if(zx)return ii;zx=1;var b=U0(),k=Vb();function w(o){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+o,y=1;y<arguments.length;y++)d+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+o+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var P=new Set,I={};function R(o,d){T(o,d),T(o+"Capture",d)}function T(o,d){for(I[o]=d,o=0;o<d.length;o++)P.add(d[o])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),V=Object.prototype.hasOwnProperty,W=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,se={},ee={};function ne(o){return V.call(ee,o)?!0:V.call(se,o)?!1:W.test(o)?ee[o]=!0:(se[o]=!0,!1)}function ke(o,d,y,S){if(y!==null&&y.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return S?!1:y!==null?!y.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function je(o,d,y,S){if(d===null||typeof d>"u"||ke(o,d,y,S))return!0;if(S)return!1;if(y!==null)switch(y.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function re(o,d,y,S,z,F,Q){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=S,this.attributeNamespace=z,this.mustUseProperty=y,this.propertyName=o,this.type=d,this.sanitizeURL=F,this.removeEmptyString=Q}var H={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){H[o]=new re(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var d=o[0];H[d]=new re(d,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){H[o]=new re(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){H[o]=new re(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){H[o]=new re(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){H[o]=new re(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){H[o]=new re(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){H[o]=new re(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){H[o]=new re(o,5,!1,o.toLowerCase(),null,!1,!1)});var Ze=/[\-:]([a-z])/g;function Pe(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var d=o.replace(Ze,Pe);H[d]=new re(d,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var d=o.replace(Ze,Pe);H[d]=new re(d,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var d=o.replace(Ze,Pe);H[d]=new re(d,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){H[o]=new re(o,1,!1,o.toLowerCase(),null,!1,!1)}),H.xlinkHref=new re("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){H[o]=new re(o,1,!1,o.toLowerCase(),null,!0,!0)});function ze(o,d,y,S){var z=H.hasOwnProperty(d)?H[d]:null;(z!==null?z.type!==0:S||!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(je(d,y,z,S)&&(y=null),S||z===null?ne(d)&&(y===null?o.removeAttribute(d):o.setAttribute(d,""+y)):z.mustUseProperty?o[z.propertyName]=y===null?z.type===3?!1:"":y:(d=z.attributeName,S=z.attributeNamespace,y===null?o.removeAttribute(d):(z=z.type,y=z===3||z===4&&y===!0?"":""+y,S?o.setAttributeNS(S,d,y):o.setAttribute(d,y))))}var lt=b.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Nt=Symbol.for("react.element"),zt=Symbol.for("react.portal"),Ft=Symbol.for("react.fragment"),Vt=Symbol.for("react.strict_mode"),Zt=Symbol.for("react.profiler"),mt=Symbol.for("react.provider"),fr=Symbol.for("react.context"),Kt=Symbol.for("react.forward_ref"),Wt=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),Ct=Symbol.for("react.memo"),it=Symbol.for("react.lazy"),Tt=Symbol.for("react.offscreen"),nt=Symbol.iterator;function ht(o){return o===null||typeof o!="object"?null:(o=nt&&o[nt]||o["@@iterator"],typeof o=="function"?o:null)}var pt=Object.assign,Ce;function Ye(o){if(Ce===void 0)try{throw Error()}catch(y){var d=y.stack.trim().match(/\n( *(at )?)/);Ce=d&&d[1]||""}return`
`+Ce+o}var qt=!1;function Yt(o,d){if(!o||qt)return"";qt=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(He){var S=He}Reflect.construct(o,[],d)}else{try{d.call()}catch(He){S=He}o.call(d.prototype)}else{try{throw Error()}catch(He){S=He}o()}}catch(He){if(He&&S&&typeof He.stack=="string"){for(var z=He.stack.split(`
`),F=S.stack.split(`
`),Q=z.length-1,ye=F.length-1;1<=Q&&0<=ye&&z[Q]!==F[ye];)ye--;for(;1<=Q&&0<=ye;Q--,ye--)if(z[Q]!==F[ye]){if(Q!==1||ye!==1)do if(Q--,ye--,0>ye||z[Q]!==F[ye]){var Te=`
`+z[Q].replace(" at new "," at ");return o.displayName&&Te.includes("<anonymous>")&&(Te=Te.replace("<anonymous>",o.displayName)),Te}while(1<=Q&&0<=ye);break}}}finally{qt=!1,Error.prepareStackTrace=y}return(o=o?o.displayName||o.name:"")?Ye(o):""}function wt(o){switch(o.tag){case 5:return Ye(o.type);case 16:return Ye("Lazy");case 13:return Ye("Suspense");case 19:return Ye("SuspenseList");case 0:case 2:case 15:return o=Yt(o.type,!1),o;case 11:return o=Yt(o.type.render,!1),o;case 1:return o=Yt(o.type,!0),o;default:return""}}function Ht(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case Ft:return"Fragment";case zt:return"Portal";case Zt:return"Profiler";case Vt:return"StrictMode";case Wt:return"Suspense";case Me:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case fr:return(o.displayName||"Context")+".Consumer";case mt:return(o._context.displayName||"Context")+".Provider";case Kt:var d=o.render;return o=o.displayName,o||(o=d.displayName||d.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case Ct:return d=o.displayName||null,d!==null?d:Ht(o.type)||"Memo";case it:d=o._payload,o=o._init;try{return Ht(o(d))}catch{}}return null}function At(o){var d=o.type;switch(o.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=d.render,o=o.displayName||o.name||"",d.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ht(d);case 8:return d===Vt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function er(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Sr(o){var d=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function Jr(o){var d=Sr(o)?"checked":"value",y=Object.getOwnPropertyDescriptor(o.constructor.prototype,d),S=""+o[d];if(!o.hasOwnProperty(d)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var z=y.get,F=y.set;return Object.defineProperty(o,d,{configurable:!0,get:function(){return z.call(this)},set:function(Q){S=""+Q,F.call(this,Q)}}),Object.defineProperty(o,d,{enumerable:y.enumerable}),{getValue:function(){return S},setValue:function(Q){S=""+Q},stopTracking:function(){o._valueTracker=null,delete o[d]}}}}function _a(o){o._valueTracker||(o._valueTracker=Jr(o))}function Qn(o){if(!o)return!1;var d=o._valueTracker;if(!d)return!0;var y=d.getValue(),S="";return o&&(S=Sr(o)?o.checked?"true":"false":o.value),o=S,o!==y?(d.setValue(o),!0):!1}function Oi(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function Cs(o,d){var y=d.checked;return pt({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:y??o._wrapperState.initialChecked})}function Gn(o,d){var y=d.defaultValue==null?"":d.defaultValue,S=d.checked!=null?d.checked:d.defaultChecked;y=er(d.value!=null?d.value:y),o._wrapperState={initialChecked:S,initialValue:y,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function ba(o,d){d=d.checked,d!=null&&ze(o,"checked",d,!1)}function as(o,d){ba(o,d);var y=er(d.value),S=d.type;if(y!=null)S==="number"?(y===0&&o.value===""||o.value!=y)&&(o.value=""+y):o.value!==""+y&&(o.value=""+y);else if(S==="submit"||S==="reset"){o.removeAttribute("value");return}d.hasOwnProperty("value")?mi(o,d.type,y):d.hasOwnProperty("defaultValue")&&mi(o,d.type,er(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(o.defaultChecked=!!d.defaultChecked)}function fi(o,d,y){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var S=d.type;if(!(S!=="submit"&&S!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+o._wrapperState.initialValue,y||d===o.value||(o.value=d),o.defaultValue=d}y=o.name,y!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,y!==""&&(o.name=y)}function mi(o,d,y){(d!=="number"||Oi(o.ownerDocument)!==o)&&(y==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+y&&(o.defaultValue=""+y))}var Oa=Array.isArray;function Zn(o,d,y,S){if(o=o.options,d){d={};for(var z=0;z<y.length;z++)d["$"+y[z]]=!0;for(y=0;y<o.length;y++)z=d.hasOwnProperty("$"+o[y].value),o[y].selected!==z&&(o[y].selected=z),z&&S&&(o[y].defaultSelected=!0)}else{for(y=""+er(y),d=null,z=0;z<o.length;z++){if(o[z].value===y){o[z].selected=!0,S&&(o[z].defaultSelected=!0);return}d!==null||o[z].disabled||(d=o[z])}d!==null&&(d.selected=!0)}}function Hn(o,d){if(d.dangerouslySetInnerHTML!=null)throw Error(w(91));return pt({},d,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function _o(o,d){var y=d.value;if(y==null){if(y=d.children,d=d.defaultValue,y!=null){if(d!=null)throw Error(w(92));if(Oa(y)){if(1<y.length)throw Error(w(93));y=y[0]}d=y}d==null&&(d=""),y=d}o._wrapperState={initialValue:er(y)}}function bo(o,d){var y=er(d.value),S=er(d.defaultValue);y!=null&&(y=""+y,y!==o.value&&(o.value=y),d.defaultValue==null&&o.defaultValue!==y&&(o.defaultValue=y)),S!=null&&(o.defaultValue=""+S)}function _n(o){var d=o.textContent;d===o._wrapperState.initialValue&&d!==""&&d!==null&&(o.value=d)}function Ae(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Y(o,d){return o==null||o==="http://www.w3.org/1999/xhtml"?Ae(d):o==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var X,ie=(function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,y,S,z){MSApp.execUnsafeLocalFunction(function(){return o(d,y,S,z)})}:o})(function(o,d){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=d;else{for(X=X||document.createElement("div"),X.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=X.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;d.firstChild;)o.appendChild(d.firstChild)}});function be(o,d){if(d){var y=o.firstChild;if(y&&y===o.lastChild&&y.nodeType===3){y.nodeValue=d;return}}o.textContent=d}var ve={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Le=["Webkit","ms","Moz","O"];Object.keys(ve).forEach(function(o){Le.forEach(function(d){d=d+o.charAt(0).toUpperCase()+o.substring(1),ve[d]=ve[o]})});function Ie(o,d,y){return d==null||typeof d=="boolean"||d===""?"":y||typeof d!="number"||d===0||ve.hasOwnProperty(o)&&ve[o]?(""+d).trim():d+"px"}function Se(o,d){o=o.style;for(var y in d)if(d.hasOwnProperty(y)){var S=y.indexOf("--")===0,z=Ie(y,d[y],S);y==="float"&&(y="cssFloat"),S?o.setProperty(y,z):o[y]=z}}var $e=pt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rt(o,d){if(d){if($e[o]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(w(137,o));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(w(60));if(typeof d.dangerouslySetInnerHTML!="object"||!("__html"in d.dangerouslySetInnerHTML))throw Error(w(61))}if(d.style!=null&&typeof d.style!="object")throw Error(w(62))}}function Qe(o,d){if(o.indexOf("-")===-1)return typeof d.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kt=null;function It(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Jt=null,wr=null,xr=null;function Fe(o){if(o=Ca(o)){if(typeof Jt!="function")throw Error(w(280));var d=o.stateNode;d&&(d=Nc(d),Jt(o.stateNode,o.type,d))}}function Or(o){wr?xr?xr.push(o):xr=[o]:wr=o}function $s(){if(wr){var o=wr,d=xr;if(xr=wr=null,Fe(o),d)for(o=0;o<d.length;o++)Fe(d[o])}}function tr(o,d){return o(d)}function Mr(){}var Rs=!1;function Gr(o,d,y){if(Rs)return o(d,y);Rs=!0;try{return tr(o,d,y)}finally{Rs=!1,(wr!==null||xr!==null)&&(Mr(),$s())}}function Zr(o,d){var y=o.stateNode;if(y===null)return null;var S=Nc(y);if(S===null)return null;y=S[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(o=o.type,S=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!S;break e;default:o=!1}if(o)return null;if(y&&typeof y!="function")throw Error(w(231,d,typeof y));return y}var Dr=!1;if(c)try{var ps={};Object.defineProperty(ps,"passive",{get:function(){Dr=!0}}),window.addEventListener("test",ps,ps),window.removeEventListener("test",ps,ps)}catch{Dr=!1}function sc(o,d,y,S,z,F,Q,ye,Te){var He=Array.prototype.slice.call(arguments,3);try{d.apply(y,He)}catch(dt){this.onError(dt)}}var gi=!1,at=null,Us=!1,en=null,Kc={onError:function(o){gi=!0,at=o}};function ea(o,d,y,S,z,F,Q,ye,Te){gi=!1,at=null,sc.apply(Kc,arguments)}function _t(o,d,y,S,z,F,Q,ye,Te){if(ea.apply(this,arguments),gi){if(gi){var He=at;gi=!1,at=null}else throw Error(w(198));Us||(Us=!0,en=He)}}function nr(o){var d=o,y=o;if(o.alternate)for(;d.return;)d=d.return;else{o=d;do d=o,(d.flags&4098)!==0&&(y=d.return),o=d.return;while(o)}return d.tag===3?y:null}function ur(o){if(o.tag===13){var d=o.memoizedState;if(d===null&&(o=o.alternate,o!==null&&(d=o.memoizedState)),d!==null)return d.dehydrated}return null}function Cn(o){if(nr(o)!==o)throw Error(w(188))}function Jc(o){var d=o.alternate;if(!d){if(d=nr(o),d===null)throw Error(w(188));return d!==o?null:o}for(var y=o,S=d;;){var z=y.return;if(z===null)break;var F=z.alternate;if(F===null){if(S=z.return,S!==null){y=S;continue}break}if(z.child===F.child){for(F=z.child;F;){if(F===y)return Cn(z),o;if(F===S)return Cn(z),d;F=F.sibling}throw Error(w(188))}if(y.return!==S.return)y=z,S=F;else{for(var Q=!1,ye=z.child;ye;){if(ye===y){Q=!0,y=z,S=F;break}if(ye===S){Q=!0,S=z,y=F;break}ye=ye.sibling}if(!Q){for(ye=F.child;ye;){if(ye===y){Q=!0,y=F,S=z;break}if(ye===S){Q=!0,S=F,y=z;break}ye=ye.sibling}if(!Q)throw Error(w(189))}}if(y.alternate!==S)throw Error(w(190))}if(y.tag!==3)throw Error(w(188));return y.stateNode.current===y?o:d}function Ba(o){return o=Jc(o),o!==null?ar(o):null}function ar(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var d=ar(o);if(d!==null)return d;o=o.sibling}return null}var ml=k.unstable_scheduleCallback,gl=k.unstable_cancelCallback,Qc=k.unstable_shouldYield,xl=k.unstable_requestPaint,is=k.unstable_now,yl=k.unstable_getCurrentPriorityLevel,vo=k.unstable_ImmediatePriority,on=k.unstable_UserBlockingPriority,Tr=k.unstable_NormalPriority,eu=k.unstable_LowPriority,wo=k.unstable_IdlePriority,Bi=null,ln=null;function va(o){if(ln&&typeof ln.onCommitFiberRoot=="function")try{ln.onCommitFiberRoot(Bi,o,void 0,(o.current.flags&128)===128)}catch{}}var ta=Math.clz32?Math.clz32:gs,ko=Math.log,tu=Math.LN2;function gs(o){return o>>>=0,o===0?32:31-(ko(o)/tu|0)|0}var nc=64,ac=4194304;function xi(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function ic(o,d){var y=o.pendingLanes;if(y===0)return 0;var S=0,z=o.suspendedLanes,F=o.pingedLanes,Q=y&268435455;if(Q!==0){var ye=Q&~z;ye!==0?S=xi(ye):(F&=Q,F!==0&&(S=xi(F)))}else Q=y&~z,Q!==0?S=xi(Q):F!==0&&(S=xi(F));if(S===0)return 0;if(d!==0&&d!==S&&(d&z)===0&&(z=S&-S,F=d&-d,z>=F||z===16&&(F&4194240)!==0))return d;if((S&4)!==0&&(S|=y&16),d=o.entangledLanes,d!==0)for(o=o.entanglements,d&=S;0<d;)y=31-ta(d),z=1<<y,S|=o[y],d&=~z;return S}function uh(o,d){switch(o){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dh(o,d){for(var y=o.suspendedLanes,S=o.pingedLanes,z=o.expirationTimes,F=o.pendingLanes;0<F;){var Q=31-ta(F),ye=1<<Q,Te=z[Q];Te===-1?((ye&y)===0||(ye&S)!==0)&&(z[Q]=uh(ye,d)):Te<=d&&(o.expiredLanes|=ye),F&=~ye}}function _l(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function ru(){var o=nc;return nc<<=1,(nc&4194240)===0&&(nc=64),o}function oc(o){for(var d=[],y=0;31>y;y++)d.push(o);return d}function jo(o,d,y){o.pendingLanes|=d,d!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,d=31-ta(d),o[d]=y}function od(o,d){var y=o.pendingLanes&~d;o.pendingLanes=d,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=d,o.mutableReadLanes&=d,o.entangledLanes&=d,d=o.entanglements;var S=o.eventTimes;for(o=o.expirationTimes;0<y;){var z=31-ta(y),F=1<<z;d[z]=0,S[z]=-1,o[z]=-1,y&=~F}}function ld(o,d){var y=o.entangledLanes|=d;for(o=o.entanglements;y;){var S=31-ta(y),z=1<<S;z&d|o[S]&d&&(o[S]|=d),y&=~z}}var Nr=0;function lc(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var cd,Vi,su,bl,yi,$i=!1,ir=[],Va=null,Ui=null,$a=null,qs=new Map,Ps=new Map,Ir=[],Xt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Br(o,d){switch(o){case"focusin":case"focusout":Va=null;break;case"dragenter":case"dragleave":Ui=null;break;case"mouseover":case"mouseout":$a=null;break;case"pointerover":case"pointerout":qs.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ps.delete(d.pointerId)}}function ra(o,d,y,S,z,F){return o===null||o.nativeEvent!==F?(o={blockedOn:d,domEventName:y,eventSystemFlags:S,nativeEvent:F,targetContainers:[z]},d!==null&&(d=Ca(d),d!==null&&Vi(d)),o):(o.eventSystemFlags|=S,d=o.targetContainers,z!==null&&d.indexOf(z)===-1&&d.push(z),o)}function bn(o,d,y,S,z){switch(d){case"focusin":return Va=ra(Va,o,d,y,S,z),!0;case"dragenter":return Ui=ra(Ui,o,d,y,S,z),!0;case"mouseover":return $a=ra($a,o,d,y,S,z),!0;case"pointerover":var F=z.pointerId;return qs.set(F,ra(qs.get(F)||null,o,d,y,S,z)),!0;case"gotpointercapture":return F=z.pointerId,Ps.set(F,ra(Ps.get(F)||null,o,d,y,S,z)),!0}return!1}function Pn(o){var d=Ea(o.target);if(d!==null){var y=nr(d);if(y!==null){if(d=y.tag,d===13){if(d=ur(y),d!==null){o.blockedOn=d,yi(o.priority,function(){su(y)});return}}else if(d===3&&y.stateNode.current.memoizedState.isDehydrated){o.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Gs(o){if(o.blockedOn!==null)return!1;for(var d=o.targetContainers;0<d.length;){var y=uc(o.domEventName,o.eventSystemFlags,d[0],o.nativeEvent);if(y===null){y=o.nativeEvent;var S=new y.constructor(y.type,y);kt=S,y.target.dispatchEvent(S),kt=null}else return d=Ca(y),d!==null&&Vi(d),o.blockedOn=y,!1;d.shift()}return!0}function So(o,d,y){Gs(o)&&y.delete(d)}function qi(){$i=!1,Va!==null&&Gs(Va)&&(Va=null),Ui!==null&&Gs(Ui)&&(Ui=null),$a!==null&&Gs($a)&&($a=null),qs.forEach(So),Ps.forEach(So)}function Qr(o,d){o.blockedOn===d&&(o.blockedOn=null,$i||($i=!0,k.unstable_scheduleCallback(k.unstable_NormalPriority,qi)))}function wa(o){function d(z){return Qr(z,o)}if(0<ir.length){Qr(ir[0],o);for(var y=1;y<ir.length;y++){var S=ir[y];S.blockedOn===o&&(S.blockedOn=null)}}for(Va!==null&&Qr(Va,o),Ui!==null&&Qr(Ui,o),$a!==null&&Qr($a,o),qs.forEach(d),Ps.forEach(d),y=0;y<Ir.length;y++)S=Ir[y],S.blockedOn===o&&(S.blockedOn=null);for(;0<Ir.length&&(y=Ir[0],y.blockedOn===null);)Pn(y),y.blockedOn===null&&Ir.shift()}var vn=lt.ReactCurrentBatchConfig,To=!0;function Mn(o,d,y,S){var z=Nr,F=vn.transition;vn.transition=null;try{Nr=1,ka(o,d,y,S)}finally{Nr=z,vn.transition=F}}function No(o,d,y,S){var z=Nr,F=vn.transition;vn.transition=null;try{Nr=4,ka(o,d,y,S)}finally{Nr=z,vn.transition=F}}function ka(o,d,y,S){if(To){var z=uc(o,d,y,S);if(z===null)Bo(o,d,S,cc,y),Br(o,S);else if(bn(z,o,d,y,S))S.stopPropagation();else if(Br(o,S),d&4&&-1<Xt.indexOf(o)){for(;z!==null;){var F=Ca(z);if(F!==null&&cd(F),F=uc(o,d,y,S),F===null&&Bo(o,d,S,cc,y),F===z)break;z=F}z!==null&&S.stopPropagation()}else Bo(o,d,S,null,y)}}var cc=null;function uc(o,d,y,S){if(cc=null,o=It(S),o=Ea(o),o!==null)if(d=nr(o),d===null)o=null;else if(y=d.tag,y===13){if(o=ur(d),o!==null)return o;o=null}else if(y===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;o=null}else d!==o&&(o=null);return cc=o,null}function Gi(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yl()){case vo:return 1;case on:return 4;case Tr:case eu:return 16;case wo:return 536870912;default:return 16}default:return 16}}var br=null,Zi=null,pr=null;function or(){if(pr)return pr;var o,d=Zi,y=d.length,S,z="value"in br?br.value:br.textContent,F=z.length;for(o=0;o<y&&d[o]===z[o];o++);var Q=y-o;for(S=1;S<=Q&&d[y-S]===z[F-S];S++);return pr=z.slice(o,1<S?1-S:void 0)}function _i(o){var d=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&d===13&&(o=13)):o=d,o===10&&(o=13),32<=o||o===13?o:0}function mr(){return!0}function vl(){return!1}function fs(o){function d(y,S,z,F,Q){this._reactName=y,this._targetInst=z,this.type=S,this.nativeEvent=F,this.target=Q,this.currentTarget=null;for(var ye in o)o.hasOwnProperty(ye)&&(y=o[ye],this[ye]=y?y(F):F[ye]);return this.isDefaultPrevented=(F.defaultPrevented!=null?F.defaultPrevented:F.returnValue===!1)?mr:vl,this.isPropagationStopped=vl,this}return pt(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=mr)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=mr)},persist:function(){},isPersistent:mr}),d}var ja={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ua=fs(ja),wl=pt({},ja,{view:0,detail:0}),dc=fs(wl),hc,ud,kl,Zs=pt({},wl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hi,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==kl&&(kl&&o.type==="mousemove"?(hc=o.screenX-kl.screenX,ud=o.screenY-kl.screenY):ud=hc=0,kl=o),hc)},movementY:function(o){return"movementY"in o?o.movementY:ud}}),Sa=fs(Zs),os=pt({},Zs,{dataTransfer:0}),Eo=fs(os),dd=pt({},wl,{relatedTarget:0}),Co=fs(dd),xs=pt({},ja,{animationName:0,elapsedTime:0,pseudoElement:0}),hh=fs(xs),hd=pt({},ja,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),ph=fs(hd),np=pt({},ja,{data:0}),Po=fs(np),nu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pc(o){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(o):(o=pd[o])?!!d[o]:!1}function Hi(){return pc}var Sl=pt({},wl,{key:function(o){if(o.key){var d=nu[o.key]||o.key;if(d!=="Unidentified")return d}return o.type==="keypress"?(o=_i(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?jl[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hi,charCode:function(o){return o.type==="keypress"?_i(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?_i(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),Ms=fs(Sl),fh=pt({},Zs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mo=fs(fh),fc=pt({},wl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hi}),Io=fs(fc),ap=pt({},ja,{propertyName:0,elapsedTime:0,pseudoElement:0}),au=fs(ap),ip=pt({},Zs,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),Tl=fs(ip),iu=[9,13,27,32],ou=c&&"CompositionEvent"in window,Nl=null;c&&"documentMode"in document&&(Nl=document.documentMode);var fd=c&&"TextEvent"in window&&!Nl,lu=c&&(!ou||Nl&&8<Nl&&11>=Nl),cu=" ",md=!1;function gd(o,d){switch(o){case"keyup":return iu.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xd(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var sa=!1;function mh(o,d){switch(o){case"compositionend":return xd(d);case"keypress":return d.which!==32?null:(md=!0,cu);case"textInput":return o=d.data,o===cu&&md?null:o;default:return null}}function yd(o,d){if(sa)return o==="compositionend"||!ou&&gd(o,d)?(o=or(),pr=Zi=br=null,sa=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return lu&&d.locale!=="ko"?null:d.data;default:return null}}var El={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _d(o){var d=o&&o.nodeName&&o.nodeName.toLowerCase();return d==="input"?!!El[o.type]:d==="textarea"}function mc(o,d,y,S){Or(S),d=zl(d,"onChange"),0<d.length&&(y=new Ua("onChange","change",null,y,S),o.push({event:y,listeners:d}))}var gc=null,xc=null;function gh(o){wh(o,0)}function Wi(o){var d=Pa(o);if(Qn(d))return o}function xh(o,d){if(o==="change")return d}var uu=!1;if(c){var du;if(c){var Cl="oninput"in document;if(!Cl){var na=document.createElement("div");na.setAttribute("oninput","return;"),Cl=typeof na.oninput=="function"}du=Cl}else du=!1;uu=du&&(!document.documentMode||9<document.documentMode)}function yc(){gc&&(gc.detachEvent("onpropertychange",hu),xc=gc=null)}function hu(o){if(o.propertyName==="value"&&Wi(xc)){var d=[];mc(d,xc,o,It(o)),Gr(gh,d)}}function bd(o,d,y){o==="focusin"?(yc(),gc=d,xc=y,gc.attachEvent("onpropertychange",hu)):o==="focusout"&&yc()}function vd(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Wi(xc)}function pu(o,d){if(o==="click")return Wi(d)}function zo(o,d){if(o==="input"||o==="change")return Wi(d)}function wd(o,d){return o===d&&(o!==0||1/o===1/d)||o!==o&&d!==d}var Ta=typeof Object.is=="function"?Object.is:wd;function Pl(o,d){if(Ta(o,d))return!0;if(typeof o!="object"||o===null||typeof d!="object"||d===null)return!1;var y=Object.keys(o),S=Object.keys(d);if(y.length!==S.length)return!1;for(S=0;S<y.length;S++){var z=y[S];if(!V.call(d,z)||!Ta(o[z],d[z]))return!1}return!0}function yh(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function _h(o,d){var y=yh(o);o=0;for(var S;y;){if(y.nodeType===3){if(S=o+y.textContent.length,o<=d&&S>=d)return{node:y,offset:d-o};o=S}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=yh(y)}}function kd(o,d){return o&&d?o===d?!0:o&&o.nodeType===3?!1:d&&d.nodeType===3?kd(o,d.parentNode):"contains"in o?o.contains(d):o.compareDocumentPosition?!!(o.compareDocumentPosition(d)&16):!1:!1}function bh(){for(var o=window,d=Oi();d instanceof o.HTMLIFrameElement;){try{var y=typeof d.contentWindow.location.href=="string"}catch{y=!1}if(y)o=d.contentWindow;else break;d=Oi(o.document)}return d}function vr(o){var d=o&&o.nodeName&&o.nodeName.toLowerCase();return d&&(d==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||d==="textarea"||o.contentEditable==="true")}function fu(o){var d=bh(),y=o.focusedElem,S=o.selectionRange;if(d!==y&&y&&y.ownerDocument&&kd(y.ownerDocument.documentElement,y)){if(S!==null&&vr(y)){if(d=S.start,o=S.end,o===void 0&&(o=d),"selectionStart"in y)y.selectionStart=d,y.selectionEnd=Math.min(o,y.value.length);else if(o=(d=y.ownerDocument||document)&&d.defaultView||window,o.getSelection){o=o.getSelection();var z=y.textContent.length,F=Math.min(S.start,z);S=S.end===void 0?F:Math.min(S.end,z),!o.extend&&F>S&&(z=S,S=F,F=z),z=_h(y,F);var Q=_h(y,S);z&&Q&&(o.rangeCount!==1||o.anchorNode!==z.node||o.anchorOffset!==z.offset||o.focusNode!==Q.node||o.focusOffset!==Q.offset)&&(d=d.createRange(),d.setStart(z.node,z.offset),o.removeAllRanges(),F>S?(o.addRange(d),o.extend(Q.node,Q.offset)):(d.setEnd(Q.node,Q.offset),o.addRange(d)))}}for(d=[],o=y;o=o.parentNode;)o.nodeType===1&&d.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<d.length;y++)o=d[y],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var mu=c&&"documentMode"in document&&11>=document.documentMode,bi=null,_c=null,Na=null,Ao=!1;function Do(o,d,y){var S=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;Ao||bi==null||bi!==Oi(S)||(S=bi,"selectionStart"in S&&vr(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Na&&Pl(Na,S)||(Na=S,S=zl(_c,"onSelect"),0<S.length&&(d=new Ua("onSelect","select",null,d,y),o.push({event:d,listeners:S}),d.target=bi)))}function wn(o,d){var y={};return y[o.toLowerCase()]=d.toLowerCase(),y["Webkit"+o]="webkit"+d,y["Moz"+o]="moz"+d,y}var Ro={animationend:wn("Animation","AnimationEnd"),animationiteration:wn("Animation","AnimationIteration"),animationstart:wn("Animation","AnimationStart"),transitionend:wn("Transition","TransitionEnd")},gu={},xu={};c&&(xu=document.createElement("div").style,"AnimationEvent"in window||(delete Ro.animationend.animation,delete Ro.animationiteration.animation,delete Ro.animationstart.animation),"TransitionEvent"in window||delete Ro.transitionend.transition);function qa(o){if(gu[o])return gu[o];if(!Ro[o])return o;var d=Ro[o],y;for(y in d)if(d.hasOwnProperty(y)&&y in xu)return gu[o]=d[y];return o}var bc=qa("animationend"),vc=qa("animationiteration"),Ml=qa("animationstart"),wc=qa("transitionend"),jd=new Map,Lo="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wn(o,d){jd.set(o,d),R(d,[o])}for(var yu=0;yu<Lo.length;yu++){var kc=Lo[yu],hr=kc.toLowerCase(),_u=kc[0].toUpperCase()+kc.slice(1);Wn(hr,"on"+_u)}Wn(bc,"onAnimationEnd"),Wn(vc,"onAnimationIteration"),Wn(Ml,"onAnimationStart"),Wn("dblclick","onDoubleClick"),Wn("focusin","onFocus"),Wn("focusout","onBlur"),Wn(wc,"onTransitionEnd"),T("onMouseEnter",["mouseout","mouseover"]),T("onMouseLeave",["mouseout","mouseover"]),T("onPointerEnter",["pointerout","pointerover"]),T("onPointerLeave",["pointerout","pointerover"]),R("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),R("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),R("onBeforeInput",["compositionend","keypress","textInput","paste"]),R("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),R("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),R("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vh=new Set("cancel close invalid load scroll toggle".split(" ").concat(jc));function Il(o,d,y){var S=o.type||"unknown-event";o.currentTarget=y,_t(S,d,void 0,o),o.currentTarget=null}function wh(o,d){d=(d&4)!==0;for(var y=0;y<o.length;y++){var S=o[y],z=S.event;S=S.listeners;e:{var F=void 0;if(d)for(var Q=S.length-1;0<=Q;Q--){var ye=S[Q],Te=ye.instance,He=ye.currentTarget;if(ye=ye.listener,Te!==F&&z.isPropagationStopped())break e;Il(z,ye,He),F=Te}else for(Q=0;Q<S.length;Q++){if(ye=S[Q],Te=ye.instance,He=ye.currentTarget,ye=ye.listener,Te!==F&&z.isPropagationStopped())break e;Il(z,ye,He),F=Te}}}if(Us)throw o=en,Us=!1,en=null,o}function ls(o,d){var y=d[Uo];y===void 0&&(y=d[Uo]=new Set);var S=o+"__bubble";y.has(S)||(Oo(d,o,2,!1),y.add(S))}function bu(o,d,y){var S=0;d&&(S|=4),Oo(y,o,S,d)}var vu="_reactListening"+Math.random().toString(36).slice(2);function Fo(o){if(!o[vu]){o[vu]=!0,P.forEach(function(y){y!=="selectionchange"&&(vh.has(y)||bu(y,!1,o),bu(y,!0,o))});var d=o.nodeType===9?o:o.ownerDocument;d===null||d[vu]||(d[vu]=!0,bu("selectionchange",!1,d))}}function Oo(o,d,y,S){switch(Gi(d)){case 1:var z=Mn;break;case 4:z=No;break;default:z=ka}y=z.bind(null,d,y,o),z=void 0,!Dr||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(z=!0),S?z!==void 0?o.addEventListener(d,y,{capture:!0,passive:z}):o.addEventListener(d,y,!0):z!==void 0?o.addEventListener(d,y,{passive:z}):o.addEventListener(d,y,!1)}function Bo(o,d,y,S,z){var F=S;if((d&1)===0&&(d&2)===0&&S!==null)e:for(;;){if(S===null)return;var Q=S.tag;if(Q===3||Q===4){var ye=S.stateNode.containerInfo;if(ye===z||ye.nodeType===8&&ye.parentNode===z)break;if(Q===4)for(Q=S.return;Q!==null;){var Te=Q.tag;if((Te===3||Te===4)&&(Te=Q.stateNode.containerInfo,Te===z||Te.nodeType===8&&Te.parentNode===z))return;Q=Q.return}for(;ye!==null;){if(Q=Ea(ye),Q===null)return;if(Te=Q.tag,Te===5||Te===6){S=F=Q;continue e}ye=ye.parentNode}}S=S.return}Gr(function(){var He=F,dt=It(y),ft=[];e:{var ut=jd.get(o);if(ut!==void 0){var Dt=Ua,$t=o;switch(o){case"keypress":if(_i(y)===0)break e;case"keydown":case"keyup":Dt=Ms;break;case"focusin":$t="focus",Dt=Co;break;case"focusout":$t="blur",Dt=Co;break;case"beforeblur":case"afterblur":Dt=Co;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Dt=Sa;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Dt=Eo;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Dt=Io;break;case bc:case vc:case Ml:Dt=hh;break;case wc:Dt=au;break;case"scroll":Dt=dc;break;case"wheel":Dt=Tl;break;case"copy":case"cut":case"paste":Dt=ph;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Dt=Mo}var Ut=(d&4)!==0,Ts=!Ut&&o==="scroll",Ve=Ut?ut!==null?ut+"Capture":null:ut;Ut=[];for(var Ee=He,Ge;Ee!==null;){Ge=Ee;var yt=Ge.stateNode;if(Ge.tag===5&&yt!==null&&(Ge=yt,Ve!==null&&(yt=Zr(Ee,Ve),yt!=null&&Ut.push(Xi(Ee,yt,Ge)))),Ts)break;Ee=Ee.return}0<Ut.length&&(ut=new Dt(ut,$t,null,y,dt),ft.push({event:ut,listeners:Ut}))}}if((d&7)===0){e:{if(ut=o==="mouseover"||o==="pointerover",Dt=o==="mouseout"||o==="pointerout",ut&&y!==kt&&($t=y.relatedTarget||y.fromElement)&&(Ea($t)||$t[aa]))break e;if((Dt||ut)&&(ut=dt.window===dt?dt:(ut=dt.ownerDocument)?ut.defaultView||ut.parentWindow:window,Dt?($t=y.relatedTarget||y.toElement,Dt=He,$t=$t?Ea($t):null,$t!==null&&(Ts=nr($t),$t!==Ts||$t.tag!==5&&$t.tag!==6)&&($t=null)):(Dt=null,$t=He),Dt!==$t)){if(Ut=Sa,yt="onMouseLeave",Ve="onMouseEnter",Ee="mouse",(o==="pointerout"||o==="pointerover")&&(Ut=Mo,yt="onPointerLeave",Ve="onPointerEnter",Ee="pointer"),Ts=Dt==null?ut:Pa(Dt),Ge=$t==null?ut:Pa($t),ut=new Ut(yt,Ee+"leave",Dt,y,dt),ut.target=Ts,ut.relatedTarget=Ge,yt=null,Ea(dt)===He&&(Ut=new Ut(Ve,Ee+"enter",$t,y,dt),Ut.target=Ge,Ut.relatedTarget=Ts,yt=Ut),Ts=yt,Dt&&$t)t:{for(Ut=Dt,Ve=$t,Ee=0,Ge=Ut;Ge;Ge=Yi(Ge))Ee++;for(Ge=0,yt=Ve;yt;yt=Yi(yt))Ge++;for(;0<Ee-Ge;)Ut=Yi(Ut),Ee--;for(;0<Ge-Ee;)Ve=Yi(Ve),Ge--;for(;Ee--;){if(Ut===Ve||Ve!==null&&Ut===Ve.alternate)break t;Ut=Yi(Ut),Ve=Yi(Ve)}Ut=null}else Ut=null;Dt!==null&&Sc(ft,ut,Dt,Ut,!1),$t!==null&&Ts!==null&&Sc(ft,Ts,$t,Ut,!0)}}e:{if(ut=He?Pa(He):window,Dt=ut.nodeName&&ut.nodeName.toLowerCase(),Dt==="select"||Dt==="input"&&ut.type==="file")var Gt=xh;else if(_d(ut))if(uu)Gt=zo;else{Gt=vd;var Qt=bd}else(Dt=ut.nodeName)&&Dt.toLowerCase()==="input"&&(ut.type==="checkbox"||ut.type==="radio")&&(Gt=pu);if(Gt&&(Gt=Gt(o,He))){mc(ft,Gt,y,dt);break e}Qt&&Qt(o,ut,He),o==="focusout"&&(Qt=ut._wrapperState)&&Qt.controlled&&ut.type==="number"&&mi(ut,"number",ut.value)}switch(Qt=He?Pa(He):window,o){case"focusin":(_d(Qt)||Qt.contentEditable==="true")&&(bi=Qt,_c=He,Na=null);break;case"focusout":Na=_c=bi=null;break;case"mousedown":Ao=!0;break;case"contextmenu":case"mouseup":case"dragend":Ao=!1,Do(ft,y,dt);break;case"selectionchange":if(mu)break;case"keydown":case"keyup":Do(ft,y,dt)}var sr;if(ou)e:{switch(o){case"compositionstart":var lr="onCompositionStart";break e;case"compositionend":lr="onCompositionEnd";break e;case"compositionupdate":lr="onCompositionUpdate";break e}lr=void 0}else sa?gd(o,y)&&(lr="onCompositionEnd"):o==="keydown"&&y.keyCode===229&&(lr="onCompositionStart");lr&&(lu&&y.locale!=="ko"&&(sa||lr!=="onCompositionStart"?lr==="onCompositionEnd"&&sa&&(sr=or()):(br=dt,Zi="value"in br?br.value:br.textContent,sa=!0)),Qt=zl(He,lr),0<Qt.length&&(lr=new Po(lr,o,null,y,dt),ft.push({event:lr,listeners:Qt}),sr?lr.data=sr:(sr=xd(y),sr!==null&&(lr.data=sr)))),(sr=fd?mh(o,y):yd(o,y))&&(He=zl(He,"onBeforeInput"),0<He.length&&(dt=new Po("onBeforeInput","beforeinput",null,y,dt),ft.push({event:dt,listeners:He}),dt.data=sr))}wh(ft,d)})}function Xi(o,d,y){return{instance:o,listener:d,currentTarget:y}}function zl(o,d){for(var y=d+"Capture",S=[];o!==null;){var z=o,F=z.stateNode;z.tag===5&&F!==null&&(z=F,F=Zr(o,y),F!=null&&S.unshift(Xi(o,F,z)),F=Zr(o,d),F!=null&&S.push(Xi(o,F,z))),o=o.return}return S}function Yi(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Sc(o,d,y,S,z){for(var F=d._reactName,Q=[];y!==null&&y!==S;){var ye=y,Te=ye.alternate,He=ye.stateNode;if(Te!==null&&Te===S)break;ye.tag===5&&He!==null&&(ye=He,z?(Te=Zr(y,F),Te!=null&&Q.unshift(Xi(y,Te,ye))):z||(Te=Zr(y,F),Te!=null&&Q.push(Xi(y,Te,ye)))),y=y.return}Q.length!==0&&o.push({event:d,listeners:Q})}var wu=/\r\n?/g,Ki=/\u0000|\uFFFD/g;function Ji(o){return(typeof o=="string"?o:""+o).replace(wu,`
`).replace(Ki,"")}function Al(o,d,y){if(d=Ji(d),Ji(o)!==d&&y)throw Error(w(425))}function ku(){}var Vo=null,Sd=null;function ju(o,d){return o==="textarea"||o==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var $o=typeof setTimeout=="function"?setTimeout:void 0,Su=typeof clearTimeout=="function"?clearTimeout:void 0,Td=typeof Promise=="function"?Promise:void 0,kh=typeof queueMicrotask=="function"?queueMicrotask:typeof Td<"u"?function(o){return Td.resolve(null).then(o).catch(Tc)}:$o;function Tc(o){setTimeout(function(){throw o})}function Dl(o,d){var y=d,S=0;do{var z=y.nextSibling;if(o.removeChild(y),z&&z.nodeType===8)if(y=z.data,y==="/$"){if(S===0){o.removeChild(z),wa(d);return}S--}else y!=="$"&&y!=="$?"&&y!=="$!"||S++;y=z}while(y);wa(d)}function vi(o){for(;o!=null;o=o.nextSibling){var d=o.nodeType;if(d===1||d===3)break;if(d===8){if(d=o.data,d==="$"||d==="$!"||d==="$?")break;if(d==="/$")return null}}return o}function Nd(o){o=o.previousSibling;for(var d=0;o;){if(o.nodeType===8){var y=o.data;if(y==="$"||y==="$!"||y==="$?"){if(d===0)return o;d--}else y==="/$"&&d++}o=o.previousSibling}return null}var Hr=Math.random().toString(36).slice(2),cn="__reactFiber$"+Hr,tn="__reactProps$"+Hr,aa="__reactContainer$"+Hr,Uo="__reactEvents$"+Hr,Tu="__reactListeners$"+Hr,Qi="__reactHandles$"+Hr;function Ea(o){var d=o[cn];if(d)return d;for(var y=o.parentNode;y;){if(d=y[aa]||y[cn]){if(y=d.alternate,d.child!==null||y!==null&&y.child!==null)for(o=Nd(o);o!==null;){if(y=o[cn])return y;o=Nd(o)}return d}o=y,y=o.parentNode}return null}function Ca(o){return o=o[cn]||o[aa],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function Pa(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(w(33))}function Nc(o){return o[tn]||null}var Nu=[],qo=-1;function wi(o){return{current:o}}function es(o){0>qo||(o.current=Nu[qo],Nu[qo]=null,qo--)}function Er(o,d){qo++,Nu[qo]=o.current,o.current=d}var Ga={},Hs=wi(Ga),Ws=wi(!1),eo=Ga;function to(o,d){var y=o.type.contextTypes;if(!y)return Ga;var S=o.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===d)return S.__reactInternalMemoizedMaskedChildContext;var z={},F;for(F in y)z[F]=d[F];return S&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=d,o.__reactInternalMemoizedMaskedChildContext=z),z}function un(o){return o=o.childContextTypes,o!=null}function Ec(){es(Ws),es(Hs)}function Eu(o,d,y){if(Hs.current!==Ga)throw Error(w(168));Er(Hs,d),Er(Ws,y)}function Cu(o,d,y){var S=o.stateNode;if(d=d.childContextTypes,typeof S.getChildContext!="function")return y;S=S.getChildContext();for(var z in S)if(!(z in d))throw Error(w(108,At(o)||"Unknown",z));return pt({},y,S)}function Ma(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Ga,eo=Hs.current,Er(Hs,o),Er(Ws,Ws.current),!0}function Ed(o,d,y){var S=o.stateNode;if(!S)throw Error(w(169));y?(o=Cu(o,d,eo),S.__reactInternalMemoizedMergedChildContext=o,es(Ws),es(Hs),Er(Hs,o)):es(Ws),Er(Ws,y)}var Is=null,In=!1,Pu=!1;function ia(o){Is===null?Is=[o]:Is.push(o)}function op(o){In=!0,ia(o)}function oa(){if(!Pu&&Is!==null){Pu=!0;var o=0,d=Nr;try{var y=Is;for(Nr=1;o<y.length;o++){var S=y[o];do S=S(!0);while(S!==null)}Is=null,In=!1}catch(z){throw Is!==null&&(Is=Is.slice(o+1)),ml(vo,oa),z}finally{Nr=d,Pu=!1}}return null}var Za=[],ys=0,ro=null,Cc=0,la=[],ca=0,ua=null,zn=1,Ls="";function bt(o,d){Za[ys++]=Cc,Za[ys++]=ro,ro=o,Cc=d}function Pc(o,d,y){la[ca++]=zn,la[ca++]=Ls,la[ca++]=ua,ua=o;var S=zn;o=Ls;var z=32-ta(S)-1;S&=~(1<<z),y+=1;var F=32-ta(d)+z;if(30<F){var Q=z-z%5;F=(S&(1<<Q)-1).toString(32),S>>=Q,z-=Q,zn=1<<32-ta(d)+z|y<<z|S,Ls=F+o}else zn=1<<F|y<<z|S,Ls=o}function Mc(o){o.return!==null&&(bt(o,1),Pc(o,1,0))}function so(o){for(;o===ro;)ro=Za[--ys],Za[ys]=null,Cc=Za[--ys],Za[ys]=null;for(;o===ua;)ua=la[--ca],la[ca]=null,Ls=la[--ca],la[ca]=null,zn=la[--ca],la[ca]=null}var rn=null,sn=null,ts=!1,kn=null;function Mu(o,d){var y=ni(5,null,null,0);y.elementType="DELETED",y.stateNode=d,y.return=o,d=o.deletions,d===null?(o.deletions=[y],o.flags|=16):d.push(y)}function Cd(o,d){switch(o.tag){case 5:var y=o.type;return d=d.nodeType!==1||y.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(o.stateNode=d,rn=o,sn=vi(d.firstChild),!0):!1;case 6:return d=o.pendingProps===""||d.nodeType!==3?null:d,d!==null?(o.stateNode=d,rn=o,sn=null,!0):!1;case 13:return d=d.nodeType!==8?null:d,d!==null?(y=ua!==null?{id:zn,overflow:Ls}:null,o.memoizedState={dehydrated:d,treeContext:y,retryLane:1073741824},y=ni(18,null,null,0),y.stateNode=d,y.return=o,o.child=y,rn=o,sn=null,!0):!1;default:return!1}}function no(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Pd(o){if(ts){var d=sn;if(d){var y=d;if(!Cd(o,d)){if(no(o))throw Error(w(418));d=vi(y.nextSibling);var S=rn;d&&Cd(o,d)?Mu(S,y):(o.flags=o.flags&-4097|2,ts=!1,rn=o)}}else{if(no(o))throw Error(w(418));o.flags=o.flags&-4097|2,ts=!1,rn=o}}}function Ic(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;rn=o}function Go(o){if(o!==rn)return!1;if(!ts)return Ic(o),ts=!0,!1;var d;if((d=o.tag!==3)&&!(d=o.tag!==5)&&(d=o.type,d=d!=="head"&&d!=="body"&&!ju(o.type,o.memoizedProps)),d&&(d=sn)){if(no(o))throw Md(),Error(w(418));for(;d;)Mu(o,d),d=vi(d.nextSibling)}if(Ic(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(w(317));e:{for(o=o.nextSibling,d=0;o;){if(o.nodeType===8){var y=o.data;if(y==="/$"){if(d===0){sn=vi(o.nextSibling);break e}d--}else y!=="$"&&y!=="$!"&&y!=="$?"||d++}o=o.nextSibling}sn=null}}else sn=rn?vi(o.stateNode.nextSibling):null;return!0}function Md(){for(var o=sn;o;)o=vi(o.nextSibling)}function ao(){sn=rn=null,ts=!1}function Iu(o){kn===null?kn=[o]:kn.push(o)}var Id=lt.ReactCurrentBatchConfig;function Zo(o,d,y){if(o=y.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(w(309));var S=y.stateNode}if(!S)throw Error(w(147,o));var z=S,F=""+o;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===F?d.ref:(d=function(Q){var ye=z.refs;Q===null?delete ye[F]:ye[F]=Q},d._stringRef=F,d)}if(typeof o!="string")throw Error(w(284));if(!y._owner)throw Error(w(290,o))}return o}function zc(o,d){throw o=Object.prototype.toString.call(d),Error(w(31,o==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":o))}function ki(o){var d=o._init;return d(o._payload)}function Rr(o){function d(Ve,Ee){if(o){var Ge=Ve.deletions;Ge===null?(Ve.deletions=[Ee],Ve.flags|=16):Ge.push(Ee)}}function y(Ve,Ee){if(!o)return null;for(;Ee!==null;)d(Ve,Ee),Ee=Ee.sibling;return null}function S(Ve,Ee){for(Ve=new Map;Ee!==null;)Ee.key!==null?Ve.set(Ee.key,Ee):Ve.set(Ee.index,Ee),Ee=Ee.sibling;return Ve}function z(Ve,Ee){return Ve=il(Ve,Ee),Ve.index=0,Ve.sibling=null,Ve}function F(Ve,Ee,Ge){return Ve.index=Ge,o?(Ge=Ve.alternate,Ge!==null?(Ge=Ge.index,Ge<Ee?(Ve.flags|=2,Ee):Ge):(Ve.flags|=2,Ee)):(Ve.flags|=1048576,Ee)}function Q(Ve){return o&&Ve.alternate===null&&(Ve.flags|=2),Ve}function ye(Ve,Ee,Ge,yt){return Ee===null||Ee.tag!==6?(Ee=Dh(Ge,Ve.mode,yt),Ee.return=Ve,Ee):(Ee=z(Ee,Ge),Ee.return=Ve,Ee)}function Te(Ve,Ee,Ge,yt){var Gt=Ge.type;return Gt===Ft?dt(Ve,Ee,Ge.props.children,yt,Ge.key):Ee!==null&&(Ee.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===it&&ki(Gt)===Ee.type)?(yt=z(Ee,Ge.props),yt.ref=Zo(Ve,Ee,Ge),yt.return=Ve,yt):(yt=Yu(Ge.type,Ge.key,Ge.props,null,Ve.mode,yt),yt.ref=Zo(Ve,Ee,Ge),yt.return=Ve,yt)}function He(Ve,Ee,Ge,yt){return Ee===null||Ee.tag!==4||Ee.stateNode.containerInfo!==Ge.containerInfo||Ee.stateNode.implementation!==Ge.implementation?(Ee=jp(Ge,Ve.mode,yt),Ee.return=Ve,Ee):(Ee=z(Ee,Ge.children||[]),Ee.return=Ve,Ee)}function dt(Ve,Ee,Ge,yt,Gt){return Ee===null||Ee.tag!==7?(Ee=Yl(Ge,Ve.mode,yt,Gt),Ee.return=Ve,Ee):(Ee=z(Ee,Ge),Ee.return=Ve,Ee)}function ft(Ve,Ee,Ge){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number")return Ee=Dh(""+Ee,Ve.mode,Ge),Ee.return=Ve,Ee;if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Nt:return Ge=Yu(Ee.type,Ee.key,Ee.props,null,Ve.mode,Ge),Ge.ref=Zo(Ve,null,Ee),Ge.return=Ve,Ge;case zt:return Ee=jp(Ee,Ve.mode,Ge),Ee.return=Ve,Ee;case it:var yt=Ee._init;return ft(Ve,yt(Ee._payload),Ge)}if(Oa(Ee)||ht(Ee))return Ee=Yl(Ee,Ve.mode,Ge,null),Ee.return=Ve,Ee;zc(Ve,Ee)}return null}function ut(Ve,Ee,Ge,yt){var Gt=Ee!==null?Ee.key:null;if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number")return Gt!==null?null:ye(Ve,Ee,""+Ge,yt);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case Nt:return Ge.key===Gt?Te(Ve,Ee,Ge,yt):null;case zt:return Ge.key===Gt?He(Ve,Ee,Ge,yt):null;case it:return Gt=Ge._init,ut(Ve,Ee,Gt(Ge._payload),yt)}if(Oa(Ge)||ht(Ge))return Gt!==null?null:dt(Ve,Ee,Ge,yt,null);zc(Ve,Ge)}return null}function Dt(Ve,Ee,Ge,yt,Gt){if(typeof yt=="string"&&yt!==""||typeof yt=="number")return Ve=Ve.get(Ge)||null,ye(Ee,Ve,""+yt,Gt);if(typeof yt=="object"&&yt!==null){switch(yt.$$typeof){case Nt:return Ve=Ve.get(yt.key===null?Ge:yt.key)||null,Te(Ee,Ve,yt,Gt);case zt:return Ve=Ve.get(yt.key===null?Ge:yt.key)||null,He(Ee,Ve,yt,Gt);case it:var Qt=yt._init;return Dt(Ve,Ee,Ge,Qt(yt._payload),Gt)}if(Oa(yt)||ht(yt))return Ve=Ve.get(Ge)||null,dt(Ee,Ve,yt,Gt,null);zc(Ee,yt)}return null}function $t(Ve,Ee,Ge,yt){for(var Gt=null,Qt=null,sr=Ee,lr=Ee=0,fn=null;sr!==null&&lr<Ge.length;lr++){sr.index>lr?(fn=sr,sr=null):fn=sr.sibling;var Lr=ut(Ve,sr,Ge[lr],yt);if(Lr===null){sr===null&&(sr=fn);break}o&&sr&&Lr.alternate===null&&d(Ve,sr),Ee=F(Lr,Ee,lr),Qt===null?Gt=Lr:Qt.sibling=Lr,Qt=Lr,sr=fn}if(lr===Ge.length)return y(Ve,sr),ts&&bt(Ve,lr),Gt;if(sr===null){for(;lr<Ge.length;lr++)sr=ft(Ve,Ge[lr],yt),sr!==null&&(Ee=F(sr,Ee,lr),Qt===null?Gt=sr:Qt.sibling=sr,Qt=sr);return ts&&bt(Ve,lr),Gt}for(sr=S(Ve,sr);lr<Ge.length;lr++)fn=Dt(sr,Ve,lr,Ge[lr],yt),fn!==null&&(o&&fn.alternate!==null&&sr.delete(fn.key===null?lr:fn.key),Ee=F(fn,Ee,lr),Qt===null?Gt=fn:Qt.sibling=fn,Qt=fn);return o&&sr.forEach(function(Kl){return d(Ve,Kl)}),ts&&bt(Ve,lr),Gt}function Ut(Ve,Ee,Ge,yt){var Gt=ht(Ge);if(typeof Gt!="function")throw Error(w(150));if(Ge=Gt.call(Ge),Ge==null)throw Error(w(151));for(var Qt=Gt=null,sr=Ee,lr=Ee=0,fn=null,Lr=Ge.next();sr!==null&&!Lr.done;lr++,Lr=Ge.next()){sr.index>lr?(fn=sr,sr=null):fn=sr.sibling;var Kl=ut(Ve,sr,Lr.value,yt);if(Kl===null){sr===null&&(sr=fn);break}o&&sr&&Kl.alternate===null&&d(Ve,sr),Ee=F(Kl,Ee,lr),Qt===null?Gt=Kl:Qt.sibling=Kl,Qt=Kl,sr=fn}if(Lr.done)return y(Ve,sr),ts&&bt(Ve,lr),Gt;if(sr===null){for(;!Lr.done;lr++,Lr=Ge.next())Lr=ft(Ve,Lr.value,yt),Lr!==null&&(Ee=F(Lr,Ee,lr),Qt===null?Gt=Lr:Qt.sibling=Lr,Qt=Lr);return ts&&bt(Ve,lr),Gt}for(sr=S(Ve,sr);!Lr.done;lr++,Lr=Ge.next())Lr=Dt(sr,Ve,lr,Lr.value,yt),Lr!==null&&(o&&Lr.alternate!==null&&sr.delete(Lr.key===null?lr:Lr.key),Ee=F(Lr,Ee,lr),Qt===null?Gt=Lr:Qt.sibling=Lr,Qt=Lr);return o&&sr.forEach(function(Nf){return d(Ve,Nf)}),ts&&bt(Ve,lr),Gt}function Ts(Ve,Ee,Ge,yt){if(typeof Ge=="object"&&Ge!==null&&Ge.type===Ft&&Ge.key===null&&(Ge=Ge.props.children),typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case Nt:e:{for(var Gt=Ge.key,Qt=Ee;Qt!==null;){if(Qt.key===Gt){if(Gt=Ge.type,Gt===Ft){if(Qt.tag===7){y(Ve,Qt.sibling),Ee=z(Qt,Ge.props.children),Ee.return=Ve,Ve=Ee;break e}}else if(Qt.elementType===Gt||typeof Gt=="object"&&Gt!==null&&Gt.$$typeof===it&&ki(Gt)===Qt.type){y(Ve,Qt.sibling),Ee=z(Qt,Ge.props),Ee.ref=Zo(Ve,Qt,Ge),Ee.return=Ve,Ve=Ee;break e}y(Ve,Qt);break}else d(Ve,Qt);Qt=Qt.sibling}Ge.type===Ft?(Ee=Yl(Ge.props.children,Ve.mode,yt,Ge.key),Ee.return=Ve,Ve=Ee):(yt=Yu(Ge.type,Ge.key,Ge.props,null,Ve.mode,yt),yt.ref=Zo(Ve,Ee,Ge),yt.return=Ve,Ve=yt)}return Q(Ve);case zt:e:{for(Qt=Ge.key;Ee!==null;){if(Ee.key===Qt)if(Ee.tag===4&&Ee.stateNode.containerInfo===Ge.containerInfo&&Ee.stateNode.implementation===Ge.implementation){y(Ve,Ee.sibling),Ee=z(Ee,Ge.children||[]),Ee.return=Ve,Ve=Ee;break e}else{y(Ve,Ee);break}else d(Ve,Ee);Ee=Ee.sibling}Ee=jp(Ge,Ve.mode,yt),Ee.return=Ve,Ve=Ee}return Q(Ve);case it:return Qt=Ge._init,Ts(Ve,Ee,Qt(Ge._payload),yt)}if(Oa(Ge))return $t(Ve,Ee,Ge,yt);if(ht(Ge))return Ut(Ve,Ee,Ge,yt);zc(Ve,Ge)}return typeof Ge=="string"&&Ge!==""||typeof Ge=="number"?(Ge=""+Ge,Ee!==null&&Ee.tag===6?(y(Ve,Ee.sibling),Ee=z(Ee,Ge),Ee.return=Ve,Ve=Ee):(y(Ve,Ee),Ee=Dh(Ge,Ve.mode,yt),Ee.return=Ve,Ve=Ee),Q(Ve)):y(Ve,Ee)}return Ts}var Rl=Rr(!0),Ll=Rr(!1),Ho=wi(null),Wo=null,io=null,zu=null;function Au(){zu=io=Wo=null}function Du(o){var d=Ho.current;es(Ho),o._currentValue=d}function Xn(o,d,y){for(;o!==null;){var S=o.alternate;if((o.childLanes&d)!==d?(o.childLanes|=d,S!==null&&(S.childLanes|=d)):S!==null&&(S.childLanes&d)!==d&&(S.childLanes|=d),o===y)break;o=o.return}}function Ha(o,d){Wo=o,zu=io=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&d)!==0&&(Sn=!0),o.firstContext=null)}function Et(o){var d=o._currentValue;if(zu!==o)if(o={context:o,memoizedValue:d,next:null},io===null){if(Wo===null)throw Error(w(308));io=o,Wo.dependencies={lanes:0,firstContext:o}}else io=io.next=o;return d}var Rt=null;function Xo(o){Rt===null?Rt=[o]:Rt.push(o)}function Ac(o,d,y,S){var z=d.interleaved;return z===null?(y.next=y,Xo(d)):(y.next=z.next,z.next=y),d.interleaved=y,da(o,S)}function da(o,d){o.lanes|=d;var y=o.alternate;for(y!==null&&(y.lanes|=d),y=o,o=o.return;o!==null;)o.childLanes|=d,y=o.alternate,y!==null&&(y.childLanes|=d),y=o,o=o.return;return y.tag===3?y.stateNode:null}var ws=!1;function An(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ru(o,d){o=o.updateQueue,d.updateQueue===o&&(d.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Wa(o,d){return{eventTime:o,lane:d,tag:0,payload:null,callback:null,next:null}}function oo(o,d,y){var S=o.updateQueue;if(S===null)return null;if(S=S.shared,(Ar&2)!==0){var z=S.pending;return z===null?d.next=d:(d.next=z.next,z.next=d),S.pending=d,da(o,y)}return z=S.interleaved,z===null?(d.next=d,Xo(S)):(d.next=z.next,z.next=d),S.interleaved=d,da(o,y)}function Lu(o,d,y){if(d=d.updateQueue,d!==null&&(d=d.shared,(y&4194240)!==0)){var S=d.lanes;S&=o.pendingLanes,y|=S,d.lanes=y,ld(o,y)}}function Fl(o,d){var y=o.updateQueue,S=o.alternate;if(S!==null&&(S=S.updateQueue,y===S)){var z=null,F=null;if(y=y.firstBaseUpdate,y!==null){do{var Q={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};F===null?z=F=Q:F=F.next=Q,y=y.next}while(y!==null);F===null?z=F=d:F=F.next=d}else z=F=d;y={baseState:S.baseState,firstBaseUpdate:z,lastBaseUpdate:F,shared:S.shared,effects:S.effects},o.updateQueue=y;return}o=y.lastBaseUpdate,o===null?y.firstBaseUpdate=d:o.next=d,y.lastBaseUpdate=d}function Wr(o,d,y,S){var z=o.updateQueue;ws=!1;var F=z.firstBaseUpdate,Q=z.lastBaseUpdate,ye=z.shared.pending;if(ye!==null){z.shared.pending=null;var Te=ye,He=Te.next;Te.next=null,Q===null?F=He:Q.next=He,Q=Te;var dt=o.alternate;dt!==null&&(dt=dt.updateQueue,ye=dt.lastBaseUpdate,ye!==Q&&(ye===null?dt.firstBaseUpdate=He:ye.next=He,dt.lastBaseUpdate=Te))}if(F!==null){var ft=z.baseState;Q=0,dt=He=Te=null,ye=F;do{var ut=ye.lane,Dt=ye.eventTime;if((S&ut)===ut){dt!==null&&(dt=dt.next={eventTime:Dt,lane:0,tag:ye.tag,payload:ye.payload,callback:ye.callback,next:null});e:{var $t=o,Ut=ye;switch(ut=d,Dt=y,Ut.tag){case 1:if($t=Ut.payload,typeof $t=="function"){ft=$t.call(Dt,ft,ut);break e}ft=$t;break e;case 3:$t.flags=$t.flags&-65537|128;case 0:if($t=Ut.payload,ut=typeof $t=="function"?$t.call(Dt,ft,ut):$t,ut==null)break e;ft=pt({},ft,ut);break e;case 2:ws=!0}}ye.callback!==null&&ye.lane!==0&&(o.flags|=64,ut=z.effects,ut===null?z.effects=[ye]:ut.push(ye))}else Dt={eventTime:Dt,lane:ut,tag:ye.tag,payload:ye.payload,callback:ye.callback,next:null},dt===null?(He=dt=Dt,Te=ft):dt=dt.next=Dt,Q|=ut;if(ye=ye.next,ye===null){if(ye=z.shared.pending,ye===null)break;ut=ye,ye=ut.next,ut.next=null,z.lastBaseUpdate=ut,z.shared.pending=null}}while(!0);if(dt===null&&(Te=ft),z.baseState=Te,z.firstBaseUpdate=He,z.lastBaseUpdate=dt,d=z.shared.interleaved,d!==null){z=d;do Q|=z.lane,z=z.next;while(z!==d)}else F===null&&(z.shared.lanes=0);$l|=Q,o.lanes=Q,o.memoizedState=ft}}function _s(o,d,y){if(o=d.effects,d.effects=null,o!==null)for(d=0;d<o.length;d++){var S=o[d],z=S.callback;if(z!==null){if(S.callback=null,S=y,typeof z!="function")throw Error(w(191,z));z.call(S)}}}var Ia={},Dn=wi(Ia),lo=wi(Ia),Yo=wi(Ia);function Xa(o){if(o===Ia)throw Error(w(174));return o}function Dc(o,d){switch(Er(Yo,d),Er(lo,o),Er(Dn,Ia),o=d.nodeType,o){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:Y(null,"");break;default:o=o===8?d.parentNode:d,d=o.namespaceURI||null,o=o.tagName,d=Y(d,o)}es(Dn),Er(Dn,d)}function Ya(){es(Dn),es(lo),es(Yo)}function Ka(o){Xa(Yo.current);var d=Xa(Dn.current),y=Y(d,o.type);d!==y&&(Er(lo,o),Er(Dn,y))}function Ol(o){lo.current===o&&(es(Dn),es(lo))}var Xr=wi(0);function Ko(o){for(var d=o;d!==null;){if(d.tag===13){var y=d.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var Jo=[];function Rc(){for(var o=0;o<Jo.length;o++)Jo[o]._workInProgressVersionPrimary=null;Jo.length=0}var ji=lt.ReactCurrentDispatcher,Si=lt.ReactCurrentBatchConfig,Ti=0,Yr=null,cs=null,zs=null,Qo=!1,co=!1,el=0,m=0;function t(){throw Error(w(321))}function n(o,d){if(d===null)return!1;for(var y=0;y<d.length&&y<o.length;y++)if(!Ta(o[y],d[y]))return!1;return!0}function l(o,d,y,S,z,F){if(Ti=F,Yr=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,ji.current=o===null||o.memoizedState===null?us:Xs,o=y(S,z),co){F=0;do{if(co=!1,el=0,25<=F)throw Error(w(301));F+=1,zs=cs=null,d.updateQueue=null,ji.current=js,o=y(S,z)}while(co)}if(ji.current=ns,d=cs!==null&&cs.next!==null,Ti=0,zs=cs=Yr=null,Qo=!1,d)throw Error(w(300));return o}function h(){var o=el!==0;return el=0,o}function g(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zs===null?Yr.memoizedState=zs=o:zs=zs.next=o,zs}function _(){if(cs===null){var o=Yr.alternate;o=o!==null?o.memoizedState:null}else o=cs.next;var d=zs===null?Yr.memoizedState:zs.next;if(d!==null)zs=d,cs=o;else{if(o===null)throw Error(w(310));cs=o,o={memoizedState:cs.memoizedState,baseState:cs.baseState,baseQueue:cs.baseQueue,queue:cs.queue,next:null},zs===null?Yr.memoizedState=zs=o:zs=zs.next=o}return zs}function j(o,d){return typeof d=="function"?d(o):d}function E(o){var d=_(),y=d.queue;if(y===null)throw Error(w(311));y.lastRenderedReducer=o;var S=cs,z=S.baseQueue,F=y.pending;if(F!==null){if(z!==null){var Q=z.next;z.next=F.next,F.next=Q}S.baseQueue=z=F,y.pending=null}if(z!==null){F=z.next,S=S.baseState;var ye=Q=null,Te=null,He=F;do{var dt=He.lane;if((Ti&dt)===dt)Te!==null&&(Te=Te.next={lane:0,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null}),S=He.hasEagerState?He.eagerState:o(S,He.action);else{var ft={lane:dt,action:He.action,hasEagerState:He.hasEagerState,eagerState:He.eagerState,next:null};Te===null?(ye=Te=ft,Q=S):Te=Te.next=ft,Yr.lanes|=dt,$l|=dt}He=He.next}while(He!==null&&He!==F);Te===null?Q=S:Te.next=ye,Ta(S,d.memoizedState)||(Sn=!0),d.memoizedState=S,d.baseState=Q,d.baseQueue=Te,y.lastRenderedState=S}if(o=y.interleaved,o!==null){z=o;do F=z.lane,Yr.lanes|=F,$l|=F,z=z.next;while(z!==o)}else z===null&&(y.lanes=0);return[d.memoizedState,y.dispatch]}function M(o){var d=_(),y=d.queue;if(y===null)throw Error(w(311));y.lastRenderedReducer=o;var S=y.dispatch,z=y.pending,F=d.memoizedState;if(z!==null){y.pending=null;var Q=z=z.next;do F=o(F,Q.action),Q=Q.next;while(Q!==z);Ta(F,d.memoizedState)||(Sn=!0),d.memoizedState=F,d.baseQueue===null&&(d.baseState=F),y.lastRenderedState=F}return[F,S]}function D(){}function $(o,d){var y=Yr,S=_(),z=d(),F=!Ta(S.memoizedState,z);if(F&&(S.memoizedState=z,Sn=!0),S=S.queue,me(J.bind(null,y,S,o),[o]),S.getSnapshot!==d||F||zs!==null&&zs.memoizedState.tag&1){if(y.flags|=2048,de(9,G.bind(null,y,S,z,d),void 0,null),pn===null)throw Error(w(349));(Ti&30)!==0||B(y,d,z)}return z}function B(o,d,y){o.flags|=16384,o={getSnapshot:d,value:y},d=Yr.updateQueue,d===null?(d={lastEffect:null,stores:null},Yr.updateQueue=d,d.stores=[o]):(y=d.stores,y===null?d.stores=[o]:y.push(o))}function G(o,d,y,S){d.value=y,d.getSnapshot=S,le(d)&&ue(o)}function J(o,d,y){return y(function(){le(d)&&ue(o)})}function le(o){var d=o.getSnapshot;o=o.value;try{var y=d();return!Ta(o,y)}catch{return!0}}function ue(o){var d=da(o,1);d!==null&&zi(d,o,1,-1)}function ce(o){var d=g();return typeof o=="function"&&(o=o()),d.memoizedState=d.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:j,lastRenderedState:o},d.queue=o,o=o.dispatch=rs.bind(null,Yr,o),[d.memoizedState,o]}function de(o,d,y,S){return o={tag:o,create:d,destroy:y,deps:S,next:null},d=Yr.updateQueue,d===null?(d={lastEffect:null,stores:null},Yr.updateQueue=d,d.lastEffect=o.next=o):(y=d.lastEffect,y===null?d.lastEffect=o.next=o:(S=y.next,y.next=o,o.next=S,d.lastEffect=o)),o}function xe(){return _().memoizedState}function he(o,d,y,S){var z=g();Yr.flags|=o,z.memoizedState=de(1|d,y,void 0,S===void 0?null:S)}function ge(o,d,y,S){var z=_();S=S===void 0?null:S;var F=void 0;if(cs!==null){var Q=cs.memoizedState;if(F=Q.destroy,S!==null&&n(S,Q.deps)){z.memoizedState=de(d,y,F,S);return}}Yr.flags|=o,z.memoizedState=de(1|d,y,F,S)}function we(o,d){return he(8390656,8,o,d)}function me(o,d){return ge(2048,8,o,d)}function Ne(o,d){return ge(4,2,o,d)}function Ue(o,d){return ge(4,4,o,d)}function Re(o,d){if(typeof d=="function")return o=o(),d(o),function(){d(null)};if(d!=null)return o=o(),d.current=o,function(){d.current=null}}function Oe(o,d,y){return y=y!=null?y.concat([o]):null,ge(4,4,Re.bind(null,d,o),y)}function Be(){}function ot(o,d){var y=_();d=d===void 0?null:d;var S=y.memoizedState;return S!==null&&d!==null&&n(d,S[1])?S[0]:(y.memoizedState=[o,d],o)}function ct(o,d){var y=_();d=d===void 0?null:d;var S=y.memoizedState;return S!==null&&d!==null&&n(d,S[1])?S[0]:(o=o(),y.memoizedState=[o,d],o)}function et(o,d,y){return(Ti&21)===0?(o.baseState&&(o.baseState=!1,Sn=!0),o.memoizedState=y):(Ta(y,d)||(y=ru(),Yr.lanes|=y,$l|=y,o.baseState=!0),d)}function xt(o,d){var y=Nr;Nr=y!==0&&4>y?y:4,o(!0);var S=Si.transition;Si.transition={};try{o(!1),d()}finally{Nr=y,Si.transition=S}}function rr(){return _().memoizedState}function zr(o,d,y){var S=fa(o);if(y={lane:S,action:y,hasEagerState:!1,eagerState:null,next:null},Vr(o))ss(d,y);else if(y=Ac(o,d,y,S),y!==null){var z=On();zi(y,o,S,z),$r(y,d,S)}}function rs(o,d,y){var S=fa(o),z={lane:S,action:y,hasEagerState:!1,eagerState:null,next:null};if(Vr(o))ss(d,z);else{var F=o.alternate;if(o.lanes===0&&(F===null||F.lanes===0)&&(F=d.lastRenderedReducer,F!==null))try{var Q=d.lastRenderedState,ye=F(Q,y);if(z.hasEagerState=!0,z.eagerState=ye,Ta(ye,Q)){var Te=d.interleaved;Te===null?(z.next=z,Xo(d)):(z.next=Te.next,Te.next=z),d.interleaved=z;return}}catch{}y=Ac(o,d,z,S),y!==null&&(z=On(),zi(y,o,S,z),$r(y,d,S))}}function Vr(o){var d=o.alternate;return o===Yr||d!==null&&d===Yr}function ss(o,d){co=Qo=!0;var y=o.pending;y===null?d.next=d:(d.next=y.next,y.next=d),o.pending=d}function $r(o,d,y){if((y&4194240)!==0){var S=d.lanes;S&=o.pendingLanes,y|=S,d.lanes=y,ld(o,y)}}var ns={readContext:Et,useCallback:t,useContext:t,useEffect:t,useImperativeHandle:t,useInsertionEffect:t,useLayoutEffect:t,useMemo:t,useReducer:t,useRef:t,useState:t,useDebugValue:t,useDeferredValue:t,useTransition:t,useMutableSource:t,useSyncExternalStore:t,useId:t,unstable_isNewReconciler:!1},us={readContext:Et,useCallback:function(o,d){return g().memoizedState=[o,d===void 0?null:d],o},useContext:Et,useEffect:we,useImperativeHandle:function(o,d,y){return y=y!=null?y.concat([o]):null,he(4194308,4,Re.bind(null,d,o),y)},useLayoutEffect:function(o,d){return he(4194308,4,o,d)},useInsertionEffect:function(o,d){return he(4,2,o,d)},useMemo:function(o,d){var y=g();return d=d===void 0?null:d,o=o(),y.memoizedState=[o,d],o},useReducer:function(o,d,y){var S=g();return d=y!==void 0?y(d):d,S.memoizedState=S.baseState=d,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:d},S.queue=o,o=o.dispatch=zr.bind(null,Yr,o),[S.memoizedState,o]},useRef:function(o){var d=g();return o={current:o},d.memoizedState=o},useState:ce,useDebugValue:Be,useDeferredValue:function(o){return g().memoizedState=o},useTransition:function(){var o=ce(!1),d=o[0];return o=xt.bind(null,o[1]),g().memoizedState=o,[d,o]},useMutableSource:function(){},useSyncExternalStore:function(o,d,y){var S=Yr,z=g();if(ts){if(y===void 0)throw Error(w(407));y=y()}else{if(y=d(),pn===null)throw Error(w(349));(Ti&30)!==0||B(S,d,y)}z.memoizedState=y;var F={value:y,getSnapshot:d};return z.queue=F,we(J.bind(null,S,F,o),[o]),S.flags|=2048,de(9,G.bind(null,S,F,y,d),void 0,null),y},useId:function(){var o=g(),d=pn.identifierPrefix;if(ts){var y=Ls,S=zn;y=(S&~(1<<32-ta(S)-1)).toString(32)+y,d=":"+d+"R"+y,y=el++,0<y&&(d+="H"+y.toString(32)),d+=":"}else y=m++,d=":"+d+"r"+y.toString(32)+":";return o.memoizedState=d},unstable_isNewReconciler:!1},Xs={readContext:Et,useCallback:ot,useContext:Et,useEffect:me,useImperativeHandle:Oe,useInsertionEffect:Ne,useLayoutEffect:Ue,useMemo:ct,useReducer:E,useRef:xe,useState:function(){return E(j)},useDebugValue:Be,useDeferredValue:function(o){var d=_();return et(d,cs.memoizedState,o)},useTransition:function(){var o=E(j)[0],d=_().memoizedState;return[o,d]},useMutableSource:D,useSyncExternalStore:$,useId:rr,unstable_isNewReconciler:!1},js={readContext:Et,useCallback:ot,useContext:Et,useEffect:me,useImperativeHandle:Oe,useInsertionEffect:Ne,useLayoutEffect:Ue,useMemo:ct,useReducer:M,useRef:xe,useState:function(){return M(j)},useDebugValue:Be,useDeferredValue:function(o){var d=_();return cs===null?d.memoizedState=o:et(d,cs.memoizedState,o)},useTransition:function(){var o=M(j)[0],d=_().memoizedState;return[o,d]},useMutableSource:D,useSyncExternalStore:$,useId:rr,unstable_isNewReconciler:!1};function Pr(o,d){if(o&&o.defaultProps){d=pt({},d),o=o.defaultProps;for(var y in o)d[y]===void 0&&(d[y]=o[y]);return d}return d}function Fs(o,d,y,S){d=o.memoizedState,y=y(S,d),y=y==null?d:pt({},d,y),o.memoizedState=y,o.lanes===0&&(o.updateQueue.baseState=y)}var za={isMounted:function(o){return(o=o._reactInternals)?nr(o)===o:!1},enqueueSetState:function(o,d,y){o=o._reactInternals;var S=On(),z=fa(o),F=Wa(S,z);F.payload=d,y!=null&&(F.callback=y),d=oo(o,F,z),d!==null&&(zi(d,o,z,S),Lu(d,o,z))},enqueueReplaceState:function(o,d,y){o=o._reactInternals;var S=On(),z=fa(o),F=Wa(S,z);F.tag=1,F.payload=d,y!=null&&(F.callback=y),d=oo(o,F,z),d!==null&&(zi(d,o,z,S),Lu(d,o,z))},enqueueForceUpdate:function(o,d){o=o._reactInternals;var y=On(),S=fa(o),z=Wa(y,S);z.tag=2,d!=null&&(z.callback=d),d=oo(o,z,S),d!==null&&(zi(d,o,S,y),Lu(d,o,S))}};function Ja(o,d,y,S,z,F,Q){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(S,F,Q):d.prototype&&d.prototype.isPureReactComponent?!Pl(y,S)||!Pl(z,F):!0}function Aa(o,d,y){var S=!1,z=Ga,F=d.contextType;return typeof F=="object"&&F!==null?F=Et(F):(z=un(d)?eo:Hs.current,S=d.contextTypes,F=(S=S!=null)?to(o,z):Ga),d=new d(y,F),o.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=za,o.stateNode=d,d._reactInternals=o,S&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=z,o.__reactInternalMemoizedMaskedChildContext=F),d}function jn(o,d,y,S){o=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(y,S),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(y,S),d.state!==o&&za.enqueueReplaceState(d,d.state,null)}function Ni(o,d,y,S){var z=o.stateNode;z.props=y,z.state=o.memoizedState,z.refs={},An(o);var F=d.contextType;typeof F=="object"&&F!==null?z.context=Et(F):(F=un(d)?eo:Hs.current,z.context=to(o,F)),z.state=o.memoizedState,F=d.getDerivedStateFromProps,typeof F=="function"&&(Fs(o,d,F,y),z.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(d=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),d!==z.state&&za.enqueueReplaceState(z,z.state,null),Wr(o,y,z,S),z.state=o.memoizedState),typeof z.componentDidMount=="function"&&(o.flags|=4194308)}function Qa(o,d){try{var y="",S=d;do y+=wt(S),S=S.return;while(S);var z=y}catch(F){z=`
Error generating stack: `+F.message+`
`+F.stack}return{value:o,source:d,stack:z,digest:null}}function Ei(o,d,y){return{value:o,source:null,stack:y??null,digest:d??null}}function Rn(o,d){try{console.error(d.value)}catch(y){setTimeout(function(){throw y})}}var ei=typeof WeakMap=="function"?WeakMap:Map;function ha(o,d,y){y=Wa(-1,y),y.tag=3,y.payload={element:null};var S=d.value;return y.callback=function(){ql||(ql=!0,Ph=S),Rn(o,d)},y}function pa(o,d,y){y=Wa(-1,y),y.tag=3;var S=o.type.getDerivedStateFromError;if(typeof S=="function"){var z=d.value;y.payload=function(){return S(z)},y.callback=function(){Rn(o,d)}}var F=o.stateNode;return F!==null&&typeof F.componentDidCatch=="function"&&(y.callback=function(){Rn(o,d),typeof S!="function"&&(nl===null?nl=new Set([this]):nl.add(this));var Q=d.stack;this.componentDidCatch(d.value,{componentStack:Q!==null?Q:""})}),y}function qr(o,d,y){var S=o.pingCache;if(S===null){S=o.pingCache=new ei;var z=new Set;S.set(d,z)}else z=S.get(d),z===void 0&&(z=new Set,S.set(d,z));z.has(y)||(z.add(y),o=xf.bind(null,o,d,y),d.then(o,o))}function Ur(o){do{var d;if((d=o.tag===13)&&(d=o.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return o;o=o.return}while(o!==null);return null}function As(o,d,y,S,z){return(o.mode&1)===0?(o===d?o.flags|=65536:(o.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(d=Wa(-1,1),d.tag=2,oo(y,d,1))),y.lanes|=1),o):(o.flags|=65536,o.lanes=z,o)}var Os=lt.ReactCurrentOwner,Sn=!1;function dn(o,d,y,S){d.child=o===null?Ll(d,null,y,S):Rl(d,o.child,y,S)}function uo(o,d,y,S,z){y=y.render;var F=d.ref;return Ha(d,z),S=l(o,d,y,S,F,z),y=h(),o!==null&&!Sn?(d.updateQueue=o.updateQueue,d.flags&=-2053,o.lanes&=~z,rl(o,d,z)):(ts&&y&&Mc(d),d.flags|=1,dn(o,d,S,z),d.child)}function jh(o,d,y,S,z){if(o===null){var F=y.type;return typeof F=="function"&&!kp(F)&&F.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(d.tag=15,d.type=F,zd(o,d,F,S,z)):(o=Yu(y.type,null,S,d,d.mode,z),o.ref=d.ref,o.return=d,d.child=o)}if(F=o.child,(o.lanes&z)===0){var Q=F.memoizedProps;if(y=y.compare,y=y!==null?y:Pl,y(Q,S)&&o.ref===d.ref)return rl(o,d,z)}return d.flags|=1,o=il(F,S),o.ref=d.ref,o.return=d,d.child=o}function zd(o,d,y,S,z){if(o!==null){var F=o.memoizedProps;if(Pl(F,S)&&o.ref===d.ref)if(Sn=!1,d.pendingProps=S=F,(o.lanes&z)!==0)(o.flags&131072)!==0&&(Sn=!0);else return d.lanes=o.lanes,rl(o,d,z)}return ti(o,d,y,S,z)}function Fu(o,d,y){var S=d.pendingProps,z=S.children,F=o!==null?o.memoizedState:null;if(S.mode==="hidden")if((d.mode&1)===0)d.memoizedState={baseLanes:0,cachePool:null,transitions:null},Er(Hu,Ra),Ra|=y;else{if((y&1073741824)===0)return o=F!==null?F.baseLanes|y:y,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:o,cachePool:null,transitions:null},d.updateQueue=null,Er(Hu,Ra),Ra|=o,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=F!==null?F.baseLanes:y,Er(Hu,Ra),Ra|=S}else F!==null?(S=F.baseLanes|y,d.memoizedState=null):S=y,Er(Hu,Ra),Ra|=S;return dn(o,d,z,y),d.child}function Ci(o,d){var y=d.ref;(o===null&&y!==null||o!==null&&o.ref!==y)&&(d.flags|=512,d.flags|=2097152)}function ti(o,d,y,S,z){var F=un(y)?eo:Hs.current;return F=to(d,F),Ha(d,z),y=l(o,d,y,S,F,z),S=h(),o!==null&&!Sn?(d.updateQueue=o.updateQueue,d.flags&=-2053,o.lanes&=~z,rl(o,d,z)):(ts&&S&&Mc(d),d.flags|=1,dn(o,d,y,z),d.child)}function Pi(o,d,y,S,z){if(un(y)){var F=!0;Ma(d)}else F=!1;if(Ha(d,z),d.stateNode===null)tl(o,d),Aa(d,y,S),Ni(d,y,S,z),S=!0;else if(o===null){var Q=d.stateNode,ye=d.memoizedProps;Q.props=ye;var Te=Q.context,He=y.contextType;typeof He=="object"&&He!==null?He=Et(He):(He=un(y)?eo:Hs.current,He=to(d,He));var dt=y.getDerivedStateFromProps,ft=typeof dt=="function"||typeof Q.getSnapshotBeforeUpdate=="function";ft||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(ye!==S||Te!==He)&&jn(d,Q,S,He),ws=!1;var ut=d.memoizedState;Q.state=ut,Wr(d,S,Q,z),Te=d.memoizedState,ye!==S||ut!==Te||Ws.current||ws?(typeof dt=="function"&&(Fs(d,y,dt,S),Te=d.memoizedState),(ye=ws||Ja(d,y,ye,S,ut,Te,He))?(ft||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(d.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=S,d.memoizedState=Te),Q.props=S,Q.state=Te,Q.context=He,S=ye):(typeof Q.componentDidMount=="function"&&(d.flags|=4194308),S=!1)}else{Q=d.stateNode,Ru(o,d),ye=d.memoizedProps,He=d.type===d.elementType?ye:Pr(d.type,ye),Q.props=He,ft=d.pendingProps,ut=Q.context,Te=y.contextType,typeof Te=="object"&&Te!==null?Te=Et(Te):(Te=un(y)?eo:Hs.current,Te=to(d,Te));var Dt=y.getDerivedStateFromProps;(dt=typeof Dt=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(ye!==ft||ut!==Te)&&jn(d,Q,S,Te),ws=!1,ut=d.memoizedState,Q.state=ut,Wr(d,S,Q,z);var $t=d.memoizedState;ye!==ft||ut!==$t||Ws.current||ws?(typeof Dt=="function"&&(Fs(d,y,Dt,S),$t=d.memoizedState),(He=ws||Ja(d,y,He,S,ut,$t,Te)||!1)?(dt||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(S,$t,Te),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(S,$t,Te)),typeof Q.componentDidUpdate=="function"&&(d.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof Q.componentDidUpdate!="function"||ye===o.memoizedProps&&ut===o.memoizedState||(d.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||ye===o.memoizedProps&&ut===o.memoizedState||(d.flags|=1024),d.memoizedProps=S,d.memoizedState=$t),Q.props=S,Q.state=$t,Q.context=Te,S=He):(typeof Q.componentDidUpdate!="function"||ye===o.memoizedProps&&ut===o.memoizedState||(d.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||ye===o.memoizedProps&&ut===o.memoizedState||(d.flags|=1024),S=!1)}return Lc(o,d,y,S,F,z)}function Lc(o,d,y,S,z,F){Ci(o,d);var Q=(d.flags&128)!==0;if(!S&&!Q)return z&&Ed(d,y,!1),rl(o,d,F);S=d.stateNode,Os.current=d;var ye=Q&&typeof y.getDerivedStateFromError!="function"?null:S.render();return d.flags|=1,o!==null&&Q?(d.child=Rl(d,o.child,null,F),d.child=Rl(d,null,ye,F)):dn(o,d,ye,F),d.memoizedState=S.state,z&&Ed(d,y,!0),d.child}function Ou(o){var d=o.stateNode;d.pendingContext?Eu(o,d.pendingContext,d.pendingContext!==d.context):d.context&&Eu(o,d.context,!1),Dc(o,d.containerInfo)}function Fc(o,d,y,S,z){return ao(),Iu(z),d.flags|=256,dn(o,d,y,S),d.child}var Bl={dehydrated:null,treeContext:null,retryLane:0};function Bu(o){return{baseLanes:o,cachePool:null,transitions:null}}function lp(o,d,y){var S=d.pendingProps,z=Xr.current,F=!1,Q=(d.flags&128)!==0,ye;if((ye=Q)||(ye=o!==null&&o.memoizedState===null?!1:(z&2)!==0),ye?(F=!0,d.flags&=-129):(o===null||o.memoizedState!==null)&&(z|=1),Er(Xr,z&1),o===null)return Pd(d),o=d.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((d.mode&1)===0?d.lanes=1:o.data==="$!"?d.lanes=8:d.lanes=1073741824,null):(Q=S.children,o=S.fallback,F?(S=d.mode,F=d.child,Q={mode:"hidden",children:Q},(S&1)===0&&F!==null?(F.childLanes=0,F.pendingProps=Q):F=Ud(Q,S,0,null),o=Yl(o,S,y,null),F.return=d,o.return=d,F.sibling=o,d.child=F,d.child.memoizedState=Bu(y),d.memoizedState=Bl,o):cp(d,Q));if(z=o.memoizedState,z!==null&&(ye=z.dehydrated,ye!==null))return wm(o,d,Q,S,ye,z,y);if(F){F=S.fallback,Q=d.mode,z=o.child,ye=z.sibling;var Te={mode:"hidden",children:S.children};return(Q&1)===0&&d.child!==z?(S=d.child,S.childLanes=0,S.pendingProps=Te,d.deletions=null):(S=il(z,Te),S.subtreeFlags=z.subtreeFlags&14680064),ye!==null?F=il(ye,F):(F=Yl(F,Q,y,null),F.flags|=2),F.return=d,S.return=d,S.sibling=F,d.child=S,S=F,F=d.child,Q=o.child.memoizedState,Q=Q===null?Bu(y):{baseLanes:Q.baseLanes|y,cachePool:null,transitions:Q.transitions},F.memoizedState=Q,F.childLanes=o.childLanes&~y,d.memoizedState=Bl,S}return F=o.child,o=F.sibling,S=il(F,{mode:"visible",children:S.children}),(d.mode&1)===0&&(S.lanes=y),S.return=d,S.sibling=null,o!==null&&(y=d.deletions,y===null?(d.deletions=[o],d.flags|=16):y.push(o)),d.child=S,d.memoizedState=null,S}function cp(o,d){return d=Ud({mode:"visible",children:d},o.mode,0,null),d.return=o,o.child=d}function Vu(o,d,y,S){return S!==null&&Iu(S),Rl(d,o.child,null,y),o=cp(d,d.pendingProps.children),o.flags|=2,d.memoizedState=null,o}function wm(o,d,y,S,z,F,Q){if(y)return d.flags&256?(d.flags&=-257,S=Ei(Error(w(422))),Vu(o,d,Q,S)):d.memoizedState!==null?(d.child=o.child,d.flags|=128,null):(F=S.fallback,z=d.mode,S=Ud({mode:"visible",children:S.children},z,0,null),F=Yl(F,z,Q,null),F.flags|=2,S.return=d,F.return=d,S.sibling=F,d.child=S,(d.mode&1)!==0&&Rl(d,o.child,null,Q),d.child.memoizedState=Bu(Q),d.memoizedState=Bl,F);if((d.mode&1)===0)return Vu(o,d,Q,null);if(z.data==="$!"){if(S=z.nextSibling&&z.nextSibling.dataset,S)var ye=S.dgst;return S=ye,F=Error(w(419)),S=Ei(F,S,void 0),Vu(o,d,Q,S)}if(ye=(Q&o.childLanes)!==0,Sn||ye){if(S=pn,S!==null){switch(Q&-Q){case 4:z=2;break;case 16:z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:z=32;break;case 536870912:z=268435456;break;default:z=0}z=(z&(S.suspendedLanes|Q))!==0?0:z,z!==0&&z!==F.retryLane&&(F.retryLane=z,da(o,z),zi(S,o,z,-1))}return bp(),S=Ei(Error(w(421))),Vu(o,d,Q,S)}return z.data==="$?"?(d.flags|=128,d.child=o.child,d=Nm.bind(null,o),z._reactRetry=d,null):(o=F.treeContext,sn=vi(z.nextSibling),rn=d,ts=!0,kn=null,o!==null&&(la[ca++]=zn,la[ca++]=Ls,la[ca++]=ua,zn=o.id,Ls=o.overflow,ua=d),d=cp(d,S.children),d.flags|=4096,d)}function Sh(o,d,y){o.lanes|=d;var S=o.alternate;S!==null&&(S.lanes|=d),Xn(o.return,d,y)}function Th(o,d,y,S,z){var F=o.memoizedState;F===null?o.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:S,tail:y,tailMode:z}:(F.isBackwards=d,F.rendering=null,F.renderingStartTime=0,F.last=S,F.tail=y,F.tailMode=z)}function up(o,d,y){var S=d.pendingProps,z=S.revealOrder,F=S.tail;if(dn(o,d,S.children,y),S=Xr.current,(S&2)!==0)S=S&1|2,d.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=d.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&Sh(o,y,d);else if(o.tag===19)Sh(o,y,d);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===d)break e;for(;o.sibling===null;){if(o.return===null||o.return===d)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}S&=1}if(Er(Xr,S),(d.mode&1)===0)d.memoizedState=null;else switch(z){case"forwards":for(y=d.child,z=null;y!==null;)o=y.alternate,o!==null&&Ko(o)===null&&(z=y),y=y.sibling;y=z,y===null?(z=d.child,d.child=null):(z=y.sibling,y.sibling=null),Th(d,!1,z,y,F);break;case"backwards":for(y=null,z=d.child,d.child=null;z!==null;){if(o=z.alternate,o!==null&&Ko(o)===null){d.child=z;break}o=z.sibling,z.sibling=y,y=z,z=o}Th(d,!0,y,null,F);break;case"together":Th(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function tl(o,d){(d.mode&1)===0&&o!==null&&(o.alternate=null,d.alternate=null,d.flags|=2)}function rl(o,d,y){if(o!==null&&(d.dependencies=o.dependencies),$l|=d.lanes,(y&d.childLanes)===0)return null;if(o!==null&&d.child!==o.child)throw Error(w(153));if(d.child!==null){for(o=d.child,y=il(o,o.pendingProps),d.child=y,y.return=d;o.sibling!==null;)o=o.sibling,y=y.sibling=il(o,o.pendingProps),y.return=d;y.sibling=null}return d.child}function $u(o,d,y){switch(d.tag){case 3:Ou(d),ao();break;case 5:Ka(d);break;case 1:un(d.type)&&Ma(d);break;case 4:Dc(d,d.stateNode.containerInfo);break;case 10:var S=d.type._context,z=d.memoizedProps.value;Er(Ho,S._currentValue),S._currentValue=z;break;case 13:if(S=d.memoizedState,S!==null)return S.dehydrated!==null?(Er(Xr,Xr.current&1),d.flags|=128,null):(y&d.child.childLanes)!==0?lp(o,d,y):(Er(Xr,Xr.current&1),o=rl(o,d,y),o!==null?o.sibling:null);Er(Xr,Xr.current&1);break;case 19:if(S=(y&d.childLanes)!==0,(o.flags&128)!==0){if(S)return up(o,d,y);d.flags|=128}if(z=d.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),Er(Xr,Xr.current),S)break;return null;case 22:case 23:return d.lanes=0,Fu(o,d,y)}return rl(o,d,y)}var Ad,Uu,rf,sf;Ad=function(o,d){for(var y=d.child;y!==null;){if(y.tag===5||y.tag===6)o.appendChild(y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===d)break;for(;y.sibling===null;){if(y.return===null||y.return===d)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},Uu=function(){},rf=function(o,d,y,S){var z=o.memoizedProps;if(z!==S){o=d.stateNode,Xa(Dn.current);var F=null;switch(y){case"input":z=Cs(o,z),S=Cs(o,S),F=[];break;case"select":z=pt({},z,{value:void 0}),S=pt({},S,{value:void 0}),F=[];break;case"textarea":z=Hn(o,z),S=Hn(o,S),F=[];break;default:typeof z.onClick!="function"&&typeof S.onClick=="function"&&(o.onclick=ku)}rt(y,S);var Q;y=null;for(He in z)if(!S.hasOwnProperty(He)&&z.hasOwnProperty(He)&&z[He]!=null)if(He==="style"){var ye=z[He];for(Q in ye)ye.hasOwnProperty(Q)&&(y||(y={}),y[Q]="")}else He!=="dangerouslySetInnerHTML"&&He!=="children"&&He!=="suppressContentEditableWarning"&&He!=="suppressHydrationWarning"&&He!=="autoFocus"&&(I.hasOwnProperty(He)?F||(F=[]):(F=F||[]).push(He,null));for(He in S){var Te=S[He];if(ye=z?.[He],S.hasOwnProperty(He)&&Te!==ye&&(Te!=null||ye!=null))if(He==="style")if(ye){for(Q in ye)!ye.hasOwnProperty(Q)||Te&&Te.hasOwnProperty(Q)||(y||(y={}),y[Q]="");for(Q in Te)Te.hasOwnProperty(Q)&&ye[Q]!==Te[Q]&&(y||(y={}),y[Q]=Te[Q])}else y||(F||(F=[]),F.push(He,y)),y=Te;else He==="dangerouslySetInnerHTML"?(Te=Te?Te.__html:void 0,ye=ye?ye.__html:void 0,Te!=null&&ye!==Te&&(F=F||[]).push(He,Te)):He==="children"?typeof Te!="string"&&typeof Te!="number"||(F=F||[]).push(He,""+Te):He!=="suppressContentEditableWarning"&&He!=="suppressHydrationWarning"&&(I.hasOwnProperty(He)?(Te!=null&&He==="onScroll"&&ls("scroll",o),F||ye===Te||(F=[])):(F=F||[]).push(He,Te))}y&&(F=F||[]).push("style",y);var He=F;(d.updateQueue=He)&&(d.flags|=4)}},sf=function(o,d,y,S){y!==S&&(d.flags|=4)};function Dd(o,d){if(!ts)switch(o.tailMode){case"hidden":d=o.tail;for(var y=null;d!==null;)d.alternate!==null&&(y=d),d=d.sibling;y===null?o.tail=null:y.sibling=null;break;case"collapsed":y=o.tail;for(var S=null;y!==null;)y.alternate!==null&&(S=y),y=y.sibling;S===null?d||o.tail===null?o.tail=null:o.tail.sibling=null:S.sibling=null}}function Ln(o){var d=o.alternate!==null&&o.alternate.child===o.child,y=0,S=0;if(d)for(var z=o.child;z!==null;)y|=z.lanes|z.childLanes,S|=z.subtreeFlags&14680064,S|=z.flags&14680064,z.return=o,z=z.sibling;else for(z=o.child;z!==null;)y|=z.lanes|z.childLanes,S|=z.subtreeFlags,S|=z.flags,z.return=o,z=z.sibling;return o.subtreeFlags|=S,o.childLanes=y,d}function km(o,d,y){var S=d.pendingProps;switch(so(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ln(d),null;case 1:return un(d.type)&&Ec(),Ln(d),null;case 3:return S=d.stateNode,Ya(),es(Ws),es(Hs),Rc(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(o===null||o.child===null)&&(Go(d)?d.flags|=4:o===null||o.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,kn!==null&&(Ih(kn),kn=null))),Uu(o,d),Ln(d),null;case 5:Ol(d);var z=Xa(Yo.current);if(y=d.type,o!==null&&d.stateNode!=null)rf(o,d,y,S,z),o.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!S){if(d.stateNode===null)throw Error(w(166));return Ln(d),null}if(o=Xa(Dn.current),Go(d)){S=d.stateNode,y=d.type;var F=d.memoizedProps;switch(S[cn]=d,S[tn]=F,o=(d.mode&1)!==0,y){case"dialog":ls("cancel",S),ls("close",S);break;case"iframe":case"object":case"embed":ls("load",S);break;case"video":case"audio":for(z=0;z<jc.length;z++)ls(jc[z],S);break;case"source":ls("error",S);break;case"img":case"image":case"link":ls("error",S),ls("load",S);break;case"details":ls("toggle",S);break;case"input":Gn(S,F),ls("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!F.multiple},ls("invalid",S);break;case"textarea":_o(S,F),ls("invalid",S)}rt(y,F),z=null;for(var Q in F)if(F.hasOwnProperty(Q)){var ye=F[Q];Q==="children"?typeof ye=="string"?S.textContent!==ye&&(F.suppressHydrationWarning!==!0&&Al(S.textContent,ye,o),z=["children",ye]):typeof ye=="number"&&S.textContent!==""+ye&&(F.suppressHydrationWarning!==!0&&Al(S.textContent,ye,o),z=["children",""+ye]):I.hasOwnProperty(Q)&&ye!=null&&Q==="onScroll"&&ls("scroll",S)}switch(y){case"input":_a(S),fi(S,F,!0);break;case"textarea":_a(S),_n(S);break;case"select":case"option":break;default:typeof F.onClick=="function"&&(S.onclick=ku)}S=z,d.updateQueue=S,S!==null&&(d.flags|=4)}else{Q=z.nodeType===9?z:z.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=Ae(y)),o==="http://www.w3.org/1999/xhtml"?y==="script"?(o=Q.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof S.is=="string"?o=Q.createElement(y,{is:S.is}):(o=Q.createElement(y),y==="select"&&(Q=o,S.multiple?Q.multiple=!0:S.size&&(Q.size=S.size))):o=Q.createElementNS(o,y),o[cn]=d,o[tn]=S,Ad(o,d,!1,!1),d.stateNode=o;e:{switch(Q=Qe(y,S),y){case"dialog":ls("cancel",o),ls("close",o),z=S;break;case"iframe":case"object":case"embed":ls("load",o),z=S;break;case"video":case"audio":for(z=0;z<jc.length;z++)ls(jc[z],o);z=S;break;case"source":ls("error",o),z=S;break;case"img":case"image":case"link":ls("error",o),ls("load",o),z=S;break;case"details":ls("toggle",o),z=S;break;case"input":Gn(o,S),z=Cs(o,S),ls("invalid",o);break;case"option":z=S;break;case"select":o._wrapperState={wasMultiple:!!S.multiple},z=pt({},S,{value:void 0}),ls("invalid",o);break;case"textarea":_o(o,S),z=Hn(o,S),ls("invalid",o);break;default:z=S}rt(y,z),ye=z;for(F in ye)if(ye.hasOwnProperty(F)){var Te=ye[F];F==="style"?Se(o,Te):F==="dangerouslySetInnerHTML"?(Te=Te?Te.__html:void 0,Te!=null&&ie(o,Te)):F==="children"?typeof Te=="string"?(y!=="textarea"||Te!=="")&&be(o,Te):typeof Te=="number"&&be(o,""+Te):F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&F!=="autoFocus"&&(I.hasOwnProperty(F)?Te!=null&&F==="onScroll"&&ls("scroll",o):Te!=null&&ze(o,F,Te,Q))}switch(y){case"input":_a(o),fi(o,S,!1);break;case"textarea":_a(o),_n(o);break;case"option":S.value!=null&&o.setAttribute("value",""+er(S.value));break;case"select":o.multiple=!!S.multiple,F=S.value,F!=null?Zn(o,!!S.multiple,F,!1):S.defaultValue!=null&&Zn(o,!!S.multiple,S.defaultValue,!0);break;default:typeof z.onClick=="function"&&(o.onclick=ku)}switch(y){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(d.flags|=4)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return Ln(d),null;case 6:if(o&&d.stateNode!=null)sf(o,d,o.memoizedProps,S);else{if(typeof S!="string"&&d.stateNode===null)throw Error(w(166));if(y=Xa(Yo.current),Xa(Dn.current),Go(d)){if(S=d.stateNode,y=d.memoizedProps,S[cn]=d,(F=S.nodeValue!==y)&&(o=rn,o!==null))switch(o.tag){case 3:Al(S.nodeValue,y,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&Al(S.nodeValue,y,(o.mode&1)!==0)}F&&(d.flags|=4)}else S=(y.nodeType===9?y:y.ownerDocument).createTextNode(S),S[cn]=d,d.stateNode=S}return Ln(d),null;case 13:if(es(Xr),S=d.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(ts&&sn!==null&&(d.mode&1)!==0&&(d.flags&128)===0)Md(),ao(),d.flags|=98560,F=!1;else if(F=Go(d),S!==null&&S.dehydrated!==null){if(o===null){if(!F)throw Error(w(318));if(F=d.memoizedState,F=F!==null?F.dehydrated:null,!F)throw Error(w(317));F[cn]=d}else ao(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Ln(d),F=!1}else kn!==null&&(Ih(kn),kn=null),F=!0;if(!F)return d.flags&65536?d:null}return(d.flags&128)!==0?(d.lanes=y,d):(S=S!==null,S!==(o!==null&&o.memoizedState!==null)&&S&&(d.child.flags|=8192,(d.mode&1)!==0&&(o===null||(Xr.current&1)!==0?Bs===0&&(Bs=3):bp())),d.updateQueue!==null&&(d.flags|=4),Ln(d),null);case 4:return Ya(),Uu(o,d),o===null&&Fo(d.stateNode.containerInfo),Ln(d),null;case 10:return Du(d.type._context),Ln(d),null;case 17:return un(d.type)&&Ec(),Ln(d),null;case 19:if(es(Xr),F=d.memoizedState,F===null)return Ln(d),null;if(S=(d.flags&128)!==0,Q=F.rendering,Q===null)if(S)Dd(F,!1);else{if(Bs!==0||o!==null&&(o.flags&128)!==0)for(o=d.child;o!==null;){if(Q=Ko(o),Q!==null){for(d.flags|=128,Dd(F,!1),S=Q.updateQueue,S!==null&&(d.updateQueue=S,d.flags|=4),d.subtreeFlags=0,S=y,y=d.child;y!==null;)F=y,o=S,F.flags&=14680066,Q=F.alternate,Q===null?(F.childLanes=0,F.lanes=o,F.child=null,F.subtreeFlags=0,F.memoizedProps=null,F.memoizedState=null,F.updateQueue=null,F.dependencies=null,F.stateNode=null):(F.childLanes=Q.childLanes,F.lanes=Q.lanes,F.child=Q.child,F.subtreeFlags=0,F.deletions=null,F.memoizedProps=Q.memoizedProps,F.memoizedState=Q.memoizedState,F.updateQueue=Q.updateQueue,F.type=Q.type,o=Q.dependencies,F.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),y=y.sibling;return Er(Xr,Xr.current&1|2),d.child}o=o.sibling}F.tail!==null&&is()>sl&&(d.flags|=128,S=!0,Dd(F,!1),d.lanes=4194304)}else{if(!S)if(o=Ko(Q),o!==null){if(d.flags|=128,S=!0,y=o.updateQueue,y!==null&&(d.updateQueue=y,d.flags|=4),Dd(F,!0),F.tail===null&&F.tailMode==="hidden"&&!Q.alternate&&!ts)return Ln(d),null}else 2*is()-F.renderingStartTime>sl&&y!==1073741824&&(d.flags|=128,S=!0,Dd(F,!1),d.lanes=4194304);F.isBackwards?(Q.sibling=d.child,d.child=Q):(y=F.last,y!==null?y.sibling=Q:d.child=Q,F.last=Q)}return F.tail!==null?(d=F.tail,F.rendering=d,F.tail=d.sibling,F.renderingStartTime=is(),d.sibling=null,y=Xr.current,Er(Xr,S?y&1|2:y&1),d):(Ln(d),null);case 22:case 23:return yp(),S=d.memoizedState!==null,o!==null&&o.memoizedState!==null!==S&&(d.flags|=8192),S&&(d.mode&1)!==0?(Ra&1073741824)!==0&&(Ln(d),d.subtreeFlags&6&&(d.flags|=8192)):Ln(d),null;case 24:return null;case 25:return null}throw Error(w(156,d.tag))}function nf(o,d){switch(so(d),d.tag){case 1:return un(d.type)&&Ec(),o=d.flags,o&65536?(d.flags=o&-65537|128,d):null;case 3:return Ya(),es(Ws),es(Hs),Rc(),o=d.flags,(o&65536)!==0&&(o&128)===0?(d.flags=o&-65537|128,d):null;case 5:return Ol(d),null;case 13:if(es(Xr),o=d.memoizedState,o!==null&&o.dehydrated!==null){if(d.alternate===null)throw Error(w(340));ao()}return o=d.flags,o&65536?(d.flags=o&-65537|128,d):null;case 19:return es(Xr),null;case 4:return Ya(),null;case 10:return Du(d.type._context),null;case 22:case 23:return yp(),null;case 24:return null;default:return null}}var qu=!1,Tn=!1,af=typeof WeakSet=="function"?WeakSet:Set,Ot=null;function Gu(o,d){var y=o.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(S){Ss(o,d,S)}else y.current=null}function Nh(o,d,y){try{y()}catch(S){Ss(o,d,S)}}var dp=!1;function jm(o,d){if(Vo=To,o=bh(),vr(o)){if("selectionStart"in o)var y={start:o.selectionStart,end:o.selectionEnd};else e:{y=(y=o.ownerDocument)&&y.defaultView||window;var S=y.getSelection&&y.getSelection();if(S&&S.rangeCount!==0){y=S.anchorNode;var z=S.anchorOffset,F=S.focusNode;S=S.focusOffset;try{y.nodeType,F.nodeType}catch{y=null;break e}var Q=0,ye=-1,Te=-1,He=0,dt=0,ft=o,ut=null;t:for(;;){for(var Dt;ft!==y||z!==0&&ft.nodeType!==3||(ye=Q+z),ft!==F||S!==0&&ft.nodeType!==3||(Te=Q+S),ft.nodeType===3&&(Q+=ft.nodeValue.length),(Dt=ft.firstChild)!==null;)ut=ft,ft=Dt;for(;;){if(ft===o)break t;if(ut===y&&++He===z&&(ye=Q),ut===F&&++dt===S&&(Te=Q),(Dt=ft.nextSibling)!==null)break;ft=ut,ut=ft.parentNode}ft=Dt}y=ye===-1||Te===-1?null:{start:ye,end:Te}}else y=null}y=y||{start:0,end:0}}else y=null;for(Sd={focusedElem:o,selectionRange:y},To=!1,Ot=d;Ot!==null;)if(d=Ot,o=d.child,(d.subtreeFlags&1028)!==0&&o!==null)o.return=d,Ot=o;else for(;Ot!==null;){d=Ot;try{var $t=d.alternate;if((d.flags&1024)!==0)switch(d.tag){case 0:case 11:case 15:break;case 1:if($t!==null){var Ut=$t.memoizedProps,Ts=$t.memoizedState,Ve=d.stateNode,Ee=Ve.getSnapshotBeforeUpdate(d.elementType===d.type?Ut:Pr(d.type,Ut),Ts);Ve.__reactInternalSnapshotBeforeUpdate=Ee}break;case 3:var Ge=d.stateNode.containerInfo;Ge.nodeType===1?Ge.textContent="":Ge.nodeType===9&&Ge.documentElement&&Ge.removeChild(Ge.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(w(163))}}catch(yt){Ss(d,d.return,yt)}if(o=d.sibling,o!==null){o.return=d.return,Ot=o;break}Ot=d.return}return $t=dp,dp=!1,$t}function Oc(o,d,y){var S=d.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var z=S=S.next;do{if((z.tag&o)===o){var F=z.destroy;z.destroy=void 0,F!==void 0&&Nh(d,y,F)}z=z.next}while(z!==S)}}function Rd(o,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var y=d=d.next;do{if((y.tag&o)===o){var S=y.create;y.destroy=S()}y=y.next}while(y!==d)}}function Ld(o){var d=o.ref;if(d!==null){var y=o.stateNode;o.tag,o=y,typeof d=="function"?d(o):d.current=o}}function Zu(o){var d=o.alternate;d!==null&&(o.alternate=null,Zu(d)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(d=o.stateNode,d!==null&&(delete d[cn],delete d[tn],delete d[Uo],delete d[Tu],delete d[Qi])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function Fn(o){return o.tag===5||o.tag===3||o.tag===4}function hp(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Fn(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function Fd(o,d,y){var S=o.tag;if(S===5||S===6)o=o.stateNode,d?y.nodeType===8?y.parentNode.insertBefore(o,d):y.insertBefore(o,d):(y.nodeType===8?(d=y.parentNode,d.insertBefore(o,y)):(d=y,d.appendChild(o)),y=y._reactRootContainer,y!=null||d.onclick!==null||(d.onclick=ku));else if(S!==4&&(o=o.child,o!==null))for(Fd(o,d,y),o=o.sibling;o!==null;)Fd(o,d,y),o=o.sibling}function pp(o,d,y){var S=o.tag;if(S===5||S===6)o=o.stateNode,d?y.insertBefore(o,d):y.appendChild(o);else if(S!==4&&(o=o.child,o!==null))for(pp(o,d,y),o=o.sibling;o!==null;)pp(o,d,y),o=o.sibling}var hn=null,Mi=!1;function Vl(o,d,y){for(y=y.child;y!==null;)fp(o,d,y),y=y.sibling}function fp(o,d,y){if(ln&&typeof ln.onCommitFiberUnmount=="function")try{ln.onCommitFiberUnmount(Bi,y)}catch{}switch(y.tag){case 5:Tn||Gu(y,d);case 6:var S=hn,z=Mi;hn=null,Vl(o,d,y),hn=S,Mi=z,hn!==null&&(Mi?(o=hn,y=y.stateNode,o.nodeType===8?o.parentNode.removeChild(y):o.removeChild(y)):hn.removeChild(y.stateNode));break;case 18:hn!==null&&(Mi?(o=hn,y=y.stateNode,o.nodeType===8?Dl(o.parentNode,y):o.nodeType===1&&Dl(o,y),wa(o)):Dl(hn,y.stateNode));break;case 4:S=hn,z=Mi,hn=y.stateNode.containerInfo,Mi=!0,Vl(o,d,y),hn=S,Mi=z;break;case 0:case 11:case 14:case 15:if(!Tn&&(S=y.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){z=S=S.next;do{var F=z,Q=F.destroy;F=F.tag,Q!==void 0&&((F&2)!==0||(F&4)!==0)&&Nh(y,d,Q),z=z.next}while(z!==S)}Vl(o,d,y);break;case 1:if(!Tn&&(Gu(y,d),S=y.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=y.memoizedProps,S.state=y.memoizedState,S.componentWillUnmount()}catch(ye){Ss(y,d,ye)}Vl(o,d,y);break;case 21:Vl(o,d,y);break;case 22:y.mode&1?(Tn=(S=Tn)||y.memoizedState!==null,Vl(o,d,y),Tn=S):Vl(o,d,y);break;default:Vl(o,d,y)}}function of(o){var d=o.updateQueue;if(d!==null){o.updateQueue=null;var y=o.stateNode;y===null&&(y=o.stateNode=new af),d.forEach(function(S){var z=$d.bind(null,o,S);y.has(S)||(y.add(S),S.then(z,z))})}}function Da(o,d){var y=d.deletions;if(y!==null)for(var S=0;S<y.length;S++){var z=y[S];try{var F=o,Q=d,ye=Q;e:for(;ye!==null;){switch(ye.tag){case 5:hn=ye.stateNode,Mi=!1;break e;case 3:hn=ye.stateNode.containerInfo,Mi=!0;break e;case 4:hn=ye.stateNode.containerInfo,Mi=!0;break e}ye=ye.return}if(hn===null)throw Error(w(160));fp(F,Q,z),hn=null,Mi=!1;var Te=z.alternate;Te!==null&&(Te.return=null),z.return=null}catch(He){Ss(z,d,He)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)mp(d,o),d=d.sibling}function mp(o,d){var y=o.alternate,S=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(Da(d,o),Ii(o),S&4){try{Oc(3,o,o.return),Rd(3,o)}catch(Ut){Ss(o,o.return,Ut)}try{Oc(5,o,o.return)}catch(Ut){Ss(o,o.return,Ut)}}break;case 1:Da(d,o),Ii(o),S&512&&y!==null&&Gu(y,y.return);break;case 5:if(Da(d,o),Ii(o),S&512&&y!==null&&Gu(y,y.return),o.flags&32){var z=o.stateNode;try{be(z,"")}catch(Ut){Ss(o,o.return,Ut)}}if(S&4&&(z=o.stateNode,z!=null)){var F=o.memoizedProps,Q=y!==null?y.memoizedProps:F,ye=o.type,Te=o.updateQueue;if(o.updateQueue=null,Te!==null)try{ye==="input"&&F.type==="radio"&&F.name!=null&&ba(z,F),Qe(ye,Q);var He=Qe(ye,F);for(Q=0;Q<Te.length;Q+=2){var dt=Te[Q],ft=Te[Q+1];dt==="style"?Se(z,ft):dt==="dangerouslySetInnerHTML"?ie(z,ft):dt==="children"?be(z,ft):ze(z,dt,ft,He)}switch(ye){case"input":as(z,F);break;case"textarea":bo(z,F);break;case"select":var ut=z._wrapperState.wasMultiple;z._wrapperState.wasMultiple=!!F.multiple;var Dt=F.value;Dt!=null?Zn(z,!!F.multiple,Dt,!1):ut!==!!F.multiple&&(F.defaultValue!=null?Zn(z,!!F.multiple,F.defaultValue,!0):Zn(z,!!F.multiple,F.multiple?[]:"",!1))}z[tn]=F}catch(Ut){Ss(o,o.return,Ut)}}break;case 6:if(Da(d,o),Ii(o),S&4){if(o.stateNode===null)throw Error(w(162));z=o.stateNode,F=o.memoizedProps;try{z.nodeValue=F}catch(Ut){Ss(o,o.return,Ut)}}break;case 3:if(Da(d,o),Ii(o),S&4&&y!==null&&y.memoizedState.isDehydrated)try{wa(d.containerInfo)}catch(Ut){Ss(o,o.return,Ut)}break;case 4:Da(d,o),Ii(o);break;case 13:Da(d,o),Ii(o),z=o.child,z.flags&8192&&(F=z.memoizedState!==null,z.stateNode.isHidden=F,!F||z.alternate!==null&&z.alternate.memoizedState!==null||(Ch=is())),S&4&&of(o);break;case 22:if(dt=y!==null&&y.memoizedState!==null,o.mode&1?(Tn=(He=Tn)||dt,Da(d,o),Tn=He):Da(d,o),Ii(o),S&8192){if(He=o.memoizedState!==null,(o.stateNode.isHidden=He)&&!dt&&(o.mode&1)!==0)for(Ot=o,dt=o.child;dt!==null;){for(ft=Ot=dt;Ot!==null;){switch(ut=Ot,Dt=ut.child,ut.tag){case 0:case 11:case 14:case 15:Oc(4,ut,ut.return);break;case 1:Gu(ut,ut.return);var $t=ut.stateNode;if(typeof $t.componentWillUnmount=="function"){S=ut,y=ut.return;try{d=S,$t.props=d.memoizedProps,$t.state=d.memoizedState,$t.componentWillUnmount()}catch(Ut){Ss(S,y,Ut)}}break;case 5:Gu(ut,ut.return);break;case 22:if(ut.memoizedState!==null){Od(ft);continue}}Dt!==null?(Dt.return=ut,Ot=Dt):Od(ft)}dt=dt.sibling}e:for(dt=null,ft=o;;){if(ft.tag===5){if(dt===null){dt=ft;try{z=ft.stateNode,He?(F=z.style,typeof F.setProperty=="function"?F.setProperty("display","none","important"):F.display="none"):(ye=ft.stateNode,Te=ft.memoizedProps.style,Q=Te!=null&&Te.hasOwnProperty("display")?Te.display:null,ye.style.display=Ie("display",Q))}catch(Ut){Ss(o,o.return,Ut)}}}else if(ft.tag===6){if(dt===null)try{ft.stateNode.nodeValue=He?"":ft.memoizedProps}catch(Ut){Ss(o,o.return,Ut)}}else if((ft.tag!==22&&ft.tag!==23||ft.memoizedState===null||ft===o)&&ft.child!==null){ft.child.return=ft,ft=ft.child;continue}if(ft===o)break e;for(;ft.sibling===null;){if(ft.return===null||ft.return===o)break e;dt===ft&&(dt=null),ft=ft.return}dt===ft&&(dt=null),ft.sibling.return=ft.return,ft=ft.sibling}}break;case 19:Da(d,o),Ii(o),S&4&&of(o);break;case 21:break;default:Da(d,o),Ii(o)}}function Ii(o){var d=o.flags;if(d&2){try{e:{for(var y=o.return;y!==null;){if(Fn(y)){var S=y;break e}y=y.return}throw Error(w(160))}switch(S.tag){case 5:var z=S.stateNode;S.flags&32&&(be(z,""),S.flags&=-33);var F=hp(o);pp(o,F,z);break;case 3:case 4:var Q=S.stateNode.containerInfo,ye=hp(o);Fd(o,ye,Q);break;default:throw Error(w(161))}}catch(Te){Ss(o,o.return,Te)}o.flags&=-3}d&4096&&(o.flags&=-4097)}function Sm(o,d,y){Ot=o,lf(o)}function lf(o,d,y){for(var S=(o.mode&1)!==0;Ot!==null;){var z=Ot,F=z.child;if(z.tag===22&&S){var Q=z.memoizedState!==null||qu;if(!Q){var ye=z.alternate,Te=ye!==null&&ye.memoizedState!==null||Tn;ye=qu;var He=Tn;if(qu=Q,(Tn=Te)&&!He)for(Ot=z;Ot!==null;)Q=Ot,Te=Q.child,Q.tag===22&&Q.memoizedState!==null?Eh(z):Te!==null?(Te.return=Q,Ot=Te):Eh(z);for(;F!==null;)Ot=F,lf(F),F=F.sibling;Ot=z,qu=ye,Tn=He}cf(o)}else(z.subtreeFlags&8772)!==0&&F!==null?(F.return=z,Ot=F):cf(o)}}function cf(o){for(;Ot!==null;){var d=Ot;if((d.flags&8772)!==0){var y=d.alternate;try{if((d.flags&8772)!==0)switch(d.tag){case 0:case 11:case 15:Tn||Rd(5,d);break;case 1:var S=d.stateNode;if(d.flags&4&&!Tn)if(y===null)S.componentDidMount();else{var z=d.elementType===d.type?y.memoizedProps:Pr(d.type,y.memoizedProps);S.componentDidUpdate(z,y.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var F=d.updateQueue;F!==null&&_s(d,F,S);break;case 3:var Q=d.updateQueue;if(Q!==null){if(y=null,d.child!==null)switch(d.child.tag){case 5:y=d.child.stateNode;break;case 1:y=d.child.stateNode}_s(d,Q,y)}break;case 5:var ye=d.stateNode;if(y===null&&d.flags&4){y=ye;var Te=d.memoizedProps;switch(d.type){case"button":case"input":case"select":case"textarea":Te.autoFocus&&y.focus();break;case"img":Te.src&&(y.src=Te.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(d.memoizedState===null){var He=d.alternate;if(He!==null){var dt=He.memoizedState;if(dt!==null){var ft=dt.dehydrated;ft!==null&&wa(ft)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(w(163))}Tn||d.flags&512&&Ld(d)}catch(ut){Ss(d,d.return,ut)}}if(d===o){Ot=null;break}if(y=d.sibling,y!==null){y.return=d.return,Ot=y;break}Ot=d.return}}function Od(o){for(;Ot!==null;){var d=Ot;if(d===o){Ot=null;break}var y=d.sibling;if(y!==null){y.return=d.return,Ot=y;break}Ot=d.return}}function Eh(o){for(;Ot!==null;){var d=Ot;try{switch(d.tag){case 0:case 11:case 15:var y=d.return;try{Rd(4,d)}catch(Te){Ss(d,y,Te)}break;case 1:var S=d.stateNode;if(typeof S.componentDidMount=="function"){var z=d.return;try{S.componentDidMount()}catch(Te){Ss(d,z,Te)}}var F=d.return;try{Ld(d)}catch(Te){Ss(d,F,Te)}break;case 5:var Q=d.return;try{Ld(d)}catch(Te){Ss(d,Q,Te)}}}catch(Te){Ss(d,d.return,Te)}if(d===o){Ot=null;break}var ye=d.sibling;if(ye!==null){ye.return=d.return,Ot=ye;break}Ot=d.return}}var uf=Math.ceil,ho=lt.ReactCurrentDispatcher,Bc=lt.ReactCurrentOwner,ri=lt.ReactCurrentBatchConfig,Ar=0,pn=null,Ys=null,Nn=0,Ra=0,Hu=wi(0),Bs=0,Bd=null,$l=0,Ul=0,gp=0,ds=null,nn=null,Ch=0,sl=1/0,si=null,ql=!1,Ph=null,nl=null,Gl=!1,po=null,al=0,Zl=0,Hl=null,Wl=-1,Mh=0;function On(){return(Ar&6)!==0?is():Wl!==-1?Wl:Wl=is()}function fa(o){return(o.mode&1)===0?1:(Ar&2)!==0&&Nn!==0?Nn&-Nn:Id.transition!==null?(Mh===0&&(Mh=ru()),Mh):(o=Nr,o!==0||(o=window.event,o=o===void 0?16:Gi(o.type)),o)}function zi(o,d,y,S){if(50<Zl)throw Zl=0,Hl=null,Error(w(185));jo(o,y,S),((Ar&2)===0||o!==pn)&&(o===pn&&((Ar&2)===0&&(Ul|=y),Bs===4&&Xl(o,Nn)),Yn(o,S),y===1&&Ar===0&&(d.mode&1)===0&&(sl=is()+500,In&&oa()))}function Yn(o,d){var y=o.callbackNode;dh(o,d);var S=ic(o,o===pn?Nn:0);if(S===0)y!==null&&gl(y),o.callbackNode=null,o.callbackPriority=0;else if(d=S&-S,o.callbackPriority!==d){if(y!=null&&gl(y),d===1)o.tag===0?op(hf.bind(null,o)):ia(hf.bind(null,o)),kh(function(){(Ar&6)===0&&oa()}),y=null;else{switch(lc(S)){case 1:y=vo;break;case 4:y=on;break;case 16:y=Tr;break;case 536870912:y=wo;break;default:y=Tr}y=_f(y,Wu.bind(null,o))}o.callbackPriority=d,o.callbackNode=y}}function Wu(o,d){if(Wl=-1,Mh=0,(Ar&6)!==0)throw Error(w(327));var y=o.callbackNode;if(Xu()&&o.callbackNode!==y)return null;var S=ic(o,o===pn?Nn:0);if(S===0)return null;if((S&30)!==0||(S&o.expiredLanes)!==0||d)d=zh(o,S);else{d=S;var z=Ar;Ar|=2;var F=_p();(pn!==o||Nn!==d)&&(si=null,sl=is()+500,Ai(o,d));do try{ff();break}catch(ye){pf(o,ye)}while(!0);Au(),ho.current=F,Ar=z,Ys!==null?d=0:(pn=null,Nn=0,d=Bs)}if(d!==0){if(d===2&&(z=_l(o),z!==0&&(S=z,d=Vd(o,z))),d===1)throw y=Bd,Ai(o,0),Xl(o,S),Yn(o,is()),y;if(d===6)Xl(o,S);else{if(z=o.current.alternate,(S&30)===0&&!df(z)&&(d=zh(o,S),d===2&&(F=_l(o),F!==0&&(S=F,d=Vd(o,F))),d===1))throw y=Bd,Ai(o,0),Xl(o,S),Yn(o,is()),y;switch(o.finishedWork=z,o.finishedLanes=S,d){case 0:case 1:throw Error(w(345));case 2:Di(o,nn,si);break;case 3:if(Xl(o,S),(S&130023424)===S&&(d=Ch+500-is(),10<d)){if(ic(o,0)!==0)break;if(z=o.suspendedLanes,(z&S)!==S){On(),o.pingedLanes|=o.suspendedLanes&z;break}o.timeoutHandle=$o(Di.bind(null,o,nn,si),d);break}Di(o,nn,si);break;case 4:if(Xl(o,S),(S&4194240)===S)break;for(d=o.eventTimes,z=-1;0<S;){var Q=31-ta(S);F=1<<Q,Q=d[Q],Q>z&&(z=Q),S&=~F}if(S=z,S=is()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*uf(S/1960))-S,10<S){o.timeoutHandle=$o(Di.bind(null,o,nn,si),S);break}Di(o,nn,si);break;case 5:Di(o,nn,si);break;default:throw Error(w(329))}}}return Yn(o,is()),o.callbackNode===y?Wu.bind(null,o):null}function Vd(o,d){var y=ds;return o.current.memoizedState.isDehydrated&&(Ai(o,d).flags|=256),o=zh(o,d),o!==2&&(d=nn,nn=y,d!==null&&Ih(d)),o}function Ih(o){nn===null?nn=o:nn.push.apply(nn,o)}function df(o){for(var d=o;;){if(d.flags&16384){var y=d.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var S=0;S<y.length;S++){var z=y[S],F=z.getSnapshot;z=z.value;try{if(!Ta(F(),z))return!1}catch{return!1}}}if(y=d.child,d.subtreeFlags&16384&&y!==null)y.return=d,d=y;else{if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Xl(o,d){for(d&=~gp,d&=~Ul,o.suspendedLanes|=d,o.pingedLanes&=~d,o=o.expirationTimes;0<d;){var y=31-ta(d),S=1<<y;o[y]=-1,d&=~S}}function hf(o){if((Ar&6)!==0)throw Error(w(327));Xu();var d=ic(o,0);if((d&1)===0)return Yn(o,is()),null;var y=zh(o,d);if(o.tag!==0&&y===2){var S=_l(o);S!==0&&(d=S,y=Vd(o,S))}if(y===1)throw y=Bd,Ai(o,0),Xl(o,d),Yn(o,is()),y;if(y===6)throw Error(w(345));return o.finishedWork=o.current.alternate,o.finishedLanes=d,Di(o,nn,si),Yn(o,is()),null}function xp(o,d){var y=Ar;Ar|=1;try{return o(d)}finally{Ar=y,Ar===0&&(sl=is()+500,In&&oa())}}function Vc(o){po!==null&&po.tag===0&&(Ar&6)===0&&Xu();var d=Ar;Ar|=1;var y=ri.transition,S=Nr;try{if(ri.transition=null,Nr=1,o)return o()}finally{Nr=S,ri.transition=y,Ar=d,(Ar&6)===0&&oa()}}function yp(){Ra=Hu.current,es(Hu)}function Ai(o,d){o.finishedWork=null,o.finishedLanes=0;var y=o.timeoutHandle;if(y!==-1&&(o.timeoutHandle=-1,Su(y)),Ys!==null)for(y=Ys.return;y!==null;){var S=y;switch(so(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&Ec();break;case 3:Ya(),es(Ws),es(Hs),Rc();break;case 5:Ol(S);break;case 4:Ya();break;case 13:es(Xr);break;case 19:es(Xr);break;case 10:Du(S.type._context);break;case 22:case 23:yp()}y=y.return}if(pn=o,Ys=o=il(o.current,null),Nn=Ra=d,Bs=0,Bd=null,gp=Ul=$l=0,nn=ds=null,Rt!==null){for(d=0;d<Rt.length;d++)if(y=Rt[d],S=y.interleaved,S!==null){y.interleaved=null;var z=S.next,F=y.pending;if(F!==null){var Q=F.next;F.next=z,S.next=Q}y.pending=S}Rt=null}return o}function pf(o,d){do{var y=Ys;try{if(Au(),ji.current=ns,Qo){for(var S=Yr.memoizedState;S!==null;){var z=S.queue;z!==null&&(z.pending=null),S=S.next}Qo=!1}if(Ti=0,zs=cs=Yr=null,co=!1,el=0,Bc.current=null,y===null||y.return===null){Bs=1,Bd=d,Ys=null;break}e:{var F=o,Q=y.return,ye=y,Te=d;if(d=Nn,ye.flags|=32768,Te!==null&&typeof Te=="object"&&typeof Te.then=="function"){var He=Te,dt=ye,ft=dt.tag;if((dt.mode&1)===0&&(ft===0||ft===11||ft===15)){var ut=dt.alternate;ut?(dt.updateQueue=ut.updateQueue,dt.memoizedState=ut.memoizedState,dt.lanes=ut.lanes):(dt.updateQueue=null,dt.memoizedState=null)}var Dt=Ur(Q);if(Dt!==null){Dt.flags&=-257,As(Dt,Q,ye,F,d),Dt.mode&1&&qr(F,He,d),d=Dt,Te=He;var $t=d.updateQueue;if($t===null){var Ut=new Set;Ut.add(Te),d.updateQueue=Ut}else $t.add(Te);break e}else{if((d&1)===0){qr(F,He,d),bp();break e}Te=Error(w(426))}}else if(ts&&ye.mode&1){var Ts=Ur(Q);if(Ts!==null){(Ts.flags&65536)===0&&(Ts.flags|=256),As(Ts,Q,ye,F,d),Iu(Qa(Te,ye));break e}}F=Te=Qa(Te,ye),Bs!==4&&(Bs=2),ds===null?ds=[F]:ds.push(F),F=Q;do{switch(F.tag){case 3:F.flags|=65536,d&=-d,F.lanes|=d;var Ve=ha(F,Te,d);Fl(F,Ve);break e;case 1:ye=Te;var Ee=F.type,Ge=F.stateNode;if((F.flags&128)===0&&(typeof Ee.getDerivedStateFromError=="function"||Ge!==null&&typeof Ge.componentDidCatch=="function"&&(nl===null||!nl.has(Ge)))){F.flags|=65536,d&=-d,F.lanes|=d;var yt=pa(F,ye,d);Fl(F,yt);break e}}F=F.return}while(F!==null)}Ah(y)}catch(Gt){d=Gt,Ys===y&&y!==null&&(Ys=y=y.return);continue}break}while(!0)}function _p(){var o=ho.current;return ho.current=ns,o===null?ns:o}function bp(){(Bs===0||Bs===3||Bs===2)&&(Bs=4),pn===null||($l&268435455)===0&&(Ul&268435455)===0||Xl(pn,Nn)}function zh(o,d){var y=Ar;Ar|=2;var S=_p();(pn!==o||Nn!==d)&&(si=null,Ai(o,d));do try{Tm();break}catch(z){pf(o,z)}while(!0);if(Au(),Ar=y,ho.current=S,Ys!==null)throw Error(w(261));return pn=null,Nn=0,Bs}function Tm(){for(;Ys!==null;)mf(Ys)}function ff(){for(;Ys!==null&&!Qc();)mf(Ys)}function mf(o){var d=wp(o.alternate,o,Ra);o.memoizedProps=o.pendingProps,d===null?Ah(o):Ys=d,Bc.current=null}function Ah(o){var d=o;do{var y=d.alternate;if(o=d.return,(d.flags&32768)===0){if(y=km(y,d,Ra),y!==null){Ys=y;return}}else{if(y=nf(y,d),y!==null){y.flags&=32767,Ys=y;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Bs=6,Ys=null;return}}if(d=d.sibling,d!==null){Ys=d;return}Ys=d=o}while(d!==null);Bs===0&&(Bs=5)}function Di(o,d,y){var S=Nr,z=ri.transition;try{ri.transition=null,Nr=1,vp(o,d,y,S)}finally{ri.transition=z,Nr=S}return null}function vp(o,d,y,S){do Xu();while(po!==null);if((Ar&6)!==0)throw Error(w(327));y=o.finishedWork;var z=o.finishedLanes;if(y===null)return null;if(o.finishedWork=null,o.finishedLanes=0,y===o.current)throw Error(w(177));o.callbackNode=null,o.callbackPriority=0;var F=y.lanes|y.childLanes;if(od(o,F),o===pn&&(Ys=pn=null,Nn=0),(y.subtreeFlags&2064)===0&&(y.flags&2064)===0||Gl||(Gl=!0,_f(Tr,function(){return Xu(),null})),F=(y.flags&15990)!==0,(y.subtreeFlags&15990)!==0||F){F=ri.transition,ri.transition=null;var Q=Nr;Nr=1;var ye=Ar;Ar|=4,Bc.current=null,jm(o,y),mp(y,o),fu(Sd),To=!!Vo,Sd=Vo=null,o.current=y,Sm(y),xl(),Ar=ye,Nr=Q,ri.transition=F}else o.current=y;if(Gl&&(Gl=!1,po=o,al=z),F=o.pendingLanes,F===0&&(nl=null),va(y.stateNode),Yn(o,is()),d!==null)for(S=o.onRecoverableError,y=0;y<d.length;y++)z=d[y],S(z.value,{componentStack:z.stack,digest:z.digest});if(ql)throw ql=!1,o=Ph,Ph=null,o;return(al&1)!==0&&o.tag!==0&&Xu(),F=o.pendingLanes,(F&1)!==0?o===Hl?Zl++:(Zl=0,Hl=o):Zl=0,oa(),null}function Xu(){if(po!==null){var o=lc(al),d=ri.transition,y=Nr;try{if(ri.transition=null,Nr=16>o?16:o,po===null)var S=!1;else{if(o=po,po=null,al=0,(Ar&6)!==0)throw Error(w(331));var z=Ar;for(Ar|=4,Ot=o.current;Ot!==null;){var F=Ot,Q=F.child;if((Ot.flags&16)!==0){var ye=F.deletions;if(ye!==null){for(var Te=0;Te<ye.length;Te++){var He=ye[Te];for(Ot=He;Ot!==null;){var dt=Ot;switch(dt.tag){case 0:case 11:case 15:Oc(8,dt,F)}var ft=dt.child;if(ft!==null)ft.return=dt,Ot=ft;else for(;Ot!==null;){dt=Ot;var ut=dt.sibling,Dt=dt.return;if(Zu(dt),dt===He){Ot=null;break}if(ut!==null){ut.return=Dt,Ot=ut;break}Ot=Dt}}}var $t=F.alternate;if($t!==null){var Ut=$t.child;if(Ut!==null){$t.child=null;do{var Ts=Ut.sibling;Ut.sibling=null,Ut=Ts}while(Ut!==null)}}Ot=F}}if((F.subtreeFlags&2064)!==0&&Q!==null)Q.return=F,Ot=Q;else e:for(;Ot!==null;){if(F=Ot,(F.flags&2048)!==0)switch(F.tag){case 0:case 11:case 15:Oc(9,F,F.return)}var Ve=F.sibling;if(Ve!==null){Ve.return=F.return,Ot=Ve;break e}Ot=F.return}}var Ee=o.current;for(Ot=Ee;Ot!==null;){Q=Ot;var Ge=Q.child;if((Q.subtreeFlags&2064)!==0&&Ge!==null)Ge.return=Q,Ot=Ge;else e:for(Q=Ee;Ot!==null;){if(ye=Ot,(ye.flags&2048)!==0)try{switch(ye.tag){case 0:case 11:case 15:Rd(9,ye)}}catch(Gt){Ss(ye,ye.return,Gt)}if(ye===Q){Ot=null;break e}var yt=ye.sibling;if(yt!==null){yt.return=ye.return,Ot=yt;break e}Ot=ye.return}}if(Ar=z,oa(),ln&&typeof ln.onPostCommitFiberRoot=="function")try{ln.onPostCommitFiberRoot(Bi,o)}catch{}S=!0}return S}finally{Nr=y,ri.transition=d}}return!1}function gf(o,d,y){d=Qa(y,d),d=ha(o,d,1),o=oo(o,d,1),d=On(),o!==null&&(jo(o,1,d),Yn(o,d))}function Ss(o,d,y){if(o.tag===3)gf(o,o,y);else for(;d!==null;){if(d.tag===3){gf(d,o,y);break}else if(d.tag===1){var S=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(nl===null||!nl.has(S))){o=Qa(y,o),o=pa(d,o,1),d=oo(d,o,1),o=On(),d!==null&&(jo(d,1,o),Yn(d,o));break}}d=d.return}}function xf(o,d,y){var S=o.pingCache;S!==null&&S.delete(d),d=On(),o.pingedLanes|=o.suspendedLanes&y,pn===o&&(Nn&y)===y&&(Bs===4||Bs===3&&(Nn&130023424)===Nn&&500>is()-Ch?Ai(o,0):gp|=y),Yn(o,d)}function yf(o,d){d===0&&((o.mode&1)===0?d=1:(d=ac,ac<<=1,(ac&130023424)===0&&(ac=4194304)));var y=On();o=da(o,d),o!==null&&(jo(o,d,y),Yn(o,y))}function Nm(o){var d=o.memoizedState,y=0;d!==null&&(y=d.retryLane),yf(o,y)}function $d(o,d){var y=0;switch(o.tag){case 13:var S=o.stateNode,z=o.memoizedState;z!==null&&(y=z.retryLane);break;case 19:S=o.stateNode;break;default:throw Error(w(314))}S!==null&&S.delete(d),yf(o,y)}var wp;wp=function(o,d,y){if(o!==null)if(o.memoizedProps!==d.pendingProps||Ws.current)Sn=!0;else{if((o.lanes&y)===0&&(d.flags&128)===0)return Sn=!1,$u(o,d,y);Sn=(o.flags&131072)!==0}else Sn=!1,ts&&(d.flags&1048576)!==0&&Pc(d,Cc,d.index);switch(d.lanes=0,d.tag){case 2:var S=d.type;tl(o,d),o=d.pendingProps;var z=to(d,Hs.current);Ha(d,y),z=l(null,d,S,o,z,y);var F=h();return d.flags|=1,typeof z=="object"&&z!==null&&typeof z.render=="function"&&z.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,un(S)?(F=!0,Ma(d)):F=!1,d.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,An(d),z.updater=za,d.stateNode=z,z._reactInternals=d,Ni(d,S,o,y),d=Lc(null,d,S,!0,F,y)):(d.tag=0,ts&&F&&Mc(d),dn(null,d,z,y),d=d.child),d;case 16:S=d.elementType;e:{switch(tl(o,d),o=d.pendingProps,z=S._init,S=z(S._payload),d.type=S,z=d.tag=Cm(S),o=Pr(S,o),z){case 0:d=ti(null,d,S,o,y);break e;case 1:d=Pi(null,d,S,o,y);break e;case 11:d=uo(null,d,S,o,y);break e;case 14:d=jh(null,d,S,Pr(S.type,o),y);break e}throw Error(w(306,S,""))}return d;case 0:return S=d.type,z=d.pendingProps,z=d.elementType===S?z:Pr(S,z),ti(o,d,S,z,y);case 1:return S=d.type,z=d.pendingProps,z=d.elementType===S?z:Pr(S,z),Pi(o,d,S,z,y);case 3:e:{if(Ou(d),o===null)throw Error(w(387));S=d.pendingProps,F=d.memoizedState,z=F.element,Ru(o,d),Wr(d,S,null,y);var Q=d.memoizedState;if(S=Q.element,F.isDehydrated)if(F={element:S,isDehydrated:!1,cache:Q.cache,pendingSuspenseBoundaries:Q.pendingSuspenseBoundaries,transitions:Q.transitions},d.updateQueue.baseState=F,d.memoizedState=F,d.flags&256){z=Qa(Error(w(423)),d),d=Fc(o,d,S,y,z);break e}else if(S!==z){z=Qa(Error(w(424)),d),d=Fc(o,d,S,y,z);break e}else for(sn=vi(d.stateNode.containerInfo.firstChild),rn=d,ts=!0,kn=null,y=Ll(d,null,S,y),d.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(ao(),S===z){d=rl(o,d,y);break e}dn(o,d,S,y)}d=d.child}return d;case 5:return Ka(d),o===null&&Pd(d),S=d.type,z=d.pendingProps,F=o!==null?o.memoizedProps:null,Q=z.children,ju(S,z)?Q=null:F!==null&&ju(S,F)&&(d.flags|=32),Ci(o,d),dn(o,d,Q,y),d.child;case 6:return o===null&&Pd(d),null;case 13:return lp(o,d,y);case 4:return Dc(d,d.stateNode.containerInfo),S=d.pendingProps,o===null?d.child=Rl(d,null,S,y):dn(o,d,S,y),d.child;case 11:return S=d.type,z=d.pendingProps,z=d.elementType===S?z:Pr(S,z),uo(o,d,S,z,y);case 7:return dn(o,d,d.pendingProps,y),d.child;case 8:return dn(o,d,d.pendingProps.children,y),d.child;case 12:return dn(o,d,d.pendingProps.children,y),d.child;case 10:e:{if(S=d.type._context,z=d.pendingProps,F=d.memoizedProps,Q=z.value,Er(Ho,S._currentValue),S._currentValue=Q,F!==null)if(Ta(F.value,Q)){if(F.children===z.children&&!Ws.current){d=rl(o,d,y);break e}}else for(F=d.child,F!==null&&(F.return=d);F!==null;){var ye=F.dependencies;if(ye!==null){Q=F.child;for(var Te=ye.firstContext;Te!==null;){if(Te.context===S){if(F.tag===1){Te=Wa(-1,y&-y),Te.tag=2;var He=F.updateQueue;if(He!==null){He=He.shared;var dt=He.pending;dt===null?Te.next=Te:(Te.next=dt.next,dt.next=Te),He.pending=Te}}F.lanes|=y,Te=F.alternate,Te!==null&&(Te.lanes|=y),Xn(F.return,y,d),ye.lanes|=y;break}Te=Te.next}}else if(F.tag===10)Q=F.type===d.type?null:F.child;else if(F.tag===18){if(Q=F.return,Q===null)throw Error(w(341));Q.lanes|=y,ye=Q.alternate,ye!==null&&(ye.lanes|=y),Xn(Q,y,d),Q=F.sibling}else Q=F.child;if(Q!==null)Q.return=F;else for(Q=F;Q!==null;){if(Q===d){Q=null;break}if(F=Q.sibling,F!==null){F.return=Q.return,Q=F;break}Q=Q.return}F=Q}dn(o,d,z.children,y),d=d.child}return d;case 9:return z=d.type,S=d.pendingProps.children,Ha(d,y),z=Et(z),S=S(z),d.flags|=1,dn(o,d,S,y),d.child;case 14:return S=d.type,z=Pr(S,d.pendingProps),z=Pr(S.type,z),jh(o,d,S,z,y);case 15:return zd(o,d,d.type,d.pendingProps,y);case 17:return S=d.type,z=d.pendingProps,z=d.elementType===S?z:Pr(S,z),tl(o,d),d.tag=1,un(S)?(o=!0,Ma(d)):o=!1,Ha(d,y),Aa(d,S,z),Ni(d,S,z,y),Lc(null,d,S,!0,o,y);case 19:return up(o,d,y);case 22:return Fu(o,d,y)}throw Error(w(156,d.tag))};function _f(o,d){return ml(o,d)}function Em(o,d,y,S){this.tag=o,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ni(o,d,y,S){return new Em(o,d,y,S)}function kp(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Cm(o){if(typeof o=="function")return kp(o)?1:0;if(o!=null){if(o=o.$$typeof,o===Kt)return 11;if(o===Ct)return 14}return 2}function il(o,d){var y=o.alternate;return y===null?(y=ni(o.tag,d,o.key,o.mode),y.elementType=o.elementType,y.type=o.type,y.stateNode=o.stateNode,y.alternate=o,o.alternate=y):(y.pendingProps=d,y.type=o.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=o.flags&14680064,y.childLanes=o.childLanes,y.lanes=o.lanes,y.child=o.child,y.memoizedProps=o.memoizedProps,y.memoizedState=o.memoizedState,y.updateQueue=o.updateQueue,d=o.dependencies,y.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},y.sibling=o.sibling,y.index=o.index,y.ref=o.ref,y}function Yu(o,d,y,S,z,F){var Q=2;if(S=o,typeof o=="function")kp(o)&&(Q=1);else if(typeof o=="string")Q=5;else e:switch(o){case Ft:return Yl(y.children,z,F,d);case Vt:Q=8,z|=8;break;case Zt:return o=ni(12,y,d,z|2),o.elementType=Zt,o.lanes=F,o;case Wt:return o=ni(13,y,d,z),o.elementType=Wt,o.lanes=F,o;case Me:return o=ni(19,y,d,z),o.elementType=Me,o.lanes=F,o;case Tt:return Ud(y,z,F,d);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case mt:Q=10;break e;case fr:Q=9;break e;case Kt:Q=11;break e;case Ct:Q=14;break e;case it:Q=16,S=null;break e}throw Error(w(130,o==null?o:typeof o,""))}return d=ni(Q,y,d,z),d.elementType=o,d.type=S,d.lanes=F,d}function Yl(o,d,y,S){return o=ni(7,o,S,d),o.lanes=y,o}function Ud(o,d,y,S){return o=ni(22,o,S,d),o.elementType=Tt,o.lanes=y,o.stateNode={isHidden:!1},o}function Dh(o,d,y){return o=ni(6,o,null,d),o.lanes=y,o}function jp(o,d,y){return d=ni(4,o.children!==null?o.children:[],o.key,d),d.lanes=y,d.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},d}function Rh(o,d,y,S,z){this.tag=d,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=oc(0),this.expirationTimes=oc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oc(0),this.identifierPrefix=S,this.onRecoverableError=z,this.mutableSourceEagerHydrationData=null}function Sp(o,d,y,S,z,F,Q,ye,Te){return o=new Rh(o,d,y,ye,Te),d===1?(d=1,F===!0&&(d|=8)):d=0,F=ni(3,null,null,d),o.current=F,F.stateNode=o,F.memoizedState={element:S,isDehydrated:y,cache:null,transitions:null,pendingSuspenseBoundaries:null},An(F),o}function bf(o,d,y){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zt,key:S==null?null:""+S,children:o,containerInfo:d,implementation:y}}function vf(o){if(!o)return Ga;o=o._reactInternals;e:{if(nr(o)!==o||o.tag!==1)throw Error(w(170));var d=o;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(un(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(w(171))}if(o.tag===1){var y=o.type;if(un(y))return Cu(o,y,d)}return d}function wf(o,d,y,S,z,F,Q,ye,Te){return o=Sp(y,S,!0,o,z,F,Q,ye,Te),o.context=vf(null),y=o.current,S=On(),z=fa(y),F=Wa(S,z),F.callback=d??null,oo(y,F,z),o.current.lanes=z,jo(o,z,S),Yn(o,S),o}function Lh(o,d,y,S){var z=d.current,F=On(),Q=fa(z);return y=vf(y),d.context===null?d.context=y:d.pendingContext=y,d=Wa(F,Q),d.payload={element:o},S=S===void 0?null:S,S!==null&&(d.callback=S),o=oo(z,d,Q),o!==null&&(zi(o,z,Q,F),Lu(o,z,Q)),Q}function qd(o){return o=o.current,o.child?(o.child.tag===5,o.child.stateNode):null}function kf(o,d){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var y=o.retryLane;o.retryLane=y!==0&&y<d?y:d}}function Tp(o,d){kf(o,d),(o=o.alternate)&&kf(o,d)}function Ks(){return null}var Ku=typeof reportError=="function"?reportError:function(o){console.error(o)};function Np(o){this._internalRoot=o}Fh.prototype.render=Np.prototype.render=function(o){var d=this._internalRoot;if(d===null)throw Error(w(409));Lh(o,d,null,null)},Fh.prototype.unmount=Np.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var d=o.containerInfo;Vc(function(){Lh(null,o,null,null)}),d[aa]=null}};function Fh(o){this._internalRoot=o}Fh.prototype.unstable_scheduleHydration=function(o){if(o){var d=bl();o={blockedOn:null,target:o,priority:d};for(var y=0;y<Ir.length&&d!==0&&d<Ir[y].priority;y++);Ir.splice(y,0,o),y===0&&Pn(o)}};function Oh(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function Gd(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function jf(){}function Sf(o,d,y,S,z){if(z){if(typeof S=="function"){var F=S;S=function(){var He=qd(Q);F.call(He)}}var Q=wf(d,S,o,0,null,!1,!1,"",jf);return o._reactRootContainer=Q,o[aa]=Q.current,Fo(o.nodeType===8?o.parentNode:o),Vc(),Q}for(;z=o.lastChild;)o.removeChild(z);if(typeof S=="function"){var ye=S;S=function(){var He=qd(Te);ye.call(He)}}var Te=Sp(o,0,!1,null,null,!1,!1,"",jf);return o._reactRootContainer=Te,o[aa]=Te.current,Fo(o.nodeType===8?o.parentNode:o),Vc(function(){Lh(d,Te,y,S)}),Te}function Zd(o,d,y,S,z){var F=y._reactRootContainer;if(F){var Q=F;if(typeof z=="function"){var ye=z;z=function(){var Te=qd(Q);ye.call(Te)}}Lh(d,Q,o,z)}else Q=Sf(y,d,o,z,S);return qd(Q)}cd=function(o){switch(o.tag){case 3:var d=o.stateNode;if(d.current.memoizedState.isDehydrated){var y=xi(d.pendingLanes);y!==0&&(ld(d,y|1),Yn(d,is()),(Ar&6)===0&&(sl=is()+500,oa()))}break;case 13:Vc(function(){var S=da(o,1);if(S!==null){var z=On();zi(S,o,1,z)}}),Tp(o,1)}},Vi=function(o){if(o.tag===13){var d=da(o,134217728);if(d!==null){var y=On();zi(d,o,134217728,y)}Tp(o,134217728)}},su=function(o){if(o.tag===13){var d=fa(o),y=da(o,d);if(y!==null){var S=On();zi(y,o,d,S)}Tp(o,d)}},bl=function(){return Nr},yi=function(o,d){var y=Nr;try{return Nr=o,d()}finally{Nr=y}},Jt=function(o,d,y){switch(d){case"input":if(as(o,y),d=y.name,y.type==="radio"&&d!=null){for(y=o;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<y.length;d++){var S=y[d];if(S!==o&&S.form===o.form){var z=Nc(S);if(!z)throw Error(w(90));Qn(S),as(S,z)}}}break;case"textarea":bo(o,y);break;case"select":d=y.value,d!=null&&Zn(o,!!y.multiple,d,!1)}},tr=xp,Mr=Vc;var Ju={usingClientEntryPoint:!1,Events:[Ca,Pa,Nc,Or,$s,xp]},$c={findFiberByHostInstance:Ea,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Tf={bundleType:$c.bundleType,version:$c.version,rendererPackageName:$c.rendererPackageName,rendererConfig:$c.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:lt.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=Ba(o),o===null?null:o.stateNode},findFiberByHostInstance:$c.findFiberByHostInstance||Ks,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hd.isDisabled&&Hd.supportsFiber)try{Bi=Hd.inject(Tf),ln=Hd}catch{}}return ii.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ju,ii.createPortal=function(o,d){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Oh(d))throw Error(w(200));return bf(o,d,null,y)},ii.createRoot=function(o,d){if(!Oh(o))throw Error(w(299));var y=!1,S="",z=Ku;return d!=null&&(d.unstable_strictMode===!0&&(y=!0),d.identifierPrefix!==void 0&&(S=d.identifierPrefix),d.onRecoverableError!==void 0&&(z=d.onRecoverableError)),d=Sp(o,1,!1,null,null,y,!1,S,z),o[aa]=d.current,Fo(o.nodeType===8?o.parentNode:o),new Np(d)},ii.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var d=o._reactInternals;if(d===void 0)throw typeof o.render=="function"?Error(w(188)):(o=Object.keys(o).join(","),Error(w(268,o)));return o=Ba(d),o=o===null?null:o.stateNode,o},ii.flushSync=function(o){return Vc(o)},ii.hydrate=function(o,d,y){if(!Gd(d))throw Error(w(200));return Zd(null,o,d,!0,y)},ii.hydrateRoot=function(o,d,y){if(!Oh(o))throw Error(w(405));var S=y!=null&&y.hydratedSources||null,z=!1,F="",Q=Ku;if(y!=null&&(y.unstable_strictMode===!0&&(z=!0),y.identifierPrefix!==void 0&&(F=y.identifierPrefix),y.onRecoverableError!==void 0&&(Q=y.onRecoverableError)),d=wf(d,null,o,1,y??null,z,!1,F,Q),o[aa]=d.current,Fo(o),S)for(o=0;o<S.length;o++)y=S[o],z=y._getVersion,z=z(y._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[y,z]:d.mutableSourceEagerHydrationData.push(y,z);return new Fh(d)},ii.render=function(o,d,y){if(!Gd(d))throw Error(w(200));return Zd(null,o,d,!1,y)},ii.unmountComponentAtNode=function(o){if(!Gd(o))throw Error(w(40));return o._reactRootContainer?(Vc(function(){Zd(null,null,o,!1,function(){o._reactRootContainer=null,o[aa]=null})}),!0):!1},ii.unstable_batchedUpdates=xp,ii.unstable_renderSubtreeIntoContainer=function(o,d,y,S){if(!Gd(y))throw Error(w(200));if(o==null||o._reactInternals===void 0)throw Error(w(38));return Zd(o,d,y,!1,S)},ii.version="18.3.1-next-f1338f8080-20240426",ii}var Ax;function jy(){if(Ax)return p0.exports;Ax=1;function b(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b)}catch(k){console.error(k)}}return b(),p0.exports=$b(),p0.exports}var Dx;function Ub(){if(Dx)return qf;Dx=1;var b=jy();return qf.createRoot=b.createRoot,qf.hydrateRoot=b.hydrateRoot,qf}var qb=Ub();const Gb="modulepreload",Zb=function(b,k){return new URL(b,k).href},Rx={},Zp=function(k,w,P){let I=Promise.resolve();if(w&&w.length>0){let W=function(se){return Promise.all(se.map(ee=>Promise.resolve(ee).then(ne=>({status:"fulfilled",value:ne}),ne=>({status:"rejected",reason:ne}))))};const T=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),V=c?.nonce||c?.getAttribute("nonce");I=W(w.map(se=>{if(se=Zb(se,P),se in Rx)return;Rx[se]=!0;const ee=se.endsWith(".css"),ne=ee?'[rel="stylesheet"]':"";if(P)for(let je=T.length-1;je>=0;je--){const re=T[je];if(re.href===se&&(!ee||re.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${se}"]${ne}`))return;const ke=document.createElement("link");if(ke.rel=ee?"stylesheet":Gb,ee||(ke.as="script"),ke.crossOrigin="",ke.href=se,V&&ke.setAttribute("nonce",V),document.head.appendChild(ke),ee)return new Promise((je,re)=>{ke.addEventListener("load",je),ke.addEventListener("error",()=>re(new Error(`Unable to preload CSS for ${se}`)))})}))}function R(T){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=T,window.dispatchEvent(c),!c.defaultPrevented)throw T}return I.then(T=>{for(const c of T||[])c.status==="rejected"&&R(c.reason);return k().catch(R)})};var K=U0();var Lx="popstate";function Hb(b={}){function k(I,R){let{pathname:T="/",search:c="",hash:V=""}=oh(I.location.hash.substring(1));return!T.startsWith("/")&&!T.startsWith(".")&&(T="/"+T),P0("",{pathname:T,search:c,hash:V},R.state&&R.state.usr||null,R.state&&R.state.key||"default")}function w(I,R){let T=I.document.querySelector("base"),c="";if(T&&T.getAttribute("href")){let V=I.location.href,W=V.indexOf("#");c=W===-1?V:V.slice(0,W)}return c+"#"+(typeof R=="string"?R:Up(R))}function P(I,R){go(I.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(R)})`)}return Xb(k,w,P,b)}function Vs(b,k){if(b===!1||b===null||typeof b>"u")throw new Error(k)}function go(b,k){if(!b){typeof console<"u"&&console.warn(k);try{throw new Error(k)}catch{}}}function Wb(){return Math.random().toString(36).substring(2,10)}function Fx(b,k){return{usr:b.state,key:b.key,idx:k}}function P0(b,k,w=null,P){return{pathname:typeof b=="string"?b:b.pathname,search:"",hash:"",...typeof k=="string"?oh(k):k,state:w,key:k&&k.key||P||Wb()}}function Up({pathname:b="/",search:k="",hash:w=""}){return k&&k!=="?"&&(b+=k.charAt(0)==="?"?k:"?"+k),w&&w!=="#"&&(b+=w.charAt(0)==="#"?w:"#"+w),b}function oh(b){let k={};if(b){let w=b.indexOf("#");w>=0&&(k.hash=b.substring(w),b=b.substring(0,w));let P=b.indexOf("?");P>=0&&(k.search=b.substring(P),b=b.substring(0,P)),b&&(k.pathname=b)}return k}function Xb(b,k,w,P={}){let{window:I=document.defaultView,v5Compat:R=!1}=P,T=I.history,c="POP",V=null,W=se();W==null&&(W=0,T.replaceState({...T.state,idx:W},""));function se(){return(T.state||{idx:null}).idx}function ee(){c="POP";let H=se(),Ze=H==null?null:H-W;W=H,V&&V({action:c,location:re.location,delta:Ze})}function ne(H,Ze){c="PUSH";let Pe=P0(re.location,H,Ze);w&&w(Pe,H),W=se()+1;let ze=Fx(Pe,W),lt=re.createHref(Pe);try{T.pushState(ze,"",lt)}catch(Nt){if(Nt instanceof DOMException&&Nt.name==="DataCloneError")throw Nt;I.location.assign(lt)}R&&V&&V({action:c,location:re.location,delta:1})}function ke(H,Ze){c="REPLACE";let Pe=P0(re.location,H,Ze);w&&w(Pe,H),W=se();let ze=Fx(Pe,W),lt=re.createHref(Pe);T.replaceState(ze,"",lt),R&&V&&V({action:c,location:re.location,delta:0})}function je(H){return Yb(H)}let re={get action(){return c},get location(){return b(I,T)},listen(H){if(V)throw new Error("A history only accepts one active listener");return I.addEventListener(Lx,ee),V=H,()=>{I.removeEventListener(Lx,ee),V=null}},createHref(H){return k(I,H)},createURL:je,encodeLocation(H){let Ze=je(H);return{pathname:Ze.pathname,search:Ze.search,hash:Ze.hash}},push:ne,replace:ke,go(H){return T.go(H)}};return re}function Yb(b,k=!1){let w="http://localhost";typeof window<"u"&&(w=window.location.origin!=="null"?window.location.origin:window.location.href),Vs(w,"No window.location.(origin|href) available to create URL");let P=typeof b=="string"?b:Up(b);return P=P.replace(/ $/,"%20"),!k&&P.startsWith("//")&&(P=w+P),new URL(P,w)}function Sy(b,k,w="/"){return Kb(b,k,w,!1)}function Kb(b,k,w,P){let I=typeof k=="string"?oh(k):k,R=Xc(I.pathname||"/",w);if(R==null)return null;let T=Ty(b);Jb(T);let c=null;for(let V=0;c==null&&V<T.length;++V){let W=cv(R);c=ov(T[V],W,P)}return c}function Ty(b,k=[],w=[],P="",I=!1){let R=(T,c,V=I,W)=>{let se={relativePath:W===void 0?T.path||"":W,caseSensitive:T.caseSensitive===!0,childrenIndex:c,route:T};if(se.relativePath.startsWith("/")){if(!se.relativePath.startsWith(P)&&V)return;Vs(se.relativePath.startsWith(P),`Absolute route path "${se.relativePath}" nested under path "${P}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),se.relativePath=se.relativePath.slice(P.length)}let ee=Wc([P,se.relativePath]),ne=w.concat(se);T.children&&T.children.length>0&&(Vs(T.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${ee}".`),Ty(T.children,k,ne,ee,V)),!(T.path==null&&!T.index)&&k.push({path:ee,score:av(ee,T.index),routesMeta:ne})};return b.forEach((T,c)=>{if(T.path===""||!T.path?.includes("?"))R(T,c);else for(let V of Ny(T.path))R(T,c,!0,V)}),k}function Ny(b){let k=b.split("/");if(k.length===0)return[];let[w,...P]=k,I=w.endsWith("?"),R=w.replace(/\?$/,"");if(P.length===0)return I?[R,""]:[R];let T=Ny(P.join("/")),c=[];return c.push(...T.map(V=>V===""?R:[R,V].join("/"))),I&&c.push(...T),c.map(V=>b.startsWith("/")&&V===""?"/":V)}function Jb(b){b.sort((k,w)=>k.score!==w.score?w.score-k.score:iv(k.routesMeta.map(P=>P.childrenIndex),w.routesMeta.map(P=>P.childrenIndex)))}var Qb=/^:[\w-]+$/,ev=3,tv=2,rv=1,sv=10,nv=-2,Ox=b=>b==="*";function av(b,k){let w=b.split("/"),P=w.length;return w.some(Ox)&&(P+=nv),k&&(P+=tv),w.filter(I=>!Ox(I)).reduce((I,R)=>I+(Qb.test(R)?ev:R===""?rv:sv),P)}function iv(b,k){return b.length===k.length&&b.slice(0,-1).every((P,I)=>P===k[I])?b[b.length-1]-k[k.length-1]:0}function ov(b,k,w=!1){let{routesMeta:P}=b,I={},R="/",T=[];for(let c=0;c<P.length;++c){let V=P[c],W=c===P.length-1,se=R==="/"?k:k.slice(R.length)||"/",ee=im({path:V.relativePath,caseSensitive:V.caseSensitive,end:W},se),ne=V.route;if(!ee&&W&&w&&!P[P.length-1].route.index&&(ee=im({path:V.relativePath,caseSensitive:V.caseSensitive,end:!1},se)),!ee)return null;Object.assign(I,ee.params),T.push({params:I,pathname:Wc([R,ee.pathname]),pathnameBase:pv(Wc([R,ee.pathnameBase])),route:ne}),ee.pathnameBase!=="/"&&(R=Wc([R,ee.pathnameBase]))}return T}function im(b,k){typeof b=="string"&&(b={path:b,caseSensitive:!1,end:!0});let[w,P]=lv(b.path,b.caseSensitive,b.end),I=k.match(w);if(!I)return null;let R=I[0],T=R.replace(/(.)\/+$/,"$1"),c=I.slice(1);return{params:P.reduce((W,{paramName:se,isOptional:ee},ne)=>{if(se==="*"){let je=c[ne]||"";T=R.slice(0,R.length-je.length).replace(/(.)\/+$/,"$1")}const ke=c[ne];return ee&&!ke?W[se]=void 0:W[se]=(ke||"").replace(/%2F/g,"/"),W},{}),pathname:R,pathnameBase:T,pattern:b}}function lv(b,k=!1,w=!0){go(b==="*"||!b.endsWith("*")||b.endsWith("/*"),`Route path "${b}" will be treated as if it were "${b.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${b.replace(/\*$/,"/*")}".`);let P=[],I="^"+b.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(T,c,V)=>(P.push({paramName:c,isOptional:V!=null}),V?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return b.endsWith("*")?(P.push({paramName:"*"}),I+=b==="*"||b==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):w?I+="\\/*$":b!==""&&b!=="/"&&(I+="(?:(?=\\/|$))"),[new RegExp(I,k?void 0:"i"),P]}function cv(b){try{return b.split("/").map(k=>decodeURIComponent(k).replace(/\//g,"%2F")).join("/")}catch(k){return go(!1,`The URL path "${b}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${k}).`),b}}function Xc(b,k){if(k==="/")return b;if(!b.toLowerCase().startsWith(k.toLowerCase()))return null;let w=k.endsWith("/")?k.length-1:k.length,P=b.charAt(w);return P&&P!=="/"?null:b.slice(w)||"/"}var Ey=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,uv=b=>Ey.test(b);function dv(b,k="/"){let{pathname:w,search:P="",hash:I=""}=typeof b=="string"?oh(b):b,R;if(w)if(uv(w))R=w;else{if(w.includes("//")){let T=w;w=w.replace(/\/\/+/g,"/"),go(!1,`Pathnames cannot have embedded double slashes - normalizing ${T} -> ${w}`)}w.startsWith("/")?R=Bx(w.substring(1),"/"):R=Bx(w,k)}else R=k;return{pathname:R,search:fv(P),hash:mv(I)}}function Bx(b,k){let w=k.replace(/\/+$/,"").split("/");return b.split("/").forEach(I=>{I===".."?w.length>1&&w.pop():I!=="."&&w.push(I)}),w.length>1?w.join("/"):"/"}function g0(b,k,w,P){return`Cannot include a '${b}' character in a manually specified \`to.${k}\` field [${JSON.stringify(P)}].  Please separate it out to the \`to.${w}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function hv(b){return b.filter((k,w)=>w===0||k.route.path&&k.route.path.length>0)}function Cy(b){let k=hv(b);return k.map((w,P)=>P===k.length-1?w.pathname:w.pathnameBase)}function Py(b,k,w,P=!1){let I;typeof b=="string"?I=oh(b):(I={...b},Vs(!I.pathname||!I.pathname.includes("?"),g0("?","pathname","search",I)),Vs(!I.pathname||!I.pathname.includes("#"),g0("#","pathname","hash",I)),Vs(!I.search||!I.search.includes("#"),g0("#","search","hash",I)));let R=b===""||I.pathname==="",T=R?"/":I.pathname,c;if(T==null)c=w;else{let ee=k.length-1;if(!P&&T.startsWith("..")){let ne=T.split("/");for(;ne[0]==="..";)ne.shift(),ee-=1;I.pathname=ne.join("/")}c=ee>=0?k[ee]:"/"}let V=dv(I,c),W=T&&T!=="/"&&T.endsWith("/"),se=(R||T===".")&&w.endsWith("/");return!V.pathname.endsWith("/")&&(W||se)&&(V.pathname+="/"),V}var Wc=b=>b.join("/").replace(/\/\/+/g,"/"),pv=b=>b.replace(/\/+$/,"").replace(/^\/*/,"/"),fv=b=>!b||b==="?"?"":b.startsWith("?")?b:"?"+b,mv=b=>!b||b==="#"?"":b.startsWith("#")?b:"#"+b,gv=class{constructor(b,k,w,P=!1){this.status=b,this.statusText=k||"",this.internal=P,w instanceof Error?(this.data=w.toString(),this.error=w):this.data=w}};function xv(b){return b!=null&&typeof b.status=="number"&&typeof b.statusText=="string"&&typeof b.internal=="boolean"&&"data"in b}function yv(b){return b.map(k=>k.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var My=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Iy(b,k){let w=b;if(typeof w!="string"||!Ey.test(w))return{absoluteURL:void 0,isExternal:!1,to:w};let P=w,I=!1;if(My)try{let R=new URL(window.location.href),T=w.startsWith("//")?new URL(R.protocol+w):new URL(w),c=Xc(T.pathname,k);T.origin===R.origin&&c!=null?w=c+T.search+T.hash:I=!0}catch{go(!1,`<Link to="${w}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:P,isExternal:I,to:w}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var zy=["POST","PUT","PATCH","DELETE"];new Set(zy);var _v=["GET",...zy];new Set(_v);var ep=K.createContext(null);ep.displayName="DataRouter";var hm=K.createContext(null);hm.displayName="DataRouterState";var bv=K.createContext(!1),Ay=K.createContext({isTransitioning:!1});Ay.displayName="ViewTransition";var vv=K.createContext(new Map);vv.displayName="Fetchers";var wv=K.createContext(null);wv.displayName="Await";var xo=K.createContext(null);xo.displayName="Navigation";var Hp=K.createContext(null);Hp.displayName="Location";var rc=K.createContext({outlet:null,matches:[],isDataRoute:!1});rc.displayName="Route";var q0=K.createContext(null);q0.displayName="RouteError";var Dy="REACT_ROUTER_ERROR",kv="REDIRECT",jv="ROUTE_ERROR_RESPONSE";function Sv(b){if(b.startsWith(`${Dy}:${kv}:{`))try{let k=JSON.parse(b.slice(28));if(typeof k=="object"&&k&&typeof k.status=="number"&&typeof k.statusText=="string"&&typeof k.location=="string"&&typeof k.reloadDocument=="boolean"&&typeof k.replace=="boolean")return k}catch{}}function Tv(b){if(b.startsWith(`${Dy}:${jv}:{`))try{let k=JSON.parse(b.slice(40));if(typeof k=="object"&&k&&typeof k.status=="number"&&typeof k.statusText=="string")return new gv(k.status,k.statusText,k.data)}catch{}}function Nv(b,{relative:k}={}){Vs(Wp(),"useHref() may be used only in the context of a <Router> component.");let{basename:w,navigator:P}=K.useContext(xo),{hash:I,pathname:R,search:T}=Xp(b,{relative:k}),c=R;return w!=="/"&&(c=R==="/"?w:Wc([w,R])),P.createHref({pathname:c,search:T,hash:I})}function Wp(){return K.useContext(Hp)!=null}function yo(){return Vs(Wp(),"useLocation() may be used only in the context of a <Router> component."),K.useContext(Hp).location}var Ry="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Ly(b){K.useContext(xo).static||K.useLayoutEffect(b)}function dr(){let{isDataRoute:b}=K.useContext(rc);return b?Bv():Ev()}function Ev(){Vs(Wp(),"useNavigate() may be used only in the context of a <Router> component.");let b=K.useContext(ep),{basename:k,navigator:w}=K.useContext(xo),{matches:P}=K.useContext(rc),{pathname:I}=yo(),R=JSON.stringify(Cy(P)),T=K.useRef(!1);return Ly(()=>{T.current=!0}),K.useCallback((V,W={})=>{if(go(T.current,Ry),!T.current)return;if(typeof V=="number"){w.go(V);return}let se=Py(V,JSON.parse(R),I,W.relative==="path");b==null&&k!=="/"&&(se.pathname=se.pathname==="/"?k:Wc([k,se.pathname])),(W.replace?w.replace:w.push)(se,W.state,W)},[k,w,R,I,b])}K.createContext(null);function di(){let{matches:b}=K.useContext(rc),k=b[b.length-1];return k?k.params:{}}function Xp(b,{relative:k}={}){let{matches:w}=K.useContext(rc),{pathname:P}=yo(),I=JSON.stringify(Cy(w));return K.useMemo(()=>Py(b,JSON.parse(I),P,k==="path"),[b,I,P,k])}function Cv(b,k){return Fy(b,k)}function Fy(b,k,w,P,I){Vs(Wp(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:R}=K.useContext(xo),{matches:T}=K.useContext(rc),c=T[T.length-1],V=c?c.params:{},W=c?c.pathname:"/",se=c?c.pathnameBase:"/",ee=c&&c.route;{let Pe=ee&&ee.path||"";By(W,!ee||Pe.endsWith("*")||Pe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${W}" (under <Route path="${Pe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Pe}"> to <Route path="${Pe==="/"?"*":`${Pe}/*`}">.`)}let ne=yo(),ke;if(k){let Pe=typeof k=="string"?oh(k):k;Vs(se==="/"||Pe.pathname?.startsWith(se),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${se}" but pathname "${Pe.pathname}" was given in the \`location\` prop.`),ke=Pe}else ke=ne;let je=ke.pathname||"/",re=je;if(se!=="/"){let Pe=se.replace(/^\//,"").split("/");re="/"+je.replace(/^\//,"").split("/").slice(Pe.length).join("/")}let H=Sy(b,{pathname:re});go(ee||H!=null,`No routes matched location "${ke.pathname}${ke.search}${ke.hash}" `),go(H==null||H[H.length-1].route.element!==void 0||H[H.length-1].route.Component!==void 0||H[H.length-1].route.lazy!==void 0,`Matched leaf route at location "${ke.pathname}${ke.search}${ke.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Ze=Av(H&&H.map(Pe=>Object.assign({},Pe,{params:Object.assign({},V,Pe.params),pathname:Wc([se,R.encodeLocation?R.encodeLocation(Pe.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Pe.pathname]),pathnameBase:Pe.pathnameBase==="/"?se:Wc([se,R.encodeLocation?R.encodeLocation(Pe.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Pe.pathnameBase])})),T,w,P,I);return k&&Ze?K.createElement(Hp.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ke},navigationType:"POP"}},Ze):Ze}function Pv(){let b=Ov(),k=xv(b)?`${b.status} ${b.statusText}`:b instanceof Error?b.message:JSON.stringify(b),w=b instanceof Error?b.stack:null,P="rgba(200,200,200, 0.5)",I={padding:"0.5rem",backgroundColor:P},R={padding:"2px 4px",backgroundColor:P},T=null;return console.error("Error handled by React Router default ErrorBoundary:",b),T=K.createElement(K.Fragment,null,K.createElement("p",null," Hey developer "),K.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",K.createElement("code",{style:R},"ErrorBoundary")," or"," ",K.createElement("code",{style:R},"errorElement")," prop on your route.")),K.createElement(K.Fragment,null,K.createElement("h2",null,"Unexpected Application Error!"),K.createElement("h3",{style:{fontStyle:"italic"}},k),w?K.createElement("pre",{style:I},w):null,T)}var Mv=K.createElement(Pv,null),Oy=class extends K.Component{constructor(b){super(b),this.state={location:b.location,revalidation:b.revalidation,error:b.error}}static getDerivedStateFromError(b){return{error:b}}static getDerivedStateFromProps(b,k){return k.location!==b.location||k.revalidation!=="idle"&&b.revalidation==="idle"?{error:b.error,location:b.location,revalidation:b.revalidation}:{error:b.error!==void 0?b.error:k.error,location:k.location,revalidation:b.revalidation||k.revalidation}}componentDidCatch(b,k){this.props.onError?this.props.onError(b,k):console.error("React Router caught the following error during render",b)}render(){let b=this.state.error;if(this.context&&typeof b=="object"&&b&&"digest"in b&&typeof b.digest=="string"){const w=Tv(b.digest);w&&(b=w)}let k=b!==void 0?K.createElement(rc.Provider,{value:this.props.routeContext},K.createElement(q0.Provider,{value:b,children:this.props.component})):this.props.children;return this.context?K.createElement(Iv,{error:b},k):k}};Oy.contextType=bv;var x0=new WeakMap;function Iv({children:b,error:k}){let{basename:w}=K.useContext(xo);if(typeof k=="object"&&k&&"digest"in k&&typeof k.digest=="string"){let P=Sv(k.digest);if(P){let I=x0.get(k);if(I)throw I;let R=Iy(P.location,w);if(My&&!x0.get(k))if(R.isExternal||P.reloadDocument)window.location.href=R.absoluteURL||R.to;else{const T=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(R.to,{replace:P.replace}));throw x0.set(k,T),T}return K.createElement("meta",{httpEquiv:"refresh",content:`0;url=${R.absoluteURL||R.to}`})}}return b}function zv({routeContext:b,match:k,children:w}){let P=K.useContext(ep);return P&&P.static&&P.staticContext&&(k.route.errorElement||k.route.ErrorBoundary)&&(P.staticContext._deepestRenderedBoundaryId=k.route.id),K.createElement(rc.Provider,{value:b},w)}function Av(b,k=[],w=null,P=null,I=null){if(b==null){if(!w)return null;if(w.errors)b=w.matches;else if(k.length===0&&!w.initialized&&w.matches.length>0)b=w.matches;else return null}let R=b,T=w?.errors;if(T!=null){let se=R.findIndex(ee=>ee.route.id&&T?.[ee.route.id]!==void 0);Vs(se>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(T).join(",")}`),R=R.slice(0,Math.min(R.length,se+1))}let c=!1,V=-1;if(w)for(let se=0;se<R.length;se++){let ee=R[se];if((ee.route.HydrateFallback||ee.route.hydrateFallbackElement)&&(V=se),ee.route.id){let{loaderData:ne,errors:ke}=w,je=ee.route.loader&&!ne.hasOwnProperty(ee.route.id)&&(!ke||ke[ee.route.id]===void 0);if(ee.route.lazy||je){c=!0,V>=0?R=R.slice(0,V+1):R=[R[0]];break}}}let W=w&&P?(se,ee)=>{P(se,{location:w.location,params:w.matches?.[0]?.params??{},unstable_pattern:yv(w.matches),errorInfo:ee})}:void 0;return R.reduceRight((se,ee,ne)=>{let ke,je=!1,re=null,H=null;w&&(ke=T&&ee.route.id?T[ee.route.id]:void 0,re=ee.route.errorElement||Mv,c&&(V<0&&ne===0?(By("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),je=!0,H=null):V===ne&&(je=!0,H=ee.route.hydrateFallbackElement||null)));let Ze=k.concat(R.slice(0,ne+1)),Pe=()=>{let ze;return ke?ze=re:je?ze=H:ee.route.Component?ze=K.createElement(ee.route.Component,null):ee.route.element?ze=ee.route.element:ze=se,K.createElement(zv,{match:ee,routeContext:{outlet:se,matches:Ze,isDataRoute:w!=null},children:ze})};return w&&(ee.route.ErrorBoundary||ee.route.errorElement||ne===0)?K.createElement(Oy,{location:w.location,revalidation:w.revalidation,component:re,error:ke,children:Pe(),routeContext:{outlet:null,matches:Ze,isDataRoute:!0},onError:W}):Pe()},null)}function G0(b){return`${b} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Dv(b){let k=K.useContext(ep);return Vs(k,G0(b)),k}function Rv(b){let k=K.useContext(hm);return Vs(k,G0(b)),k}function Lv(b){let k=K.useContext(rc);return Vs(k,G0(b)),k}function Z0(b){let k=Lv(b),w=k.matches[k.matches.length-1];return Vs(w.route.id,`${b} can only be used on routes that contain a unique "id"`),w.route.id}function Fv(){return Z0("useRouteId")}function Ov(){let b=K.useContext(q0),k=Rv("useRouteError"),w=Z0("useRouteError");return b!==void 0?b:k.errors?.[w]}function Bv(){let{router:b}=Dv("useNavigate"),k=Z0("useNavigate"),w=K.useRef(!1);return Ly(()=>{w.current=!0}),K.useCallback(async(I,R={})=>{go(w.current,Ry),w.current&&(typeof I=="number"?await b.navigate(I):await b.navigate(I,{fromRouteId:k,...R}))},[b,k])}var Vx={};function By(b,k,w){!k&&!Vx[b]&&(Vx[b]=!0,go(!1,w))}K.memo(Vv);function Vv({routes:b,future:k,state:w,onError:P}){return Fy(b,void 0,w,P,k)}function cr(b){Vs(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function $v({basename:b="/",children:k=null,location:w,navigationType:P="POP",navigator:I,static:R=!1,unstable_useTransitions:T}){Vs(!Wp(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=b.replace(/^\/*/,"/"),V=K.useMemo(()=>({basename:c,navigator:I,static:R,unstable_useTransitions:T,future:{}}),[c,I,R,T]);typeof w=="string"&&(w=oh(w));let{pathname:W="/",search:se="",hash:ee="",state:ne=null,key:ke="default"}=w,je=K.useMemo(()=>{let re=Xc(W,c);return re==null?null:{location:{pathname:re,search:se,hash:ee,state:ne,key:ke},navigationType:P}},[c,W,se,ee,ne,ke,P]);return go(je!=null,`<Router basename="${c}"> is not able to match the URL "${W}${se}${ee}" because it does not start with the basename, so the <Router> won't render anything.`),je==null?null:K.createElement(xo.Provider,{value:V},K.createElement(Hp.Provider,{children:k,value:je}))}function Uv({children:b,location:k}){return Cv(M0(b),k)}function M0(b,k=[]){let w=[];return K.Children.forEach(b,(P,I)=>{if(!K.isValidElement(P))return;let R=[...k,I];if(P.type===K.Fragment){w.push.apply(w,M0(P.props.children,R));return}Vs(P.type===cr,`[${typeof P.type=="string"?P.type:P.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Vs(!P.props.index||!P.props.children,"An index route cannot have child routes.");let T={id:P.props.id||R.join("-"),caseSensitive:P.props.caseSensitive,element:P.props.element,Component:P.props.Component,index:P.props.index,path:P.props.path,middleware:P.props.middleware,loader:P.props.loader,action:P.props.action,hydrateFallbackElement:P.props.hydrateFallbackElement,HydrateFallback:P.props.HydrateFallback,errorElement:P.props.errorElement,ErrorBoundary:P.props.ErrorBoundary,hasErrorBoundary:P.props.hasErrorBoundary===!0||P.props.ErrorBoundary!=null||P.props.errorElement!=null,shouldRevalidate:P.props.shouldRevalidate,handle:P.props.handle,lazy:P.props.lazy};P.props.children&&(T.children=M0(P.props.children,R)),w.push(T)}),w}var Xf="get",Yf="application/x-www-form-urlencoded";function pm(b){return typeof HTMLElement<"u"&&b instanceof HTMLElement}function qv(b){return pm(b)&&b.tagName.toLowerCase()==="button"}function Gv(b){return pm(b)&&b.tagName.toLowerCase()==="form"}function Zv(b){return pm(b)&&b.tagName.toLowerCase()==="input"}function Hv(b){return!!(b.metaKey||b.altKey||b.ctrlKey||b.shiftKey)}function Wv(b,k){return b.button===0&&(!k||k==="_self")&&!Hv(b)}var Gf=null;function Xv(){if(Gf===null)try{new FormData(document.createElement("form"),0),Gf=!1}catch{Gf=!0}return Gf}var Yv=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function y0(b){return b!=null&&!Yv.has(b)?(go(!1,`"${b}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Yf}"`),null):b}function Kv(b,k){let w,P,I,R,T;if(Gv(b)){let c=b.getAttribute("action");P=c?Xc(c,k):null,w=b.getAttribute("method")||Xf,I=y0(b.getAttribute("enctype"))||Yf,R=new FormData(b)}else if(qv(b)||Zv(b)&&(b.type==="submit"||b.type==="image")){let c=b.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let V=b.getAttribute("formaction")||c.getAttribute("action");if(P=V?Xc(V,k):null,w=b.getAttribute("formmethod")||c.getAttribute("method")||Xf,I=y0(b.getAttribute("formenctype"))||y0(c.getAttribute("enctype"))||Yf,R=new FormData(c,b),!Xv()){let{name:W,type:se,value:ee}=b;if(se==="image"){let ne=W?`${W}.`:"";R.append(`${ne}x`,"0"),R.append(`${ne}y`,"0")}else W&&R.append(W,ee)}}else{if(pm(b))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');w=Xf,P=null,I=Yf,T=b}return R&&I==="text/plain"&&(T=R,R=void 0),{action:P,method:w.toLowerCase(),encType:I,formData:R,body:T}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function H0(b,k){if(b===!1||b===null||typeof b>"u")throw new Error(k)}function Jv(b,k,w,P){let I=typeof b=="string"?new URL(b,typeof window>"u"?"server://singlefetch/":window.location.origin):b;return w?I.pathname.endsWith("/")?I.pathname=`${I.pathname}_.${P}`:I.pathname=`${I.pathname}.${P}`:I.pathname==="/"?I.pathname=`_root.${P}`:k&&Xc(I.pathname,k)==="/"?I.pathname=`${k.replace(/\/$/,"")}/_root.${P}`:I.pathname=`${I.pathname.replace(/\/$/,"")}.${P}`,I}async function Qv(b,k){if(b.id in k)return k[b.id];try{let w=await import(b.module);return k[b.id]=w,w}catch(w){return console.error(`Error loading route module \`${b.module}\`, reloading page...`),console.error(w),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function e1(b){return b==null?!1:b.href==null?b.rel==="preload"&&typeof b.imageSrcSet=="string"&&typeof b.imageSizes=="string":typeof b.rel=="string"&&typeof b.href=="string"}async function t1(b,k,w){let P=await Promise.all(b.map(async I=>{let R=k.routes[I.route.id];if(R){let T=await Qv(R,w);return T.links?T.links():[]}return[]}));return a1(P.flat(1).filter(e1).filter(I=>I.rel==="stylesheet"||I.rel==="preload").map(I=>I.rel==="stylesheet"?{...I,rel:"prefetch",as:"style"}:{...I,rel:"prefetch"}))}function $x(b,k,w,P,I,R){let T=(V,W)=>w[W]?V.route.id!==w[W].route.id:!0,c=(V,W)=>w[W].pathname!==V.pathname||w[W].route.path?.endsWith("*")&&w[W].params["*"]!==V.params["*"];return R==="assets"?k.filter((V,W)=>T(V,W)||c(V,W)):R==="data"?k.filter((V,W)=>{let se=P.routes[V.route.id];if(!se||!se.hasLoader)return!1;if(T(V,W)||c(V,W))return!0;if(V.route.shouldRevalidate){let ee=V.route.shouldRevalidate({currentUrl:new URL(I.pathname+I.search+I.hash,window.origin),currentParams:w[0]?.params||{},nextUrl:new URL(b,window.origin),nextParams:V.params,defaultShouldRevalidate:!0});if(typeof ee=="boolean")return ee}return!0}):[]}function r1(b,k,{includeHydrateFallback:w}={}){return s1(b.map(P=>{let I=k.routes[P.route.id];if(!I)return[];let R=[I.module];return I.clientActionModule&&(R=R.concat(I.clientActionModule)),I.clientLoaderModule&&(R=R.concat(I.clientLoaderModule)),w&&I.hydrateFallbackModule&&(R=R.concat(I.hydrateFallbackModule)),I.imports&&(R=R.concat(I.imports)),R}).flat(1))}function s1(b){return[...new Set(b)]}function n1(b){let k={},w=Object.keys(b).sort();for(let P of w)k[P]=b[P];return k}function a1(b,k){let w=new Set;return new Set(k),b.reduce((P,I)=>{let R=JSON.stringify(n1(I));return w.has(R)||(w.add(R),P.push({key:R,link:I})),P},[])}function Vy(){let b=K.useContext(ep);return H0(b,"You must render this element inside a <DataRouterContext.Provider> element"),b}function i1(){let b=K.useContext(hm);return H0(b,"You must render this element inside a <DataRouterStateContext.Provider> element"),b}var W0=K.createContext(void 0);W0.displayName="FrameworkContext";function $y(){let b=K.useContext(W0);return H0(b,"You must render this element inside a <HydratedRouter> element"),b}function o1(b,k){let w=K.useContext(W0),[P,I]=K.useState(!1),[R,T]=K.useState(!1),{onFocus:c,onBlur:V,onMouseEnter:W,onMouseLeave:se,onTouchStart:ee}=k,ne=K.useRef(null);K.useEffect(()=>{if(b==="render"&&T(!0),b==="viewport"){let re=Ze=>{Ze.forEach(Pe=>{T(Pe.isIntersecting)})},H=new IntersectionObserver(re,{threshold:.5});return ne.current&&H.observe(ne.current),()=>{H.disconnect()}}},[b]),K.useEffect(()=>{if(P){let re=setTimeout(()=>{T(!0)},100);return()=>{clearTimeout(re)}}},[P]);let ke=()=>{I(!0)},je=()=>{I(!1),T(!1)};return w?b!=="intent"?[R,ne,{}]:[R,ne,{onFocus:Rp(c,ke),onBlur:Rp(V,je),onMouseEnter:Rp(W,ke),onMouseLeave:Rp(se,je),onTouchStart:Rp(ee,ke)}]:[!1,ne,{}]}function Rp(b,k){return w=>{b&&b(w),w.defaultPrevented||k(w)}}function l1({page:b,...k}){let{router:w}=Vy(),P=K.useMemo(()=>Sy(w.routes,b,w.basename),[w.routes,b,w.basename]);return P?K.createElement(u1,{page:b,matches:P,...k}):null}function c1(b){let{manifest:k,routeModules:w}=$y(),[P,I]=K.useState([]);return K.useEffect(()=>{let R=!1;return t1(b,k,w).then(T=>{R||I(T)}),()=>{R=!0}},[b,k,w]),P}function u1({page:b,matches:k,...w}){let P=yo(),{future:I,manifest:R,routeModules:T}=$y(),{basename:c}=Vy(),{loaderData:V,matches:W}=i1(),se=K.useMemo(()=>$x(b,k,W,R,P,"data"),[b,k,W,R,P]),ee=K.useMemo(()=>$x(b,k,W,R,P,"assets"),[b,k,W,R,P]),ne=K.useMemo(()=>{if(b===P.pathname+P.search+P.hash)return[];let re=new Set,H=!1;if(k.forEach(Pe=>{let ze=R.routes[Pe.route.id];!ze||!ze.hasLoader||(!se.some(lt=>lt.route.id===Pe.route.id)&&Pe.route.id in V&&T[Pe.route.id]?.shouldRevalidate||ze.hasClientLoader?H=!0:re.add(Pe.route.id))}),re.size===0)return[];let Ze=Jv(b,c,I.unstable_trailingSlashAwareDataRequests,"data");return H&&re.size>0&&Ze.searchParams.set("_routes",k.filter(Pe=>re.has(Pe.route.id)).map(Pe=>Pe.route.id).join(",")),[Ze.pathname+Ze.search]},[c,I.unstable_trailingSlashAwareDataRequests,V,P,R,se,k,b,T]),ke=K.useMemo(()=>r1(ee,R),[ee,R]),je=c1(ee);return K.createElement(K.Fragment,null,ne.map(re=>K.createElement("link",{key:re,rel:"prefetch",as:"fetch",href:re,...w})),ke.map(re=>K.createElement("link",{key:re,rel:"modulepreload",href:re,...w})),je.map(({key:re,link:H})=>K.createElement("link",{key:re,nonce:w.nonce,...H})))}function d1(...b){return k=>{b.forEach(w=>{typeof w=="function"?w(k):w!=null&&(w.current=k)})}}var h1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{h1&&(window.__reactRouterVersion="7.12.0")}catch{}function p1({basename:b,children:k,unstable_useTransitions:w,window:P}){let I=K.useRef();I.current==null&&(I.current=Hb({window:P,v5Compat:!0}));let R=I.current,[T,c]=K.useState({action:R.action,location:R.location}),V=K.useCallback(W=>{w===!1?c(W):K.startTransition(()=>c(W))},[w]);return K.useLayoutEffect(()=>R.listen(V),[R,V]),K.createElement($v,{basename:b,children:k,location:T.location,navigationType:T.action,navigator:R,unstable_useTransitions:w})}var Uy=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xa=K.forwardRef(function({onClick:k,discover:w="render",prefetch:P="none",relative:I,reloadDocument:R,replace:T,state:c,target:V,to:W,preventScrollReset:se,viewTransition:ee,unstable_defaultShouldRevalidate:ne,...ke},je){let{basename:re,unstable_useTransitions:H}=K.useContext(xo),Ze=typeof W=="string"&&Uy.test(W),Pe=Iy(W,re);W=Pe.to;let ze=Nv(W,{relative:I}),[lt,Nt,zt]=o1(P,ke),Ft=g1(W,{replace:T,state:c,target:V,preventScrollReset:se,relative:I,viewTransition:ee,unstable_defaultShouldRevalidate:ne,unstable_useTransitions:H});function Vt(mt){k&&k(mt),mt.defaultPrevented||Ft(mt)}let Zt=K.createElement("a",{...ke,...zt,href:Pe.absoluteURL||ze,onClick:Pe.isExternal||R?k:Vt,ref:d1(je,Nt),target:V,"data-discover":!Ze&&w==="render"?"true":void 0});return lt&&!Ze?K.createElement(K.Fragment,null,Zt,K.createElement(l1,{page:ze})):Zt});xa.displayName="Link";var qy=K.forwardRef(function({"aria-current":k="page",caseSensitive:w=!1,className:P="",end:I=!1,style:R,to:T,viewTransition:c,children:V,...W},se){let ee=Xp(T,{relative:W.relative}),ne=yo(),ke=K.useContext(hm),{navigator:je,basename:re}=K.useContext(xo),H=ke!=null&&v1(ee)&&c===!0,Ze=je.encodeLocation?je.encodeLocation(ee).pathname:ee.pathname,Pe=ne.pathname,ze=ke&&ke.navigation&&ke.navigation.location?ke.navigation.location.pathname:null;w||(Pe=Pe.toLowerCase(),ze=ze?ze.toLowerCase():null,Ze=Ze.toLowerCase()),ze&&re&&(ze=Xc(ze,re)||ze);const lt=Ze!=="/"&&Ze.endsWith("/")?Ze.length-1:Ze.length;let Nt=Pe===Ze||!I&&Pe.startsWith(Ze)&&Pe.charAt(lt)==="/",zt=ze!=null&&(ze===Ze||!I&&ze.startsWith(Ze)&&ze.charAt(Ze.length)==="/"),Ft={isActive:Nt,isPending:zt,isTransitioning:H},Vt=Nt?k:void 0,Zt;typeof P=="function"?Zt=P(Ft):Zt=[P,Nt?"active":null,zt?"pending":null,H?"transitioning":null].filter(Boolean).join(" ");let mt=typeof R=="function"?R(Ft):R;return K.createElement(xa,{...W,"aria-current":Vt,className:Zt,ref:se,style:mt,to:T,viewTransition:c},typeof V=="function"?V(Ft):V)});qy.displayName="NavLink";var f1=K.forwardRef(({discover:b="render",fetcherKey:k,navigate:w,reloadDocument:P,replace:I,state:R,method:T=Xf,action:c,onSubmit:V,relative:W,preventScrollReset:se,viewTransition:ee,unstable_defaultShouldRevalidate:ne,...ke},je)=>{let{unstable_useTransitions:re}=K.useContext(xo),H=_1(),Ze=b1(c,{relative:W}),Pe=T.toLowerCase()==="get"?"get":"post",ze=typeof c=="string"&&Uy.test(c),lt=Nt=>{if(V&&V(Nt),Nt.defaultPrevented)return;Nt.preventDefault();let zt=Nt.nativeEvent.submitter,Ft=zt?.getAttribute("formmethod")||T,Vt=()=>H(zt||Nt.currentTarget,{fetcherKey:k,method:Ft,navigate:w,replace:I,state:R,relative:W,preventScrollReset:se,viewTransition:ee,unstable_defaultShouldRevalidate:ne});re&&w!==!1?K.startTransition(()=>Vt()):Vt()};return K.createElement("form",{ref:je,method:Pe,action:Ze,onSubmit:P?V:lt,...ke,"data-discover":!ze&&b==="render"?"true":void 0})});f1.displayName="Form";function m1(b){return`${b} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Gy(b){let k=K.useContext(ep);return Vs(k,m1(b)),k}function g1(b,{target:k,replace:w,state:P,preventScrollReset:I,relative:R,viewTransition:T,unstable_defaultShouldRevalidate:c,unstable_useTransitions:V}={}){let W=dr(),se=yo(),ee=Xp(b,{relative:R});return K.useCallback(ne=>{if(Wv(ne,k)){ne.preventDefault();let ke=w!==void 0?w:Up(se)===Up(ee),je=()=>W(b,{replace:ke,state:P,preventScrollReset:I,relative:R,viewTransition:T,unstable_defaultShouldRevalidate:c});V?K.startTransition(()=>je()):je()}},[se,W,ee,w,P,k,b,I,R,T,c,V])}var x1=0,y1=()=>`__${String(++x1)}__`;function _1(){let{router:b}=Gy("useSubmit"),{basename:k}=K.useContext(xo),w=Fv(),P=b.fetch,I=b.navigate;return K.useCallback(async(R,T={})=>{let{action:c,method:V,encType:W,formData:se,body:ee}=Kv(R,k);if(T.navigate===!1){let ne=T.fetcherKey||y1();await P(ne,w,T.action||c,{unstable_defaultShouldRevalidate:T.unstable_defaultShouldRevalidate,preventScrollReset:T.preventScrollReset,formData:se,body:ee,formMethod:T.method||V,formEncType:T.encType||W,flushSync:T.flushSync})}else await I(T.action||c,{unstable_defaultShouldRevalidate:T.unstable_defaultShouldRevalidate,preventScrollReset:T.preventScrollReset,formData:se,body:ee,formMethod:T.method||V,formEncType:T.encType||W,replace:T.replace,state:T.state,fromRouteId:w,flushSync:T.flushSync,viewTransition:T.viewTransition})},[P,I,k,w])}function b1(b,{relative:k}={}){let{basename:w}=K.useContext(xo),P=K.useContext(rc);Vs(P,"useFormAction must be used inside a RouteContext");let[I]=P.matches.slice(-1),R={...Xp(b||".",{relative:k})},T=yo();if(b==null){R.search=T.search;let c=new URLSearchParams(R.search),V=c.getAll("index");if(V.some(se=>se==="")){c.delete("index"),V.filter(ee=>ee).forEach(ee=>c.append("index",ee));let se=c.toString();R.search=se?`?${se}`:""}}return(!b||b===".")&&I.route.index&&(R.search=R.search?R.search.replace(/^\?/,"?index&"):"?index"),w!=="/"&&(R.pathname=R.pathname==="/"?w:Wc([w,R.pathname])),Up(R)}function v1(b,{relative:k}={}){let w=K.useContext(Ay);Vs(w!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:P}=Gy("useViewTransitionState"),I=Xp(b,{relative:k});if(!w.isTransitioning)return!1;let R=Xc(w.currentLocation.pathname,P)||w.currentLocation.pathname,T=Xc(w.nextLocation.pathname,P)||w.nextLocation.pathname;return im(I.pathname,T)!=null||im(I.pathname,R)!=null}var w1=jy();var Kh;(function(b){b.Unimplemented="UNIMPLEMENTED",b.Unavailable="UNAVAILABLE"})(Kh||(Kh={}));class _0 extends Error{constructor(k,w,P){super(k),this.message=k,this.code=w,this.data=P}}const k1=b=>{var k,w;return b?.androidBridge?"android":!((w=(k=b?.webkit)===null||k===void 0?void 0:k.messageHandlers)===null||w===void 0)&&w.bridge?"ios":"web"},j1=b=>{const k=b.CapacitorCustomPlatform||null,w=b.Capacitor||{},P=w.Plugins=w.Plugins||{},I=()=>k!==null?k.name:k1(b),R=()=>I()!=="web",T=ee=>{const ne=W.get(ee);return!!(ne?.platforms.has(I())||c(ee))},c=ee=>{var ne;return(ne=w.PluginHeaders)===null||ne===void 0?void 0:ne.find(ke=>ke.name===ee)},V=ee=>b.console.error(ee),W=new Map,se=(ee,ne={})=>{const ke=W.get(ee);if(ke)return console.warn(`Capacitor plugin "${ee}" already registered. Cannot register plugins twice.`),ke.proxy;const je=I(),re=c(ee);let H;const Ze=async()=>(!H&&je in ne?H=typeof ne[je]=="function"?H=await ne[je]():H=ne[je]:k!==null&&!H&&"web"in ne&&(H=typeof ne.web=="function"?H=await ne.web():H=ne.web),H),Pe=(Vt,Zt)=>{var mt,fr;if(re){const Kt=re?.methods.find(Wt=>Zt===Wt.name);if(Kt)return Kt.rtype==="promise"?Wt=>w.nativePromise(ee,Zt.toString(),Wt):(Wt,Me)=>w.nativeCallback(ee,Zt.toString(),Wt,Me);if(Vt)return(mt=Vt[Zt])===null||mt===void 0?void 0:mt.bind(Vt)}else{if(Vt)return(fr=Vt[Zt])===null||fr===void 0?void 0:fr.bind(Vt);throw new _0(`"${ee}" plugin is not implemented on ${je}`,Kh.Unimplemented)}},ze=Vt=>{let Zt;const mt=(...fr)=>{const Kt=Ze().then(Wt=>{const Me=Pe(Wt,Vt);if(Me){const Ct=Me(...fr);return Zt=Ct?.remove,Ct}else throw new _0(`"${ee}.${Vt}()" is not implemented on ${je}`,Kh.Unimplemented)});return Vt==="addListener"&&(Kt.remove=async()=>Zt()),Kt};return mt.toString=()=>`${Vt.toString()}() { [capacitor code] }`,Object.defineProperty(mt,"name",{value:Vt,writable:!1,configurable:!1}),mt},lt=ze("addListener"),Nt=ze("removeListener"),zt=(Vt,Zt)=>{const mt=lt({eventName:Vt},Zt),fr=async()=>{const Wt=await mt;Nt({eventName:Vt,callbackId:Wt},Zt)},Kt=new Promise(Wt=>mt.then(()=>Wt({remove:fr})));return Kt.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await fr()},Kt},Ft=new Proxy({},{get(Vt,Zt){switch(Zt){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return re?zt:lt;case"removeListener":return Nt;default:return ze(Zt)}}});return P[ee]=Ft,W.set(ee,{name:ee,proxy:Ft,platforms:new Set([...Object.keys(ne),...re?[je]:[]])}),Ft};return w.convertFileSrc||(w.convertFileSrc=ee=>ee),w.getPlatform=I,w.handleError=V,w.isNativePlatform=R,w.isPluginAvailable=T,w.registerPlugin=se,w.Exception=_0,w.DEBUG=!!w.DEBUG,w.isLoggingEnabled=!!w.isLoggingEnabled,w},S1=b=>b.Capacitor=j1(b),I0=S1(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),lh=I0.registerPlugin;class X0{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(k,w){let P=!1;this.listeners[k]||(this.listeners[k]=[],P=!0),this.listeners[k].push(w);const R=this.windowListeners[k];R&&!R.registered&&this.addWindowListener(R),P&&this.sendRetainedArgumentsForEvent(k);const T=async()=>this.removeListener(k,w);return Promise.resolve({remove:T})}async removeAllListeners(){this.listeners={};for(const k in this.windowListeners)this.removeWindowListener(this.windowListeners[k]);this.windowListeners={}}notifyListeners(k,w,P){const I=this.listeners[k];if(!I){if(P){let R=this.retainedEventArguments[k];R||(R=[]),R.push(w),this.retainedEventArguments[k]=R}return}I.forEach(R=>R(w))}hasListeners(k){var w;return!!(!((w=this.listeners[k])===null||w===void 0)&&w.length)}registerWindowListener(k,w){this.windowListeners[w]={registered:!1,windowEventName:k,pluginEventName:w,handler:P=>{this.notifyListeners(w,P)}}}unimplemented(k="not implemented"){return new I0.Exception(k,Kh.Unimplemented)}unavailable(k="not available"){return new I0.Exception(k,Kh.Unavailable)}async removeListener(k,w){const P=this.listeners[k];if(!P)return;const I=P.indexOf(w);this.listeners[k].splice(I,1),this.listeners[k].length||this.removeWindowListener(this.windowListeners[k])}addWindowListener(k){window.addEventListener(k.windowEventName,k.handler),k.registered=!0}removeWindowListener(k){k&&(window.removeEventListener(k.windowEventName,k.handler),k.registered=!1)}sendRetainedArgumentsForEvent(k){const w=this.retainedEventArguments[k];w&&(delete this.retainedEventArguments[k],w.forEach(P=>{this.notifyListeners(k,P)}))}}const Ux=b=>encodeURIComponent(b).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),qx=b=>b.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class T1 extends X0{async getCookies(){const k=document.cookie,w={};return k.split(";").forEach(P=>{if(P.length<=0)return;let[I,R]=P.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");I=qx(I).trim(),R=qx(R).trim(),w[I]=R}),w}async setCookie(k){try{const w=Ux(k.key),P=Ux(k.value),I=`; expires=${(k.expires||"").replace("expires=","")}`,R=(k.path||"/").replace("path=",""),T=k.url!=null&&k.url.length>0?`domain=${k.url}`:"";document.cookie=`${w}=${P||""}${I}; path=${R}; ${T};`}catch(w){return Promise.reject(w)}}async deleteCookie(k){try{document.cookie=`${k.key}=; Max-Age=0`}catch(w){return Promise.reject(w)}}async clearCookies(){try{const k=document.cookie.split(";")||[];for(const w of k)document.cookie=w.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(k){return Promise.reject(k)}}async clearAllCookies(){try{await this.clearCookies()}catch(k){return Promise.reject(k)}}}lh("CapacitorCookies",{web:()=>new T1});const N1=async b=>new Promise((k,w)=>{const P=new FileReader;P.onload=()=>{const I=P.result;k(I.indexOf(",")>=0?I.split(",")[1]:I)},P.onerror=I=>w(I),P.readAsDataURL(b)}),E1=(b={})=>{const k=Object.keys(b);return Object.keys(b).map(I=>I.toLocaleLowerCase()).reduce((I,R,T)=>(I[R]=b[k[T]],I),{})},C1=(b,k=!0)=>b?Object.entries(b).reduce((P,I)=>{const[R,T]=I;let c,V;return Array.isArray(T)?(V="",T.forEach(W=>{c=k?encodeURIComponent(W):W,V+=`${R}=${c}&`}),V.slice(0,-1)):(c=k?encodeURIComponent(T):T,V=`${R}=${c}`),`${P}&${V}`},"").substr(1):null,P1=(b,k={})=>{const w=Object.assign({method:b.method||"GET",headers:b.headers},k),I=E1(b.headers)["content-type"]||"";if(typeof b.data=="string")w.body=b.data;else if(I.includes("application/x-www-form-urlencoded")){const R=new URLSearchParams;for(const[T,c]of Object.entries(b.data||{}))R.set(T,c);w.body=R.toString()}else if(I.includes("multipart/form-data")||b.data instanceof FormData){const R=new FormData;if(b.data instanceof FormData)b.data.forEach((c,V)=>{R.append(V,c)});else for(const c of Object.keys(b.data))R.append(c,b.data[c]);w.body=R;const T=new Headers(w.headers);T.delete("content-type"),w.headers=T}else(I.includes("application/json")||typeof b.data=="object")&&(w.body=JSON.stringify(b.data));return w};class M1 extends X0{async request(k){const w=P1(k,k.webFetchExtra),P=C1(k.params,k.shouldEncodeUrlParams),I=P?`${k.url}?${P}`:k.url,R=await fetch(I,w),T=R.headers.get("content-type")||"";let{responseType:c="text"}=R.ok?k:{};T.includes("application/json")&&(c="json");let V,W;switch(c){case"arraybuffer":case"blob":W=await R.blob(),V=await N1(W);break;case"json":V=await R.json();break;default:V=await R.text()}const se={};return R.headers.forEach((ee,ne)=>{se[ne]=ee}),{data:V,headers:se,status:R.status,url:R.url}}async get(k){return this.request(Object.assign(Object.assign({},k),{method:"GET"}))}async post(k){return this.request(Object.assign(Object.assign({},k),{method:"POST"}))}async put(k){return this.request(Object.assign(Object.assign({},k),{method:"PUT"}))}async patch(k){return this.request(Object.assign(Object.assign({},k),{method:"PATCH"}))}async delete(k){return this.request(Object.assign(Object.assign({},k),{method:"DELETE"}))}}lh("CapacitorHttp",{web:()=>new M1});var Gx;(function(b){b.Dark="DARK",b.Light="LIGHT",b.Default="DEFAULT"})(Gx||(Gx={}));var Zx;(function(b){b.StatusBar="StatusBar",b.NavigationBar="NavigationBar"})(Zx||(Zx={}));class I1 extends X0{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}lh("SystemBars",{web:()=>new I1});function z1(b){b.CapacitorUtils.Synapse=new Proxy({},{get(k,w){return new Proxy({},{get(P,I){return(R,T,c)=>{const V=b.Capacitor.Plugins[w];if(V===void 0){c(new Error(`Capacitor plugin ${w} not found`));return}if(typeof V[I]!="function"){c(new Error(`Method ${I} not found in Capacitor plugin ${w}`));return}(async()=>{try{const W=await V[I](R);T(W)}catch(W){c(W)}})()}}})}})}function A1(b){b.CapacitorUtils.Synapse=new Proxy({},{get(k,w){return b.cordova.plugins[w]}})}function D1(b=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!b?z1(window):window.cordova!==void 0&&A1(window))}const nd=lh("Geolocation",{web:()=>Zp(()=>import("./web-Ck9d0Z_g.js"),[],import.meta.url).then(b=>new b.GeolocationWeb)});D1();const R1=b=>b.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),L1=b=>b.replace(/^([A-Z])|[\s-_]+(\w)/g,(k,w,P)=>P?P.toUpperCase():w.toLowerCase()),Hx=b=>{const k=L1(b);return k.charAt(0).toUpperCase()+k.slice(1)},Zy=(...b)=>b.filter((k,w,P)=>!!k&&k.trim()!==""&&P.indexOf(k)===w).join(" ").trim(),F1=b=>{for(const k in b)if(k.startsWith("aria-")||k==="role"||k==="title")return!0};var O1={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const B1=K.forwardRef(({color:b="currentColor",size:k=24,strokeWidth:w=2,absoluteStrokeWidth:P,className:I="",children:R,iconNode:T,...c},V)=>K.createElement("svg",{ref:V,...O1,width:k,height:k,stroke:b,strokeWidth:P?Number(w)*24/Number(k):w,className:Zy("lucide",I),...!R&&!F1(c)&&{"aria-hidden":"true"},...c},[...T.map(([W,se])=>K.createElement(W,se)),...Array.isArray(R)?R:[R]]));const St=(b,k)=>{const w=K.forwardRef(({className:P,...I},R)=>K.createElement(B1,{ref:R,iconNode:k,className:Zy(`lucide-${R1(Hx(b))}`,`lucide-${b}`,P),...I}));return w.displayName=Hx(b),w};const V1=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Cr=St("arrow-right",V1);const $1=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],Y0=St("arrow-up-right",$1);const U1=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Kf=St("award",U1);const q1=[["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["path",{d:"M14.856 6H16a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.935",key:"lre1cr"}],["path",{d:"M22 14v-4",key:"14q9d5"}],["path",{d:"M5.14 18H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2.936",key:"13q5k0"}]],G1=St("battery-charging",q1);const Z1=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],H1=St("bell-off",Z1);const W1=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],fm=St("bell",W1);const X1=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Jh=St("book-open",X1);const Y1=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],K1=St("book",Y1);const J1=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],Q1=St("bookmark",J1);const ew=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],z0=St("briefcase",ew);const tw=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],b0=St("building-2",tw);const rw=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],sw=St("calendar-days",rw);const nw=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],hl=St("calendar",nw);const aw=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],om=St("camera",aw);const iw=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],A0=St("chart-column",iw);const ow=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],D0=St("check",ow);const lw=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Wx=St("chevron-down",lw);const cw=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],id=St("chevron-left",cw);const uw=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Xx=St("chevron-right",uw);const dw=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],K0=St("circle-alert",dw);const hw=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Yh=St("circle-check-big",hw);const pw=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],lm=St("circle-check",pw);const fw=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],oi=St("clock",fw);const mw=[["rect",{x:"2",y:"6",width:"20",height:"8",rx:"1",key:"1estib"}],["path",{d:"M17 14v7",key:"7m2elx"}],["path",{d:"M7 14v7",key:"1cm7wv"}],["path",{d:"M17 3v3",key:"1v4jwn"}],["path",{d:"M7 3v3",key:"7o6guu"}],["path",{d:"M10 14 2.3 6.3",key:"1023jk"}],["path",{d:"m14 6 7.7 7.7",key:"1s8pl2"}],["path",{d:"m8 6 8 8",key:"hl96qh"}]],gw=St("construction",mw);const xw=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Hy=St("cpu",xw);const yw=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],Wy=St("crosshair",yw);const _w=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Bp=St("dollar-sign",_w);const bw=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],vw=St("droplet",bw);const ww=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],Vp=St("droplets",ww);const kw=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Xy=St("eye",kw);const jw=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Yy=St("file-text",jw);const Sw=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Tw=St("funnel",Sw);const Nw=[["path",{d:"m14 13-8.381 8.38a1 1 0 0 1-3.001-3l8.384-8.381",key:"pgg06f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m21.5 10.5-8-8",key:"a17d9x"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m8.5 7.5 8 8",key:"1oyaui"}]],Ew=St("gavel",Nw);const Cw=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],Pw=St("github",Cw);const Mw=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],rh=St("globe",Mw);const Iw=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Jf=St("hash",Iw);const zw=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Yc=St("heart",zw);const Aw=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],Dw=St("house",Aw);const Rw=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Ky=St("image",Rw);const Lw=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],J0=St("info",Lw);const Fw=[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]],Ow=St("landmark",Fw);const Bw=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],cm=St("layers",Bw);const Vw=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],Qf=St("leaf",Vw);const $w=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],mo=St("lightbulb",$w);const Uw=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Jy=St("loader-circle",Uw);const qw=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Gw=St("lock",qw);const Zw=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],Qy=St("log-in",Zw);const Hw=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ww=St("log-out",Hw);const Xw=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Q0=St("mail",Xw);const Yw=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],qn=St("map-pin",Yw);const Kw=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Jw=St("map",Kw);const Qw=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],mm=St("message-circle",Qw);const e2=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],R0=St("message-square",e2);const t2=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],e_=St("moon",t2);const r2=[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["circle",{cx:"18.5",cy:"15.5",r:"2.5",key:"b5zd12"}],["path",{d:"M20.27 17.27 22 19",key:"1l4muz"}]],s2=St("package-search",r2);const n2=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],a2=St("pen-tool",n2);const i2=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],o2=St("pen",i2);const l2=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],tc=St("phone",l2);const c2=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],qp=St("plus",c2);const u2=[["path",{d:"M5 7 3 5",key:"1yys58"}],["path",{d:"M9 6V3",key:"1ptz9u"}],["path",{d:"m13 7 2-2",key:"1w3vmq"}],["circle",{cx:"9",cy:"13",r:"3",key:"1mma13"}],["path",{d:"M11.83 12H20a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2.17",key:"2frwzc"}],["path",{d:"M16 16h2",key:"dnq2od"}]],d2=St("projector",u2);const h2=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],p2=St("quote",h2);const f2=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],m2=St("refresh-ccw",f2);const g2=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],x2=St("reply",g2);const y2=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],_2=St("save",y2);const b2=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ch=St("search",b2);const v2=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Gp=St("send",v2);const w2=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Yp=St("share-2",w2);const k2=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],t_=St("shield-check",k2);const j2=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],sh=St("shield",j2);const S2=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],gm=St("smartphone",S2);const T2=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],N2=St("smile",T2);const E2=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],ah=St("star",E2);const C2=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],r_=St("sun",C2);const P2=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],eg=St("target",P2);const M2=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],L0=St("thumbs-up",M2);const I2=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],F0=St("trash-2",I2);const z2=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],eh=St("trending-up",z2);const A2=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ec=St("triangle-alert",A2);const D2=[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]],R2=St("twitter",D2);const L2=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],F2=St("upload",L2);const O2=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],s_=St("user-plus",O2);const B2=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],tp=St("user",B2);const V2=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Jn=St("users",V2);const $2=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],U2=St("wifi",$2);const q2=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],v0=St("wrench",q2);const G2=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ad=St("x",G2);const Z2=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],pl=St("zap",Z2);function n_(b,k){return function(){return b.apply(k,arguments)}}const{toString:H2}=Object.prototype,{getPrototypeOf:tg}=Object,{iterator:xm,toStringTag:a_}=Symbol,ym=(b=>k=>{const w=H2.call(k);return b[w]||(b[w]=w.slice(8,-1).toLowerCase())})(Object.create(null)),fl=b=>(b=b.toLowerCase(),k=>ym(k)===b),_m=b=>k=>typeof k===b,{isArray:rp}=Array,Qh=_m("undefined");function Kp(b){return b!==null&&!Qh(b)&&b.constructor!==null&&!Qh(b.constructor)&&li(b.constructor.isBuffer)&&b.constructor.isBuffer(b)}const i_=fl("ArrayBuffer");function W2(b){let k;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?k=ArrayBuffer.isView(b):k=b&&b.buffer&&i_(b.buffer),k}const X2=_m("string"),li=_m("function"),o_=_m("number"),Jp=b=>b!==null&&typeof b=="object",Y2=b=>b===!0||b===!1,em=b=>{if(ym(b)!=="object")return!1;const k=tg(b);return(k===null||k===Object.prototype||Object.getPrototypeOf(k)===null)&&!(a_ in b)&&!(xm in b)},K2=b=>{if(!Jp(b)||Kp(b))return!1;try{return Object.keys(b).length===0&&Object.getPrototypeOf(b)===Object.prototype}catch{return!1}},J2=fl("Date"),Q2=fl("File"),ek=fl("Blob"),tk=fl("FileList"),rk=b=>Jp(b)&&li(b.pipe),sk=b=>{let k;return b&&(typeof FormData=="function"&&b instanceof FormData||li(b.append)&&((k=ym(b))==="formdata"||k==="object"&&li(b.toString)&&b.toString()==="[object FormData]"))},nk=fl("URLSearchParams"),[ak,ik,ok,lk]=["ReadableStream","Request","Response","Headers"].map(fl),ck=b=>b.trim?b.trim():b.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qp(b,k,{allOwnKeys:w=!1}={}){if(b===null||typeof b>"u")return;let P,I;if(typeof b!="object"&&(b=[b]),rp(b))for(P=0,I=b.length;P<I;P++)k.call(null,b[P],P,b);else{if(Kp(b))return;const R=w?Object.getOwnPropertyNames(b):Object.keys(b),T=R.length;let c;for(P=0;P<T;P++)c=R[P],k.call(null,b[c],c,b)}}function l_(b,k){if(Kp(b))return null;k=k.toLowerCase();const w=Object.keys(b);let P=w.length,I;for(;P-- >0;)if(I=w[P],k===I.toLowerCase())return I;return null}const th=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,c_=b=>!Qh(b)&&b!==th;function O0(){const{caseless:b,skipUndefined:k}=c_(this)&&this||{},w={},P=(I,R)=>{const T=b&&l_(w,R)||R;em(w[T])&&em(I)?w[T]=O0(w[T],I):em(I)?w[T]=O0({},I):rp(I)?w[T]=I.slice():(!k||!Qh(I))&&(w[T]=I)};for(let I=0,R=arguments.length;I<R;I++)arguments[I]&&Qp(arguments[I],P);return w}const uk=(b,k,w,{allOwnKeys:P}={})=>(Qp(k,(I,R)=>{w&&li(I)?b[R]=n_(I,w):b[R]=I},{allOwnKeys:P}),b),dk=b=>(b.charCodeAt(0)===65279&&(b=b.slice(1)),b),hk=(b,k,w,P)=>{b.prototype=Object.create(k.prototype,P),b.prototype.constructor=b,Object.defineProperty(b,"super",{value:k.prototype}),w&&Object.assign(b.prototype,w)},pk=(b,k,w,P)=>{let I,R,T;const c={};if(k=k||{},b==null)return k;do{for(I=Object.getOwnPropertyNames(b),R=I.length;R-- >0;)T=I[R],(!P||P(T,b,k))&&!c[T]&&(k[T]=b[T],c[T]=!0);b=w!==!1&&tg(b)}while(b&&(!w||w(b,k))&&b!==Object.prototype);return k},fk=(b,k,w)=>{b=String(b),(w===void 0||w>b.length)&&(w=b.length),w-=k.length;const P=b.indexOf(k,w);return P!==-1&&P===w},mk=b=>{if(!b)return null;if(rp(b))return b;let k=b.length;if(!o_(k))return null;const w=new Array(k);for(;k-- >0;)w[k]=b[k];return w},gk=(b=>k=>b&&k instanceof b)(typeof Uint8Array<"u"&&tg(Uint8Array)),xk=(b,k)=>{const P=(b&&b[xm]).call(b);let I;for(;(I=P.next())&&!I.done;){const R=I.value;k.call(b,R[0],R[1])}},yk=(b,k)=>{let w;const P=[];for(;(w=b.exec(k))!==null;)P.push(w);return P},_k=fl("HTMLFormElement"),bk=b=>b.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(w,P,I){return P.toUpperCase()+I}),Yx=(({hasOwnProperty:b})=>(k,w)=>b.call(k,w))(Object.prototype),vk=fl("RegExp"),u_=(b,k)=>{const w=Object.getOwnPropertyDescriptors(b),P={};Qp(w,(I,R)=>{let T;(T=k(I,R,b))!==!1&&(P[R]=T||I)}),Object.defineProperties(b,P)},wk=b=>{u_(b,(k,w)=>{if(li(b)&&["arguments","caller","callee"].indexOf(w)!==-1)return!1;const P=b[w];if(li(P)){if(k.enumerable=!1,"writable"in k){k.writable=!1;return}k.set||(k.set=()=>{throw Error("Can not rewrite read-only method '"+w+"'")})}})},kk=(b,k)=>{const w={},P=I=>{I.forEach(R=>{w[R]=!0})};return rp(b)?P(b):P(String(b).split(k)),w},jk=()=>{},Sk=(b,k)=>b!=null&&Number.isFinite(b=+b)?b:k;function Tk(b){return!!(b&&li(b.append)&&b[a_]==="FormData"&&b[xm])}const Nk=b=>{const k=new Array(10),w=(P,I)=>{if(Jp(P)){if(k.indexOf(P)>=0)return;if(Kp(P))return P;if(!("toJSON"in P)){k[I]=P;const R=rp(P)?[]:{};return Qp(P,(T,c)=>{const V=w(T,I+1);!Qh(V)&&(R[c]=V)}),k[I]=void 0,R}}return P};return w(b,0)},Ek=fl("AsyncFunction"),Ck=b=>b&&(Jp(b)||li(b))&&li(b.then)&&li(b.catch),d_=((b,k)=>b?setImmediate:k?((w,P)=>(th.addEventListener("message",({source:I,data:R})=>{I===th&&R===w&&P.length&&P.shift()()},!1),I=>{P.push(I),th.postMessage(w,"*")}))(`axios@${Math.random()}`,[]):w=>setTimeout(w))(typeof setImmediate=="function",li(th.postMessage)),Pk=typeof queueMicrotask<"u"?queueMicrotask.bind(th):typeof process<"u"&&process.nextTick||d_,Mk=b=>b!=null&&li(b[xm]),Xe={isArray:rp,isArrayBuffer:i_,isBuffer:Kp,isFormData:sk,isArrayBufferView:W2,isString:X2,isNumber:o_,isBoolean:Y2,isObject:Jp,isPlainObject:em,isEmptyObject:K2,isReadableStream:ak,isRequest:ik,isResponse:ok,isHeaders:lk,isUndefined:Qh,isDate:J2,isFile:Q2,isBlob:ek,isRegExp:vk,isFunction:li,isStream:rk,isURLSearchParams:nk,isTypedArray:gk,isFileList:tk,forEach:Qp,merge:O0,extend:uk,trim:ck,stripBOM:dk,inherits:hk,toFlatObject:pk,kindOf:ym,kindOfTest:fl,endsWith:fk,toArray:mk,forEachEntry:xk,matchAll:yk,isHTMLForm:_k,hasOwnProperty:Yx,hasOwnProp:Yx,reduceDescriptors:u_,freezeMethods:wk,toObjectSet:kk,toCamelCase:bk,noop:jk,toFiniteNumber:Sk,findKey:l_,global:th,isContextDefined:c_,isSpecCompliantForm:Tk,toJSONObject:Nk,isAsyncFn:Ek,isThenable:Ck,setImmediate:d_,asap:Pk,isIterable:Mk};function _r(b,k,w,P,I){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=b,this.name="AxiosError",k&&(this.code=k),w&&(this.config=w),P&&(this.request=P),I&&(this.response=I,this.status=I.status?I.status:null)}Xe.inherits(_r,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xe.toJSONObject(this.config),code:this.code,status:this.status}}});const h_=_r.prototype,p_={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(b=>{p_[b]={value:b}});Object.defineProperties(_r,p_);Object.defineProperty(h_,"isAxiosError",{value:!0});_r.from=(b,k,w,P,I,R)=>{const T=Object.create(h_);Xe.toFlatObject(b,T,function(se){return se!==Error.prototype},W=>W!=="isAxiosError");const c=b&&b.message?b.message:"Error",V=k==null&&b?b.code:k;return _r.call(T,c,V,w,P,I),b&&T.cause==null&&Object.defineProperty(T,"cause",{value:b,configurable:!0}),T.name=b&&b.name||"Error",R&&Object.assign(T,R),T};const Ik=null;function B0(b){return Xe.isPlainObject(b)||Xe.isArray(b)}function f_(b){return Xe.endsWith(b,"[]")?b.slice(0,-2):b}function Kx(b,k,w){return b?b.concat(k).map(function(I,R){return I=f_(I),!w&&R?"["+I+"]":I}).join(w?".":""):k}function zk(b){return Xe.isArray(b)&&!b.some(B0)}const Ak=Xe.toFlatObject(Xe,{},null,function(k){return/^is[A-Z]/.test(k)});function bm(b,k,w){if(!Xe.isObject(b))throw new TypeError("target must be an object");k=k||new FormData,w=Xe.toFlatObject(w,{metaTokens:!0,dots:!1,indexes:!1},!1,function(re,H){return!Xe.isUndefined(H[re])});const P=w.metaTokens,I=w.visitor||se,R=w.dots,T=w.indexes,V=(w.Blob||typeof Blob<"u"&&Blob)&&Xe.isSpecCompliantForm(k);if(!Xe.isFunction(I))throw new TypeError("visitor must be a function");function W(je){if(je===null)return"";if(Xe.isDate(je))return je.toISOString();if(Xe.isBoolean(je))return je.toString();if(!V&&Xe.isBlob(je))throw new _r("Blob is not supported. Use a Buffer instead.");return Xe.isArrayBuffer(je)||Xe.isTypedArray(je)?V&&typeof Blob=="function"?new Blob([je]):Buffer.from(je):je}function se(je,re,H){let Ze=je;if(je&&!H&&typeof je=="object"){if(Xe.endsWith(re,"{}"))re=P?re:re.slice(0,-2),je=JSON.stringify(je);else if(Xe.isArray(je)&&zk(je)||(Xe.isFileList(je)||Xe.endsWith(re,"[]"))&&(Ze=Xe.toArray(je)))return re=f_(re),Ze.forEach(function(ze,lt){!(Xe.isUndefined(ze)||ze===null)&&k.append(T===!0?Kx([re],lt,R):T===null?re:re+"[]",W(ze))}),!1}return B0(je)?!0:(k.append(Kx(H,re,R),W(je)),!1)}const ee=[],ne=Object.assign(Ak,{defaultVisitor:se,convertValue:W,isVisitable:B0});function ke(je,re){if(!Xe.isUndefined(je)){if(ee.indexOf(je)!==-1)throw Error("Circular reference detected in "+re.join("."));ee.push(je),Xe.forEach(je,function(Ze,Pe){(!(Xe.isUndefined(Ze)||Ze===null)&&I.call(k,Ze,Xe.isString(Pe)?Pe.trim():Pe,re,ne))===!0&&ke(Ze,re?re.concat(Pe):[Pe])}),ee.pop()}}if(!Xe.isObject(b))throw new TypeError("data must be an object");return ke(b),k}function Jx(b){const k={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(b).replace(/[!'()~]|%20|%00/g,function(P){return k[P]})}function rg(b,k){this._pairs=[],b&&bm(b,this,k)}const m_=rg.prototype;m_.append=function(k,w){this._pairs.push([k,w])};m_.toString=function(k){const w=k?function(P){return k.call(this,P,Jx)}:Jx;return this._pairs.map(function(I){return w(I[0])+"="+w(I[1])},"").join("&")};function Dk(b){return encodeURIComponent(b).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function g_(b,k,w){if(!k)return b;const P=w&&w.encode||Dk;Xe.isFunction(w)&&(w={serialize:w});const I=w&&w.serialize;let R;if(I?R=I(k,w):R=Xe.isURLSearchParams(k)?k.toString():new rg(k,w).toString(P),R){const T=b.indexOf("#");T!==-1&&(b=b.slice(0,T)),b+=(b.indexOf("?")===-1?"?":"&")+R}return b}class Qx{constructor(){this.handlers=[]}use(k,w,P){return this.handlers.push({fulfilled:k,rejected:w,synchronous:P?P.synchronous:!1,runWhen:P?P.runWhen:null}),this.handlers.length-1}eject(k){this.handlers[k]&&(this.handlers[k]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(k){Xe.forEach(this.handlers,function(P){P!==null&&k(P)})}}const x_={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Rk=typeof URLSearchParams<"u"?URLSearchParams:rg,Lk=typeof FormData<"u"?FormData:null,Fk=typeof Blob<"u"?Blob:null,Ok={isBrowser:!0,classes:{URLSearchParams:Rk,FormData:Lk,Blob:Fk},protocols:["http","https","file","blob","url","data"]},sg=typeof window<"u"&&typeof document<"u",V0=typeof navigator=="object"&&navigator||void 0,Bk=sg&&(!V0||["ReactNative","NativeScript","NS"].indexOf(V0.product)<0),Vk=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",$k=sg&&window.location.href||"http://localhost",Uk=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:sg,hasStandardBrowserEnv:Bk,hasStandardBrowserWebWorkerEnv:Vk,navigator:V0,origin:$k},Symbol.toStringTag,{value:"Module"})),ya={...Uk,...Ok};function qk(b,k){return bm(b,new ya.classes.URLSearchParams,{visitor:function(w,P,I,R){return ya.isNode&&Xe.isBuffer(w)?(this.append(P,w.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)},...k})}function Gk(b){return Xe.matchAll(/\w+|\[(\w*)]/g,b).map(k=>k[0]==="[]"?"":k[1]||k[0])}function Zk(b){const k={},w=Object.keys(b);let P;const I=w.length;let R;for(P=0;P<I;P++)R=w[P],k[R]=b[R];return k}function y_(b){function k(w,P,I,R){let T=w[R++];if(T==="__proto__")return!0;const c=Number.isFinite(+T),V=R>=w.length;return T=!T&&Xe.isArray(I)?I.length:T,V?(Xe.hasOwnProp(I,T)?I[T]=[I[T],P]:I[T]=P,!c):((!I[T]||!Xe.isObject(I[T]))&&(I[T]=[]),k(w,P,I[T],R)&&Xe.isArray(I[T])&&(I[T]=Zk(I[T])),!c)}if(Xe.isFormData(b)&&Xe.isFunction(b.entries)){const w={};return Xe.forEachEntry(b,(P,I)=>{k(Gk(P),I,w,0)}),w}return null}function Hk(b,k,w){if(Xe.isString(b))try{return(k||JSON.parse)(b),Xe.trim(b)}catch(P){if(P.name!=="SyntaxError")throw P}return(w||JSON.stringify)(b)}const ef={transitional:x_,adapter:["xhr","http","fetch"],transformRequest:[function(k,w){const P=w.getContentType()||"",I=P.indexOf("application/json")>-1,R=Xe.isObject(k);if(R&&Xe.isHTMLForm(k)&&(k=new FormData(k)),Xe.isFormData(k))return I?JSON.stringify(y_(k)):k;if(Xe.isArrayBuffer(k)||Xe.isBuffer(k)||Xe.isStream(k)||Xe.isFile(k)||Xe.isBlob(k)||Xe.isReadableStream(k))return k;if(Xe.isArrayBufferView(k))return k.buffer;if(Xe.isURLSearchParams(k))return w.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),k.toString();let c;if(R){if(P.indexOf("application/x-www-form-urlencoded")>-1)return qk(k,this.formSerializer).toString();if((c=Xe.isFileList(k))||P.indexOf("multipart/form-data")>-1){const V=this.env&&this.env.FormData;return bm(c?{"files[]":k}:k,V&&new V,this.formSerializer)}}return R||I?(w.setContentType("application/json",!1),Hk(k)):k}],transformResponse:[function(k){const w=this.transitional||ef.transitional,P=w&&w.forcedJSONParsing,I=this.responseType==="json";if(Xe.isResponse(k)||Xe.isReadableStream(k))return k;if(k&&Xe.isString(k)&&(P&&!this.responseType||I)){const T=!(w&&w.silentJSONParsing)&&I;try{return JSON.parse(k,this.parseReviver)}catch(c){if(T)throw c.name==="SyntaxError"?_r.from(c,_r.ERR_BAD_RESPONSE,this,null,this.response):c}}return k}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ya.classes.FormData,Blob:ya.classes.Blob},validateStatus:function(k){return k>=200&&k<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xe.forEach(["delete","get","head","post","put","patch"],b=>{ef.headers[b]={}});const Wk=Xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Xk=b=>{const k={};let w,P,I;return b&&b.split(`
`).forEach(function(T){I=T.indexOf(":"),w=T.substring(0,I).trim().toLowerCase(),P=T.substring(I+1).trim(),!(!w||k[w]&&Wk[w])&&(w==="set-cookie"?k[w]?k[w].push(P):k[w]=[P]:k[w]=k[w]?k[w]+", "+P:P)}),k},ey=Symbol("internals");function Lp(b){return b&&String(b).trim().toLowerCase()}function tm(b){return b===!1||b==null?b:Xe.isArray(b)?b.map(tm):String(b)}function Yk(b){const k=Object.create(null),w=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let P;for(;P=w.exec(b);)k[P[1]]=P[2];return k}const Kk=b=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(b.trim());function w0(b,k,w,P,I){if(Xe.isFunction(P))return P.call(this,k,w);if(I&&(k=w),!!Xe.isString(k)){if(Xe.isString(P))return k.indexOf(P)!==-1;if(Xe.isRegExp(P))return P.test(k)}}function Jk(b){return b.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(k,w,P)=>w.toUpperCase()+P)}function Qk(b,k){const w=Xe.toCamelCase(" "+k);["get","set","has"].forEach(P=>{Object.defineProperty(b,P+w,{value:function(I,R,T){return this[P].call(this,k,I,R,T)},configurable:!0})})}let ci=class{constructor(k){k&&this.set(k)}set(k,w,P){const I=this;function R(c,V,W){const se=Lp(V);if(!se)throw new Error("header name must be a non-empty string");const ee=Xe.findKey(I,se);(!ee||I[ee]===void 0||W===!0||W===void 0&&I[ee]!==!1)&&(I[ee||V]=tm(c))}const T=(c,V)=>Xe.forEach(c,(W,se)=>R(W,se,V));if(Xe.isPlainObject(k)||k instanceof this.constructor)T(k,w);else if(Xe.isString(k)&&(k=k.trim())&&!Kk(k))T(Xk(k),w);else if(Xe.isObject(k)&&Xe.isIterable(k)){let c={},V,W;for(const se of k){if(!Xe.isArray(se))throw TypeError("Object iterator must return a key-value pair");c[W=se[0]]=(V=c[W])?Xe.isArray(V)?[...V,se[1]]:[V,se[1]]:se[1]}T(c,w)}else k!=null&&R(w,k,P);return this}get(k,w){if(k=Lp(k),k){const P=Xe.findKey(this,k);if(P){const I=this[P];if(!w)return I;if(w===!0)return Yk(I);if(Xe.isFunction(w))return w.call(this,I,P);if(Xe.isRegExp(w))return w.exec(I);throw new TypeError("parser must be boolean|regexp|function")}}}has(k,w){if(k=Lp(k),k){const P=Xe.findKey(this,k);return!!(P&&this[P]!==void 0&&(!w||w0(this,this[P],P,w)))}return!1}delete(k,w){const P=this;let I=!1;function R(T){if(T=Lp(T),T){const c=Xe.findKey(P,T);c&&(!w||w0(P,P[c],c,w))&&(delete P[c],I=!0)}}return Xe.isArray(k)?k.forEach(R):R(k),I}clear(k){const w=Object.keys(this);let P=w.length,I=!1;for(;P--;){const R=w[P];(!k||w0(this,this[R],R,k,!0))&&(delete this[R],I=!0)}return I}normalize(k){const w=this,P={};return Xe.forEach(this,(I,R)=>{const T=Xe.findKey(P,R);if(T){w[T]=tm(I),delete w[R];return}const c=k?Jk(R):String(R).trim();c!==R&&delete w[R],w[c]=tm(I),P[c]=!0}),this}concat(...k){return this.constructor.concat(this,...k)}toJSON(k){const w=Object.create(null);return Xe.forEach(this,(P,I)=>{P!=null&&P!==!1&&(w[I]=k&&Xe.isArray(P)?P.join(", "):P)}),w}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([k,w])=>k+": "+w).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(k){return k instanceof this?k:new this(k)}static concat(k,...w){const P=new this(k);return w.forEach(I=>P.set(I)),P}static accessor(k){const P=(this[ey]=this[ey]={accessors:{}}).accessors,I=this.prototype;function R(T){const c=Lp(T);P[c]||(Qk(I,T),P[c]=!0)}return Xe.isArray(k)?k.forEach(R):R(k),this}};ci.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Xe.reduceDescriptors(ci.prototype,({value:b},k)=>{let w=k[0].toUpperCase()+k.slice(1);return{get:()=>b,set(P){this[w]=P}}});Xe.freezeMethods(ci);function k0(b,k){const w=this||ef,P=k||w,I=ci.from(P.headers);let R=P.data;return Xe.forEach(b,function(c){R=c.call(w,R,I.normalize(),k?k.status:void 0)}),I.normalize(),R}function __(b){return!!(b&&b.__CANCEL__)}function sp(b,k,w){_r.call(this,b??"canceled",_r.ERR_CANCELED,k,w),this.name="CanceledError"}Xe.inherits(sp,_r,{__CANCEL__:!0});function b_(b,k,w){const P=w.config.validateStatus;!w.status||!P||P(w.status)?b(w):k(new _r("Request failed with status code "+w.status,[_r.ERR_BAD_REQUEST,_r.ERR_BAD_RESPONSE][Math.floor(w.status/100)-4],w.config,w.request,w))}function ej(b){const k=/^([-+\w]{1,25})(:?\/\/|:)/.exec(b);return k&&k[1]||""}function tj(b,k){b=b||10;const w=new Array(b),P=new Array(b);let I=0,R=0,T;return k=k!==void 0?k:1e3,function(V){const W=Date.now(),se=P[R];T||(T=W),w[I]=V,P[I]=W;let ee=R,ne=0;for(;ee!==I;)ne+=w[ee++],ee=ee%b;if(I=(I+1)%b,I===R&&(R=(R+1)%b),W-T<k)return;const ke=se&&W-se;return ke?Math.round(ne*1e3/ke):void 0}}function rj(b,k){let w=0,P=1e3/k,I,R;const T=(W,se=Date.now())=>{w=se,I=null,R&&(clearTimeout(R),R=null),b(...W)};return[(...W)=>{const se=Date.now(),ee=se-w;ee>=P?T(W,se):(I=W,R||(R=setTimeout(()=>{R=null,T(I)},P-ee)))},()=>I&&T(I)]}const um=(b,k,w=3)=>{let P=0;const I=tj(50,250);return rj(R=>{const T=R.loaded,c=R.lengthComputable?R.total:void 0,V=T-P,W=I(V),se=T<=c;P=T;const ee={loaded:T,total:c,progress:c?T/c:void 0,bytes:V,rate:W||void 0,estimated:W&&c&&se?(c-T)/W:void 0,event:R,lengthComputable:c!=null,[k?"download":"upload"]:!0};b(ee)},w)},ty=(b,k)=>{const w=b!=null;return[P=>k[0]({lengthComputable:w,total:b,loaded:P}),k[1]]},ry=b=>(...k)=>Xe.asap(()=>b(...k)),sj=ya.hasStandardBrowserEnv?((b,k)=>w=>(w=new URL(w,ya.origin),b.protocol===w.protocol&&b.host===w.host&&(k||b.port===w.port)))(new URL(ya.origin),ya.navigator&&/(msie|trident)/i.test(ya.navigator.userAgent)):()=>!0,nj=ya.hasStandardBrowserEnv?{write(b,k,w,P,I,R,T){if(typeof document>"u")return;const c=[`${b}=${encodeURIComponent(k)}`];Xe.isNumber(w)&&c.push(`expires=${new Date(w).toUTCString()}`),Xe.isString(P)&&c.push(`path=${P}`),Xe.isString(I)&&c.push(`domain=${I}`),R===!0&&c.push("secure"),Xe.isString(T)&&c.push(`SameSite=${T}`),document.cookie=c.join("; ")},read(b){if(typeof document>"u")return null;const k=document.cookie.match(new RegExp("(?:^|; )"+b+"=([^;]*)"));return k?decodeURIComponent(k[1]):null},remove(b){this.write(b,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function aj(b){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(b)}function ij(b,k){return k?b.replace(/\/?\/$/,"")+"/"+k.replace(/^\/+/,""):b}function v_(b,k,w){let P=!aj(k);return b&&(P||w==!1)?ij(b,k):k}const sy=b=>b instanceof ci?{...b}:b;function ih(b,k){k=k||{};const w={};function P(W,se,ee,ne){return Xe.isPlainObject(W)&&Xe.isPlainObject(se)?Xe.merge.call({caseless:ne},W,se):Xe.isPlainObject(se)?Xe.merge({},se):Xe.isArray(se)?se.slice():se}function I(W,se,ee,ne){if(Xe.isUndefined(se)){if(!Xe.isUndefined(W))return P(void 0,W,ee,ne)}else return P(W,se,ee,ne)}function R(W,se){if(!Xe.isUndefined(se))return P(void 0,se)}function T(W,se){if(Xe.isUndefined(se)){if(!Xe.isUndefined(W))return P(void 0,W)}else return P(void 0,se)}function c(W,se,ee){if(ee in k)return P(W,se);if(ee in b)return P(void 0,W)}const V={url:R,method:R,data:R,baseURL:T,transformRequest:T,transformResponse:T,paramsSerializer:T,timeout:T,timeoutMessage:T,withCredentials:T,withXSRFToken:T,adapter:T,responseType:T,xsrfCookieName:T,xsrfHeaderName:T,onUploadProgress:T,onDownloadProgress:T,decompress:T,maxContentLength:T,maxBodyLength:T,beforeRedirect:T,transport:T,httpAgent:T,httpsAgent:T,cancelToken:T,socketPath:T,responseEncoding:T,validateStatus:c,headers:(W,se,ee)=>I(sy(W),sy(se),ee,!0)};return Xe.forEach(Object.keys({...b,...k}),function(se){const ee=V[se]||I,ne=ee(b[se],k[se],se);Xe.isUndefined(ne)&&ee!==c||(w[se]=ne)}),w}const w_=b=>{const k=ih({},b);let{data:w,withXSRFToken:P,xsrfHeaderName:I,xsrfCookieName:R,headers:T,auth:c}=k;if(k.headers=T=ci.from(T),k.url=g_(v_(k.baseURL,k.url,k.allowAbsoluteUrls),b.params,b.paramsSerializer),c&&T.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),Xe.isFormData(w)){if(ya.hasStandardBrowserEnv||ya.hasStandardBrowserWebWorkerEnv)T.setContentType(void 0);else if(Xe.isFunction(w.getHeaders)){const V=w.getHeaders(),W=["content-type","content-length"];Object.entries(V).forEach(([se,ee])=>{W.includes(se.toLowerCase())&&T.set(se,ee)})}}if(ya.hasStandardBrowserEnv&&(P&&Xe.isFunction(P)&&(P=P(k)),P||P!==!1&&sj(k.url))){const V=I&&R&&nj.read(R);V&&T.set(I,V)}return k},oj=typeof XMLHttpRequest<"u",lj=oj&&function(b){return new Promise(function(w,P){const I=w_(b);let R=I.data;const T=ci.from(I.headers).normalize();let{responseType:c,onUploadProgress:V,onDownloadProgress:W}=I,se,ee,ne,ke,je;function re(){ke&&ke(),je&&je(),I.cancelToken&&I.cancelToken.unsubscribe(se),I.signal&&I.signal.removeEventListener("abort",se)}let H=new XMLHttpRequest;H.open(I.method.toUpperCase(),I.url,!0),H.timeout=I.timeout;function Ze(){if(!H)return;const ze=ci.from("getAllResponseHeaders"in H&&H.getAllResponseHeaders()),Nt={data:!c||c==="text"||c==="json"?H.responseText:H.response,status:H.status,statusText:H.statusText,headers:ze,config:b,request:H};b_(function(Ft){w(Ft),re()},function(Ft){P(Ft),re()},Nt),H=null}"onloadend"in H?H.onloadend=Ze:H.onreadystatechange=function(){!H||H.readyState!==4||H.status===0&&!(H.responseURL&&H.responseURL.indexOf("file:")===0)||setTimeout(Ze)},H.onabort=function(){H&&(P(new _r("Request aborted",_r.ECONNABORTED,b,H)),H=null)},H.onerror=function(lt){const Nt=lt&&lt.message?lt.message:"Network Error",zt=new _r(Nt,_r.ERR_NETWORK,b,H);zt.event=lt||null,P(zt),H=null},H.ontimeout=function(){let lt=I.timeout?"timeout of "+I.timeout+"ms exceeded":"timeout exceeded";const Nt=I.transitional||x_;I.timeoutErrorMessage&&(lt=I.timeoutErrorMessage),P(new _r(lt,Nt.clarifyTimeoutError?_r.ETIMEDOUT:_r.ECONNABORTED,b,H)),H=null},R===void 0&&T.setContentType(null),"setRequestHeader"in H&&Xe.forEach(T.toJSON(),function(lt,Nt){H.setRequestHeader(Nt,lt)}),Xe.isUndefined(I.withCredentials)||(H.withCredentials=!!I.withCredentials),c&&c!=="json"&&(H.responseType=I.responseType),W&&([ne,je]=um(W,!0),H.addEventListener("progress",ne)),V&&H.upload&&([ee,ke]=um(V),H.upload.addEventListener("progress",ee),H.upload.addEventListener("loadend",ke)),(I.cancelToken||I.signal)&&(se=ze=>{H&&(P(!ze||ze.type?new sp(null,b,H):ze),H.abort(),H=null)},I.cancelToken&&I.cancelToken.subscribe(se),I.signal&&(I.signal.aborted?se():I.signal.addEventListener("abort",se)));const Pe=ej(I.url);if(Pe&&ya.protocols.indexOf(Pe)===-1){P(new _r("Unsupported protocol "+Pe+":",_r.ERR_BAD_REQUEST,b));return}H.send(R||null)})},cj=(b,k)=>{const{length:w}=b=b?b.filter(Boolean):[];if(k||w){let P=new AbortController,I;const R=function(W){if(!I){I=!0,c();const se=W instanceof Error?W:this.reason;P.abort(se instanceof _r?se:new sp(se instanceof Error?se.message:se))}};let T=k&&setTimeout(()=>{T=null,R(new _r(`timeout ${k} of ms exceeded`,_r.ETIMEDOUT))},k);const c=()=>{b&&(T&&clearTimeout(T),T=null,b.forEach(W=>{W.unsubscribe?W.unsubscribe(R):W.removeEventListener("abort",R)}),b=null)};b.forEach(W=>W.addEventListener("abort",R));const{signal:V}=P;return V.unsubscribe=()=>Xe.asap(c),V}},uj=function*(b,k){let w=b.byteLength;if(w<k){yield b;return}let P=0,I;for(;P<w;)I=P+k,yield b.slice(P,I),P=I},dj=async function*(b,k){for await(const w of hj(b))yield*uj(w,k)},hj=async function*(b){if(b[Symbol.asyncIterator]){yield*b;return}const k=b.getReader();try{for(;;){const{done:w,value:P}=await k.read();if(w)break;yield P}}finally{await k.cancel()}},ny=(b,k,w,P)=>{const I=dj(b,k);let R=0,T,c=V=>{T||(T=!0,P&&P(V))};return new ReadableStream({async pull(V){try{const{done:W,value:se}=await I.next();if(W){c(),V.close();return}let ee=se.byteLength;if(w){let ne=R+=ee;w(ne)}V.enqueue(new Uint8Array(se))}catch(W){throw c(W),W}},cancel(V){return c(V),I.return()}},{highWaterMark:2})},ay=64*1024,{isFunction:Zf}=Xe,pj=(({Request:b,Response:k})=>({Request:b,Response:k}))(Xe.global),{ReadableStream:iy,TextEncoder:oy}=Xe.global,ly=(b,...k)=>{try{return!!b(...k)}catch{return!1}},fj=b=>{b=Xe.merge.call({skipUndefined:!0},pj,b);const{fetch:k,Request:w,Response:P}=b,I=k?Zf(k):typeof fetch=="function",R=Zf(w),T=Zf(P);if(!I)return!1;const c=I&&Zf(iy),V=I&&(typeof oy=="function"?(je=>re=>je.encode(re))(new oy):async je=>new Uint8Array(await new w(je).arrayBuffer())),W=R&&c&&ly(()=>{let je=!1;const re=new w(ya.origin,{body:new iy,method:"POST",get duplex(){return je=!0,"half"}}).headers.has("Content-Type");return je&&!re}),se=T&&c&&ly(()=>Xe.isReadableStream(new P("").body)),ee={stream:se&&(je=>je.body)};I&&["text","arrayBuffer","blob","formData","stream"].forEach(je=>{!ee[je]&&(ee[je]=(re,H)=>{let Ze=re&&re[je];if(Ze)return Ze.call(re);throw new _r(`Response type '${je}' is not supported`,_r.ERR_NOT_SUPPORT,H)})});const ne=async je=>{if(je==null)return 0;if(Xe.isBlob(je))return je.size;if(Xe.isSpecCompliantForm(je))return(await new w(ya.origin,{method:"POST",body:je}).arrayBuffer()).byteLength;if(Xe.isArrayBufferView(je)||Xe.isArrayBuffer(je))return je.byteLength;if(Xe.isURLSearchParams(je)&&(je=je+""),Xe.isString(je))return(await V(je)).byteLength},ke=async(je,re)=>{const H=Xe.toFiniteNumber(je.getContentLength());return H??ne(re)};return async je=>{let{url:re,method:H,data:Ze,signal:Pe,cancelToken:ze,timeout:lt,onDownloadProgress:Nt,onUploadProgress:zt,responseType:Ft,headers:Vt,withCredentials:Zt="same-origin",fetchOptions:mt}=w_(je),fr=k||fetch;Ft=Ft?(Ft+"").toLowerCase():"text";let Kt=cj([Pe,ze&&ze.toAbortSignal()],lt),Wt=null;const Me=Kt&&Kt.unsubscribe&&(()=>{Kt.unsubscribe()});let Ct;try{if(zt&&W&&H!=="get"&&H!=="head"&&(Ct=await ke(Vt,Ze))!==0){let Ce=new w(re,{method:"POST",body:Ze,duplex:"half"}),Ye;if(Xe.isFormData(Ze)&&(Ye=Ce.headers.get("content-type"))&&Vt.setContentType(Ye),Ce.body){const[qt,Yt]=ty(Ct,um(ry(zt)));Ze=ny(Ce.body,ay,qt,Yt)}}Xe.isString(Zt)||(Zt=Zt?"include":"omit");const it=R&&"credentials"in w.prototype,Tt={...mt,signal:Kt,method:H.toUpperCase(),headers:Vt.normalize().toJSON(),body:Ze,duplex:"half",credentials:it?Zt:void 0};Wt=R&&new w(re,Tt);let nt=await(R?fr(Wt,mt):fr(re,Tt));const ht=se&&(Ft==="stream"||Ft==="response");if(se&&(Nt||ht&&Me)){const Ce={};["status","statusText","headers"].forEach(wt=>{Ce[wt]=nt[wt]});const Ye=Xe.toFiniteNumber(nt.headers.get("content-length")),[qt,Yt]=Nt&&ty(Ye,um(ry(Nt),!0))||[];nt=new P(ny(nt.body,ay,qt,()=>{Yt&&Yt(),Me&&Me()}),Ce)}Ft=Ft||"text";let pt=await ee[Xe.findKey(ee,Ft)||"text"](nt,je);return!ht&&Me&&Me(),await new Promise((Ce,Ye)=>{b_(Ce,Ye,{data:pt,headers:ci.from(nt.headers),status:nt.status,statusText:nt.statusText,config:je,request:Wt})})}catch(it){throw Me&&Me(),it&&it.name==="TypeError"&&/Load failed|fetch/i.test(it.message)?Object.assign(new _r("Network Error",_r.ERR_NETWORK,je,Wt),{cause:it.cause||it}):_r.from(it,it&&it.code,je,Wt)}}},mj=new Map,k_=b=>{let k=b&&b.env||{};const{fetch:w,Request:P,Response:I}=k,R=[P,I,w];let T=R.length,c=T,V,W,se=mj;for(;c--;)V=R[c],W=se.get(V),W===void 0&&se.set(V,W=c?new Map:fj(k)),se=W;return W};k_();const ng={http:Ik,xhr:lj,fetch:{get:k_}};Xe.forEach(ng,(b,k)=>{if(b){try{Object.defineProperty(b,"name",{value:k})}catch{}Object.defineProperty(b,"adapterName",{value:k})}});const cy=b=>`- ${b}`,gj=b=>Xe.isFunction(b)||b===null||b===!1;function xj(b,k){b=Xe.isArray(b)?b:[b];const{length:w}=b;let P,I;const R={};for(let T=0;T<w;T++){P=b[T];let c;if(I=P,!gj(P)&&(I=ng[(c=String(P)).toLowerCase()],I===void 0))throw new _r(`Unknown adapter '${c}'`);if(I&&(Xe.isFunction(I)||(I=I.get(k))))break;R[c||"#"+T]=I}if(!I){const T=Object.entries(R).map(([V,W])=>`adapter ${V} `+(W===!1?"is not supported by the environment":"is not available in the build"));let c=w?T.length>1?`since :
`+T.map(cy).join(`
`):" "+cy(T[0]):"as no adapter specified";throw new _r("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return I}const j_={getAdapter:xj,adapters:ng};function j0(b){if(b.cancelToken&&b.cancelToken.throwIfRequested(),b.signal&&b.signal.aborted)throw new sp(null,b)}function uy(b){return j0(b),b.headers=ci.from(b.headers),b.data=k0.call(b,b.transformRequest),["post","put","patch"].indexOf(b.method)!==-1&&b.headers.setContentType("application/x-www-form-urlencoded",!1),j_.getAdapter(b.adapter||ef.adapter,b)(b).then(function(P){return j0(b),P.data=k0.call(b,b.transformResponse,P),P.headers=ci.from(P.headers),P},function(P){return __(P)||(j0(b),P&&P.response&&(P.response.data=k0.call(b,b.transformResponse,P.response),P.response.headers=ci.from(P.response.headers))),Promise.reject(P)})}const S_="1.13.2",vm={};["object","boolean","number","function","string","symbol"].forEach((b,k)=>{vm[b]=function(P){return typeof P===b||"a"+(k<1?"n ":" ")+b}});const dy={};vm.transitional=function(k,w,P){function I(R,T){return"[Axios v"+S_+"] Transitional option '"+R+"'"+T+(P?". "+P:"")}return(R,T,c)=>{if(k===!1)throw new _r(I(T," has been removed"+(w?" in "+w:"")),_r.ERR_DEPRECATED);return w&&!dy[T]&&(dy[T]=!0,console.warn(I(T," has been deprecated since v"+w+" and will be removed in the near future"))),k?k(R,T,c):!0}};vm.spelling=function(k){return(w,P)=>(console.warn(`${P} is likely a misspelling of ${k}`),!0)};function yj(b,k,w){if(typeof b!="object")throw new _r("options must be an object",_r.ERR_BAD_OPTION_VALUE);const P=Object.keys(b);let I=P.length;for(;I-- >0;){const R=P[I],T=k[R];if(T){const c=b[R],V=c===void 0||T(c,R,b);if(V!==!0)throw new _r("option "+R+" must be "+V,_r.ERR_BAD_OPTION_VALUE);continue}if(w!==!0)throw new _r("Unknown option "+R,_r.ERR_BAD_OPTION)}}const rm={assertOptions:yj,validators:vm},Ql=rm.validators;let nh=class{constructor(k){this.defaults=k||{},this.interceptors={request:new Qx,response:new Qx}}async request(k,w){try{return await this._request(k,w)}catch(P){if(P instanceof Error){let I={};Error.captureStackTrace?Error.captureStackTrace(I):I=new Error;const R=I.stack?I.stack.replace(/^.+\n/,""):"";try{P.stack?R&&!String(P.stack).endsWith(R.replace(/^.+\n.+\n/,""))&&(P.stack+=`
`+R):P.stack=R}catch{}}throw P}}_request(k,w){typeof k=="string"?(w=w||{},w.url=k):w=k||{},w=ih(this.defaults,w);const{transitional:P,paramsSerializer:I,headers:R}=w;P!==void 0&&rm.assertOptions(P,{silentJSONParsing:Ql.transitional(Ql.boolean),forcedJSONParsing:Ql.transitional(Ql.boolean),clarifyTimeoutError:Ql.transitional(Ql.boolean)},!1),I!=null&&(Xe.isFunction(I)?w.paramsSerializer={serialize:I}:rm.assertOptions(I,{encode:Ql.function,serialize:Ql.function},!0)),w.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?w.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:w.allowAbsoluteUrls=!0),rm.assertOptions(w,{baseUrl:Ql.spelling("baseURL"),withXsrfToken:Ql.spelling("withXSRFToken")},!0),w.method=(w.method||this.defaults.method||"get").toLowerCase();let T=R&&Xe.merge(R.common,R[w.method]);R&&Xe.forEach(["delete","get","head","post","put","patch","common"],je=>{delete R[je]}),w.headers=ci.concat(T,R);const c=[];let V=!0;this.interceptors.request.forEach(function(re){typeof re.runWhen=="function"&&re.runWhen(w)===!1||(V=V&&re.synchronous,c.unshift(re.fulfilled,re.rejected))});const W=[];this.interceptors.response.forEach(function(re){W.push(re.fulfilled,re.rejected)});let se,ee=0,ne;if(!V){const je=[uy.bind(this),void 0];for(je.unshift(...c),je.push(...W),ne=je.length,se=Promise.resolve(w);ee<ne;)se=se.then(je[ee++],je[ee++]);return se}ne=c.length;let ke=w;for(;ee<ne;){const je=c[ee++],re=c[ee++];try{ke=je(ke)}catch(H){re.call(this,H);break}}try{se=uy.call(this,ke)}catch(je){return Promise.reject(je)}for(ee=0,ne=W.length;ee<ne;)se=se.then(W[ee++],W[ee++]);return se}getUri(k){k=ih(this.defaults,k);const w=v_(k.baseURL,k.url,k.allowAbsoluteUrls);return g_(w,k.params,k.paramsSerializer)}};Xe.forEach(["delete","get","head","options"],function(k){nh.prototype[k]=function(w,P){return this.request(ih(P||{},{method:k,url:w,data:(P||{}).data}))}});Xe.forEach(["post","put","patch"],function(k){function w(P){return function(R,T,c){return this.request(ih(c||{},{method:k,headers:P?{"Content-Type":"multipart/form-data"}:{},url:R,data:T}))}}nh.prototype[k]=w(),nh.prototype[k+"Form"]=w(!0)});let _j=class T_{constructor(k){if(typeof k!="function")throw new TypeError("executor must be a function.");let w;this.promise=new Promise(function(R){w=R});const P=this;this.promise.then(I=>{if(!P._listeners)return;let R=P._listeners.length;for(;R-- >0;)P._listeners[R](I);P._listeners=null}),this.promise.then=I=>{let R;const T=new Promise(c=>{P.subscribe(c),R=c}).then(I);return T.cancel=function(){P.unsubscribe(R)},T},k(function(R,T,c){P.reason||(P.reason=new sp(R,T,c),w(P.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(k){if(this.reason){k(this.reason);return}this._listeners?this._listeners.push(k):this._listeners=[k]}unsubscribe(k){if(!this._listeners)return;const w=this._listeners.indexOf(k);w!==-1&&this._listeners.splice(w,1)}toAbortSignal(){const k=new AbortController,w=P=>{k.abort(P)};return this.subscribe(w),k.signal.unsubscribe=()=>this.unsubscribe(w),k.signal}static source(){let k;return{token:new T_(function(I){k=I}),cancel:k}}};function bj(b){return function(w){return b.apply(null,w)}}function vj(b){return Xe.isObject(b)&&b.isAxiosError===!0}const $0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries($0).forEach(([b,k])=>{$0[k]=b});function N_(b){const k=new nh(b),w=n_(nh.prototype.request,k);return Xe.extend(w,nh.prototype,k,{allOwnKeys:!0}),Xe.extend(w,k,null,{allOwnKeys:!0}),w.create=function(I){return N_(ih(b,I))},w}const an=N_(ef);an.Axios=nh;an.CanceledError=sp;an.CancelToken=_j;an.isCancel=__;an.VERSION=S_;an.toFormData=bm;an.AxiosError=_r;an.Cancel=an.CanceledError;an.all=function(k){return Promise.all(k)};an.spread=bj;an.isAxiosError=vj;an.mergeConfig=ih;an.AxiosHeaders=ci;an.formToJSON=b=>y_(Xe.isHTMLForm(b)?new FormData(b):b);an.getAdapter=j_.getAdapter;an.HttpStatusCode=$0;an.default=an;const{Axios:FS,AxiosError:OS,CanceledError:BS,isCancel:VS,CancelToken:$S,VERSION:US,all:qS,Cancel:GS,isAxiosError:ZS,spread:HS,toFormData:WS,AxiosHeaders:XS,HttpStatusCode:YS,formToJSON:KS,getAdapter:JS,mergeConfig:QS}=an,E_="https://darayyaconnect.com/api",Lt=an.create({baseURL:E_,headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:1e4});Lt.interceptors.request.use(b=>{const k=localStorage.getItem("token");return k&&(b.headers.Authorization=`Bearer ${k}`),console.log(` API Request: ${b.method?.toUpperCase()} ${b.baseURL}${b.url}`),b},b=>(console.error(" Request Error:",b),Promise.reject(b)));Lt.interceptors.response.use(b=>(console.log(` API Success: ${b.config.url} - Status: ${b.status}`),b),b=>(console.error(" API Error:",b),b.code==="ECONNABORTED"?console.error(" Request timeout - Server took too long"):b.code==="ERR_NETWORK"||b.message==="Network Error"?(console.error(" Network Error - Cannot reach server"),console.error(`Trying to connect to: ${E_}`)):b.response?(console.error(` Response error: ${b.response.status}`,b.response.data),b.response.status===404&&console.error(" Endpoint not found:",b.config.url)):b.request&&(console.error(" No response received from server"),console.error("Request was sent but no response:",b.request)),Promise.reject(b)));const S0=lh("Preferences",{web:()=>Zp(()=>import("./web-w-eLAb8p.js"),[],import.meta.url).then(b=>new b.PreferencesWeb)}),T0="offline_reports",ag={async saveReport(b){const w={...b,id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(I){var R=Math.random()*16|0,T=I=="x"?R:R&3|8;return T.toString(16)}),timestamp:Date.now()},P=await this.getReports();return P.push(w),await this.saveReportsList(P),w},async getReports(){const{value:b}=await S0.get({key:T0});return b?JSON.parse(b):[]},async removeReport(b){const w=(await this.getReports()).filter(P=>P.id!==b);await this.saveReportsList(w)},async clearReports(){await S0.remove({key:T0})},async saveReportsList(b){await S0.set({key:T0,value:JSON.stringify(b)})},async getPendingCount(){return(await this.getReports()).length},async syncReports(){if(!navigator.onLine)return 0;const b=await this.getReports();if(b.length===0)return 0;let k=0;for(const w of b)try{const P=new FormData;if(P.append("title",w.title||"  "),P.append("description",w.description),P.append("type",w.type),w.latitude&&P.append("latitude",w.latitude.toString()),w.longitude&&P.append("longitude",w.longitude.toString()),w.infrastructure_node_id&&P.append("infrastructure_node_id",w.infrastructure_node_id.toString()),w.infrastructure_line_id&&P.append("infrastructure_line_id",w.infrastructure_line_id.toString()),w.image&&w.image.startsWith("data:")){const R=await(await fetch(w.image)).blob();P.append("image",R,"offline_image.jpg")}await Lt.post("/infrastructure/reports",P,{headers:{"Content-Type":"multipart/form-data"}}),await this.removeReport(w.id),k++}catch(P){console.error("Failed to sync report",w.id,P)}return k}},wj=Object.freeze(Object.defineProperty({__proto__:null,OfflineService:ag},Symbol.toStringTag,{value:"Module"}));function C_(){const[b,k]=K.useState(navigator.onLine),[w,P]=K.useState(0);return K.useEffect(()=>{const I=()=>k(!0),R=()=>k(!1);window.addEventListener("online",I),window.addEventListener("offline",R);const T=setInterval(async()=>{const c=await ag.getPendingCount();P(c)},5e3);return()=>{window.removeEventListener("online",I),window.removeEventListener("offline",R),clearInterval(T)}},[]),b&&w===0?null:b?i.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[9999] bg-blue-600 text-white py-3 px-4 flex items-center justify-center gap-3 shadow-lg animate-slide-down",dir:"rtl",children:[i.jsx("span",{className:"text-xl",children:""}),i.jsxs("div",{className:"flex-1 text-center",children:[i.jsx("p",{className:"font-bold text-sm",children:"  ..."}),i.jsxs("p",{className:"text-xs opacity-90",children:[" ",w,"   "]})]})]}):i.jsxs("div",{className:"fixed top-0 left-0 right-0 z-[9999] bg-red-500 text-white py-3 px-4 flex items-center justify-center gap-3 shadow-lg animate-slide-down",dir:"rtl",children:[i.jsx("span",{className:"text-xl",children:""}),i.jsxs("div",{className:"flex-1 text-center",children:[i.jsx("p",{className:"font-bold text-sm",children:"   "}),i.jsx("p",{className:"text-xs opacity-90",children:"    "})]})]})}function hi(b){const[k,w]=K.useState(!1),P=K.useRef(0),I=K.useRef(0),R=K.useRef(null),T=K.useRef(null),c=80,V=ne=>{if(R.current&&(R.current.style.transform=`translateY(${ne}px)`,R.current.style.transition="none"),T.current){T.current.style.opacity=ne>20?"1":"0";const ke=T.current.querySelector(".pull-icon");ke&&(ke.style.transform=`rotate(${Math.min(ne*2,180)}deg)`)}};return{isRefreshing:k,containerRef:R,indicatorRef:T,handlers:{onTouchStart:ne=>{window.scrollY===0&&(P.current=ne.touches[0].clientY)},onTouchMove:ne=>{if(P.current===0)return;const je=ne.touches[0].clientY-P.current;if(je>0&&window.scrollY===0){const re=Math.min(je*.4,100);I.current=re,V(re),ne.cancelable&&ne.preventDefault()}},onTouchEnd:async()=>{if(P.current===0)return;if(I.current>c){w(!0),R.current&&(R.current.style.transition="transform 0.3s cubic-bezier(0.2, 0, 0, 1)",R.current.style.transform="translateY(60px)");try{await b()}finally{R.current&&(R.current.style.transition="transform 0.4s cubic-bezier(0.2, 0, 0, 1)",R.current.style.transform="translateY(0px)"),setTimeout(()=>{w(!1),I.current=0,P.current=0},400)}}else R.current&&(R.current.style.transition="transform 0.3s cubic-bezier(0.2, 0, 0, 1)",R.current.style.transform="translateY(0px)"),I.current=0,P.current=0}}}}function pi({children:b,isRefreshing:k,containerRef:w,indicatorRef:P}){return i.jsxs("div",{ref:w,className:"will-change-transform",children:[i.jsx("div",{ref:P,className:"absolute top-0 left-0 right-0 flex justify-center -mt-12 pointer-events-none transition-opacity duration-200",style:{opacity:0},children:i.jsx("div",{className:"w-10 h-10 rounded-full bg-white dark:bg-slate-800 shadow-premium flex items-center justify-center text-emerald-600 dark:text-emerald-400 border border-slate-100 dark:border-slate-700",children:i.jsx("div",{className:`pull-icon text-xl ${k?"animate-spin":"transition-transform"}`,children:k?"":""})})}),b]})}const P_=K.createContext(void 0);function kj({children:b}){const[k,w]=K.useState(()=>{const I=localStorage.getItem("theme");return I==="dark"||I==="light"?I:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"});K.useEffect(()=>{const I=window.document.documentElement;I.classList.remove("light","dark"),I.classList.add(k),localStorage.setItem("theme",k);const R=document.querySelector('meta[name="theme-color"]');R&&R.setAttribute("content",k==="dark"?"#0f172a":"#ffffff")},[k]);const P=()=>{w(I=>I==="light"?"dark":"light")};return i.jsx(P_.Provider,{value:{theme:k,toggleTheme:P},children:b})}function ig(){const b=K.useContext(P_);if(b===void 0)throw new Error("useTheme must be used within a ThemeProvider");return b}var $p;(function(b){b.Heavy="HEAVY",b.Medium="MEDIUM",b.Light="LIGHT"})($p||($p={}));var dm;(function(b){b.Success="SUCCESS",b.Warning="WARNING",b.Error="ERROR"})(dm||(dm={}));const Fp=lh("Haptics",{web:()=>Zp(()=>import("./web-CtT1uFCx.js"),[],import.meta.url).then(b=>new b.HapticsWeb)}),sm={async lightImpact(){try{await Fp.impact({style:$p.Light})}catch{}},async mediumImpact(){try{await Fp.impact({style:$p.Medium})}catch{}},async heavyImpact(){try{await Fp.impact({style:$p.Heavy})}catch{}},async notificationSuccess(){try{await Fp.notification({type:dm.Success})}catch{}},async notificationError(){try{await Fp.notification({type:dm.Error})}catch{}}};function jj({isOpen:b,onClose:k}){const[w,P]=K.useState("idle"),[I,R]=K.useState("");K.useEffect(()=>{b||setTimeout(()=>P("idle"),300)},[b]);const T=async c=>{try{P("locating"),sm.heavyImpact();const V=await nd.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4});P("sending"),await Lt.post("/sos/trigger",{latitude:V.coords.latitude,longitude:V.coords.longitude,emergency_type:c,message:`SOS Triggered from mobile app. Type: ${c}`}),P("success"),sm.notificationSuccess(),setTimeout(()=>{k()},3e3)}catch(V){console.error("SOS Failed:",V),P("error"),R(V.message||"    "),sm.notificationError()}};return b?w1.createPortal(i.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-md animate-in fade-in duration-300",children:i.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-[40px] p-8 shadow-2xl relative border border-slate-100 dark:border-slate-800 animate-in zoom-in-95 duration-300",children:[i.jsx("button",{onClick:k,className:"absolute top-6 right-6 p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-500 dark:text-slate-400 z-10",children:i.jsx(ad,{size:20})}),i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-20 h-20 bg-rose-100 dark:bg-rose-900/30 rounded-3xl flex items-center justify-center text-rose-600 dark:text-rose-400 mx-auto mb-4 animate-bounce",children:i.jsx(sh,{size:40,strokeWidth:2.5})}),i.jsx("h3",{className:"text-2xl font-black text-slate-900 dark:text-white mb-2",children:"  (SOS)"}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm font-medium",children:"        "})]}),w==="idle"?i.jsx("div",{className:"grid grid-cols-1 gap-3",children:[{id:"general",label:" ",icon:"",color:"bg-rose-600"},{id:"medical",label:" ",icon:"",color:"bg-emerald-600"},{id:"fire",label:"",icon:"",color:"bg-orange-600"},{id:"security",label:" / ",icon:"",color:"bg-blue-600"}].map(c=>i.jsxs("button",{onClick:()=>T(c.id),className:`flex items-center gap-4 p-4 rounded-2xl ${c.color} text-white font-bold active:scale-95 transition-all shadow-lg`,children:[i.jsx("span",{className:"text-2xl",children:c.icon}),i.jsx("span",{className:"flex-1 text-right",children:c.label})]},c.id))}):i.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-center",children:[w==="locating"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"relative mb-6",children:[i.jsx(qn,{size:60,className:"text-emerald-500 animate-bounce"}),i.jsx("div",{className:"absolute inset-0 bg-emerald-500/20 rounded-full animate-ping"})]}),i.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:"  ..."})]}),w==="sending"&&i.jsxs(i.Fragment,{children:[i.jsx(Jy,{size:60,className:"text-rose-500 animate-spin mb-6"}),i.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:"   ..."})]}),w==="success"&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-20 h-20 bg-emerald-100 dark:bg-emerald-900/30 rounded-full flex items-center justify-center text-emerald-600 dark:text-emerald-400 mb-6",children:i.jsx(sh,{size:40})}),i.jsx("h4",{className:"text-xl font-black text-emerald-600 dark:text-emerald-400 mb-2",children:"  !"}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm mb-4",children:"        ."}),i.jsx("button",{onClick:k,className:"px-8 py-3 bg-emerald-600 text-white rounded-xl font-bold",children:""})]}),w==="error"&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-20 h-20 bg-rose-100 dark:bg-rose-900/30 rounded-full flex items-center justify-center text-rose-600 dark:text-rose-400 mb-6",children:i.jsx(ad,{size:40})}),i.jsx("h4",{className:"text-xl font-black text-rose-600 mb-2",children:" !"}),i.jsx("p",{className:"text-rose-500/80 text-sm mb-6",children:I}),i.jsx("button",{onClick:()=>P("idle"),className:"px-8 py-3 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 rounded-xl font-bold",children:" "})]})]})]})}),document.body):null}function Sj({user:b,unreadCount:k}){const w=dr(),{theme:P,toggleTheme:I}=ig(),[R,T]=K.useState(!1);return i.jsxs(i.Fragment,{children:[i.jsx(jj,{isOpen:R,onClose:()=>T(!1)}),i.jsx("header",{className:"bg-white/95 dark:bg-slate-900/95 backdrop-blur-lg border-b border-slate-200/60 dark:border-slate-800/60 sticky top-0 z-40 px-4 py-3 shadow-md transition-colors duration-300",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs(xa,{to:"/",className:"flex items-center gap-3 active:scale-95 transition-transform",children:[i.jsx("div",{className:"w-10 h-10 bg-emerald-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-premium",children:""}),i.jsxs("div",{children:[i.jsx("span",{className:"text-lg font-bold text-slate-900 dark:text-slate-100 block leading-tight",children:" "}),i.jsx("span",{className:"text-[10px] text-emerald-600 dark:text-emerald-400 font-bold bg-emerald-50 dark:bg-emerald-900/20 px-2 py-0.5 rounded-full inline-block border border-emerald-100 dark:border-emerald-800/50",children:"  beta"})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>T(!0),className:"bg-rose-600 dark:bg-rose-600 text-white flex items-center gap-2 px-3 py-2 rounded-xl shadow-lg shadow-rose-500/30 active:scale-95 transition-all text-sm font-bold border border-rose-400 group relative overflow-hidden",title:"",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:animate-shimmer"}),i.jsx(K0,{size:20,className:"animate-pulse"}),i.jsx("span",{children:" SOS"})]}),i.jsxs("button",{onClick:()=>w("/notifications"),className:"w-10 h-10 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-xl flex items-center justify-center text-slate-600 dark:text-slate-400 active:scale-95 transition-all border border-slate-200 dark:border-slate-800 relative shadow-card",children:[i.jsx(fm,{size:20}),k>0&&i.jsx("span",{className:"absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 border-2 border-white dark:border-slate-900 rounded-full animate-pulse"})]})]})]})})]})}function Tj({stats:b}){return i.jsx("div",{className:"w-full",children:i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-md border border-slate-100 dark:border-slate-700/50 flex items-center justify-between transition-all duration-200 active:scale-[0.98]",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-3xl font-black text-slate-900 dark:text-slate-100",children:b.population.toLocaleString()}),i.jsx("p",{className:"text-slate-500 dark:text-slate-500 text-xs font-bold uppercase tracking-wider mt-1",children:"  "})]}),i.jsx("div",{className:"h-14 w-14 bg-slate-50 dark:bg-slate-700 rounded-full flex items-center justify-center text-3xl",children:""})]})})}function Nj(){const b=dr();return i.jsxs("button",{onClick:()=>b("/add-report"),className:"w-full bg-white dark:bg-slate-800 rounded-[28px] border border-slate-200/60 dark:border-slate-700 p-5 shadow-premium flex gap-4 items-center hover:border-emerald-200 dark:hover:border-emerald-700 hover:bg-emerald-50/10 active:scale-[0.98] transition-all group",children:[i.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-emerald-500/30",children:i.jsx(ec,{size:24})}),i.jsxs("div",{className:"flex-1 text-right",children:[i.jsx("h4",{className:"text-sm font-bold text-slate-900 dark:text-slate-100 mb-0.5",children:"     "}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-medium",children:"     "})]}),i.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-50 dark:bg-slate-700 flex items-center justify-center text-slate-300 dark:text-slate-500 group-hover:bg-emerald-100 dark:group-hover:bg-emerald-600 group-hover:text-emerald-600 dark:group-hover:text-emerald-100 transition-colors",children:i.jsx("span",{className:"text-lg",children:""})})]})}function Ej({serviceStates:b}){return i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx("div",{className:"col-span-2",children:i.jsxs(xa,{to:"/map",className:"group relative bg-blue-600 dark:bg-blue-700 rounded-[32px] p-6 shadow-premium active:scale-[0.98] transition-all h-36 flex items-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-700 dark:to-indigo-700"}),i.jsx("div",{className:"absolute right-[-20%] bottom-[-50%] w-[200px] h-[200px] bg-white/10 rounded-full blur-3xl group-hover:scale-125 transition-transform duration-700"}),i.jsxs("div",{className:"relative z-10 flex flex-row items-center gap-5 w-full",children:[i.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center border border-white/20 shadow-inner group-hover:rotate-6 transition-transform",children:i.jsx(Jw,{size:32,className:"text-white drop-shadow-md"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-black text-white text-xl mb-1 drop-shadow-sm",children:" "}),i.jsx("p",{className:"text-blue-100/90 text-sm font-medium",children:"   "})]})]})]})}),i.jsx("div",{children:i.jsxs(xa,{to:"/directory",className:"premium-card p-5 h-full flex flex-col items-start hover:shadow-premium transition-all active:scale-95 group relative overflow-hidden",children:[i.jsx("div",{className:"w-12 h-12 bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400 rounded-2xl flex items-center justify-center mb-4 border border-amber-100 dark:border-amber-800/50 group-hover:scale-110 transition-transform",children:i.jsx(tc,{size:24})}),i.jsx("h4",{className:"font-bold text-slate-900 dark:text-slate-100 text-sm",children:" "})]})}),i.jsx("div",{children:i.jsxs(xa,{to:"/lost-found",className:"bg-indigo-600 dark:bg-indigo-700 p-5 rounded-[20px] hover:shadow-premium transition-all active:scale-95 group block h-full relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500 to-violet-600 opacity-90"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-md text-white rounded-2xl flex items-center justify-center mb-4 border border-white/20 shadow-inner group-hover:scale-110 transition-transform",children:i.jsx(ch,{size:24})}),i.jsx("h4",{className:"font-bold text-white text-sm",children:" "})]})]})}),i.jsx("div",{className:"col-span-2",children:i.jsxs(xa,{to:"/services-status",className:"premium-card p-5 hover:shadow-premium transition-all active:scale-[0.98] group flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-14 h-14 bg-rose-50 dark:bg-rose-900/20 text-rose-500 dark:text-rose-400 rounded-2xl flex items-center justify-center border border-rose-100 dark:border-rose-800/50 shadow-inner-soft group-hover:animate-pulse",children:i.jsx(ec,{size:28})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-black text-slate-800 dark:text-slate-100 text-base mb-1",children:" "}),i.jsx("div",{className:"flex gap-2 flex-wrap",children:b.length>0?b.map(k=>i.jsxs("span",{className:`text-[10px] bg-${k.status_color}-100 dark:bg-${k.status_color}-900/30 text-${k.status_color}-700 dark:text-${k.status_color}-400 px-2.5 py-1 rounded-full font-bold shadow-sm border border-${k.status_color}-200 dark:border-${k.status_color}-800/50`,children:[k.name,": ",k.status_text]},k.id)):i.jsx("span",{className:"text-[10px] text-slate-400",children:" ..."})})]})]}),i.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-50 dark:bg-slate-700 flex items-center justify-center text-slate-400 group-hover:bg-rose-100 dark:group-hover:bg-rose-900/40 group-hover:text-rose-500 transition-colors",children:i.jsx("span",{className:"text-xl rotate-180",children:""})})]})}),i.jsx("div",{children:i.jsxs(xa,{to:"/books",className:"bg-teal-600 dark:bg-teal-700 p-5 rounded-[20px] hover:shadow-premium transition-all active:scale-95 group block h-full relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-teal-500 to-emerald-600 opacity-90"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-md text-white rounded-2xl flex items-center justify-center mb-4 border border-white/20 shadow-inner group-hover:scale-110 transition-transform",children:i.jsx("span",{className:"text-2xl",children:""})}),i.jsx("h4",{className:"font-bold text-white text-sm",children:" "})]})]})}),i.jsx("div",{children:i.jsxs(xa,{to:"/events",className:"bg-orange-500 dark:bg-orange-600 p-5 rounded-[20px] hover:shadow-premium transition-all active:scale-95 group block h-full relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-400 to-red-500 opacity-90"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-md text-white rounded-2xl flex items-center justify-center mb-4 border border-white/20 shadow-inner group-hover:scale-110 transition-transform",children:i.jsx(hl,{size:24})}),i.jsx("h4",{className:"font-bold text-white text-sm",children:"  "})]})]})}),i.jsx("div",{className:"col-span-2",children:i.jsx(xa,{to:"/hashtag",className:"premium-card p-5 hover:shadow-premium transition-all active:scale-95 group relative overflow-hidden block",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-2xl flex items-center justify-center border border-blue-100 dark:border-blue-800/50 shadow-inner-soft group-hover:rotate-12 transition-transform",children:i.jsx(Jf,{size:24})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm",children:" # "}),i.jsx("p",{className:"text-[10px] text-slate-500",children:"  "})]})]})})}),i.jsx("div",{className:"col-span-2",children:i.jsxs(xa,{to:"/skills",className:"premium-card p-5 hover:shadow-premium transition-all active:scale-95 group relative overflow-hidden block",children:[i.jsx("div",{className:"absolute top-0 left-0 w-24 h-24 bg-gradient-to-br from-indigo-500/20 to-purple-500/0 rounded-full blur-2xl -ml-6 -mt-6"}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 rounded-2xl flex items-center justify-center border border-purple-100 dark:border-purple-800/50 shadow-inner-soft group-hover:scale-110 transition-transform",children:i.jsx(mo,{size:24})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm",children:"   "}),i.jsx("p",{className:"text-[10px] text-slate-500",children:"    "})]})]})]})}),i.jsx("div",{className:"col-span-2",children:i.jsxs(xa,{to:"/awareness",className:"bg-purple-600 dark:bg-purple-700 rounded-[32px] p-6 shadow-premium active:scale-[0.98] transition-all h-32 flex items-center block relative overflow-hidden group",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-600 to-fuchsia-600 dark:from-purple-700 dark:to-fuchsia-700"}),i.jsx("div",{className:"absolute -right-10 -bottom-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"}),i.jsxs("div",{className:"relative z-10 flex flex-row items-center gap-4 w-full",children:[i.jsx("div",{className:"w-14 h-14 bg-white/20 backdrop-blur-md text-white rounded-2xl flex items-center justify-center border border-white/20 shadow-inner group-hover:scale-110 transition-transform",children:i.jsx("span",{className:"text-3xl",children:""})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-black text-white text-lg mb-1 drop-shadow-sm",children:" "}),i.jsx("p",{className:"text-purple-100/90 text-xs font-medium",children:"   "})]})]})]})})]})}function Cj({activeTab:b,newsItems:k}){const w=dr();return i.jsxs("div",{className:"min-h-[200px]",children:[b==="news"&&i.jsx("div",{className:"space-y-4",children:[{title:"    ",body:"        ...",color:"bg-blue-500",icon:"",iconBg:"bg-blue-50",iconColor:"text-blue-600",time:" ",source:" "},{title:"  ",body:"   3   3    ...",color:"bg-amber-500",icon:"",iconBg:"bg-amber-50",iconColor:"text-amber-600",time:"",source:""}].map((P,I)=>i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-5 border border-slate-200/60 dark:border-slate-700/50 shadow-sm relative overflow-hidden group active:scale-[0.99] transition-transform [contain:layout_style]",children:[i.jsx("div",{className:`absolute top-0 right-0 w-1.5 h-full ${P.color}`}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx("div",{className:`w-11 h-11 ${P.iconBg} dark:bg-slate-900 rounded-xl flex items-center justify-center ${P.iconColor} font-bold text-sm shrink-0 border border-slate-100 dark:border-slate-800 shadow-inner-soft`,children:P.icon}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("span",{className:"text-xs font-bold text-slate-900 dark:text-slate-100",children:P.source}),i.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:[" ",P.time]})]}),i.jsx("h3",{className:"font-bold text-slate-900 dark:text-slate-100 mb-2 leading-tight",children:P.title}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-relaxed line-clamp-2",children:P.body})]})]})]},I))}),b==="community"&&i.jsxs("div",{className:"text-center py-10 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-3xl border border-dashed border-slate-300 dark:border-slate-700 shadow-inner-soft",children:[i.jsx("div",{className:"w-16 h-16 bg-emerald-50 dark:bg-emerald-900/20 rounded-2xl flex items-center justify-center mx-auto mb-4 text-emerald-600 dark:text-emerald-400 shadow-md",children:i.jsx(mm,{size:32})}),i.jsx("h3",{className:"font-bold text-slate-900 dark:text-slate-100 mb-1",children:" "}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-6",children:"   "}),i.jsx("button",{onClick:()=>w("/discussions"),className:"px-8 py-3 bg-emerald-600 text-white rounded-xl text-xs font-bold shadow-premium active:scale-95 transition-transform hover:bg-emerald-700",children:" "})]}),b==="polls"&&i.jsx("div",{className:"text-center py-10 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-3xl border border-dashed border-slate-300 dark:border-slate-700 shadow-inner-soft",children:i.jsx("p",{className:"text-sm text-slate-500",children:"     "})})]})}function Pj(){const[b,k]=K.useState(null),[w,P]=K.useState("news"),[I,R]=K.useState({population:78e3,activeUsers:0,reports:0}),[T,c]=K.useState([]),[V,W]=K.useState([]),[se,ee]=K.useState([]),[ne,ke]=K.useState(0),[je,re]=K.useState(!1),H=K.useCallback(async()=>{try{const[zt,Ft,Vt,Zt,mt]=await Promise.all([Lt.get("/dashboard/stats"),Lt.get("/dashboard/news"),Lt.get("/dashboard/discussions"),Lt.get("/service-states").catch(()=>({data:[]})),Lt.get("/notifications/unread-count").catch(()=>({data:{count:0}}))]);R(zt.data),c(Ft.data),W(Vt.data),ee(Zt.data||[]),ke(mt.data.count||0)}catch(zt){console.error("Failed to fetch dashboard data:",zt)}},[]),Ze=K.useCallback(async()=>{re(!0),await H(),re(!1)},[H]),{isRefreshing:Pe,containerRef:ze,indicatorRef:lt,handlers:Nt}=hi(Ze);return K.useEffect(()=>{const zt=localStorage.getItem("user");zt&&k(JSON.parse(zt)),H()},[H]),i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 relative transition-colors duration-300 overflow-x-hidden",dir:"rtl",...Nt,children:i.jsxs(pi,{isRefreshing:Pe,containerRef:ze,indicatorRef:lt,children:[i.jsx(C_,{}),i.jsx(Sj,{user:b,unreadCount:ne}),i.jsxs("main",{className:"px-5 space-y-8 max-w-md mx-auto pt-4",children:[i.jsxs("div",{className:"relative overflow-hidden rounded-[32px] p-8 shadow-premium group",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500 to-teal-700 dark:from-emerald-600 dark:to-teal-800 transition-all duration-500 group-hover:scale-105"}),i.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20 mix-blend-overlay"}),i.jsx("div",{className:"absolute top-[-50%] left-[-20%] w-[200px] h-[200px] bg-white/10 rounded-full blur-3xl animate-float-slow"}),i.jsxs("div",{className:"relative z-10 flex flex-col items-start text-right",children:[i.jsx("span",{className:"inline-block px-3 py-1 bg-white/20 backdrop-blur-md rounded-full text-xs font-bold text-white border border-white/20 mb-3 shadow-sm",children:"  "}),i.jsxs("h2",{className:"text-3xl font-black text-white mb-2 leading-tight drop-shadow-sm",children:["   ",i.jsx("br",{})," ",i.jsx("span",{className:"text-emerald-100",children:" "})]}),i.jsx("p",{className:"text-emerald-50 text-sm font-medium leading-relaxed max-w-[85%]",children:"      ."})]})]}),i.jsx(Tj,{stats:I}),b&&i.jsx(Nj,{}),i.jsxs("div",{className:"py-2",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-4 px-1 flex items-center gap-2",children:[i.jsx("span",{className:"w-1.5 h-6 bg-emerald-500 rounded-full"})," "]}),i.jsx(Ej,{serviceStates:se})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsx("div",{className:"bg-slate-200/50 dark:bg-slate-800/50 p-1.5 rounded-2xl flex relative",children:[{key:"news",label:" "},{key:"community",label:" "},{key:"polls",label:" "}].map(zt=>i.jsxs("button",{onClick:()=>P(zt.key),className:`flex-1 py-3 rounded-xl text-sm font-bold transition-all relative z-10 ${w===zt.key?"text-slate-800 dark:text-slate-100 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[w===zt.key&&i.jsx("div",{className:"absolute inset-0 bg-white dark:bg-slate-700 rounded-xl shadow-sm -z-10 animate-in fade-in zoom-in-95 duration-200"}),zt.label]},zt.key))}),i.jsx("div",{className:"animate-in slide-in-from-bottom-2 duration-300",children:i.jsx(Cj,{activeTab:w,newsItems:T})})]}),i.jsxs(xa,{to:"/volunteering",className:"block relative overflow-hidden rounded-[32px] group active:scale-[0.98] transition-all shadow-premium mb-8",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-600 to-indigo-600 dark:from-violet-700 dark:to-indigo-700"}),i.jsxs("div",{className:"relative p-8 flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("span",{className:"inline-block bg-white/20 backdrop-blur-md text-white text-[10px] font-bold px-3 py-1 rounded-full border border-white/20 mb-3 shadow-sm",children:"  "}),i.jsx("h3",{className:"font-black text-white text-2xl mb-2 drop-shadow-sm",children:" "}),i.jsx("p",{className:"text-indigo-100 text-xs font-medium",children:"      "})]}),i.jsx("div",{className:"w-16 h-16 bg-white/10 backdrop-blur-sm rounded-2xl flex items-center justify-center text-white shadow-inner border border-white/10 group-hover:scale-110 transition-transform",children:i.jsx(Yc,{size:32,className:"fill-white/20 text-white"})})]})]})]})]})})}function ui({type:b}){return b==="card"?i.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-5 shadow-sm animate-pulse-slow",children:[i.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[i.jsx("div",{className:"w-10 h-10 bg-slate-100 rounded-lg"}),i.jsxs("div",{className:"flex-1 space-y-2",children:[i.jsx("div",{className:"h-4 bg-slate-100 rounded w-1/4"}),i.jsx("div",{className:"h-5 bg-slate-100 rounded w-3/4"}),i.jsx("div",{className:"h-3 bg-slate-100 rounded w-full"})]})]}),i.jsxs("div",{className:"flex justify-between pt-3 border-t border-slate-50",children:[i.jsx("div",{className:"h-3 bg-slate-100 rounded w-20"}),i.jsx("div",{className:"h-3 bg-slate-100 rounded w-16"})]})]}):b==="list"?i.jsxs("div",{className:"flex items-center gap-3 bg-white p-4 rounded-xl border border-slate-200 shadow-sm animate-pulse-slow",children:[i.jsx("div",{className:"w-12 h-12 bg-slate-100 rounded-full"}),i.jsxs("div",{className:"flex-1 space-y-2",children:[i.jsx("div",{className:"h-4 bg-slate-100 rounded w-1/3"}),i.jsx("div",{className:"h-3 bg-slate-100 rounded w-1/2"})]})]}):b==="profile"?i.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm text-center animate-pulse-slow",children:[i.jsx("div",{className:"w-20 h-20 bg-slate-100 rounded-full mx-auto mb-4"}),i.jsx("div",{className:"h-6 bg-slate-100 rounded w-1/2 mx-auto mb-2"}),i.jsx("div",{className:"h-4 bg-slate-100 rounded w-1/3 mx-auto"})]}):null}function Mj(){const[b,k]=K.useState([]),[w,P]=K.useState("global"),[I,R]=K.useState(!0),T=dr(),c=[{id:1,title:":   ",category:" ",readTime:"8 ",summary:"            ",image:"https://images.unsplash.com/photo-1525625293386-3f8f99389da2?w=800&q=80",color:"blue",stats:{label:" ",value:"30%"}},{id:2,title:":   ",category:" ",readTime:"6 ",summary:"    99%         ",image:"https://images.unsplash.com/photo-1532996122724-e3c354a0b15b?w=800&q=80",color:"emerald",stats:{label:" ",value:"99%"}},{id:3,title:":  ",category:" ",readTime:"10 ",summary:"              ",image:"https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80",color:"indigo",stats:{label:" ",value:"99.9%"}},{id:4,title:":   ",category:" ",readTime:"7 ",summary:"              ",image:"https://images.unsplash.com/photo-1599388147926-3d23450d992f?w=800&q=80",color:"rose",stats:{label:" ",value:"80%"}},{id:5,title:":   ",category:" ",readTime:"6 ",summary:"      (BRT)    100          ",image:"https://images.unsplash.com/photo-1570125909232-eb263c188f7e?w=800&q=80",color:"amber",stats:{label:" ",value:"75%"}},{id:6,title:":  ",category:" ",readTime:"9 ",summary:"           ..      ",image:"https://images.unsplash.com/photo-1512470876302-687da745313d?w=800&q=80",color:"cyan",stats:{label:" ",value:"40%"}},{id:7,title:":    ",category:" ",readTime:"5 ",summary:" '':      (  )        ",image:"https://images.unsplash.com/photo-1576023363380-4f30cd252549?w=800&q=80",color:"emerald",stats:{label:" ",value:"90%"}},{id:8,title:":  ",category:" ",readTime:"7 ",summary:"       ..          ",image:"https://images.unsplash.com/photo-1583009653303-12e08cb0a221?w=800&q=80",color:"sky",stats:{label:" ",value:"62%"}}],V=K.useCallback(async()=>{try{R(!0);const ne=await Lt.get("/ai-studies"),je=(Array.isArray(ne.data)?ne.data:ne.data.data||[]).map(re=>({...re,color:re.color||"indigo"}));k(je)}catch(ne){console.error(ne)}finally{R(!1)}},[]),{isRefreshing:W,pullMoveY:se,handlers:ee}=hi(V);return K.useEffect(()=>{V()},[V]),i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...ee,children:i.jsxs(pi,{isRefreshing:W,pullMoveY:se,children:[i.jsxs("header",{className:"bg-white dark:bg-slate-900 pb-12 pt-6 z-30 relative transition-colors duration-300",children:[i.jsxs("div",{className:"px-5 flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-black text-slate-800 dark:text-slate-100 tracking-tight",children:"  "}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium mt-0.5",children:"   "})]}),i.jsx("button",{className:"w-10 h-10 bg-slate-50 dark:bg-slate-800 border border-slate-100 dark:border-slate-800 rounded-full flex items-center justify-center text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition active:scale-95 shadow-sm",children:i.jsx(ch,{size:20})})]}),i.jsx("div",{className:"px-5 pb-2",children:i.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-1.5 rounded-2xl flex relative",children:[i.jsx("button",{onClick:()=>P("global"),className:`flex-1 py-2.5 rounded-xl text-xs font-bold transition-all relative z-10 ${w==="global"?"bg-white dark:bg-slate-700 text-indigo-600 dark:text-indigo-400 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:"  "}),i.jsx("button",{onClick:()=>P("local"),className:`flex-1 py-2.5 rounded-xl text-xs font-bold transition-all relative z-10 ${w==="local"?"bg-white dark:bg-slate-700 text-emerald-600 dark:text-emerald-400 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:"  "}),i.jsx("button",{onClick:()=>P("awareness"),className:`flex-1 py-2.5 rounded-xl text-xs font-bold transition-all relative z-10 ${w==="awareness"?"bg-white dark:bg-slate-700 text-amber-600 dark:text-amber-400 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200"}`,children:" "})]})})]}),i.jsxs("main",{className:"px-5 -mt-10 relative z-40 bg-slate-50 dark:bg-slate-900 rounded-t-[40px] pt-8 min-h-[calc(100vh-200px)] space-y-8 transition-colors duration-300",children:[w==="global"&&i.jsxs("div",{className:"space-y-6 animate-slide-up",children:[i.jsxs("div",{onClick:()=>T("/study/1"),className:"relative h-[420px] rounded-[32px] overflow-hidden shadow-2xl group cursor-pointer",children:[i.jsx("img",{src:c[0].image,className:"absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105",alt:""}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-90"}),i.jsxs("div",{className:"absolute top-5 right-5 left-5 flex justify-between items-start",children:[i.jsx("span",{className:"bg-blue-600 text-white text-[10px] font-black px-3 py-1.5 rounded-full uppercase tracking-wider shadow-lg backdrop-blur-md border border-white/20",children:"  "}),i.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/20 group-hover:bg-white group-hover:text-black transition-all",children:i.jsx(Y0,{size:20,className:"text-white group-hover:text-black"})})]}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-8 text-white",children:[i.jsx("h2",{className:"text-3xl font-black mb-3 leading-tight",children:c[0].title}),i.jsx("p",{className:"text-blue-100 text-sm opacity-90 line-clamp-2 mb-4 font-medium leading-relaxed",children:c[0].summary}),i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("div",{className:"px-4 py-2 bg-white/10 backdrop-blur-md rounded-xl border border-white/10 flex items-center gap-2",children:[i.jsx(eh,{size:16,className:"text-blue-400"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-[9px] text-blue-200 uppercase font-bold",children:c[0].stats.label}),i.jsx("span",{className:"text-sm font-black text-white",children:c[0].stats.value})]})]}),i.jsxs("div",{className:"px-4 py-2 bg-white/10 backdrop-blur-md rounded-xl border border-white/10 flex items-center gap-2",children:[i.jsx(oi,{size:16,className:"text-white/60"}),i.jsxs("span",{className:"text-xs font-bold",children:[c[0].readTime," "]})]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 gap-5",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[" ",i.jsx("div",{className:"h-px flex-1 bg-slate-200 mx-2"})]}),c.slice(1).map(ne=>i.jsxs("div",{onClick:()=>T(`/study/${ne.id}`),className:"bg-white dark:bg-slate-800 rounded-3xl p-4 shadow-sm border border-slate-100 dark:border-slate-700/50 flex gap-4 hover:border-blue-200 dark:hover:border-blue-700 transition-colors cursor-pointer group",children:[i.jsxs("div",{className:"w-24 h-24 rounded-2xl bg-slate-100 dark:bg-slate-900 overflow-hidden shrink-0 relative",children:[i.jsx("img",{src:ne.image,className:"w-full h-full object-cover",alt:""}),i.jsx("div",{className:`absolute inset-0 bg-${ne.color}-500/10 mix-blend-overlay`})]}),i.jsxs("div",{className:"flex-1 py-1",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("span",{className:`text-[10px] font-bold text-${ne.color}-600 dark:text-${ne.color}-400 uppercase tracking-wide bg-${ne.color}-50 dark:bg-${ne.color}-900/20 px-2 py-0.5 rounded-lg`,children:ne.category}),i.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold flex items-center gap-1",children:[i.jsx(oi,{size:10})," ",ne.readTime]})]}),i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-base mb-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors line-clamp-1",children:ne.title}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-relaxed line-clamp-2",children:ne.summary})]})]},ne.id))]})]}),w==="local"&&i.jsxs("div",{className:"space-y-4 animate-slide-up",children:[i.jsxs("div",{className:"bg-emerald-600 rounded-3xl p-8 text-white shadow-xl shadow-emerald-600/20 relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -mr-20 -mt-20"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("h2",{className:"text-2xl font-black mb-2",children:"  "}),i.jsx("p",{className:"text-emerald-50 text-sm opacity-90 leading-relaxed font-medium max-w-[80%]",children:"         ."})]})]}),I?[1,2].map(ne=>i.jsx(ui,{type:"card"},ne)):b.map(ne=>i.jsxs("div",{onClick:()=>T(`/study/${ne.id}`),className:"bg-white dark:bg-slate-800 rounded-2xl p-5 border border-slate-200 dark:border-slate-700 shadow-sm active:scale-[0.98] transition-all",children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-xl bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 flex items-center justify-center text-2xl border border-orange-100 dark:border-orange-800/50",children:ne.icon||""}),i.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 px-2 py-1 rounded-lg border border-slate-100 dark:border-slate-800/50",children:i.jsx("span",{className:"text-[10px] font-bold text-slate-500 dark:text-slate-400",children:ne.category})})]}),i.jsx("h3",{className:"font-bold text-slate-900 dark:text-slate-100 text-lg mb-2",children:ne.title}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm line-clamp-2 leading-relaxed mb-4",children:ne.summary}),i.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-slate-50 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(Bp,{size:14,className:"text-slate-400 dark:text-slate-500"}),i.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-slate-300",children:ne.economics?.investment||" "})]}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(Jn,{size:14,className:"text-slate-400 dark:text-slate-500"}),i.jsxs("span",{className:"text-xs font-bold text-slate-700 dark:text-slate-300",children:[ne.economics?.jobs||" "," "]})]})]})]},ne.id))]}),w==="awareness"&&i.jsxs("div",{className:"space-y-4 animate-slide-up",children:[i.jsxs("div",{className:"bg-gradient-to-br from-amber-500 to-orange-600 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full blur-3xl -mr-10 -mt-10"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("h2",{className:"text-2xl font-black mb-2",children:"  "}),i.jsx("p",{className:"text-amber-50 text-sm opacity-90 leading-relaxed font-medium",children:"        "})]})]}),i.jsx("div",{className:"grid grid-cols-1 gap-4",children:[{id:1,title:" :  ",type:" ",icon:"",color:"emerald",desc:"     "},{id:2,title:"   ",type:"",icon:"",color:"blue",desc:"    "},{id:3,title:"  ",type:"",icon:"",color:"amber",desc:"  30%   "},{id:4,title:"  ",type:"",icon:"",color:"cyan",desc:"     "},{id:5,title:"  ",type:"",icon:"",color:"rose",desc:"   "},{id:6,title:"  ",type:"",icon:"",color:"slate",desc:"     "},{id:7,title:"  ",type:"",icon:"",color:"pink",desc:"    "},{id:8,title:" ",type:"",icon:"",color:"purple",desc:"     "}].map(ne=>i.jsxs("button",{onClick:()=>T(`/awareness/${ne.id}`),className:"w-full bg-white dark:bg-slate-800 rounded-3xl border border-slate-200 dark:border-slate-700 p-4 flex items-center gap-4 text-right active:scale-[0.98] transition-all shadow-premium hover:border-slate-300 dark:hover:border-slate-600",children:[i.jsx("div",{className:`w-16 h-16 rounded-2xl bg-${ne.color}-50 dark:bg-${ne.color}-900/20 border border-${ne.color}-100 dark:border-${ne.color}-800/50 flex items-center justify-center text-3xl shrink-0`,children:ne.icon}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:`text-[10px] font-black uppercase text-${ne.color}-600 dark:text-${ne.color}-400 mb-0.5 tracking-wide`,children:ne.type}),i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-base mb-1 leading-tight",children:ne.title}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-relaxed line-clamp-1",children:ne.desc})]}),i.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-50 dark:bg-slate-900 flex items-center justify-center shrink-0",children:i.jsx(Cr,{size:16,className:"text-slate-400 dark:text-slate-500 rotate-180"})})]},ne.id))}),i.jsx("div",{className:"bg-gradient-to-br from-indigo-50 to-blue-50 border border-indigo-100 rounded-3xl p-6 text-center",children:i.jsxs("p",{className:"text-sm text-slate-600 font-medium leading-relaxed",children:["    ",i.jsx("br",{}),i.jsx("button",{className:"text-indigo-600 font-bold underline mt-2",children:" "})]})})]})]})]})})}function Ij(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0),T={1:{title:":   ",category:" ",created_at:new Date().toISOString(),image:"https://images.unsplash.com/photo-1525625293386-3f8f99389da2?w=800&q=80",summary:"                   .",stats:[{label:" ",value:"$5M",icon:i.jsx(Bp,{size:16,className:"text-emerald-500"})},{label:" ",value:"",icon:i.jsx(oi,{size:16,className:"text-blue-500"})},{label:"",value:"2M+",icon:i.jsx(Jn,{size:16,className:"text-purple-500"})}],challenge:"                        .",solution:"   'ERP' (  )            .",solutionPoints:["   ( )"," ","    "],impact:{val1:"30%",label1:"  ",val2:"20%",label2:" "},quote:"              .",author:"  ",role:"  ",color:"blue",gallery:["https://images.unsplash.com/photo-1465447142348-e9952c393450?w=800&q=80","https://images.unsplash.com/photo-1494522855154-9297ac14b55f?w=800&q=80","https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=800&q=80"]},2:{title:":    ",category:" ",created_at:new Date().toISOString(),image:"https://images.unsplash.com/photo-1532996122724-e3c354a0b15b?w=800&q=80",summary:"    99%              .",stats:[{label:" ",value:"$120M",icon:i.jsx(Bp,{size:16,className:"text-emerald-500"})},{label:" ",value:"60k",icon:i.jsx(mo,{size:16,className:"text-blue-500"})},{label:" ",value:"99%",icon:i.jsx(Yh,{size:16,className:"text-purple-500"})}],challenge:"                  .",solution:"      (Waste-to-Energy).      '' .",solutionPoints:["  ","  ","   "],impact:{val1:"99%",label1:" ",val2:"1%",label2:" "},quote:"       .",author:"  ",role:" ",color:"emerald",gallery:["https://images.unsplash.com/photo-1542601906990-24ccd08d7455?w=800&q=80","https://images.unsplash.com/photo-1532996122724-e3c354a0b15b?w=800&q=80","https://images.unsplash.com/photo-1497436072909-60f360e1d4b0?w=800&q=80"]},3:{title:":   ",category:" ",created_at:new Date().toISOString(),image:"https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80",summary:"       18      .",stats:[{label:" ",value:"800y",icon:i.jsx(oi,{size:16,className:"text-emerald-500"})},{label:" ",value:"99%",icon:i.jsx(gm,{size:16,className:"text-blue-500"})},{label:" ",value:"100%",icon:i.jsx(Qf,{size:16,className:"text-purple-500"})}],challenge:"                  .",solution:" X-Road:             .",solutionPoints:["  ","  i-Voting","  e-Health"],impact:{val1:"2%",label1:"   ",val2:"5d",label2:"   "},quote:"       .",author:" ",role:"  ",color:"indigo",gallery:["https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=800&q=80","https://images.unsplash.com/photo-1531403009284-440f080d1e12?w=800&q=80","https://images.unsplash.com/photo-1504384308090-c54be3855833?w=800&q=80"]},4:{title:":    ",category:" ",created_at:new Date().toISOString(),image:"https://images.unsplash.com/photo-1599388147926-3d23450d992f?w=800&q=80",summary:"       '  '    .",stats:[{label:" ",value:"1.5M",icon:i.jsx(Jn,{size:16,className:"text-emerald-500"})},{label:" ",value:"5",icon:i.jsx(eh,{size:16,className:"text-blue-500"})},{label:" ",value:"30",icon:i.jsx(Qf,{size:16,className:"text-purple-500"})}],challenge:"   (Comunas)          .",solution:"  :    ( )        ' '.",solutionPoints:["  ","  ","  "],impact:{val1:"80%",label1:" ",val2:"3x",label2:" "},quote:"          .",author:" ",role:" ",color:"rose",gallery:["https://images.unsplash.com/photo-1596422846543-75c6fc197f07?w=800&q=80","https://images.unsplash.com/photo-1540397106260-e24a594092d4?w=800&q=80","https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=800&q=80"]},5:{title:":   ",category:" ",created_at:new Date().toISOString(),image:"https://images.unsplash.com/photo-1570125909232-eb263c188f7e?w=800&q=80",summary:"           ' ':     .",stats:[{label:"/",value:"$3M",icon:i.jsx(Bp,{size:16,className:"text-emerald-500"})},{label:" ",value:"2.3M",icon:i.jsx(Jn,{size:16,className:"text-blue-500"})},{label:" ",value:"27M",icon:i.jsx(eh,{size:16,className:"text-purple-500"})}],challenge:"                .",solution:" BRT:                   .",solutionPoints:["  ","   ","   "],impact:{val1:"75%",label1:"  ",val2:"1/100",label2:"  "},quote:"      .",author:" ",role:"  ( )",color:"amber",gallery:["https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=800&q=80","https://images.unsplash.com/photo-1494519883701-35282a4bd3eb?w=800&q=80","https://images.unsplash.com/photo-1517649763962-0c623066013b?w=800&q=80"]},6:{title:":  ",category:" ",created_at:new Date().toISOString(),image:"https://images.unsplash.com/photo-1512470876302-687da745313d?w=800&q=80",summary:"     (IoT)   :               .",stats:[{label:" ",value:"40%",icon:i.jsx(Qf,{size:16,className:"text-emerald-500"})},{label:" ",value:"10k+",icon:i.jsx(mo,{size:16,className:"text-blue-500"})},{label:" ",value:"600+",icon:i.jsx(eh,{size:16,className:"text-purple-500"})}],challenge:"           .",solution:" Amsterdam Smart City:   . : Climate Street         .",solutionPoints:["    ","   ","   "],impact:{val1:"15%",label1:" ",val2:"200",label2:"   "},quote:"          .",author:" ",role:" ",color:"cyan",gallery:["https://images.unsplash.com/photo-1468436385273-8abca6dfd8d3?w=800&q=80","https://images.unsplash.com/photo-1580674684081-7617fbf3d745?w=800&q=80","https://images.unsplash.com/photo-1584285418504-0062a4e21703?w=800&q=80"]},7:{title:":    ",category:" ",created_at:new Date().toISOString(),image:"https://images.unsplash.com/photo-1576023363380-4f30cd252549?w=800&q=80",summary:"            '':   .",stats:[{label:"",value:"90%",icon:i.jsx(Jn,{size:16,className:"text-emerald-500"})},{label:" ",value:"0%",icon:i.jsx(Yh,{size:16,className:"text-blue-500"})},{label:" ",value:"30%",icon:i.jsx(eh,{size:16,className:"text-purple-500"})}],challenge:"            .",solution:"  'Umuganda':         (  )     .",solutionPoints:["    (2008)","    ","    "],impact:{val1:"Top 1",label1:"  ",val2:"$10M",label2:"   "},quote:"        .",author:" ",role:" ",color:"emerald",gallery:["https://images.unsplash.com/photo-1523798724021-f7a8b4b7297e?w=800&q=80","https://images.unsplash.com/photo-1489743342057-3448cc7d3bb9?w=800&q=80","https://images.unsplash.com/photo-1588556394336-d71e223d6a6a?w=800&q=80"]},8:{title:":  ",category:" ",created_at:new Date().toISOString(),image:"https://images.unsplash.com/photo-1583009653303-12e08cb0a221?w=800&q=80",summary:"       .        ",stats:[{label:"/",value:"5:1",icon:i.jsx(eh,{size:16,className:"text-emerald-500"})},{label:"",value:"390km",icon:i.jsx(qn,{size:16,className:"text-blue-500"})},{label:" ",value:"62%",icon:i.jsx(Jn,{size:16,className:"text-purple-500"})}],challenge:"           .",solution:"  '  ' (Super Cycle Highways)       ( ).",solutionPoints:["   ","    ","    "],impact:{val1:"1.2M",label1:"   ",val2:"$250M",label2:"  "},quote:"             .",author:" ",role:" ",color:"sky",gallery:["https://images.unsplash.com/photo-1571182126296-6e068c92a99d?w=800&q=80","https://images.unsplash.com/photo-1506161869818-45e3f4369766?w=800&q=80","https://images.unsplash.com/photo-1571520696924-f7b5329cf566?w=800&q=80"]}},c=T[b||"1"]||T[1];if(K.useEffect(()=>{if(T[b||""]){P(T[b||""]),R(!1);return}Lt.get(`/ai-studies/${b}`).then(W=>P(W.data)).catch(W=>{console.error(W)}).finally(()=>R(!1))},[b]),I)return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center transition-colors duration-300",children:i.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-slate-800 dark:border-slate-400 border-t-transparent rounded-full"})});const V=T[b||""]?c:w;return V?i.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900 min-h-screen pb-10 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:"relative h-[60vh] w-full bg-slate-900 overflow-hidden",children:[i.jsx("img",{src:V.image||"https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80",className:"absolute inset-0 w-full h-full object-cover opacity-80",alt:V.title}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/40 to-transparent"}),i.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 pt-12 flex justify-between items-center z-20",children:[i.jsx("button",{onClick:()=>k(-1),className:"w-10 h-10 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/20 hover:bg-white/20 transition-all",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsx("button",{className:"w-10 h-10 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/20 hover:bg-white/20 transition-all",children:i.jsx(Yp,{size:20})})]}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-12 z-20",children:[i.jsx("span",{className:`bg - ${c.color||"blue"} -600 text - white text - [10px] font - black px - 3 py - 1.5 rounded - lg mb - 4 inline - block shadow - lg border border - white / 20 tracking - wider uppercase`,children:V.category}),i.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white leading-tight mb-4 drop-shadow-sm",children:V.title}),i.jsxs("div",{className:"flex items-center gap-4 text-slate-300 text-xs font-bold",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(hl,{size:14,className:`text - ${c.color||"blue"} -400`}),i.jsx("span",{children:new Date(V.created_at).toLocaleDateString("ar-SY")})]}),i.jsx("div",{className:"w-1 h-1 bg-slate-500 rounded-full"}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(oi,{size:14,className:`text - ${c.color||"blue"} -400`}),i.jsxs("span",{children:[c.readTime||"5 "," "]})]})]})]})]}),i.jsxs("main",{className:"px-5 -mt-8 relative z-30 space-y-6",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-[32px] p-6 shadow-premium border border-slate-100 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center border border-slate-200 dark:border-slate-600",children:i.jsx(Jh,{size:18,className:"text-slate-600 dark:text-slate-400"})}),i.jsx("h3",{className:"text-lg font-black text-slate-800 dark:text-slate-100",children:""})]}),i.jsx("p",{className:"text-slate-600 dark:text-slate-300 leading-loose text-sm font-medium",children:V.summary})]}),c.stats&&i.jsx("div",{className:"grid grid-cols-3 gap-3",children:c.stats.map((W,se)=>i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-2xl border border-slate-100 dark:border-slate-700 text-center shadow-sm",children:[i.jsx("div",{className:"flex justify-center mb-1",children:W.icon}),i.jsx("div",{className:"text-lg font-black text-slate-800 dark:text-slate-100",children:W.value}),i.jsx("div",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase",children:W.label})]},se))}),c.challenge&&i.jsxs("div",{className:"bg-rose-50 dark:bg-rose-950/20 rounded-[32px] p-6 border border-rose-100 dark:border-rose-900/30",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-2xl bg-rose-100 dark:bg-rose-900/30 flex items-center justify-center text-rose-600 dark:text-rose-400",children:i.jsx(eg,{size:20})}),i.jsx("h3",{className:"text-lg font-black text-rose-900 dark:text-rose-100",children:" / "})]}),i.jsx("p",{className:"text-rose-800/80 dark:text-rose-300/80 leading-loose text-sm font-medium",children:c.challenge})]}),c.solution&&i.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-950/20 rounded-[32px] p-6 border border-emerald-100 dark:border-emerald-900/30",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-2xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center text-emerald-600 dark:text-emerald-400",children:i.jsx(mo,{size:20})}),i.jsx("h3",{className:"text-lg font-black text-emerald-900 dark:text-emerald-100",children:" "})]}),i.jsx("p",{className:"text-emerald-800/80 dark:text-emerald-300/80 leading-loose text-sm font-medium mb-4",children:c.solution}),c.solutionPoints&&i.jsx("ul",{className:"space-y-3",children:c.solutionPoints.map((W,se)=>i.jsxs("li",{className:"flex items-center gap-3 bg-white/60 dark:bg-slate-800/60 p-3 rounded-xl",children:[i.jsx(Yh,{size:16,className:"text-emerald-500 shrink-0"}),i.jsx("span",{className:"text-emerald-900 dark:text-emerald-100 text-xs font-bold",children:W})]},se))})]}),c.impact&&i.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-950/20 rounded-[32px] p-6 border border-indigo-100 dark:border-indigo-900/30",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-2xl bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:i.jsx(eh,{size:20})}),i.jsx("h3",{className:"text-lg font-black text-indigo-900 dark:text-indigo-100",children:" "})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-premium text-center border border-indigo-100 dark:border-indigo-900/30",children:[i.jsx("span",{className:"text-3xl font-black text-indigo-600 dark:text-indigo-400 block mb-1",children:c.impact.val1}),i.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-bold uppercase",children:c.impact.label1})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-premium text-center border border-indigo-100 dark:border-indigo-900/30",children:[i.jsx("span",{className:"text-3xl font-black text-indigo-600 dark:text-indigo-400 block mb-1",children:c.impact.val2}),i.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-bold uppercase",children:c.impact.label2})]})]})]}),c.gallery&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-black text-slate-800 dark:text-slate-100 mb-4 px-2",children:" "}),i.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 px-1 -mx-5 px-5 snap-x scrollbar-hide",children:c.gallery.map((W,se)=>i.jsx("div",{className:"flex-shrink-0 w-64 h-48 rounded-2xl overflow-hidden shadow-premium snap-center relative border border-slate-200 dark:border-slate-700",children:i.jsx("img",{src:W,className:"w-full h-full object-cover",alt:`Gallery ${se}`})},se))})]}),c.quote&&i.jsxs("div",{className:"relative py-8 px-4 text-center",children:[i.jsx(p2,{size:40,className:"text-slate-200 dark:text-slate-800 absolute top-0 left-0"}),i.jsxs("p",{className:"font-black text-xl text-slate-800 dark:text-slate-100 leading-relaxed italic relative z-10",children:['"',c.quote,'"']}),i.jsxs("div",{className:"mt-4 flex items-center justify-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center font-bold text-slate-50 dark:text-slate-400 text-lg",children:c.author?.charAt(0)}),i.jsxs("div",{className:"text-right",children:[i.jsx("div",{className:"text-sm font-bold text-slate-800 dark:text-slate-200",children:c.author}),i.jsx("div",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:c.role})]})]})]}),i.jsxs("button",{className:"w-full py-4 bg-slate-900 dark:bg-indigo-600 text-white rounded-2xl font-bold flex items-center justify-center gap-2 active:scale-95 transition-all shadow-xl shadow-slate-900/20 dark:shadow-indigo-600/20",children:[i.jsx("span",{children:"    (PDF)"}),i.jsx(Y0,{size:18})]})]})]}):null}function hy(){const{id:b}=di(),k=dr(),[w,P]=K.useState("content"),R={1:{title:" :  ",type:" ",icon:i.jsx(Qf,{size:32}),color:"emerald",bgGradient:"from-emerald-500 to-teal-600",image:"https://images.unsplash.com/photo-1532996122724-e3c354a0b15b?w=800&q=80",summary:"            ",intro:"        .        :",mainPoints:["        70%","      ","      ","      "],steps:[{title:"  -  ",desc:"      "},{title:"  -  ",desc:"     "},{title:"  -  ",desc:"   "},{title:"  -  ",desc:"      "}],quickTips:["    ","   ","      ","    "],didYouKnow:["       17 ","           3 ","  450    "],actions:[{label:"   ",action:"schedule",color:"emerald",icon:i.jsx(tc,{size:18})}]},2:{title:"   ",type:"",icon:i.jsx(gm,{size:32}),color:"blue",bgGradient:"from-blue-500 to-indigo-600",image:"https://images.unsplash.com/photo-1556761175-b413da4baf72?w=800&q=80",summary:"          ",intro:"          .    :",mainPoints:["       80%","    ","     ","    "],steps:[{title:"   ",desc:"     "},{title:"  ",desc:"     "},{title:"   ",desc:"     "},{title:"   ",desc:"  ' '  "},{title:"  ",desc:"    "}],quickTips:["     ","   (   )","    ","   3-5  "],didYouKnow:["     48 ","90%       ","        "],actions:[{label:"  ",action:"report",color:"blue",icon:i.jsx(ec,{size:18})},{label:" ",action:"history",color:"slate",icon:i.jsx(J0,{size:18})}]},3:{title:"  ",type:"",icon:i.jsx(pl,{size:32}),color:"amber",bgGradient:"from-amber-500 to-orange-600",image:"https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=800&q=80",summary:"         ",intro:"        .    30%  :",mainPoints:["      ","     ","     ","   "],steps:[{title:"    LED",desc:"  80%    "},{title:"   ",desc:"     "},{title:"    ",desc:"      "},{title:"   ",desc:"     "}],quickTips:["   24  ( )","    ","      ","    "],didYouKnow:[" LED  15$    ","      25%","  (6-10 )    "],actions:[{label:"  ",action:"calculator",color:"amber",icon:i.jsx(mo,{size:18})}]},4:{title:"  ",type:"",icon:i.jsx(vw,{size:32}),color:"cyan",bgGradient:"from-cyan-500 to-blue-600",image:"https://images.unsplash.com/photo-1548839140-29a749e1cf4d?w=800&q=80",summary:"       ",intro:"       .     :",mainPoints:["  4    100  ","     ","     ","     "],steps:[{title:"  ",desc:"   = 15   "},{title:"   ",desc:"   50%   "},{title:"   ",desc:"    200  "},{title:"    6 ",desc:"     "}],quickTips:["    ","      ","     ","       "],didYouKnow:["     90   ","    40$ ","      "],actions:[{label:"   ",action:"maintenance",color:"cyan",icon:i.jsx(v0,{size:18})}]},5:{title:"  ",type:"",icon:i.jsx(ec,{size:32}),color:"rose",bgGradient:"from-rose-500 to-pink-600",image:"https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=800&q=80",summary:"        ",intro:"    .     :",mainPoints:["90%     ","    ","      70%","     "],steps:[{title:"    ",desc:"        "},{title:"   ",desc:"       "},{title:"  ",desc:"         "},{title:"  ",desc:"       "}],quickTips:["    ","      ","     ","    "],didYouKnow:["      ","  30     50 /","      "],actions:[{label:"    ",action:"report_hazard",color:"rose",icon:i.jsx(ec,{size:18})}]},6:{title:"  ",type:" ",icon:i.jsx(v0,{size:32}),color:"slate",bgGradient:"from-slate-600 to-gray-700",image:"https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=800&q=80",summary:"         ",intro:"       .   :",mainPoints:["   80%   ","    ","    ","    "],steps:[{title:"   ",desc:"     "},{title:"   ",desc:"      "},{title:"  ",desc:"        "},{title:"   ",desc:"    "}],quickTips:["      ","    ","    ","   "],didYouKnow:["       4    ","        15%","    "],actions:[{label:"  ",action:"report",color:"slate",icon:i.jsx(v0,{size:18})}]},7:{title:"  ",type:"",icon:i.jsx(Yc,{size:32}),color:"pink",bgGradient:"from-pink-500 to-rose-600",image:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=800&q=80",summary:"       ",intro:"         .     :",mainPoints:["   80%   ","    ","    ","    "],steps:[{title:"  ",desc:"       - 20  "},{title:"   ",desc:"     "},{title:"  ",desc:"  15    "},{title:"    ",desc:"     "}],quickTips:["      ","   (    !)","    3 ","    "],didYouKnow:["   8   12    ","      50%","      10    "],actions:[{label:"  ",action:"health_tips",color:"pink",icon:i.jsx(Yc,{size:18})}]},8:{title:" ",type:"",icon:i.jsx(Jn,{size:32}),color:"purple",bgGradient:"from-purple-500 to-indigo-600",image:"https://images.unsplash.com/photo-1559027615-cd4628902d4a?w=800&q=80",summary:"        ",intro:"   .      :",mainPoints:["    ","    ","     ","     "],steps:[{title:"  ",desc:"        "},{title:"   ",desc:"     "},{title:" ",desc:"   -   "},{title:"  ",desc:"     "}],quickTips:["    ","  -  ","    ","   "],didYouKnow:["     ","    10  ","        40%"],actions:[{label:" ",action:"initiatives",color:"purple",icon:i.jsx(Jn,{size:18})},{label:"  ",action:"create_initiative",color:"indigo",icon:i.jsx(mo,{size:18})}]}}[b||"1"];return R?i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:`relative h-64 bg-gradient-to-br ${R.bgGradient} overflow-hidden`,children:[i.jsx("img",{src:R.image,className:"absolute inset-0 w-full h-full object-cover opacity-20 mix-blend-overlay",alt:""}),i.jsx("div",{className:"absolute inset-0 bg-black/20"}),i.jsx("button",{onClick:()=>k(-1),className:"absolute top-4 right-4 w-10 h-10 bg-white/20 dark:bg-slate-900/40 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 dark:border-white/10 hover:bg-white/30 transition z-10",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 text-white",children:i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/20 dark:bg-slate-900/40 backdrop-blur-md flex items-center justify-center border border-white/30 dark:border-white/10",children:R.icon}),i.jsxs("div",{children:[i.jsx("span",{className:"text-xs font-bold opacity-90 uppercase tracking-wide",children:R.type}),i.jsx("h1",{className:"text-2xl font-black leading-tight text-white",children:R.title})]})]})})]}),i.jsx("div",{className:"sticky top-0 z-20 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-4 py-3 transition-colors duration-300",children:i.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-1 rounded-xl flex",children:[i.jsx("button",{onClick:()=>P("content"),className:`flex-1 py-2 rounded-lg text-xs font-bold transition ${w==="content"?"bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 shadow-sm":"text-slate-500 dark:text-slate-400"}`,children:""}),i.jsx("button",{onClick:()=>P("tips"),className:`flex-1 py-2 rounded-lg text-xs font-bold transition ${w==="tips"?"bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 shadow-sm":"text-slate-500 dark:text-slate-400"}`,children:" "}),i.jsx("button",{onClick:()=>P("facts"),className:`flex-1 py-2 rounded-lg text-xs font-bold transition ${w==="facts"?"bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 shadow-sm":"text-slate-500 dark:text-slate-400"}`,children:" "})]})}),i.jsxs("main",{className:"px-5 py-6 space-y-6",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-premium border border-slate-100 dark:border-slate-700/50",children:[i.jsx("p",{className:"text-slate-600 dark:text-slate-300 leading-relaxed text-sm font-medium mb-4",children:R.summary}),i.jsx("p",{className:"text-slate-700 dark:text-slate-400 text-sm leading-loose",children:R.intro})]}),w==="content"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-3xl p-6 border border-blue-100 dark:border-blue-900/30",children:[i.jsxs("h3",{className:"font-bold text-lg text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2",children:[i.jsx(mo,{size:20,className:"text-blue-600 dark:text-blue-400"}),"  "]}),i.jsx("ul",{className:"space-y-3",children:R.mainPoints.map((T,c)=>i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx(lm,{size:18,className:"text-blue-600 dark:text-blue-400 shrink-0 mt-0.5"}),i.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300 leading-relaxed",children:T})]},c))})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-slate-100 mb-4 px-2",children:" "}),i.jsx("div",{className:"space-y-3",children:R.steps.map((T,c)=>i.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-200 dark:border-slate-700 shadow-premium",children:i.jsxs("div",{className:"flex gap-4",children:[i.jsx("div",{className:`w-8 h-8 rounded-full bg-${R.color}-100 dark:bg-${R.color}-900/40 text-${R.color}-700 dark:text-${R.color}-400 flex items-center justify-center font-bold text-sm shrink-0`,children:c+1}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm mb-1",children:T.title}),i.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 leading-relaxed",children:T.desc})]})]})},c))})]})]}),w==="tips"&&i.jsx("div",{className:"space-y-3",children:R.quickTips.map((T,c)=>i.jsxs("div",{className:`bg-${R.color}-50 dark:bg-${R.color}-900/10 border border-${R.color}-100 dark:border-${R.color}-900/30 rounded-2xl p-4 flex gap-3`,children:[i.jsx("div",{className:`w-6 h-6 rounded-full bg-${R.color}-100 dark:bg-${R.color}-900/40 flex items-center justify-center shrink-0 mt-0.5`,children:i.jsx("span",{className:`text-${R.color}-600 dark:text-${R.color}-400 font-bold text-xs`,children:""})}),i.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 leading-relaxed",children:T})]},c))}),w==="facts"&&i.jsx("div",{className:"space-y-4",children:R.didYouKnow.map((T,c)=>i.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/10 dark:to-pink-900/10 border border-purple-100 dark:border-purple-900/30 rounded-3xl p-5 shadow-sm",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/40 flex items-center justify-center shrink-0",children:i.jsx("span",{className:"text-2xl",children:""})}),i.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300 leading-relaxed flex-1 pt-1",children:T})]})},c))}),R.actions&&R.actions.length>0&&i.jsx("div",{className:"space-y-3 pt-4",children:R.actions.map((T,c)=>i.jsxs("button",{className:`w-full py-4 bg-${T.color}-600 text-white rounded-2xl font-bold flex items-center justify-center gap-2 active:scale-95 transition-transform shadow-lg`,children:[T.icon,i.jsx("span",{children:T.label}),i.jsx(Y0,{size:18})]},c))})]})]}):null}function zj(){const[b,k]=K.useState(null),[w,P]=K.useState(!0),{theme:I,toggleTheme:R}=ig(),T=dr(),[c,V]=K.useState(""),W=async(re,H)=>{try{const Pe=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${re}&lon=${H}&accept-language=ar`)).json();if(Pe.display_name){const ze=Pe.address,lt=[ze.road||ze.pedestrian||ze.suburb,ze.neighbourhood||ze.quarter,ze.city||ze.town||ze.village].filter(Boolean).join(" ");V(lt||Pe.display_name)}}catch(Ze){console.error("Failed to resolve address",Ze),V("  ")}},se=K.useCallback(async()=>{try{const re=localStorage.getItem("user");if(re){const H=JSON.parse(re);k(H),H.latitude&&H.longitude&&W(H.latitude,H.longitude)}}catch(re){console.error(re)}finally{P(!1)}},[]),{isRefreshing:ee,pullMoveY:ne,handlers:ke}=hi(se);K.useEffect(()=>{se()},[se]);const je=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),T("/login")};return w?i.jsx(ui,{type:"profile"}):b?i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...ke,children:i.jsxs(pi,{isRefreshing:ee,pullMoveY:ne,children:[i.jsxs("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30 px-4 py-4 shadow-sm flex items-center justify-between transition-colors duration-300",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>T(-1),className:"w-10 h-10 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl flex items-center justify-center text-slate-600 dark:text-slate-400 transition-colors border border-slate-200 dark:border-slate-800",children:i.jsx(id,{size:24})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:" "}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-medium",children:"  "})]})]}),i.jsx("button",{onClick:je,className:"w-10 h-10 bg-rose-50 text-rose-600 rounded-xl flex items-center justify-center border border-rose-100 hover:bg-rose-100 transition",children:i.jsx(Ww,{size:18})})]}),i.jsxs("main",{className:"px-4 py-6 space-y-6",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 border border-slate-200 dark:border-slate-700 shadow-premium relative overflow-hidden animate-fade-in-up",children:[i.jsx("div",{className:"absolute top-0 left-0 w-32 h-32 bg-emerald-50 dark:bg-emerald-900/10 rounded-full -ml-10 -mt-10 opacity-50 blur-2xl animate-pulse-slow"}),i.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center",children:[i.jsxs("div",{className:"w-24 h-24 bg-gradient-to-br from-slate-100 to-slate-200 rounded-full flex items-center justify-center text-slate-400 mb-4 ring-4 ring-white shadow-md relative group",children:[i.jsx(tp,{size:40,className:"group-hover:scale-110 transition-transform"}),i.jsx("div",{className:"absolute bottom-1 right-1 w-6 h-6 bg-emerald-500 border-2 border-white rounded-full flex items-center justify-center",children:i.jsx(sh,{size:12,className:"text-white fill-current"})})]}),i.jsx("h2",{className:"text-xl font-black text-slate-900 dark:text-slate-100 mb-1",children:b.name}),i.jsxs("span",{className:"text-xs text-emerald-700 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-3 py-1 rounded-full border border-emerald-100 dark:border-emerald-800/50 mb-6 inline-flex items-center gap-1 font-bold",children:[i.jsx(Kf,{size:12})," "]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[i.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/40 p-3.5 rounded-2xl border border-slate-100 dark:border-slate-800/50 flex items-center gap-3",children:[i.jsx("div",{className:"w-9 h-9 rounded-xl bg-white dark:bg-slate-800 flex items-center justify-center text-slate-400 dark:text-slate-500 shadow-sm border border-slate-100 dark:border-slate-700",children:i.jsx(Q0,{size:16})}),i.jsxs("div",{className:"text-right overflow-hidden",children:[i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold mb-0.5",children:" "}),i.jsx("p",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 truncate",children:b.email})]})]}),i.jsxs("div",{className:"bg-slate-50 p-3.5 rounded-2xl border border-slate-100 flex items-center gap-3",children:[i.jsx("div",{className:"w-9 h-9 rounded-xl bg-white flex items-center justify-center text-slate-400 shadow-sm border border-slate-100",children:i.jsx(tc,{size:16})}),i.jsxs("div",{className:"text-right overflow-hidden",children:[i.jsx("p",{className:"text-[10px] text-slate-400 font-bold mb-0.5",children:" "}),i.jsx("p",{className:"text-xs font-bold text-slate-700 truncate",children:b.phone||" "})]})]}),i.jsxs("div",{className:"bg-slate-50 p-3.5 rounded-2xl border border-slate-100 flex items-center gap-3",children:[i.jsx("div",{className:"w-9 h-9 rounded-xl bg-white flex items-center justify-center text-slate-400 shadow-sm border border-slate-100",children:i.jsx(qn,{size:16})}),i.jsxs("div",{className:"text-right overflow-hidden",children:[i.jsx("p",{className:"text-[10px] text-slate-400 font-bold mb-0.5",children:""}),i.jsx("p",{className:"text-xs font-bold text-slate-700 truncate",dir:"auto",children:c||b.neighborhood||(b.is_resident?" ...":" ")})]})]})]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("button",{onClick:()=>T("/service-log"),className:"bg-gradient-to-br from-orange-500 to-amber-600 rounded-2xl p-4 border border-orange-400/20 shadow-sm relative overflow-hidden group active:scale-[0.98] transition-all",children:[i.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full -mr-10 -mt-10 blur-xl group-hover:bg-white/20 transition-all"}),i.jsxs("div",{className:"relative z-10 flex flex-col items-start h-full justify-between gap-4",children:[i.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm",children:i.jsx(pl,{size:20,className:"text-white"})}),i.jsxs("div",{className:"text-right",children:[i.jsx("h4",{className:"font-bold text-sm mb-0.5",children:" "}),i.jsx("p",{className:"text-[10px] text-orange-100",children:" / "})]})]})]}),i.jsx("button",{onClick:()=>T("/add-report"),className:"bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-200 dark:border-slate-700 shadow-premium relative overflow-hidden group active:scale-[0.98] transition-all",children:i.jsxs("div",{className:"relative z-10 flex flex-col items-start h-full justify-between gap-4",children:[i.jsx("div",{className:"w-10 h-10 bg-rose-50 dark:bg-rose-900/20 rounded-xl flex items-center justify-center border border-rose-100 dark:border-rose-800/50",children:i.jsx(o2,{size:20,className:"text-rose-500 dark:text-rose-400"})}),i.jsxs("div",{className:"text-right",children:[i.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm mb-0.5",children:" "}),i.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"  "})]})]})})]}),i.jsxs("div",{className:"bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden animate-fade-in-up",style:{animationDelay:"200ms"},children:[i.jsxs("div",{className:"p-5 border-b border-slate-100 flex items-center justify-between",children:[i.jsx("h3",{className:"font-bold text-slate-800 text-sm",children:" "}),i.jsx("button",{className:"text-[11px] font-bold text-indigo-600 hover:bg-indigo-50 px-2 py-1 rounded-lg transition",children:" "})]}),i.jsx("div",{className:"divide-y divide-slate-50",children:[1,2,3].map((re,H)=>i.jsxs("div",{className:"p-4 flex items-center gap-4 hover:bg-slate-50 transition group",children:[i.jsx("div",{className:"w-10 h-10 rounded-2xl bg-slate-50 text-slate-500 flex items-center justify-center border border-slate-100 group-hover:scale-110 transition-transform",children:i.jsx(Kf,{size:18})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"text-xs font-bold text-slate-800 mb-1",children:"   "}),i.jsx("p",{className:"text-[10px] text-slate-500 line-clamp-1",children:'"     "'})]}),i.jsx("span",{className:"text-[10px] text-slate-400 font-medium bg-slate-50 px-2 py-1 rounded-lg",children:" "})]},re))})]}),i.jsxs("div",{className:"space-y-3 animate-fade-in-up",style:{animationDelay:"300ms"},children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 mb-2 text-sm px-1 mt-4",children:" "}),i.jsxs("button",{onClick:R,className:"w-full bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-200 dark:border-slate-700 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-700 transition active:scale-[0.99] shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-10 h-10 rounded-xl ${I==="light"?"bg-amber-50 text-amber-600 border-amber-100":"bg-slate-900 text-slate-100 border-slate-800"} flex items-center justify-center border`,children:I==="light"?i.jsx(r_,{size:18}):i.jsx(e_,{size:18})}),i.jsxs("div",{className:"text-right",children:[i.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 text-sm block",children:" "}),i.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-medium",children:I==="light"?" ":" "})]})]}),i.jsx("div",{className:"bg-slate-100 dark:bg-slate-900 px-3 py-1 rounded-full text-[10px] font-black text-slate-500 dark:text-slate-400",children:I==="light"?"":""})]}),[{icon:i.jsx(sh,{size:18}),label:" ",color:"emerald"},{icon:i.jsx(Kf,{size:18}),label:" ",color:"purple"}].map((re,H)=>i.jsxs("button",{className:"w-full bg-white p-4 rounded-2xl border border-slate-200 flex items-center justify-between hover:bg-slate-50 transition active:scale-[0.99]",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-10 h-10 rounded-xl bg-${re.color}-50 text-${re.color}-600 flex items-center justify-center border border-${re.color}-100`,children:re.icon}),i.jsx("span",{className:"font-bold text-slate-700 text-sm",children:re.label})]}),i.jsx("div",{className:"bg-slate-50 p-2 rounded-lg",children:i.jsx(id,{size:16,className:"text-slate-400"})})]},H))]}),i.jsxs("div",{className:"flex items-center gap-2 justify-center mt-8 text-slate-400 pb-4",children:[i.jsx(sh,{size:12}),i.jsx("span",{className:"text-[10px] font-medium opacity-70",children:"   "})]})]})]})}):(T("/login"),null)}function Aj(){const[b,k]=K.useState([]),[w,P]=K.useState(!0),[I,R]=K.useState({totalReports:0,criticalZones:0});K.useEffect(()=>{(async()=>{try{const[W,se]=await Promise.all([Lt.get("/infrastructure/status-summary"),Lt.get("/infrastructure/status-heatmap")]);k(W.data);const ee=se.data.features||[],ne=ee.filter(ke=>ke.properties.status==="cutoff").length;R({totalReports:ee.reduce((ke,je)=>ke+je.properties.total_reports,0),criticalZones:ne})}catch(W){console.error("Failed to fetch services data",W)}finally{P(!1)}})()},[]);const T=V=>{switch(V){case"stable":return{bg:"bg-emerald-50 dark:bg-emerald-900/20",border:"border-emerald-100 dark:border-emerald-800/50",text:"text-emerald-700 dark:text-emerald-400",icon:"bg-emerald-500",pulse:"bg-emerald-400"};case"unstable":return{bg:"bg-amber-50 dark:bg-amber-900/20",border:"border-amber-100 dark:border-amber-800/50",text:"text-amber-700 dark:text-amber-400",icon:"bg-amber-500",pulse:"bg-amber-400"};default:return{bg:"bg-rose-50 dark:bg-rose-900/20",border:"border-rose-100 dark:border-rose-800/50",text:"text-rose-700 dark:text-rose-400",icon:"bg-rose-500",pulse:"bg-rose-400"}}},c=V=>{switch(V){case"electricity":return i.jsx(pl,{size:20});case"water":return i.jsx(Vp,{size:20});case"internet":return i.jsx(U2,{size:20});case"phone":return i.jsx(tc,{size:20});default:return i.jsx(t_,{size:20})}};return i.jsxs("div",{className:"min-h-screen bg-white dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl border-b border-slate-100 dark:border-slate-800 sticky top-0 z-40 px-6 py-5 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:()=>window.history.back(),className:"w-10 h-10 bg-slate-50 dark:bg-slate-800 rounded-2xl flex items-center justify-center text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 transition-transform active:scale-90",children:i.jsx(id,{size:20,className:"transform rotate-180"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-black text-slate-900 dark:text-slate-100",children:" "}),i.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-bold uppercase tracking-widest",children:"Live Services Health"})]})]}),i.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-emerald-50 dark:bg-emerald-900/30 rounded-full border border-emerald-100 dark:border-emerald-800/50",children:[i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),i.jsx("span",{className:"text-[10px] font-black text-emerald-700 dark:text-emerald-400",children:" "})]})]}),i.jsxs("main",{className:"px-6 py-8 space-y-8",children:[i.jsx("section",{children:i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-slate-900 dark:bg-slate-800 rounded-[32px] p-5 text-white shadow-xl shadow-slate-200/50 dark:shadow-none",children:[i.jsx("div",{className:"text-[10px] font-black opacity-60 uppercase mb-3 text-emerald-400",children:" "}),i.jsx("div",{className:"text-3xl font-black mb-1",children:I.totalReports}),i.jsx("div",{className:"text-[10px] font-bold opacity-80",children:"  "})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-[32px] p-5 border border-slate-100 dark:border-slate-700 shadow-sm",children:[i.jsx("div",{className:"text-[10px] font-black text-rose-500 uppercase mb-3",children:" "}),i.jsx("div",{className:"text-3xl font-black text-slate-900 dark:text-slate-100 mb-1",children:I.criticalZones}),i.jsx("div",{className:"text-[10px] font-bold text-slate-500",children:"  / "})]})]})}),i.jsxs("section",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h2",{className:"text-lg font-black text-slate-900 dark:text-slate-100",children:"  "}),i.jsx("button",{onClick:()=>window.location.reload(),className:"p-2 text-slate-400 hover:text-blue-500 transition-colors",children:i.jsx(m2,{size:18})})]}),w?i.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(V=>i.jsx("div",{className:"h-24 bg-slate-50 dark:bg-slate-800 rounded-[28px] animate-pulse"},V))}):i.jsx("div",{className:"grid grid-cols-1 gap-4",children:b.map(V=>{const W=T(V.status);return i.jsx("div",{className:`p-5 rounded-[32px] border ${W.border} ${W.bg} transition-all active:scale-[0.98] relative overflow-hidden group`,children:i.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center shadow-sm border border-white/50 dark:border-slate-700 bg-white dark:bg-slate-900 ${W.text}`,children:c(V.id)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-black text-slate-900 dark:text-slate-100 text-base",children:V.name}),i.jsx("p",{className:`text-[10px] font-bold mt-1 ${W.text}`,children:V.label})]})]}),i.jsxs("div",{className:"flex flex-col items-end gap-2",children:[i.jsxs("div",{className:`px-3 py-1.5 rounded-xl border ${W.border} bg-white dark:bg-slate-900 flex items-center gap-2`,children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${W.icon} shadow-[0_0_8px_rgba(16,185,129,0.5)]`}),i.jsx("span",{className:`text-[10px] font-black ${W.text}`,children:" "})]}),i.jsxs("span",{className:"text-[9px] font-bold text-slate-400 opacity-60",children:[": ",new Date(V.updated_at).toLocaleTimeString("ar-SY",{hour:"2-digit",minute:"2-digit"})]})]})]})},V.id)})})]}),i.jsxs("section",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-[32px] p-6 border border-slate-100 dark:border-slate-800 text-center",children:[i.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-3xl flex items-center justify-center mx-auto mb-4 border border-blue-200 dark:border-blue-800/50",children:i.jsx(qn,{size:28})}),i.jsx("h3",{className:"font-black text-slate-900 dark:text-slate-100 mb-2",children:"    "}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium leading-relaxed mb-6 px-4",children:"        ."}),i.jsxs(xa,{to:"/add-report",className:"inline-flex items-center justify-center gap-2 w-full py-4 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 rounded-2xl font-black text-sm transition-transform active:scale-95 shadow-xl shadow-slate-200 dark:shadow-none",children:[i.jsx("span",{children:""}),"   "]})]})]})]})}function Dj(){const[b,k]=K.useState([]),[w,P]=K.useState(!0);return K.useEffect(()=>{Lt.get("/api/infrastructure/water").then(I=>k(I.data)).catch(I=>console.error(I)).finally(()=>P(!1))},[]),i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30 px-4 py-4 shadow-sm flex items-center justify-between transition-colors duration-300",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>window.history.back(),className:"w-10 h-10 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl flex items-center justify-center text-slate-600 dark:text-slate-400 transition-colors border border-slate-200 dark:border-slate-700",children:i.jsx("span",{className:"text-xl transform rotate-180",children:""})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:" "}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-medium",children:"    "})]})]}),i.jsx("div",{className:"w-10 h-10 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-xl flex items-center justify-center border border-blue-100 dark:border-blue-800/50",children:i.jsx("span",{className:"text-xl",children:""})})]}),i.jsxs("main",{className:"px-4 py-6",children:[w?i.jsx("p",{className:"text-center py-10 opacity-50 text-sm font-medium text-slate-500",children:" ..."}):i.jsx("div",{className:"grid grid-cols-1 gap-3",children:b.map(I=>i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-200 dark:border-slate-700/50 flex justify-between items-center shadow-premium",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm",children:I.name}),i.jsxs("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 mt-1 font-medium text-right",children:[" : ",new Date(I.updated_at).toLocaleTimeString("ar-SY")]})]}),i.jsx("div",{className:`px-3 py-1 rounded-md text-[10px] font-bold border transition-colors ${I.status==="Working"?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 border-emerald-100 dark:border-emerald-800/50":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 border-red-100 dark:border-red-800/50"}`,children:I.status==="Working"?"":""})]},I.id))}),i.jsxs("div",{className:"mt-6 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-2xl border border-blue-100 dark:border-blue-800/50 flex gap-3 text-blue-800 dark:text-blue-400 shadow-sm",children:[i.jsx("span",{className:"text-lg",children:""}),i.jsx("p",{className:"text-xs leading-relaxed font-medium pt-0.5 text-right",children:"            ."})]})]})]})}const N0={religious:{label:"",color:"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800/50"},cultural:{label:"",color:"bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800/50"},social:{label:"",color:"bg-purple-50 text-purple-600 border-purple-100 dark:bg-purple-900/30 dark:text-purple-400 dark:border-purple-800/50"},emergency:{label:"",color:"bg-red-50 text-red-600 border-red-100 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800/50"},other:{label:"",color:"bg-slate-50 text-slate-600 border-slate-100 dark:bg-slate-700/30 dark:text-slate-400 dark:border-slate-600/50"}};function Rj(){const b=dr(),[k,w]=K.useState([]),[P,I]=K.useState(!0),[R,T]=K.useState(""),[c,V]=K.useState("all");K.useEffect(()=>{W()},[]);const W=async()=>{try{const ne=await Lt.get("/portal/events");w(ne.data)}catch(ne){console.error(ne)}finally{I(!1)}},ee=(k.length>0?k:[]).filter(ne=>{const ke=ne.title.toLowerCase().includes(R.toLowerCase())||ne.description.toLowerCase().includes(R.toLowerCase()),je=c==="all"||ne.category===c;return ke&&je});return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30 shadow-sm transition-all duration-300",children:i.jsxs("div",{className:"px-4 py-4 flex flex-col gap-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>b(-1),className:"w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition-colors text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700",children:i.jsx(Cr,{size:20})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-black text-slate-800 dark:text-slate-100",children:""}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-medium leading-none mt-0.5",children:"    "})]})]}),i.jsx("div",{className:"w-12 h-12 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-2xl flex items-center justify-center border border-indigo-100 dark:border-indigo-800/50 shadow-sm",children:i.jsx(hl,{size:24})})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(ch,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),i.jsx("input",{type:"text",placeholder:"  ...",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl py-2.5 pr-10 pl-4 text-xs font-bold text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 transition-all",value:R,onChange:ne=>T(ne.target.value)})]}),i.jsx("button",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 p-2.5 rounded-xl text-slate-600 dark:text-slate-400 shadow-sm active:scale-95 transition-all",children:i.jsx(Tw,{size:20})})]}),i.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide -mx-4 px-4 pr-4",children:[i.jsx("button",{onClick:()=>V("all"),className:`px-4 py-1.5 rounded-full text-[11px] font-bold whitespace-nowrap transition-all ${c==="all"?"bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 shadow-lg":"bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700"}`,children:""}),Object.entries(N0).map(([ne,ke])=>i.jsx("button",{onClick:()=>V(ne),className:`px-4 py-1.5 rounded-full text-[11px] font-bold whitespace-nowrap transition-all ${c===ne?"bg-indigo-600 text-white shadow-lg border-indigo-500":"bg-white dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700"}`,children:ke.label},ne))]})]})}),i.jsx("main",{className:"px-4 py-6 space-y-4",children:P?i.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[i.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-slate-800 dark:border-slate-400 border-t-transparent rounded-full mb-4"}),i.jsx("p",{className:"text-xs text-slate-500",children:"  ..."})]}):ee.length>0?ee.map(ne=>{const ke=N0[ne.category]||N0.other;return i.jsxs("div",{onClick:()=>b(`/events/${ne.id}`),className:"bg-white dark:bg-slate-800 rounded-3xl overflow-hidden shadow-premium border border-slate-100 dark:border-slate-700/50 group active:scale-[0.98] transition-all cursor-pointer",children:[i.jsxs("div",{className:"h-32 bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-800 relative",children:[i.jsx("div",{className:"absolute top-4 right-4 z-10",children:i.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wider border ${ke.color}`,children:ke.label})}),ne.image?i.jsx("img",{src:ne.image,alt:ne.title,className:"w-full h-full object-cover"}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsx(hl,{size:48,className:"text-slate-300 dark:text-slate-600 opacity-50 group-hover:scale-110 transition-transform duration-500"})})]}),i.jsxs("div",{className:"p-5",children:[i.jsx("h3",{className:"text-lg font-black text-slate-800 dark:text-slate-100 mb-2 leading-tight group-hover:text-indigo-600 transition-colors",children:ne.title}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 leading-relaxed font-medium mb-4 line-clamp-2",children:ne.description}),i.jsxs("div",{className:"space-y-2 border-t border-slate-50 dark:border-slate-700/50 pt-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-bold text-slate-600 dark:text-slate-400",children:[i.jsx(hl,{size:14,className:"text-indigo-500"}),i.jsx("span",{children:new Date(ne.date).toLocaleDateString("ar-SY",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-bold text-slate-600 dark:text-slate-400",children:[i.jsx(oi,{size:14,className:"text-emerald-500"}),i.jsxs("span",{children:[" ",ne.time]})]}),i.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1 bg-slate-50 dark:bg-slate-900 rounded-lg border border-slate-100 dark:border-slate-800 text-[10px] font-bold text-slate-500 dark:text-slate-400",children:[i.jsx(qn,{size:12,className:"text-orange-500"}),i.jsx("span",{className:"truncate max-w-[120px]",children:ne.location})]})]})]})]})]},ne.id)}):i.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[i.jsx("div",{className:"w-20 h-20 bg-slate-100 dark:bg-slate-800 rounded-3xl flex items-center justify-center mb-4 border border-slate-200 dark:border-slate-700",children:i.jsx(oi,{size:40,className:"text-slate-300 dark:text-slate-600"})}),i.jsx("h4",{className:"text-slate-800 dark:text-slate-100 font-bold mb-1",children:"  "}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 px-10 leading-relaxed font-medium",children:"       ."})]})})]})}const py={religious:{label:"",color:"bg-emerald-50 text-emerald-600 border-emerald-100 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800/50"},cultural:{label:"",color:"bg-blue-50 text-blue-600 border-blue-100 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800/50"},social:{label:"",color:"bg-purple-50 text-purple-600 border-purple-100 dark:bg-purple-900/30 dark:text-purple-400 dark:border-purple-800/50"},emergency:{label:"",color:"bg-red-50 text-red-600 border-red-100 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800/50"},other:{label:"",color:"bg-slate-50 text-slate-600 border-slate-100 dark:bg-slate-700/30 dark:text-slate-400 dark:border-slate-600/50"}};function Lj(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0);K.useEffect(()=>{(async()=>{try{const W=await Lt.get(`/portal/events/${b}`);P(W.data)}catch(W){console.error(W)}finally{R(!1)}})()},[b]);const T=()=>{alert("      ")};if(I)return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center",children:i.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-indigo-600 border-t-transparent rounded-full"})});if(!w)return null;const c=py[w.category]||py.other;return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:"relative h-72 bg-slate-900",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-900 to-slate-900 opacity-90"}),i.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:"radial-gradient(#fff 1px, transparent 1px)",backgroundSize:"30px 30px"}}),w.image&&i.jsx("img",{src:w.image,alt:w.title,className:"absolute inset-0 w-full h-full object-cover mix-blend-overlay opacity-50"}),i.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 z-20 flex justify-between items-center",children:[i.jsx("button",{onClick:()=>k(-1),className:"w-10 h-10 bg-white/10 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/20 active:scale-95 transition-transform",children:i.jsx(Cr,{size:20})}),i.jsx("button",{className:"w-10 h-10 bg-white/10 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/20 active:scale-95 transition-transform",children:i.jsx(Yp,{size:20})})]}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 z-20 bg-gradient-to-t from-slate-900 via-slate-900/80 to-transparent",children:[i.jsx("span",{className:`px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-wider mb-3 inline-block ${c.color} bg-opacity-100 border-none`,children:c.label}),i.jsx("h1",{className:"text-2xl font-black text-white mb-2 leading-tight",children:w.title}),i.jsxs("div",{className:"flex items-center gap-4 text-slate-300 text-xs font-bold",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(hl,{size:14,className:"text-indigo-400"}),i.jsx("span",{children:new Date(w.date).toLocaleDateString("ar-SY",{weekday:"long",day:"numeric",month:"long"})})]}),i.jsx("div",{className:"w-1 h-1 bg-slate-500 rounded-full"}),i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(oi,{size:14,className:"text-emerald-400"}),i.jsx("span",{children:w.time})]})]})]})]}),i.jsxs("main",{className:"px-5 py-6 space-y-6",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-slate-200 dark:border-slate-700/50 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-indigo-50 dark:bg-indigo-900/30 rounded-full flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:i.jsx(qn,{size:20})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase mb-0.5",children:""}),i.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-slate-100",children:w.location})]})]}),i.jsx("button",{className:"text-xs font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/20 px-3 py-1.5 rounded-lg",children:""})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-premium border border-slate-100 dark:border-slate-700/50",children:[i.jsx("h3",{className:"text-lg font-black text-slate-800 dark:text-slate-100 mb-4",children:" "}),i.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-loose font-medium",children:w.description})]}),i.jsxs("button",{onClick:T,className:"w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold text-sm shadow-lg shadow-indigo-600/20 flex items-center justify-center gap-2 active:scale-95 transition-transform",children:[i.jsx(sw,{size:20}),i.jsx("span",{children:"  "})]})]})]})}const fy=[{id:"general",name:"",description:"    "},{id:"help",name:"",description:"   "},{id:"news",name:"-",description:"   "},{id:"trading",name:"-",description:"   "},{id:"tech",name:"",description:"   "}];function Fj(){const b=dr(),[k,w]=K.useState("general"),[P,I]=K.useState([]),[R,T]=K.useState(""),[c,V]=K.useState(!1),[W,se]=K.useState(null),[ee,ne]=K.useState(null),[ke,je]=K.useState(!1),[re,H]=K.useState(null),[Ze,Pe]=K.useState(null),[ze,lt]=K.useState(null),Nt=K.useRef(null),zt=K.useRef(null),Ft=K.useRef(null);K.useEffect(()=>{const Me=localStorage.getItem("user");Me&&ne(JSON.parse(Me))},[]);const Vt=K.useCallback(async()=>{try{const Me=await Lt.get(`/chat/${k}`);I(Me.data)}catch(Me){console.error("Failed to fetch messages",Me)}},[k]);K.useEffect(()=>(je(!0),Vt().then(()=>{je(!1),setTimeout(()=>{Nt.current&&(Nt.current.scrollTop=Nt.current.scrollHeight)},100)}),Ft.current=setInterval(Vt,3e3),()=>{Ft.current&&clearInterval(Ft.current)}),[k,Vt]);const Zt=async()=>{if(!R.trim())return;const Ct={id:Date.now(),user_id:ee?.id||0,user:{id:ee?.id||0,name:ee?.name||""},body:R,created_at:new Date().toISOString(),type:"text",reply_to_id:W?.id};I(it=>[...it,Ct]),T(""),se(null),setTimeout(()=>{Nt.current&&(Nt.current.scrollTop=Nt.current.scrollHeight)},100);try{await Lt.post(`/chat/${k}`,{body:Ct.body,reply_to_id:Ct.reply_to_id}),Vt()}catch(it){console.error("Failed to send message",it),Vt()}},mt=(Me,Ct)=>{H(Me.touches[0].clientX),lt(Ct),zt.current=setTimeout(()=>{window.confirm("     ")&&alert(" .")},800)},fr=Me=>{re!==null&&(Pe(Me.touches[0].clientX),Math.abs(re-Me.touches[0].clientX)>10&&clearTimeout(zt.current))},Kt=(Me,Ct)=>{if(clearTimeout(zt.current),re===null)return;re-Me.changedTouches[0].clientX>100&&se(Ct),H(null),Pe(null),lt(null)},Wt=fy.find(Me=>Me.id===k);return i.jsxs("div",{className:"flex h-screen bg-slate-50 dark:bg-slate-900 transition-colors duration-300 overflow-hidden",dir:"rtl",children:[i.jsx("aside",{className:`fixed inset-y-0 right-0 z-40 w-64 bg-slate-100 dark:bg-slate-800 border-l border-slate-200 dark:border-slate-700 transition-transform duration-300 transform ${c?"translate-x-0":"translate-x-full"} md:translate-x-0 md:relative`,children:i.jsxs("div",{className:"flex flex-col h-full",children:[i.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between bg-white dark:bg-slate-800",children:[i.jsx("h2",{className:"font-black text-slate-800 dark:text-slate-100",children:" "}),i.jsx(qp,{size:20,className:"text-slate-400"})]}),i.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:fy.map(Me=>i.jsxs("button",{onClick:()=>{w(Me.id),V(!1)},className:`w-full flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-bold transition-all ${k===Me.id?"bg-indigo-600 text-white shadow-lg":"text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700/50"}`,children:[i.jsx(Jf,{size:18,className:k===Me.id?"text-indigo-200":"text-slate-400"}),i.jsx("span",{children:Me.name})]},Me.id))}),ee&&i.jsxs("div",{className:"p-4 bg-slate-200 dark:bg-slate-900/50 flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500 border-2 border-white dark:border-slate-700 flex items-center justify-center text-white font-bold",children:ee.name.charAt(0)}),i.jsxs("div",{className:"flex-1 text-right truncate",children:[i.jsx("p",{className:"text-xs font-black text-slate-800 dark:text-slate-100 truncate",children:ee.name}),i.jsx("p",{className:"text-[10px] text-emerald-500 font-bold uppercase",children:""})]})]})]})}),i.jsxs("main",{className:"flex-1 flex flex-col h-full relative bg-slate-50 dark:bg-slate-900 w-full max-w-full",children:[i.jsxs("header",{className:"h-16 flex-none flex items-center justify-between px-4 bg-white/90 dark:bg-slate-900/90 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 z-30 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>b(-1),className:"w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-slate-800 rounded-xl text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 md:hidden active:scale-95",children:i.jsx(Cr,{size:20})}),i.jsxs("button",{onClick:()=>V(!c),className:"flex items-center gap-3 group px-2 py-1 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 bg-indigo-50 dark:bg-indigo-900/30 rounded-full flex items-center justify-center text-indigo-600 dark:text-indigo-400",children:i.jsx(Jf,{size:20})}),i.jsxs("div",{className:"text-right",children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 leading-none text-sm",children:Wt?.name}),i.jsx("p",{className:"text-[10px] text-slate-400 font-medium mt-1 truncate max-w-[150px]",children:Wt?.description})]})]})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsx("button",{className:"w-10 h-10 flex items-center justify-center text-slate-400 hover:text-indigo-600 rounded-xl",children:i.jsx(Jn,{size:20})})})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide bg-pattern relative w-full",children:[i.jsx("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none",style:{backgroundImage:"radial-gradient(#6366f1 1px, transparent 1px)",backgroundSize:"20px 20px"}}),i.jsxs("div",{ref:Nt,className:"p-4 space-y-4 pb-4 min-h-full flex flex-col justify-end",children:[ke&&P.length===0&&i.jsx("div",{className:"flex justify-center p-10",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}),!ke&&P.length===0&&i.jsxs("div",{className:"flex flex-col items-center py-10 opacity-40 text-center mb-auto",children:[i.jsx("div",{className:"w-20 h-20 bg-indigo-100 dark:bg-indigo-900/30 rounded-full flex items-center justify-center mb-4 text-indigo-500 dark:text-indigo-400",children:i.jsx(Jf,{size:40})}),i.jsxs("h4",{className:"font-black text-lg text-slate-700 dark:text-slate-200",children:["   #",Wt?.name,"!"]}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-2 px-10",children:"    ..."})]}),P.map(Me=>{const Ct=Me.user_id===ee?.id,it=Me.reply_to_id?P.find(pt=>pt.id===Me.reply_to_id):null,Tt=ze===Me.id&&Ze!==null&&re!==null,nt=Tt?Ze-re:0,ht=Tt?{transform:`translateX(${nt*.5}px)`,transition:"none"}:{transition:"transform 0.2s ease-out"};return i.jsxs("div",{className:`relative flex gap-3 group ${Ct?"flex-row-reverse":""}`,style:ht,onTouchStart:pt=>mt(pt,Me.id),onTouchMove:fr,onTouchEnd:pt=>Kt(pt,Me),children:[Tt&&nt>50&&i.jsx("div",{className:"absolute left-[-40px] top-1/2 -translate-y-1/2 text-indigo-500 animate-pulse",children:i.jsx(Cr,{size:24,className:"rotate-180"})}),i.jsx("div",{className:"flex flex-col items-center justify-end pb-1",children:i.jsx("div",{className:`w-8 h-8 rounded-full flex-shrink-0 overflow-hidden shadow-sm border-2 flex items-center justify-center bg-slate-200 dark:bg-slate-700 font-bold text-xs ${Ct?"border-indigo-200 dark:border-indigo-900 text-indigo-700":"border-white dark:border-slate-700 text-slate-600"}`,children:Me.user.name.charAt(0)})}),i.jsxs("div",{className:`flex flex-col max-w-[85%] ${Ct?"items-end":"items-start"}`,children:[i.jsx("div",{className:"flex items-center gap-2 mb-1 px-1",children:i.jsx("span",{className:`text-[11px] font-bold ${Ct?"text-indigo-600 dark:text-indigo-400":"text-slate-600 dark:text-slate-400"}`,children:Me.user.name})}),it&&i.jsxs("div",{className:`mb-1 text-[10px] bg-slate-100 dark:bg-slate-800/80 px-3 py-1.5 rounded-xl border-l-4 ${Ct?"border-indigo-300 rounded-tr-none":"border-slate-300 rounded-tl-none"} opacity-80 max-w-full truncate`,children:[i.jsxs("span",{className:"font-bold opacity-70 block mb-0.5",children:["  ",it.user.name]}),i.jsx("span",{className:"opacity-60",children:it.body})]}),i.jsxs("div",{className:`relative px-4 py-2 shadow-sm text-sm font-medium leading-snug break-words ${Ct?"bg-indigo-600 text-white rounded-2xl rounded-tr-none":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 rounded-2xl rounded-tl-none border border-slate-100 dark:border-slate-700/50"}`,children:[Me.body,i.jsx("span",{className:`text-[9px] block text-left mt-1 opacity-70 ${Ct?"text-indigo-100":"text-slate-400"}`,children:new Date(Me.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]},Me.id)})]})]}),i.jsxs("div",{className:"flex-none z-20 bg-white/80 dark:bg-slate-900/90 backdrop-blur-xl border-t border-slate-200 dark:border-slate-800 pb-[env(safe-area-inset-bottom)] shadow-up",children:[W&&i.jsxs("div",{className:"px-4 pt-3 pb-1 flex items-center justify-between animate-slide-up",children:[i.jsxs("div",{className:"flex-1 bg-slate-50 dark:bg-slate-800 border-l-4 border-indigo-500 rounded-r-lg px-3 py-2",children:[i.jsxs("p",{className:"text-[10px] font-bold text-indigo-600 mb-0.5",children:["  ",W.user.name]}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 line-clamp-1",children:W.body})]}),i.jsx("button",{onClick:()=>se(null),className:"ml-3 w-8 h-8 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-400",children:i.jsx(qp,{size:20,className:"rotate-45"})})]}),i.jsxs("div",{className:"p-3 flex items-end gap-2 max-w-4xl mx-auto w-full",children:[i.jsxs("div",{className:"flex-1 bg-slate-100 dark:bg-slate-800 rounded-[24px] flex items-end border border-transparent focus-within:border-indigo-500/50 focus-within:ring-2 focus-within:ring-indigo-500/10 transition-all max-h-[140px] overflow-hidden",children:[i.jsx("textarea",{rows:1,style:{minHeight:"44px",maxHeight:"120px"},placeholder:`  #${Wt?.name}`,className:"flex-1 bg-transparent border-none focus:ring-0 text-sm font-medium text-slate-800 dark:text-slate-100 placeholder-slate-400 px-4 py-3 resize-none custom-scrollbar",value:R,onChange:Me=>{T(Me.target.value),Me.target.style.height="auto",Me.target.style.height=`${Math.min(Me.target.scrollHeight,120)}px`},onKeyDown:Me=>{Me.key==="Enter"&&!Me.shiftKey&&(Me.preventDefault(),Zt())}}),i.jsx("button",{className:"p-3 text-slate-400 hover:text-amber-500 transition-colors",children:i.jsx(N2,{size:20})})]}),i.jsx("button",{onClick:Zt,disabled:!R.trim(),className:`w-11 h-11 rounded-full flex items-center justify-center transition-all shadow-md flex-shrink-0 ${R.trim()?"bg-indigo-600 text-white hover:bg-indigo-700 hover:scale-105":"bg-slate-200 dark:bg-slate-800 text-slate-400 cursor-not-allowed"}`,children:i.jsx(Gp,{size:20,className:"rtl:rotate-180 ml-0.5"})})]})]})]}),c&&i.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-30 md:hidden animate-fade-in",onClick:()=>V(!1)})]})}const my=[{id:"basics",title:" ",icon:eg,color:"bg-emerald-600",desc:"   "},{id:"ai",title:"  (AI)",icon:Hy,color:"bg-indigo-600",desc:"   "},{id:"reality",title:" ",icon:G1,color:"bg-amber-600",desc:"   "},{id:"business",title:" ",icon:z0,color:"bg-slate-600",desc:"  "}],Oj={basics:[{id:1,icon:eg,title:"     ",sections:[{type:"text",content:"   .   ' '  ' '  ' '.    ."},{type:"header",content:"  "},{type:"list",items:["    :   (Data Entry)    .","           .","   ''    '   '."]},{type:"warning",content:"     .        ."}]},{id:4,icon:rh,title:"   ",sections:[{type:"text",content:"  Upwork  Freelancer     .      ."},{type:"header",content:" :"},{type:"list",items:["  ()    () .","      (     ).","       ."]},{type:"tip",content:"   : '  10      5$'   '  '."}]},{id:5,icon:R0,title:"   ",sections:[{type:"text",content:"   .       ."},{type:"header",content:" :"},{type:"list",items:[" Google Translate   ."," ChatGPT  :   '      '.","      (: Deadline, Revision, Brief)."]}]},{id:19,icon:mo,title:"    ",sections:[{type:"text",content:" '' .    ."},{type:"header",content:"  "},{type:"list",items:["   (:    ).","  : '  '  'Canva tutorial for beginners'.","   .    ."]},{type:"tip",content:"     .     90%  ."}]}],ai:[{id:3,icon:mo,title:"   ",sections:[{type:"text",content:"    AI . :    AI      ."},{type:"header",content:" :"},{type:"list",items:[" :       .",":      .",":      ."]},{type:"warning",content:"   .  AI     ."}]},{id:10,icon:Hy,title:"    AI",sections:[{type:"text",content:"     .     ."},{type:"header",content:"  (Prompt) "},{type:"list",items:[" : '  '."," : '   '."," : '      '."," : '   '."]}]},{id:15,icon:pl,title:"  AI  ",sections:[{type:"text",content:"     .   5      ."},{type:"list",items:["     .","    .","    ( Midjourney  Bing Image Creator) ."]}]},{id:20,icon:rh,title:"   ",sections:[{type:"text",content:"   .          ."},{type:"tip",content:"         .     ."}]}],reality:[{id:2,icon:pl,title:"    ",sections:[{type:"text",content:"   .      ."},{type:"header",content:"  :"},{type:"list",items:[" :        ."," :  (Upload)  (Google)  .","     ."]}]},{id:7,icon:gm,title:"  ",sections:[{type:"text",content:"    .    ."},{type:"header",content:"  :"},{type:"list",items:[": Google Docs ( ).",": Canva (    ).",": CapCut (    )."," : CamScanner."]}]},{id:17,icon:cm,title:"    ",sections:[{type:"text",content:"     .      ."},{type:"tip",content:" Google Drive.     .         ."}]}],business:[{id:6,icon:Bp,title:"    ",sections:[{type:"text",content:"    .         ."},{type:"header",content:" :"},{type:"list",items:[" 5 :      (    5 ).","   :    .","          ."]}]},{id:8,icon:cm,title:"  ",sections:[{type:"text",content:"        ."},{type:"list",items:["      (      ).","   .","   (   )."]}]},{id:9,icon:z0,title:"   ",sections:[{type:"text",content:"   .      ."},{type:"header",content:" :"},{type:"list",items:[" :         .",":     .",":     ."]}]},{id:13,icon:R0,title:"  ",sections:[{type:"text",content:" ' '   ."},{type:"warning",content:"      :       ."}]},{id:16,icon:ah,title:"     ",sections:[{type:"text",content:"      ."},{type:"text",content:"        .      ''   ''."}]},{id:18,icon:z0,title:"   ",sections:[{type:"warning",content:"   ' 100$  '.  ."},{type:"text",content:"         .     .    ."}]}]};function Bj(){const b=dr(),[k,w]=K.useState(null),[P,I]=K.useState(null),R=k?Oj[k]:[],T=my.find(V=>V.id===k),c=(V,W)=>{switch(V.type){case"header":return i.jsx("h3",{className:"text-lg font-black text-slate-800 dark:text-slate-100 mt-6 mb-3",children:V.content},W);case"text":return i.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm leading-7 mb-4 font-medium",children:V.content},W);case"list":return i.jsx("ul",{className:"space-y-3 mb-6 bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl border border-slate-100 dark:border-slate-700/50",children:V.items?.map((se,ee)=>i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-1.5 h-1.5 bg-indigo-500 rounded-full mt-2.5 flex-shrink-0"}),i.jsx("span",{className:"text-slate-700 dark:text-slate-200 text-sm leading-relaxed",children:se})]},ee))},W);case"warning":return i.jsxs("div",{className:"flex gap-3 bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-900/20 mb-6",children:[i.jsx(ec,{className:"text-red-500 flex-shrink-0",size:20}),i.jsx("p",{className:"text-red-700 dark:text-red-300 text-xs font-bold leading-relaxed",children:V.content})]},W);case"tip":return i.jsxs("div",{className:"flex gap-3 bg-indigo-50 dark:bg-indigo-900/10 p-4 rounded-xl border border-indigo-100 dark:border-indigo-900/20 mb-6",children:[i.jsx(mo,{className:"text-indigo-500 flex-shrink-0",size:20}),i.jsx("p",{className:"text-indigo-700 dark:text-indigo-300 text-xs font-bold leading-relaxed",children:V.content})]},W);default:return null}};return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:"bg-slate-900 dark:bg-slate-950 px-6 pt-12 pb-20 rounded-b-[40px] relative overflow-hidden shadow-2xl",children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-slate-800/30 rounded-full blur-3xl -mr-16 -mt-16"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-slate-800/30 rounded-full -ml-12 -mb-12 blur-3xl"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("button",{onClick:()=>b(-1),className:"w-10 h-10 mb-6 bg-white/10 dark:bg-slate-800/40 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/20 hover:bg-white/20 transition-all active:scale-95",children:i.jsx(Cr,{size:20,className:"transform rotate-180"})}),i.jsx("h1",{className:"text-3xl font-black text-white mb-2 leading-tight",children:"  "}),i.jsx("p",{className:"text-slate-300 text-sm font-medium leading-relaxed opacity-90 max-w-sm",children:"     (  )       ."})]})]}),i.jsxs("main",{className:"px-5 -mt-12 relative z-20",children:[!k&&i.jsx("div",{className:"grid grid-cols-1 gap-4 animate-slide-up",children:my.map(V=>i.jsxs("button",{onClick:()=>w(V.id),className:"bg-white dark:bg-slate-800 p-5 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-sm hover:shadow-lg transition-all active:scale-95 flex items-center gap-4 text-right group",children:[i.jsx("div",{className:`w-14 h-14 ${V.color} rounded-2xl flex items-center justify-center text-white shadow-lg group-hover:scale-110 transition-transform duration-300`,children:i.jsx(V.icon,{size:28})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-lg",children:V.title}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-xs font-medium",children:V.desc})]}),i.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-400",children:i.jsx(Cr,{size:16,className:"rotate-180"})})]},V.id))}),k&&i.jsxs("div",{className:"animate-fade-in space-y-4",children:[i.jsxs("button",{onClick:()=>w(null),className:"flex items-center gap-2 text-slate-500 mb-2 font-bold text-sm hover:text-indigo-600 transition-colors",children:[i.jsx(Cr,{size:16})," "]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl border border-slate-100 dark:border-slate-700 text-center mb-6",children:[i.jsx("div",{className:`w-16 h-16 ${T?.color} rounded-2xl flex items-center justify-center text-white shadow-xl mx-auto mb-4`,children:T&&i.jsx(T.icon,{size:32})}),i.jsx("h2",{className:"text-2xl font-black text-slate-800 dark:text-slate-100",children:T?.title}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm mt-2",children:T?.desc})]}),R.map(V=>i.jsxs("div",{onClick:()=>I(V),className:"bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm flex items-center gap-4 cursor-pointer hover:shadow-md transition-all active:scale-98",children:[i.jsx("div",{className:"w-12 h-12 bg-slate-50 dark:bg-slate-700/50 rounded-xl flex items-center justify-center text-slate-600 dark:text-slate-300",children:i.jsx(V.icon,{size:22})}),i.jsx("div",{className:"flex-1",children:i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm leading-snug",children:V.title})}),i.jsx(Cr,{size:16,className:"text-slate-300 rotate-180"})]},V.id))]})]}),P&&i.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in",children:[i.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:()=>I(null)}),i.jsxs("div",{className:"relative bg-white dark:bg-slate-900 w-full max-w-lg rounded-t-[32px] sm:rounded-[32px] overflow-hidden shadow-2xl animate-slide-up sm:animate-zoom-in max-h-[85vh] flex flex-col",children:[i.jsxs("div",{className:`h-32 ${T?.color} relative flex items-center justify-center overflow-hidden flex-shrink-0`,children:[i.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/20 rounded-full blur-2xl -mr-10 -mt-10"}),i.jsx("button",{onClick:()=>I(null),className:"absolute top-4 right-4 w-8 h-8 bg-black/10 hover:bg-black/20 text-white rounded-full flex items-center justify-center transition-colors backdrop-blur-md z-10",children:i.jsx(ad,{size:18})}),i.jsx(P.icon,{size:48,className:"text-white/90 drop-shadow-md relative z-10"})]}),i.jsxs("div",{className:"p-6 overflow-y-auto flex-1 custom-scrollbar",children:[i.jsx("h2",{className:"text-xl font-black text-slate-800 dark:text-slate-100 mb-2 leading-tight text-center",children:P.title}),i.jsx("div",{className:"w-12 h-1 bg-slate-100 dark:bg-slate-800 rounded-full mx-auto mb-6"}),i.jsx("div",{className:"pb-8",children:P.sections.map((V,W)=>c(V,W))}),i.jsx("button",{onClick:()=>I(null),className:"w-full py-3.5 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 rounded-xl font-bold hover:scale-[1.02] transition-transform shadow-lg sticky bottom-0",children:""})]})]})]})]})}function Vj(){const[b,k]=K.useState(""),[w,P]=K.useState(""),[I,R]=K.useState(!1),[T,c]=K.useState(null),V=dr(),W=async se=>{se.preventDefault(),R(!0),c(null);try{const ee=await Lt.post("/login",{email:b,password:w,device_name:"android_mobile"});localStorage.setItem("token",ee.data.token),localStorage.setItem("user",JSON.stringify(ee.data.user)),V("/profile")}catch(ee){c(ee.response?.data?.message||"  .    .")}finally{R(!1)}};return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col justify-center py-10 transition-colors duration-300",dir:"rtl",children:i.jsxs("div",{className:"w-full max-w-md mx-auto px-6",children:[i.jsx("button",{onClick:()=>V("/"),className:"w-10 h-10 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl flex items-center justify-center text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700 hover:text-slate-800 dark:hover:text-slate-100 transition-all shadow-sm mb-6",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsxs("div",{className:"text-center mb-10",children:[i.jsx("div",{className:"w-20 h-20 bg-emerald-50 dark:bg-emerald-900/20 rounded-2xl mx-auto flex items-center justify-center border border-emerald-100 dark:border-emerald-800 mb-6 rotate-3",children:i.jsx("span",{className:"text-4xl font-black text-emerald-600 dark:text-emerald-400",children:""})}),i.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 mb-2",children:" ! "}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"     "})]}),i.jsxs("form",{onSubmit:W,className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700/50 p-8 rounded-3xl shadow-premium space-y-6",children:[i.jsxs("div",{className:"space-y-1.5",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:" "}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"email",value:b,onChange:se=>k(se.target.value),className:"w-full pl-4 pr-12 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all text-slate-800 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm font-medium",placeholder:"name@example.com",required:!0}),i.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400",children:i.jsx(Q0,{size:20})})]})]}),i.jsxs("div",{className:"space-y-1.5",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:" "}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"password",value:w,onChange:se=>P(se.target.value),className:"w-full pl-4 pr-12 py-3.5 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all text-slate-800 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm font-medium",placeholder:"",required:!0}),i.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400",children:i.jsx(Gw,{size:20})})]})]}),T&&i.jsxs("div",{className:"bg-red-50 border border-red-100 text-red-600 p-4 rounded-xl text-xs font-bold flex items-center gap-2",children:[i.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-red-500"}),T]}),i.jsx("button",{type:"submit",disabled:I,className:"w-full py-3.5 bg-emerald-600 hover:bg-emerald-700 dark:bg-emerald-500 dark:hover:bg-emerald-600 text-white rounded-xl font-bold text-sm shadow-lg shadow-emerald-600/20 active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:I?i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:" "}),i.jsx(Qy,{size:18})]})})]}),i.jsxs("div",{className:"text-center mt-8 space-y-4",children:[i.jsxs("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:["   ",i.jsx("span",{onClick:()=>V("/register"),className:"text-emerald-600 dark:text-emerald-400 font-bold cursor-pointer hover:underline transition-colors",children:"  "})]}),i.jsxs("p",{className:"text-slate-400 dark:text-slate-500 text-xs",children:["   ",i.jsx("span",{className:"text-slate-600 dark:text-slate-300 font-semibold cursor-pointer hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors",children:" "})]})]})]})})}function $j(){const[b,k]=K.useState({name:"",email:"",age:"",gender:"male",password:"",password_confirmation:"",mobile:"",country_code:"+963"}),[w,P]=K.useState(!1),[I,R]=K.useState({}),T=dr(),c=async W=>{W.preventDefault(),P(!0),R({});try{const se=await Lt.post("/register",{...b,device_name:"android_mobile"});localStorage.setItem("token",se.data.token),localStorage.setItem("user",JSON.stringify(se.data.user)),T("/setup-location")}catch(se){se.response?.data?.errors?R(se.response.data.errors):R({general:"  .    ."})}finally{P(!1)}},V=(W,se)=>{k(ee=>({...ee,[W]:se})),I[W]&&R(ee=>({...ee,[W]:null}))};return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col justify-center py-10 transition-colors duration-300",dir:"rtl",children:i.jsxs("div",{className:"w-full max-w-md mx-auto px-6",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("div",{className:"w-16 h-16 bg-emerald-50 dark:bg-emerald-900/20 rounded-2xl mx-auto flex items-center justify-center border border-emerald-100 dark:border-emerald-800 mb-4 rotate-3",children:i.jsx("span",{className:"text-3xl font-black text-emerald-600 dark:text-emerald-400",children:""})}),i.jsx("h1",{className:"text-xl font-bold text-slate-800 dark:text-slate-100 mb-1",children:"  "}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"     "})]}),i.jsxs("form",{onSubmit:c,className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700/50 p-6 rounded-3xl shadow-premium space-y-4",children:[I.general&&i.jsx("div",{className:"bg-red-50 border border-red-100 text-red-600 p-3 rounded-xl text-xs font-bold",children:I.general}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:" "}),i.jsx("input",{type:"text",value:b.name,onChange:W=>V("name",W.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all text-slate-800 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm",placeholder:":  ",required:!0}),I.name&&i.jsx("p",{className:"text-red-500 text-[10px] mt-1 font-bold",children:I.name[0]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:" "}),i.jsx("input",{type:"email",value:b.email,onChange:W=>V("email",W.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all text-slate-800 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm",placeholder:"example@gmail.com",required:!0}),I.email&&i.jsx("p",{className:"text-red-500 text-[10px] mt-1 font-bold",children:I.email[0]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:" "}),i.jsxs("div",{className:"flex gap-2",dir:"ltr",children:[i.jsxs("div",{className:"relative",children:[i.jsxs("select",{value:b.country_code,onChange:W=>V("country_code",W.target.value),className:"h-full pl-8 pr-2 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 text-slate-800 dark:text-slate-100 text-sm text-center appearance-none cursor-pointer w-[110px]",children:[i.jsx("option",{value:"+963",children:"SY (+963)"}),i.jsx("option",{value:"+971",children:"AE (+971)"}),i.jsx("option",{value:"+966",children:"SA (+966)"}),i.jsx("option",{value:"+962",children:"JO (+962)"}),i.jsx("option",{value:"+90",children:"TR (+90)"}),i.jsx("option",{value:"+1",children:"US (+1)"}),i.jsx("option",{value:"+44",children:"UK (+44)"}),i.jsx("option",{value:"+49",children:"DE (+49)"})]}),i.jsx("div",{className:"absolute left-2 top-1/2 -translate-y-1/2 w-5 h-3.5 rounded-sm overflow-hidden pointer-events-none shadow-sm flex flex-col",children:b.country_code==="+963"?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"h-[33%] bg-[#007a3d]"}),i.jsxs("div",{className:"h-[33%] bg-white relative flex items-center justify-center gap-[1px]",children:[i.jsx("span",{className:"text-[4px] text-red-600 leading-none block pt-[1px]",children:""}),i.jsx("span",{className:"text-[4px] text-red-600 leading-none block pt-[1px]",children:""}),i.jsx("span",{className:"text-[4px] text-red-600 leading-none block pt-[1px]",children:""})]}),i.jsx("div",{className:"h-[33%] bg-black"})]}):i.jsx("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center text-[8px]",children:""})})]}),i.jsx("input",{type:"tel",value:b.mobile,onChange:W=>V("mobile",W.target.value),className:"flex-1 px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 text-slate-800 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm text-left font-mono",placeholder:"933XXXXXX",required:!0})]}),I.mobile&&i.jsx("p",{className:"text-red-500 text-[10px] mt-1 font-bold text-right",children:I.mobile[0]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:""}),i.jsx("input",{type:"number",value:b.age,onChange:W=>V("age",W.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all text-slate-800 dark:text-slate-100 text-center text-sm",min:"12",max:"100",required:!0}),I.age&&i.jsx("p",{className:"text-red-500 text-[10px] mt-1 font-bold",children:I.age[0]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:""}),i.jsxs("select",{value:b.gender,onChange:W=>V("gender",W.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all text-slate-800 dark:text-slate-100 text-sm appearance-none",required:!0,children:[i.jsx("option",{value:"male",className:"dark:bg-slate-800",children:" "}),i.jsx("option",{value:"female",className:"dark:bg-slate-800",children:" "})]})]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:" "}),i.jsx("input",{type:"password",value:b.password,onChange:W=>V("password",W.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all text-slate-800 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm",required:!0}),I.password&&i.jsx("p",{className:"text-red-500 text-[10px] mt-1 font-bold",children:I.password[0]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("label",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mr-1",children:"  "}),i.jsx("input",{type:"password",value:b.password_confirmation,onChange:W=>V("password_confirmation",W.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all text-slate-800 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm",required:!0})]}),i.jsx("button",{type:"submit",disabled:w,className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-emerald-500/30 active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:w?i.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:"  "}),i.jsx(s_,{size:20})]})})]}),i.jsx("div",{className:"text-center mt-6 mb-10",children:i.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["  "," ",i.jsx("button",{onClick:()=>T("/login"),className:"text-emerald-600 dark:text-emerald-400 font-bold hover:underline transition-colors",children:" "})]})})]})})}function Uj(){return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col items-center justify-center p-6 relative overflow-hidden transition-colors duration-300",dir:"rtl",children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full -mr-32 -mt-32 blur-3xl animate-pulse-slow"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-blue-500/10 rounded-full -ml-32 -mb-32 blur-3xl animate-pulse-slow delay-1000"}),i.jsxs("div",{className:"relative z-10 w-full max-w-sm flex flex-col items-center text-center",children:[i.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-3xl flex items-center justify-center text-white text-5xl font-black shadow-2xl shadow-emerald-500/30 mb-8 animate-float rotate-3",children:""}),i.jsx("h1",{className:"text-3xl font-black text-slate-800 dark:text-slate-100 mb-2",children:" "}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-12 text-lg",children:"    "}),i.jsxs("div",{className:"w-full space-y-4 animate-fade-in-up",children:[i.jsxs(xa,{to:"/login",className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-bold shadow-lg shadow-emerald-600/20 active:scale-[0.98] transition-all flex items-center justify-center gap-3",children:[i.jsx(Qy,{size:20})," "]}),i.jsxs(xa,{to:"/register",className:"w-full py-4 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 rounded-2xl font-bold shadow-sm hover:bg-slate-50 dark:hover:bg-slate-700 active:scale-[0.98] transition-all flex items-center justify-center gap-3",children:[i.jsx(s_,{size:20}),"  "]})]}),i.jsx("p",{className:"mt-8 text-xs text-slate-400 dark:text-slate-500",children:"  Beta 1.0.0"})]})]})}var nm={exports:{}};var qj=nm.exports,gy;function Gj(){return gy||(gy=1,(function(b,k){(function(w,P){b.exports=P()})(qj,(function(){var w={},P={};function I(T,c,V){if(P[T]=V,T==="index"){var W="var sharedModule = {}; ("+P.shared+")(sharedModule); ("+P.worker+")(sharedModule);",se={};return P.shared(se),P.index(w,se),typeof window<"u"&&w.setWorkerUrl(window.URL.createObjectURL(new Blob([W],{type:"text/javascript"}))),w}}I("shared",["exports"],(function(T){function c(s,e,r,a){return new(r||(r=Promise))((function(u,p){function f(N){try{v(a.next(N))}catch(C){p(C)}}function x(N){try{v(a.throw(N))}catch(C){p(C)}}function v(N){var C;N.done?u(N.value):(C=N.value,C instanceof r?C:new r((function(A){A(C)}))).then(f,x)}v((a=a.apply(s,e||[])).next())}))}function V(s,e){this.x=s,this.y=e}function W(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var se,ee;typeof SuppressedError=="function"&&SuppressedError,V.prototype={clone(){return new V(this.x,this.y)},add(s){return this.clone()._add(s)},sub(s){return this.clone()._sub(s)},multByPoint(s){return this.clone()._multByPoint(s)},divByPoint(s){return this.clone()._divByPoint(s)},mult(s){return this.clone()._mult(s)},div(s){return this.clone()._div(s)},rotate(s){return this.clone()._rotate(s)},rotateAround(s,e){return this.clone()._rotateAround(s,e)},matMult(s){return this.clone()._matMult(s)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(s){return this.x===s.x&&this.y===s.y},dist(s){return Math.sqrt(this.distSqr(s))},distSqr(s){const e=s.x-this.x,r=s.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith(s){return this.angleWithSep(s.x,s.y)},angleWithSep(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult(s){const e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add(s){return this.x+=s.x,this.y+=s.y,this},_sub(s){return this.x-=s.x,this.y-=s.y,this},_mult(s){return this.x*=s,this.y*=s,this},_div(s){return this.x/=s,this.y/=s,this},_multByPoint(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint(s){return this.x/=s.x,this.y/=s.y,this},_unit(){return this._div(this.mag()),this},_perp(){const s=this.y;return this.y=this.x,this.x=-s,this},_rotate(s){const e=Math.cos(s),r=Math.sin(s),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround(s,e){const r=Math.cos(s),a=Math.sin(s),u=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:V},V.convert=function(s){if(s instanceof V)return s;if(Array.isArray(s))return new V(+s[0],+s[1]);if(s.x!==void 0&&s.y!==void 0)return new V(+s.x,+s.y);throw new Error("Expected [x, y] or {x, y} point format")};var ne=(function(){if(ee)return se;function s(e,r,a,u){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=a,this.p2y=u}return ee=1,se=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,u=0;u<8;u++){var p=this.sampleCurveX(a)-e;if(Math.abs(p)<r)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=p/f}var x=0,v=1;for(a=e,u=0;u<20&&(p=this.sampleCurveX(a),!(Math.abs(p-e)<r));u++)e>p?x=a:v=a,a=.5*(v-x)+x;return a},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},se})(),ke=W(ne);let je,re;function H(){return je==null&&(je=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),je}function Ze(){if(re==null&&(re=!1,H())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<25;a++){const u=4*a;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let a=0;a<100;a++)if(a%4!=3&&r[a]!==a){re=!0;break}}}return re||!1}var Pe=1e-6,ze=typeof Float32Array<"u"?Float32Array:Array;function lt(){var s=new ze(9);return ze!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Nt(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function zt(){var s=new ze(3);return ze!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Ft(s){var e=s[0],r=s[1],a=s[2];return Math.sqrt(e*e+r*r+a*a)}function Vt(s,e,r){var a=new ze(3);return a[0]=s,a[1]=e,a[2]=r,a}function Zt(s,e,r){return s[0]=e[0]+r[0],s[1]=e[1]+r[1],s[2]=e[2]+r[2],s}function mt(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s}function fr(s,e,r){var a=e[0],u=e[1],p=e[2],f=r[0],x=r[1],v=r[2];return s[0]=u*v-p*x,s[1]=p*f-a*v,s[2]=a*x-u*f,s}var Kt,Wt=Ft;function Me(s,e,r){var a=e[0],u=e[1],p=e[2],f=e[3];return s[0]=r[0]*a+r[4]*u+r[8]*p+r[12]*f,s[1]=r[1]*a+r[5]*u+r[9]*p+r[13]*f,s[2]=r[2]*a+r[6]*u+r[10]*p+r[14]*f,s[3]=r[3]*a+r[7]*u+r[11]*p+r[15]*f,s}function Ct(){var s=new ze(4);return ze!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function it(s,e,r,a){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;e*=p,a*=p,r*=p;var f=Math.sin(e),x=Math.cos(e),v=Math.sin(r),N=Math.cos(r),C=Math.sin(a),A=Math.cos(a);switch(u){case"xyz":s[0]=f*N*A+x*v*C,s[1]=x*v*A-f*N*C,s[2]=x*N*C+f*v*A,s[3]=x*N*A-f*v*C;break;case"xzy":s[0]=f*N*A-x*v*C,s[1]=x*v*A-f*N*C,s[2]=x*N*C+f*v*A,s[3]=x*N*A+f*v*C;break;case"yxz":s[0]=f*N*A+x*v*C,s[1]=x*v*A-f*N*C,s[2]=x*N*C-f*v*A,s[3]=x*N*A+f*v*C;break;case"yzx":s[0]=f*N*A+x*v*C,s[1]=x*v*A+f*N*C,s[2]=x*N*C-f*v*A,s[3]=x*N*A-f*v*C;break;case"zxy":s[0]=f*N*A-x*v*C,s[1]=x*v*A+f*N*C,s[2]=x*N*C+f*v*A,s[3]=x*N*A-f*v*C;break;case"zyx":s[0]=f*N*A-x*v*C,s[1]=x*v*A+f*N*C,s[2]=x*N*C-f*v*A,s[3]=x*N*A+f*v*C;break;default:throw new Error("Unknown angle order "+u)}return s}function Tt(){var s=new ze(2);return ze!=Float32Array&&(s[0]=0,s[1]=0),s}function nt(s,e){var r=new ze(2);return r[0]=s,r[1]=e,r}zt(),Kt=new ze(4),ze!=Float32Array&&(Kt[0]=0,Kt[1]=0,Kt[2]=0,Kt[3]=0),zt(),Vt(1,0,0),Vt(0,1,0),Ct(),Ct(),lt(),Tt();const ht=8192;function pt(s,e,r){return e*(ht/(s.tileSize*Math.pow(2,r-s.tileID.overscaledZ)))}function Ce(s,e){return(s%e+e)%e}function Ye(s,e,r){return s*(1-r)+e*r}function qt(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,r=e*s;return 4*(s<.5?r:3*(s-e)+r-.75)}function Yt(s,e,r,a){const u=new ke(s,e,r,a);return p=>u.solve(p)}const wt=Yt(.25,.1,.25,1);function Ht(s,e,r){return Math.min(r,Math.max(e,s))}function At(s,e,r){const a=r-e,u=((s-e)%a+a)%a+e;return u===e?r:u}function er(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}let Sr=1;function Jr(s,e,r){const a={};for(const u in s)a[u]=e.call(this,s[u],u,s);return a}function _a(s,e,r){const a={};for(const u in s)e.call(this,s[u],u,s)&&(a[u]=s[u]);return a}function Qn(s){return Array.isArray(s)?s.map(Qn):typeof s=="object"&&s?Jr(s,Qn):s}const Oi={};function Cs(s){Oi[s]||(typeof console<"u"&&console.warn(s),Oi[s]=!0)}function Gn(s,e,r){return(r.y-s.y)*(e.x-s.x)>(e.y-s.y)*(r.x-s.x)}function ba(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let as=null;function fi(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const mi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Oa(s,e,r,a,u){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(s,{timestamp:0});try{const f=p?.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const x=f.startsWith("BGR"),v=new Uint8ClampedArray(a*u*4);if(yield p.copyTo(v,(function(N,C,A,L,O){const U=4*Math.max(-C,0),q=(Math.max(0,A)-A)*L*4+U,Z=4*L,te=Math.max(0,C),pe=Math.max(0,A);return{rect:{x:te,y:pe,width:Math.min(N.width,C+L)-te,height:Math.min(N.height,A+O)-pe},layout:[{offset:q,stride:Z}]}})(s,e,r,a,u)),x)for(let N=0;N<v.length;N+=4){const C=v[N];v[N]=v[N+2],v[N+2]=C}return v}finally{p.close()}}))}let Zn,Hn;function _o(s,e,r,a){return s.addEventListener(e,r,a),{unsubscribe:()=>{s.removeEventListener(e,r,a)}}}function bo(s){return s*Math.PI/180}function _n(s){return s/Math.PI*180}const Ae={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Y={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},X="AbortError";class ie extends Error{constructor(e=X){super(e instanceof Error?e.message:e),this.name=X,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function be(s){return s.name===X}const ve={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Le(s){return ve.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const Ie="global-dispatcher";class Se extends Error{constructor(e,r,a,u){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=u}}const $e=()=>ba(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,rt=function(s,e){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const a=Le(s.url);if(a)return a(s,e);if(ba(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:Ie},e)}if(!(/^file:/.test(r=s.url)||/^file:/.test($e())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(a,u){return c(this,void 0,void 0,(function*(){const p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:$e(),signal:u.signal});let f,x;a.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{f=yield fetch(p)}catch(N){throw be(N)?N:new Se(0,N.message,a.url,new Blob)}if(!f.ok){const N=yield f.blob();throw new Se(f.status,f.statusText,a.url,N)}x=a.type==="arrayBuffer"||a.type==="image"?f.arrayBuffer():a.type==="json"?f.json():f.text();const v=yield x;return u.signal.throwIfAborted(),{data:v,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}}))})(s,e);if(ba(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:Ie},e)}var r;return(function(a,u){return new Promise(((p,f)=>{var x;const v=new XMLHttpRequest;v.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(v.responseType="arraybuffer");for(const N in a.headers)v.setRequestHeader(N,a.headers[N]);a.type==="json"&&(v.responseType="text",!((x=a.headers)===null||x===void 0)&&x.Accept||v.setRequestHeader("Accept","application/json")),v.withCredentials=a.credentials==="include",v.onerror=()=>{f(new Error(v.statusText))},v.onload=()=>{if(!u.signal.aborted)if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let N=v.response;if(a.type==="json")try{N=JSON.parse(v.response)}catch(C){return void f(C)}p({data:N,cacheControl:v.getResponseHeader("Cache-Control"),expires:v.getResponseHeader("Expires")})}else{const N=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});f(new Se(v.status,v.statusText,a.url,N))}},u.signal.addEventListener("abort",(()=>{v.abort(),f(new ie(u.signal.reason))})),v.send(a.body)}))})(s,e)};function Qe(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const e=new URL(s),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function kt(s,e,r){r[s]&&r[s].indexOf(e)!==-1||(r[s]=r[s]||[],r[s].push(e))}function It(s,e,r){if(r&&r[s]){const a=r[s].indexOf(e);a!==-1&&r[s].splice(a,1)}}class Jt{constructor(e,r={}){er(this,r),this.type=e}}class wr extends Jt{constructor(e,r={}){super("error",er({error:e},r))}}class xr{on(e,r){return this._listeners=this._listeners||{},kt(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return It(e,r,this._listeners),It(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},kt(e,r,this._oneTimeListeners),this):new Promise((a=>this.once(e,a)))}fire(e,r){typeof e=="string"&&(e=new Jt(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const x of u)x.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const x of p)It(a,x,this._oneTimeListeners),x.call(this,e);const f=this._eventedParent;f&&(er(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof wr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Or=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function $s(s,e){const r={};for(const a in s)a!=="ref"&&(r[a]=s[a]);return Or.forEach((a=>{a in e&&(r[a]=e[a])})),r}function tr(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let r=0;r<s.length;r++)if(!tr(s[r],e[r]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const r in s)if(!tr(s[r],e[r]))return!1;return!0}return s===e}function Mr(s,e){s.push(e)}function Rs(s,e,r){Mr(r,{command:"addSource",args:[s,e[s]]})}function Gr(s,e,r){Mr(e,{command:"removeSource",args:[s]}),r[s]=!0}function Zr(s,e,r,a){Gr(s,r,a),Rs(s,e,r)}function Dr(s,e,r){let a;for(a in s[r])if(Object.prototype.hasOwnProperty.call(s[r],a)&&a!=="data"&&!tr(s[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!tr(s[r][a],e[r][a]))return!1;return!0}function ps(s,e,r,a,u,p){s=s||{},e=e||{};for(const f in s)Object.prototype.hasOwnProperty.call(s,f)&&(tr(s[f],e[f])||r.push({command:p,args:[a,f,e[f],u]}));for(const f in e)Object.prototype.hasOwnProperty.call(e,f)&&!Object.prototype.hasOwnProperty.call(s,f)&&(tr(s[f],e[f])||r.push({command:p,args:[a,f,e[f],u]}))}function sc(s){return s.id}function gi(s,e){return s[e.id]=e,s}class at{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function Us(s,...e){for(const r of e)for(const a in r)s[a]=r[a];return s}class en extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Kc{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,u]of r)this.bindings[a]=u}concat(e){return new Kc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ea={kind:"null"},_t={kind:"number"},nr={kind:"string"},ur={kind:"boolean"},Cn={kind:"color"},Jc={kind:"projectionDefinition"},Ba={kind:"object"},ar={kind:"value"},ml={kind:"collator"},gl={kind:"formatted"},Qc={kind:"padding"},xl={kind:"colorArray"},is={kind:"numberArray"},yl={kind:"resolvedImage"},vo={kind:"variableAnchorOffsetCollection"};function on(s,e){return{kind:"array",itemType:s,N:e}}function Tr(s){if(s.kind==="array"){const e=Tr(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const eu=[ea,_t,nr,ur,Cn,Jc,gl,Ba,on(ar),Qc,is,xl,yl,vo];function wo(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!wo(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const r of eu)if(!wo(r,e))return null}}return`Expected ${Tr(s)} but found ${Tr(e)} instead.`}function Bi(s,e){return e.some((r=>r.kind===s.kind))}function ln(s,e){return e.some((r=>r==="null"?s===null:r==="array"?Array.isArray(s):r==="object"?s&&!Array.isArray(s)&&typeof s=="object":r===typeof s))}function va(s,e){return s.kind==="array"&&e.kind==="array"?s.itemType.kind===e.itemType.kind&&typeof s.N=="number":s.kind===e.kind}const ta=.96422,ko=.82521,tu=4/29,gs=6/29,nc=3*gs*gs,ac=gs*gs*gs,xi=Math.PI/180,ic=180/Math.PI;function uh(s){return(s%=360)<0&&(s+=360),s}function dh([s,e,r,a]){let u,p;const f=ru((.2225045*(s=_l(s))+.7168786*(e=_l(e))+.0606169*(r=_l(r)))/1);s===e&&e===r?u=p=f:(u=ru((.4360747*s+.3850649*e+.1430804*r)/ta),p=ru((.0139322*s+.0971045*e+.7141733*r)/ko));const x=116*f-16;return[x<0?0:x,500*(u-f),200*(f-p),a]}function _l(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function ru(s){return s>ac?Math.pow(s,1/3):s/nc+tu}function oc([s,e,r,a]){let u=(s+16)/116,p=isNaN(e)?u:u+e/500,f=isNaN(r)?u:u-r/200;return u=1*od(u),p=ta*od(p),f=ko*od(f),[jo(3.1338561*p-1.6168667*u-.4906146*f),jo(-.9787684*p+1.9161415*u+.033454*f),jo(.0719453*p-.2289914*u+1.4052427*f),a]}function jo(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function od(s){return s>gs?s*s*s:nc*(s-tu)}const ld=Object.hasOwn||function(s,e){return Object.prototype.hasOwnProperty.call(s,e)};function Nr(s,e){return ld(s,e)?s[e]:void 0}function lc(s){return parseInt(s.padEnd(2,s),16)/255}function cd(s,e){return Vi(e?s/100:s,0,1)}function Vi(s,e,r){return Math.min(Math.max(e,s),r)}function su(s){return!s.some(Number.isNaN)}const bl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function yi(s,e,r){return s+r*(e-s)}function $i(s,e,r){return s.map(((a,u)=>yi(a,e[u],r)))}class ir{constructor(e,r,a,u=1,p=!0){this.r=e,this.g=r,this.b=a,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,r,a,u]))}static parse(e){if(e instanceof ir)return e;if(typeof e!="string")return;const r=(function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Nr(bl,a);if(u){const[f,x,v]=u;return[f/255,x/255,v/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const f=a.length<6?1:2;let x=1;return[lc(a.slice(x,x+=f)),lc(a.slice(x,x+=f)),lc(a.slice(x,x+=f)),lc(a.slice(x,x+f)||"ff")]}if(a.startsWith("rgb")){const f=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[x,v,N,C,A,L,O,U,q,Z,te,pe]=f,ae=[C||" ",O||" ",Z].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const oe=[N,L,q].join(""),fe=oe==="%%%"?100:oe===""?255:0;if(fe){const _e=[Vi(+v/fe,0,1),Vi(+A/fe,0,1),Vi(+U/fe,0,1),te?cd(+te,pe):1];if(su(_e))return _e}}return}}const p=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[f,x,v,N,C,A,L,O,U]=p,q=[v||" ",C||" ",L].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const Z=[+x,Vi(+N,0,100),Vi(+A,0,100),O?cd(+O,U):1];if(su(Z))return(function([te,pe,ae,oe]){function fe(_e){const De=(_e+te/30)%12,Je=pe*Math.min(ae,1-ae);return ae-Je*Math.max(-1,Math.min(De-3,9-De,1))}return te=uh(te),pe/=100,ae/=100,[fe(0),fe(8),fe(4),oe]})(Z)}}})(e);return r?new ir(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[e/p,r/p,a/p,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[r,a,u,p]=dh(e),f=Math.sqrt(a*a+u*u);return[Math.round(1e4*f)?uh(Math.atan2(u,a)*ic):NaN,f,r,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",dh(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,u]=this.rgb;return`rgba(${[e,r,a].map((p=>Math.round(255*p))).join(",")},${u})`}static interpolate(e,r,a,u="rgb"){switch(u){case"rgb":{const[p,f,x,v]=$i(e.rgb,r.rgb,a);return new ir(p,f,x,v,!1)}case"hcl":{const[p,f,x,v]=e.hcl,[N,C,A,L]=r.hcl;let O,U;if(isNaN(p)||isNaN(N))isNaN(p)?isNaN(N)?O=NaN:(O=N,x!==1&&x!==0||(U=C)):(O=p,A!==1&&A!==0||(U=f));else{let ae=N-p;N>p&&ae>180?ae-=360:N<p&&p-N>180&&(ae+=360),O=p+a*ae}const[q,Z,te,pe]=(function([ae,oe,fe,_e]){return ae=isNaN(ae)?0:ae*xi,oc([fe,Math.cos(ae)*oe,Math.sin(ae)*oe,_e])})([O,U??yi(f,C,a),yi(x,A,a),yi(v,L,a)]);return new ir(q,Z,te,pe,!1)}case"lab":{const[p,f,x,v]=oc($i(e.lab,r.lab,a));return new ir(p,f,x,v,!1)}}}}ir.black=new ir(0,0,0,1),ir.white=new ir(1,1,1,1),ir.transparent=new ir(0,0,0,0),ir.red=new ir(1,0,0,1);class Va{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ui=["bottom","center","top"];class $a{constructor(e,r,a,u,p,f){this.text=e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=p,this.verticalAlign=f}}class qs{constructor(e){this.sections=e}static fromString(e){return new qs([new $a(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof qs?e:qs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Ps{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ps)return e;if(typeof e=="number")return new Ps([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Ps(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,a){return new Ps($i(e.values,r.values,a))}}class Ir{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ir)return e;if(typeof e=="number")return new Ir([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new Ir(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,a){return new Ir($i(e.values,r.values,a))}}class Xt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Xt)return e;if(typeof e=="string"){const a=ir.parse(e);return a?new Xt([a]):void 0}if(!Array.isArray(e))return;const r=[];for(const a of e){if(typeof a!="string")return;const u=ir.parse(a);if(!u)return;r.push(u)}return new Xt(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,a,u="rgb"){const p=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let f=0;f<e.values.length;f++)p.push(ir.interpolate(e.values[f],r.values[f],a,u));return new Xt(p)}}class Br extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const ra=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class bn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof bn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const a=e[r],u=e[r+1];if(typeof a!="string"||!ra.has(a)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new bn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,a){const u=e.values,p=r.values;if(u.length!==p.length)throw new Br(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const f=[];for(let x=0;x<u.length;x+=2){if(u[x]!==p[x])throw new Br(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${u[x]}, to[${x}]: ${p[x]}`);f.push(u[x]);const[v,N]=u[x+1],[C,A]=p[x+1];f.push([yi(v,C,a),yi(N,A,a)])}return new bn(f)}}class Pn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Pn({name:e,available:!1}):null}}class Gs{constructor(e,r,a){this.from=e,this.to=r,this.transition=a}static interpolate(e,r,a){return new Gs(e,r,a)}static parse(e){return e instanceof Gs?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Gs(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Gs(e.from,e.to,e.transition):typeof e=="string"?new Gs(e,e,1):void 0}}function So(s,e,r,a){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[s,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[s,e,r,a]:[s,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qi(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Gs||s instanceof ir||s instanceof Va||s instanceof qs||s instanceof Ps||s instanceof Ir||s instanceof Xt||s instanceof bn||s instanceof Pn)return!0;if(Array.isArray(s)){for(const e of s)if(!qi(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!qi(s[e]))return!1;return!0}return!1}function Qr(s){if(s===null)return ea;if(typeof s=="string")return nr;if(typeof s=="boolean")return ur;if(typeof s=="number")return _t;if(s instanceof ir)return Cn;if(s instanceof Gs)return Jc;if(s instanceof Va)return ml;if(s instanceof qs)return gl;if(s instanceof Ps)return Qc;if(s instanceof Ir)return is;if(s instanceof Xt)return xl;if(s instanceof bn)return vo;if(s instanceof Pn)return yl;if(Array.isArray(s)){const e=s.length;let r;for(const a of s){const u=Qr(a);if(r){if(r===u)continue;r=ar;break}r=u}return on(r||ar,e)}return Ba}function wa(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof ir||s instanceof Gs||s instanceof qs||s instanceof Ps||s instanceof Ir||s instanceof Xt||s instanceof bn||s instanceof Pn?s.toString():JSON.stringify(s)}class vn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!qi(e[1]))return r.error("invalid value");const a=e[1];let u=Qr(a);const p=r.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new vn(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const To={string:nr,number:_t,boolean:ur,object:Ba};class Mn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1;const p=e[0];if(p==="array"){let x,v;if(e.length>2){const N=e[1];if(typeof N!="string"||!(N in To)||N==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=To[N],u++}else x=ar;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],u++}a=on(x,v)}else{if(!To[p])throw new Error(`Types doesn't contain name = ${p}`);a=To[p]}const f=[];for(;u<e.length;u++){const x=r.parse(e[u],u,ar);if(!x)return null;f.push(x)}return new Mn(a,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!wo(this.type,Qr(a)))return a;if(r===this.args.length-1)throw new Br(`Expected value to be of type ${Tr(this.type)}, but found ${Tr(Qr(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const No={"to-boolean":ur,"to-color":Cn,"to-number":_t,"to-string":nr};class ka{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!No[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=No[a],p=[];for(let f=1;f<e.length;f++){const x=r.parse(e[f],f,ar);if(!x)return null;p.push(x)}return new ka(u,p)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,a;for(const u of this.args){if(r=u.evaluate(e),a=null,r instanceof ir)return r;if(typeof r=="string"){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:So(r[0],r[1],r[2],r[3]),!a))return new ir(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Br(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(e);const u=Ps.parse(r);if(u)return u}throw new Br(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const a of this.args){r=a.evaluate(e);const u=Ir.parse(r);if(u)return u}throw new Br(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const a of this.args){r=a.evaluate(e);const u=Xt.parse(r);if(u)return u}throw new Br(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(e);const u=bn.parse(r);if(u)return u}throw new Br(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Br(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return qs.fromString(wa(this.args[0].evaluate(e)));case"resolvedImage":return Pn.fromString(wa(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return wa(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const cc=["Unknown","Point","LineString","Polygon"];class uc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=ir.parse(e),this._parseColorCache.set(e,r)),r}}class Gi{constructor(e,r,a=[],u,p=new Kc,f=[]){this.registry=e,this.path=a,this.key=a.map((x=>`[${x}]`)).join(""),this.scope=p,this.errors=f,this.expectedType=u,this._isConstant=r}parse(e,r,a,u,p={}){return r?this.concat(r,a,u)._parse(e,p):this._parse(e,p)}_parse(e,r){function a(u,p,f){return f==="assert"?new Mn(p,[u]):f==="coerce"?new ka(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let f=p.parse(e,this);if(!f)return null;if(this.expectedType){const x=this.expectedType,v=f.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||v.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(v.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(v.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(v.kind)||x.kind==="colorArray"&&["value","string","array"].includes(v.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(v.kind))f=a(f,x,r.typeAnnotation||"coerce");else if(this.checkSubtype(x,v))return null}else f=a(f,x,r.typeAnnotation||"assert")}if(!(f instanceof vn)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const x=new uc;try{f=new vn(f.type,f.evaluate(x))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const u=typeof e=="number"?this.path.concat(e):this.path,p=a?this.scope.concat(a):this.scope;return new Gi(this.registry,this._isConstant,u,r||null,p,this.errors)}error(e,...r){const a=`${this.key}${r.map((u=>`[${u}]`)).join("")}`;this.errors.push(new en(a,e))}checkSubtype(e,r){const a=wo(e,r);return a&&this.error(a),a}}class br{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let p=1;p<e.length-1;p+=2){const f=e[p];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,p);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=r.parse(e[p+1],p+1);if(!x)return null;a.push([f,x])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new br(a,u):null}outputDefined(){return this.result.outputDefined()}}class Zi{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new Zi(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class pr{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,_t),u=r.parse(e[2],2,on(r.expectedType||ar));return a&&u?new pr(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Br(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Br(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Br(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class or{constructor(e,r){this.type=ur,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ar),u=r.parse(e[2],2,ar);return a&&u?Bi(a.type,[ur,nr,_t,ea,ar])?new or(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!ln(r,["boolean","string","number","null"]))throw new Br(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Qr(r))} instead.`);if(!ln(a,["string","array"]))throw new Br(`Expected second argument to be of type array or string, but found ${Tr(Qr(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class _i{constructor(e,r,a){this.type=_t,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ar),u=r.parse(e[2],2,ar);if(!a||!u)return null;if(!Bi(a.type,[ur,nr,_t,ea,ar]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(a.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,_t);return p?new _i(a,u,p):null}return new _i(a,u)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!ln(r,["boolean","string","number","null"]))throw new Br(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Qr(r))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),ln(a,["string"])){const p=a.indexOf(r,u);return p===-1?-1:[...a.slice(0,p)].length}if(ln(a,["array"]))return a.indexOf(r,u);throw new Br(`Expected second argument to be of type array or string, but found ${Tr(Qr(a))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class mr{constructor(e,r,a,u,p,f){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=p,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const p={},f=[];for(let N=2;N<e.length-1;N+=2){let C=e[N];const A=e[N+1];Array.isArray(C)||(C=[C]);const L=r.concat(N);if(C.length===0)return L.error("Expected at least one branch label.");for(const U of C){if(typeof U!="number"&&typeof U!="string")return L.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return L.error("Numeric branch labels must be integer values.");if(a){if(L.checkSubtype(a,Qr(U)))return null}else a=Qr(U);if(p[String(U)]!==void 0)return L.error("Branch labels must be unique.");p[String(U)]=f.length}const O=r.parse(A,N,u);if(!O)return null;u=u||O.type,f.push(O)}const x=r.parse(e[1],1,ar);if(!x)return null;const v=r.parse(e[e.length-1],e.length-1,u);return v?x.type.kind!=="value"&&r.concat(1).checkSubtype(a,x.type)?null:new mr(a,u,x,p,f,v):null}evaluate(e){const r=this.input.evaluate(e);return(Qr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class vl{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u=[];for(let f=1;f<e.length-1;f+=2){const x=r.parse(e[f],f,ur);if(!x)return null;const v=r.parse(e[f+1],f+1,a);if(!v)return null;u.push([x,v]),a=a||v.type}const p=r.parse(e[e.length-1],e.length-1,a);if(!p)return null;if(!a)throw new Error("Can't infer output type");return new vl(a,u,p)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every((([e,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class fs{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ar),u=r.parse(e[2],2,_t);if(!a||!u)return null;if(!Bi(a.type,[on(ar),nr,ar]))return r.error(`Expected first argument to be of type array or string, but found ${Tr(a.type)} instead`);if(e.length===4){const p=r.parse(e[3],3,_t);return p?new fs(a.type,a,u,p):null}return new fs(a.type,a,u)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),ln(r,["string"]))return[...r].slice(a,u).join("");if(ln(r,["array"]))return r.slice(a,u);throw new Br(`Expected first argument to be of type array or string, but found ${Tr(Qr(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ja(s,e){const r=s.length-1;let a,u,p=0,f=r,x=0;for(;p<=f;)if(x=Math.floor((p+f)/2),a=s[x],u=s[x+1],a<=e){if(x===r||e<u)return x;p=x+1}else{if(!(a>e))throw new Br("Input is not a number.");f=x-1}return 0}class Ua{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,p]of a)this.labels.push(u),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,_t);if(!a)return null;const u=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let f=1;f<e.length;f+=2){const x=f===1?-1/0:e[f],v=e[f+1],N=f,C=f+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(u.length&&u[u.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const A=r.parse(v,C,p);if(!A)return null;p=p||A.type,u.push([x,A])}return new Ua(p,a,u)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const p=r.length;return u>=r[p-1]?a[p-1].evaluate(e):a[ja(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function wl(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var dc,hc,ud=(function(){if(hc)return dc;function s(e,r,a,u){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=a,this.p2y=u}return hc=1,dc=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,u=0;u<8;u++){var p=this.sampleCurveX(a)-e;if(Math.abs(p)<r)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=p/f}var x=0,v=1;for(a=e,u=0;u<20&&(p=this.sampleCurveX(a),!(Math.abs(p-e)<r));u++)e>p?x=a:v=a,a=.5*(v-x)+x;return a},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},dc})(),kl=wl(ud);class Zs{constructor(e,r,a,u,p){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[f,x]of p)this.labels.push(f),this.outputs.push(x)}static interpolationFactor(e,r,a,u){let p=0;if(e.name==="exponential")p=Sa(r,e.base,a,u);else if(e.name==="linear")p=Sa(r,1,a,u);else if(e.name==="cubic-bezier"){const f=e.controlPoints;p=new kl(f[0],f[1],f[2],f[3]).solve(Sa(r,1,a,u))}return p}static parse(e,r){let[a,u,p,...f]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const N=u[1];if(typeof N!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:N}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const N=u.slice(1);if(N.length!==4||N.some((C=>typeof C!="number"||C<0||C>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:N}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,_t),!p)return null;const x=[];let v=null;a!=="interpolate-hcl"&&a!=="interpolate-lab"||r.expectedType==xl?r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType):v=Cn;for(let N=0;N<f.length;N+=2){const C=f[N],A=f[N+1],L=N+3,O=N+4;if(typeof C!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(x.length&&x[x.length-1][0]>=C)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const U=r.parse(A,O,v);if(!U)return null;v=v||U.type,x.push([C,U])}return va(v,_t)||va(v,Jc)||va(v,Cn)||va(v,Qc)||va(v,is)||va(v,xl)||va(v,vo)||va(v,on(_t))?new Zs(v,a,u,p,x):r.error(`Type ${Tr(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const p=r.length;if(u>=r[p-1])return a[p-1].evaluate(e);const f=ja(r,u),x=Zs.interpolationFactor(this.interpolation,u,r[f],r[f+1]),v=a[f].evaluate(e),N=a[f+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return yi(v,N,x);case"color":return ir.interpolate(v,N,x);case"padding":return Ps.interpolate(v,N,x);case"colorArray":return Xt.interpolate(v,N,x);case"numberArray":return Ir.interpolate(v,N,x);case"variableAnchorOffsetCollection":return bn.interpolate(v,N,x);case"array":return $i(v,N,x);case"projectionDefinition":return Gs.interpolate(v,N,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return ir.interpolate(v,N,x,"hcl");case"colorArray":return Xt.interpolate(v,N,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ir.interpolate(v,N,x,"lab");case"colorArray":return Xt.interpolate(v,N,x,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Sa(s,e,r,a){const u=a-r,p=s-r;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}const os={color:ir.interpolate,number:yi,padding:Ps.interpolate,numberArray:Ir.interpolate,colorArray:Xt.interpolate,variableAnchorOffsetCollection:bn.interpolate,array:$i};class Eo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a=null;const u=r.expectedType;u&&u.kind!=="value"&&(a=u);const p=[];for(const x of e.slice(1)){const v=r.parse(x,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!v)return null;a=a||v.type,p.push(v)}if(!a)throw new Error("No output type");const f=u&&p.some((x=>wo(u,x.type)));return new Eo(f?ar:a,p)}evaluate(e){let r,a=null,u=0;for(const p of this.args)if(u++,a=p.evaluate(e),a&&a instanceof Pn&&!a.available&&(r||(r=a.name),a=null,u===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function dd(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Co(s,e,r,a){return a.compare(e,r)===0}function xs(s,e,r){const a=s!=="=="&&s!=="!=";return class M_{constructor(p,f,x){this.type=ur,this.lhs=p,this.rhs=f,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||f.type.kind==="value"}static parse(p,f){if(p.length!==3&&p.length!==4)return f.error("Expected two or three arguments.");const x=p[0];let v=f.parse(p[1],1,ar);if(!v)return null;if(!dd(x,v.type))return f.concat(1).error(`"${x}" comparisons are not supported for type '${Tr(v.type)}'.`);let N=f.parse(p[2],2,ar);if(!N)return null;if(!dd(x,N.type))return f.concat(2).error(`"${x}" comparisons are not supported for type '${Tr(N.type)}'.`);if(v.type.kind!==N.type.kind&&v.type.kind!=="value"&&N.type.kind!=="value")return f.error(`Cannot compare types '${Tr(v.type)}' and '${Tr(N.type)}'.`);a&&(v.type.kind==="value"&&N.type.kind!=="value"?v=new Mn(N.type,[v]):v.type.kind!=="value"&&N.type.kind==="value"&&(N=new Mn(v.type,[N])));let C=null;if(p.length===4){if(v.type.kind!=="string"&&N.type.kind!=="string"&&v.type.kind!=="value"&&N.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(C=f.parse(p[3],3,ml),!C)return null}return new M_(v,N,C)}evaluate(p){const f=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){const v=Qr(f),N=Qr(x);if(v.kind!==N.kind||v.kind!=="string"&&v.kind!=="number")throw new Br(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${v.kind}, ${N.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const v=Qr(f),N=Qr(x);if(v.kind!=="string"||N.kind!=="string")return e(p,f,x)}return this.collator?r(p,f,x,this.collator.evaluate(p)):e(p,f,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const hh=xs("==",(function(s,e,r){return e===r}),Co),hd=xs("!=",(function(s,e,r){return e!==r}),(function(s,e,r,a){return!Co(0,e,r,a)})),ph=xs("<",(function(s,e,r){return e<r}),(function(s,e,r,a){return a.compare(e,r)<0})),np=xs(">",(function(s,e,r){return e>r}),(function(s,e,r,a){return a.compare(e,r)>0})),Po=xs("<=",(function(s,e,r){return e<=r}),(function(s,e,r,a){return a.compare(e,r)<=0})),nu=xs(">=",(function(s,e,r){return e>=r}),(function(s,e,r,a){return a.compare(e,r)>=0}));class jl{constructor(e,r,a){this.type=ml,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const u=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ur);if(!u)return null;const p=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ur);if(!p)return null;let f=null;return a.locale&&(f=r.parse(a.locale,1,nr),!f)?null:new jl(u,p,f)}evaluate(e){return new Va(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class pd{constructor(e,r,a,u,p){this.type=nr,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,_t);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=r.parse(u.locale,1,nr),!p))return null;let f=null;if(u.currency&&(f=r.parse(u.currency,1,nr),!f))return null;let x=null;if(u["min-fraction-digits"]&&(x=r.parse(u["min-fraction-digits"],1,_t),!x))return null;let v=null;return u["max-fraction-digits"]&&(v=r.parse(u["max-fraction-digits"],1,_t),!v)?null:new pd(a,p,f,x,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class pc{constructor(e){this.type=gl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const u=[];let p=!1;for(let f=1;f<=e.length-1;++f){const x=e[f];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let v=null;if(x["font-scale"]&&(v=r.parse(x["font-scale"],1,_t),!v))return null;let N=null;if(x["text-font"]&&(N=r.parse(x["text-font"],1,on(nr)),!N))return null;let C=null;if(x["text-color"]&&(C=r.parse(x["text-color"],1,Cn),!C))return null;let A=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!Ui.includes(x["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(A=r.parse(x["vertical-align"],1,nr),!A)return null}const L=u[u.length-1];L.scale=v,L.font=N,L.textColor=C,L.verticalAlign=A}else{const v=r.parse(e[f],1,ar);if(!v)return null;const N=v.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:v,scale:null,font:null,textColor:null,verticalAlign:null})}}return new pc(u)}evaluate(e){return new qs(this.sections.map((r=>{const a=r.content.evaluate(e);return Qr(a)===yl?new $a("",a,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new $a(wa(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class Hi{constructor(e){this.type=yl,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,nr);return a?new Hi(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=Pn.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class Sl{constructor(e){this.type=_t,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Tr(a.type)} instead.`):new Sl(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Br(`Expected value to be of type string or array, but found ${Tr(Qr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ms=8192;function fh(s,e){const r=(180+s[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Ms),Math.round(a*u*Ms)]}function Mo(s,e){const r=Math.pow(2,e.z);return[(u=(s[0]/Ms+e.x)/r,360*u-180),(a=(s[1]/Ms+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,u}function fc(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Io(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function ap(s,e,r){const a=s[0]-e[0],u=s[1]-e[1],p=s[0]-r[0],f=s[1]-r[1];return a*f-p*u==0&&a*p<=0&&u*f<=0}function au(s,e,r,a){return(u=[a[0]-r[0],a[1]-r[1]])[0]*(p=[e[0]-s[0],e[1]-s[1]])[1]-u[1]*p[0]!=0&&!(!fd(s,e,r,a)||!fd(r,a,s,e));var u,p}function ip(s,e,r){for(const a of r)for(let u=0;u<a.length-1;++u)if(au(s,e,a[u],a[u+1]))return!0;return!1}function Tl(s,e,r=!1){let a=!1;for(const x of e)for(let v=0;v<x.length-1;v++){if(ap(s,x[v],x[v+1]))return r;(p=x[v])[1]>(u=s)[1]!=(f=x[v+1])[1]>u[1]&&u[0]<(f[0]-p[0])*(u[1]-p[1])/(f[1]-p[1])+p[0]&&(a=!a)}var u,p,f;return a}function iu(s,e){for(const r of e)if(Tl(s,r))return!0;return!1}function ou(s,e){for(const r of s)if(!Tl(r,e))return!1;for(let r=0;r<s.length-1;++r)if(ip(s[r],s[r+1],e))return!1;return!0}function Nl(s,e){for(const r of e)if(ou(s,r))return!0;return!1}function fd(s,e,r,a){const u=a[0]-r[0],p=a[1]-r[1],f=(s[0]-r[0])*p-u*(s[1]-r[1]),x=(e[0]-r[0])*p-u*(e[1]-r[1]);return f>0&&x<0||f<0&&x>0}function lu(s,e,r){const a=[];for(let u=0;u<s.length;u++){const p=[];for(let f=0;f<s[u].length;f++){const x=fh(s[u][f],r);fc(e,x),p.push(x)}a.push(p)}return a}function cu(s,e,r){const a=[];for(let u=0;u<s.length;u++){const p=lu(s[u],e,r);a.push(p)}return a}function md(s,e,r,a){if(s[0]<r[0]||s[0]>r[2]){const u=.5*a;let p=s[0]-r[0]>u?-a:r[0]-s[0]>u?a:0;p===0&&(p=s[0]-r[2]>u?-a:r[2]-s[0]>u?a:0),s[0]+=p}fc(e,s)}function gd(s,e,r,a){const u=Math.pow(2,a.z)*Ms,p=[a.x*Ms,a.y*Ms],f=[];for(const x of s)for(const v of x){const N=[v.x+p[0],v.y+p[1]];md(N,e,r,u),f.push(N)}return f}function xd(s,e,r,a){const u=Math.pow(2,a.z)*Ms,p=[a.x*Ms,a.y*Ms],f=[];for(const v of s){const N=[];for(const C of v){const A=[C.x+p[0],C.y+p[1]];fc(e,A),N.push(A)}f.push(N)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const v of f)for(const N of v)md(N,e,r,u)}var x;return f}class sa{constructor(e,r){this.type=ur,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(qi(e[1])){const a=e[1];if(a.type==="FeatureCollection"){const u=[];for(const p of a.features){const{type:f,coordinates:x}=p.geometry;f==="Polygon"&&u.push(x),f==="MultiPolygon"&&u.push(...x)}if(u.length)return new sa(a,{type:"MultiPolygon",coordinates:u})}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new sa(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new sa(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,a){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(a.type==="Polygon"){const x=lu(a.coordinates,p,f),v=gd(r.geometry(),u,p,f);if(!Io(u,p))return!1;for(const N of v)if(!Tl(N,x))return!1}if(a.type==="MultiPolygon"){const x=cu(a.coordinates,p,f),v=gd(r.geometry(),u,p,f);if(!Io(u,p))return!1;for(const N of v)if(!iu(N,x))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,a){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(a.type==="Polygon"){const x=lu(a.coordinates,p,f),v=xd(r.geometry(),u,p,f);if(!Io(u,p))return!1;for(const N of v)if(!ou(N,x))return!1}if(a.type==="MultiPolygon"){const x=cu(a.coordinates,p,f),v=xd(r.geometry(),u,p,f);if(!Io(u,p))return!1;for(const N of v)if(!Nl(N,x))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let mh=class{constructor(s=[],e=(r,a)=>r<a?-1:r>a?1:0){if(this.data=s,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:e,compare:r}=this,a=e[s];for(;s>0;){const u=s-1>>1,p=e[u];if(r(a,p)>=0)break;e[s]=p,s=u}e[s]=a}_down(s){const{data:e,compare:r}=this,a=this.length>>1,u=e[s];for(;s<a;){let p=1+(s<<1);const f=p+1;if(f<this.length&&r(e[f],e[p])<0&&(p=f),r(e[p],u)>=0)break;e[s]=e[p],s=p}e[s]=u}};function yd(s,e,r=0,a=s.length-1,u=_d){for(;a>r;){if(a-r>600){const v=a-r+1,N=e-r+1,C=Math.log(v),A=.5*Math.exp(2*C/3),L=.5*Math.sqrt(C*A*(v-A)/v)*(N-v/2<0?-1:1);yd(s,e,Math.max(r,Math.floor(e-N*A/v+L)),Math.min(a,Math.floor(e+(v-N)*A/v+L)),u)}const p=s[e];let f=r,x=a;for(El(s,r,e),u(s[a],p)>0&&El(s,r,a);f<x;){for(El(s,f,x),f++,x--;u(s[f],p)<0;)f++;for(;u(s[x],p)>0;)x--}u(s[r],p)===0?El(s,r,x):(x++,El(s,x,a)),x<=e&&(r=x+1),e<=x&&(a=x-1)}}function El(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}function _d(s,e){return s<e?-1:s>e?1:0}function mc(s,e){if(s.length<=1)return[s];const r=[];let a,u;for(const p of s){const f=xc(p);f!==0&&(p.area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(a&&r.push(a),a=[p]):a.push(p))}if(a&&r.push(a),e>1)for(let p=0;p<r.length;p++)r[p].length<=e||(yd(r[p],e,1,r[p].length-1,gc),r[p]=r[p].slice(0,e));return r}function gc(s,e){return e.area-s.area}function xc(s){let e=0;for(let r,a,u=0,p=s.length,f=p-1;u<p;f=u++)r=s[u],a=s[f],e+=(a.x-r.x)*(r.y+a.y);return e}const gh=1/298.257223563,Wi=gh*(2-gh),xh=Math.PI/180;class uu{constructor(e){const r=6378.137*xh*1e3,a=Math.cos(e*xh),u=1/(1-Wi*(1-a*a)),p=Math.sqrt(u);this.kx=r*p*a,this.ky=r*p*u*(1-Wi)}distance(e,r){const a=this.wrap(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(a*a+u*u)}pointOnLine(e,r){let a,u,p,f,x=1/0;for(let v=0;v<e.length-1;v++){let N=e[v][0],C=e[v][1],A=this.wrap(e[v+1][0]-N)*this.kx,L=(e[v+1][1]-C)*this.ky,O=0;A===0&&L===0||(O=(this.wrap(r[0]-N)*this.kx*A+(r[1]-C)*this.ky*L)/(A*A+L*L),O>1?(N=e[v+1][0],C=e[v+1][1]):O>0&&(N+=A/this.kx*O,C+=L/this.ky*O)),A=this.wrap(r[0]-N)*this.kx,L=(r[1]-C)*this.ky;const U=A*A+L*L;U<x&&(x=U,a=N,u=C,p=v,f=O)}return{point:[a,u],index:p,t:Math.max(0,Math.min(1,f))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function du(s,e){return e[0]-s[0]}function Cl(s){return s[1]-s[0]+1}function na(s,e){return s[1]>=s[0]&&s[1]<e}function yc(s,e){if(s[0]>s[1])return[null,null];const r=Cl(s);if(e){if(r===2)return[s,null];const u=Math.floor(r/2);return[[s[0],s[0]+u],[s[0]+u,s[1]]]}if(r===1)return[s,null];const a=Math.floor(r/2)-1;return[[s[0],s[0]+a],[s[0]+a+1,s[1]]]}function hu(s,e){if(!na(e,s.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let a=e[0];a<=e[1];++a)fc(r,s[a]);return r}function bd(s){const e=[1/0,1/0,-1/0,-1/0];for(const r of s)for(const a of r)fc(e,a);return e}function vd(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function pu(s,e,r){if(!vd(s)||!vd(e))return NaN;let a=0,u=0;return s[2]<e[0]&&(a=e[0]-s[2]),s[0]>e[2]&&(a=s[0]-e[2]),s[1]>e[3]&&(u=s[1]-e[3]),s[3]<e[1]&&(u=e[1]-s[3]),r.distance([0,0],[a,u])}function zo(s,e,r){const a=r.pointOnLine(e,s);return r.distance(s,a.point)}function wd(s,e,r,a,u){const p=Math.min(zo(s,[r,a],u),zo(e,[r,a],u)),f=Math.min(zo(r,[s,e],u),zo(a,[s,e],u));return Math.min(p,f)}function Ta(s,e,r,a,u){if(!na(e,s.length)||!na(a,r.length))return 1/0;let p=1/0;for(let f=e[0];f<e[1];++f){const x=s[f],v=s[f+1];for(let N=a[0];N<a[1];++N){const C=r[N],A=r[N+1];if(au(x,v,C,A))return 0;p=Math.min(p,wd(x,v,C,A,u))}}return p}function Pl(s,e,r,a,u){if(!na(e,s.length)||!na(a,r.length))return NaN;let p=1/0;for(let f=e[0];f<=e[1];++f)for(let x=a[0];x<=a[1];++x)if(p=Math.min(p,u.distance(s[f],r[x])),p===0)return p;return p}function yh(s,e,r){if(Tl(s,e,!0))return 0;let a=1/0;for(const u of e){const p=u[0],f=u[u.length-1];if(p!==f&&(a=Math.min(a,zo(s,[f,p],r)),a===0))return a;const x=r.pointOnLine(u,s);if(a=Math.min(a,r.distance(s,x.point)),a===0)return a}return a}function _h(s,e,r,a){if(!na(e,s.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Tl(s[p],r,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p){const f=s[p],x=s[p+1];for(const v of r)for(let N=0,C=v.length,A=C-1;N<C;A=N++){const L=v[A],O=v[N];if(au(f,x,L,O))return 0;u=Math.min(u,wd(f,x,L,O,a))}}return u}function kd(s,e){for(const r of s)for(const a of r)if(Tl(a,e,!0))return!0;return!1}function bh(s,e,r,a=1/0){const u=bd(s),p=bd(e);if(a!==1/0&&pu(u,p,r)>=a)return a;if(Io(u,p)){if(kd(s,e))return 0}else if(kd(e,s))return 0;let f=1/0;for(const x of s)for(let v=0,N=x.length,C=N-1;v<N;C=v++){const A=x[C],L=x[v];for(const O of e)for(let U=0,q=O.length,Z=q-1;U<q;Z=U++){const te=O[Z],pe=O[U];if(au(A,L,te,pe))return 0;f=Math.min(f,wd(A,L,te,pe,r))}}return f}function vr(s,e,r,a,u,p){if(!p)return;const f=pu(hu(a,p),u,r);f<e&&s.push([f,p,[0,0]])}function fu(s,e,r,a,u,p,f){if(!p||!f)return;const x=pu(hu(a,p),hu(u,f),r);x<e&&s.push([x,p,f])}function mu(s,e,r,a,u=1/0){let p=Math.min(a.distance(s[0],r[0][0]),u);if(p===0)return p;const f=new mh([[0,[0,s.length-1],[0,0]]],du),x=bd(r);for(;f.length>0;){const v=f.pop();if(v[0]>=p)continue;const N=v[1],C=e?50:100;if(Cl(N)<=C){if(!na(N,s.length))return NaN;if(e){const A=_h(s,N,r,a);if(isNaN(A)||A===0)return A;p=Math.min(p,A)}else for(let A=N[0];A<=N[1];++A){const L=yh(s[A],r,a);if(p=Math.min(p,L),p===0)return 0}}else{const A=yc(N,e);vr(f,p,a,s,x,A[0]),vr(f,p,a,s,x,A[1])}}return p}function bi(s,e,r,a,u,p=1/0){let f=Math.min(p,u.distance(s[0],r[0]));if(f===0)return f;const x=new mh([[0,[0,s.length-1],[0,r.length-1]]],du);for(;x.length>0;){const v=x.pop();if(v[0]>=f)continue;const N=v[1],C=v[2],A=e?50:100,L=a?50:100;if(Cl(N)<=A&&Cl(C)<=L){if(!na(N,s.length)&&na(C,r.length))return NaN;let O;if(e&&a)O=Ta(s,N,r,C,u),f=Math.min(f,O);else if(e&&!a){const U=s.slice(N[0],N[1]+1);for(let q=C[0];q<=C[1];++q)if(O=zo(r[q],U,u),f=Math.min(f,O),f===0)return f}else if(!e&&a){const U=r.slice(C[0],C[1]+1);for(let q=N[0];q<=N[1];++q)if(O=zo(s[q],U,u),f=Math.min(f,O),f===0)return f}else O=Pl(s,N,r,C,u),f=Math.min(f,O)}else{const O=yc(N,e),U=yc(C,a);fu(x,f,u,s,r,O[0],U[0]),fu(x,f,u,s,r,O[0],U[1]),fu(x,f,u,s,r,O[1],U[0]),fu(x,f,u,s,r,O[1],U[1])}}return f}function _c(s){return s.type==="MultiPolygon"?s.coordinates.map((e=>({type:"Polygon",coordinates:e}))):s.type==="MultiLineString"?s.coordinates.map((e=>({type:"LineString",coordinates:e}))):s.type==="MultiPoint"?s.coordinates.map((e=>({type:"Point",coordinates:e}))):[s]}class Na{constructor(e,r){this.type=_t,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(qi(e[1])){const a=e[1];if(a.type==="FeatureCollection")return new Na(a,a.features.map((u=>_c(u.geometry))).flat());if(a.type==="Feature")return new Na(a,_c(a.geometry));if("type"in a&&"coordinates"in a)return new Na(a,_c(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,a){const u=r.geometry(),p=u.flat().map((v=>Mo([v.x,v.y],r.canonical)));if(u.length===0)return NaN;const f=new uu(p[0][1]);let x=1/0;for(const v of a){switch(v.type){case"Point":x=Math.min(x,bi(p,!1,[v.coordinates],!1,f,x));break;case"LineString":x=Math.min(x,bi(p,!1,v.coordinates,!0,f,x));break;case"Polygon":x=Math.min(x,mu(p,!1,v.coordinates,f,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,a){const u=r.geometry(),p=u.flat().map((v=>Mo([v.x,v.y],r.canonical)));if(u.length===0)return NaN;const f=new uu(p[0][1]);let x=1/0;for(const v of a){switch(v.type){case"Point":x=Math.min(x,bi(p,!0,[v.coordinates],!1,f,x));break;case"LineString":x=Math.min(x,bi(p,!0,v.coordinates,!0,f,x));break;case"Polygon":x=Math.min(x,mu(p,!0,v.coordinates,f,x))}if(x===0)return x}return x})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(r,a){const u=r.geometry();if(u.length===0||u[0].length===0)return NaN;const p=mc(u,0).map((v=>v.map((N=>N.map((C=>Mo([C.x,C.y],r.canonical))))))),f=new uu(p[0][0][0][1]);let x=1/0;for(const v of a)for(const N of p){switch(v.type){case"Point":x=Math.min(x,mu([v.coordinates],!1,N,f,x));break;case"LineString":x=Math.min(x,mu(v.coordinates,!0,N,f,x));break;case"Polygon":x=Math.min(x,bh(N,v.coordinates,f,x))}if(x===0)return x}return x})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ao{constructor(e){this.type=ar,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=e[1];return a==null?r.error("Global state property must be defined."):typeof a!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ao(a)}evaluate(e){var r;const a=(r=e.globals)===null||r===void 0?void 0:r.globalState;return a&&Object.keys(a).length!==0?Nr(a,this.key):null}eachChild(){}outputDefined(){return!1}}const Do={"==":hh,"!=":hd,">":np,"<":ph,">=":nu,"<=":Po,array:Mn,at:pr,boolean:Mn,case:vl,coalesce:Eo,collator:jl,format:pc,image:Hi,in:or,"index-of":_i,interpolate:Zs,"interpolate-hcl":Zs,"interpolate-lab":Zs,length:Sl,let:br,literal:vn,match:mr,number:Mn,"number-format":pd,object:Mn,slice:fs,step:Ua,string:Mn,"to-boolean":ka,"to-color":ka,"to-number":ka,"to-string":ka,var:Zi,within:sa,distance:Na,"global-state":Ao};class wn{constructor(e,r,a,u){this.name=e,this.type=r,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],u=wn.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=f.filter((([N])=>!Array.isArray(N)||N.length===e.length-1));let v=null;for(const[N,C]of x){v=new Gi(r.registry,bc,r.path,null,r.scope);const A=[];let L=!1;for(let O=1;O<e.length;O++){const U=e[O],q=Array.isArray(N)?N[O-1]:N.type,Z=v.parse(U,1+A.length,q);if(!Z){L=!0;break}A.push(Z)}if(!L)if(Array.isArray(N)&&N.length!==A.length)v.error(`Expected ${N.length} arguments, but found ${A.length} instead.`);else{for(let O=0;O<A.length;O++){const U=Array.isArray(N)?N[O]:N.type,q=A[O];v.concat(O+1).checkSubtype(U,q.type)}if(v.errors.length===0)return new wn(a,p,C,A)}}if(x.length===1)r.errors.push(...v.errors);else{const N=(x.length?x:f).map((([A])=>{return L=A,Array.isArray(L)?`(${L.map(Tr).join(", ")})`:`(${Tr(L.type)}...)`;var L})).join(" | "),C=[];for(let A=1;A<e.length;A++){const L=r.parse(e[A],1+C.length);if(!L)return null;C.push(Tr(L.type))}r.error(`Expected arguments of type ${N}, but found (${C.join(", ")}) instead.`)}return null}static register(e,r){wn.definitions=r;for(const a in r)e[a]=wn}}function Ro(s,[e,r,a,u]){e=e.evaluate(s),r=r.evaluate(s),a=a.evaluate(s);const p=u?u.evaluate(s):1,f=So(e,r,a,p);if(f)throw new Br(f);return new ir(e/255,r/255,a/255,p,!1)}function gu(s,e){return s in e}function xu(s,e){const r=e[s];return r===void 0?null:r}function qa(s){return{type:s}}function bc(s){if(s instanceof Zi)return bc(s.boundExpression);if(s instanceof wn&&s.name==="error"||s instanceof jl||s instanceof sa||s instanceof Na||s instanceof Ao)return!1;const e=s instanceof ka||s instanceof Mn;let r=!0;return s.eachChild((a=>{r=e?r&&bc(a):r&&a instanceof vn})),!!r&&vc(s)&&wc(s,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function vc(s){if(s instanceof wn&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof sa||s instanceof Na)return!1;let e=!0;return s.eachChild((r=>{e&&!vc(r)&&(e=!1)})),e}function Ml(s){if(s instanceof wn&&s.name==="feature-state")return!1;let e=!0;return s.eachChild((r=>{e&&!Ml(r)&&(e=!1)})),e}function wc(s,e){if(s instanceof wn&&e.indexOf(s.name)>=0)return!1;let r=!0;return s.eachChild((a=>{r&&!wc(a,e)&&(r=!1)})),r}function jd(s){return{result:"success",value:s}}function Lo(s){return{result:"error",value:s}}function Wn(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function yu(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function kc(s){return!!s.expression&&s.expression.interpolated}function hr(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function _u(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)&&Qr(s)===Ba}function jc(s){return s}function vh(s,e){const r=s.stops&&typeof s.stops[0][0]=="object",a=r||!(r||s.property!==void 0),u=s.type||(kc(e)?"exponential":"interval"),p=(function(C){switch(C.type){case"color":return ir.parse;case"padding":return Ps.parse;case"numberArray":return Ir.parse;case"colorArray":return Xt.parse;default:return null}})(e);if(p&&((s=Us({},s)).stops&&(s.stops=s.stops.map((C=>[C[0],p(C[1])]))),s.default=p(s.default?s.default:e.default)),s.colorSpace&&(f=s.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var f;const x=(function(C){switch(C){case"exponential":return bu;case"interval":return ls;case"categorical":return wh;case"identity":return vu;default:throw new Error(`Unknown function type "${C}"`)}})(u);let v,N;if(u==="categorical"){v=Object.create(null);for(const C of s.stops)v[C[0]]=C[1];N=typeof s.stops[0][0]}if(r){const C={},A=[];for(let U=0;U<s.stops.length;U++){const q=s.stops[U],Z=q[0].zoom;C[Z]===void 0&&(C[Z]={zoom:Z,type:s.type,property:s.property,default:s.default,stops:[]},A.push(Z)),C[Z].stops.push([q[0].value,q[1]])}const L=[];for(const U of A)L.push([C[U].zoom,vh(C[U],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Zs.interpolationFactor.bind(void 0,O),zoomStops:L.map((U=>U[0])),evaluate:({zoom:U},q)=>bu({stops:L,base:s.base},e,U).evaluate(U,q)}}if(a){const C=u==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Zs.interpolationFactor.bind(void 0,C),zoomStops:s.stops.map((A=>A[0])),evaluate:({zoom:A})=>x(s,e,A,v,N)}}return{kind:"source",evaluate(C,A){const L=A&&A.properties?A.properties[s.property]:void 0;return L===void 0?Il(s.default,e.default):x(s,e,L,v,N)}}}function Il(s,e,r){return s!==void 0?s:e!==void 0?e:r!==void 0?r:void 0}function wh(s,e,r,a,u){return Il(typeof r===u?a[r]:void 0,s.default,e.default)}function ls(s,e,r){if(hr(r)!=="number")return Il(s.default,e.default);const a=s.stops.length;if(a===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[a-1][0])return s.stops[a-1][1];const u=ja(s.stops.map((p=>p[0])),r);return s.stops[u][1]}function bu(s,e,r){const a=s.base!==void 0?s.base:1;if(hr(r)!=="number")return Il(s.default,e.default);const u=s.stops.length;if(u===1||r<=s.stops[0][0])return s.stops[0][1];if(r>=s.stops[u-1][0])return s.stops[u-1][1];const p=ja(s.stops.map((C=>C[0])),r),f=(function(C,A,L,O){const U=O-L,q=C-L;return U===0?0:A===1?q/U:(Math.pow(A,q)-1)/(Math.pow(A,U)-1)})(r,a,s.stops[p][0],s.stops[p+1][0]),x=s.stops[p][1],v=s.stops[p+1][1],N=os[e.type]||jc;return typeof x.evaluate=="function"?{evaluate(...C){const A=x.evaluate.apply(void 0,C),L=v.evaluate.apply(void 0,C);if(A!==void 0&&L!==void 0)return N(A,L,f,s.colorSpace)}}:N(x,v,f,s.colorSpace)}function vu(s,e,r){switch(e.type){case"color":r=ir.parse(r);break;case"formatted":r=qs.fromString(r.toString());break;case"resolvedImage":r=Pn.fromString(r.toString());break;case"padding":r=Ps.parse(r);break;case"colorArray":r=Xt.parse(r);break;case"numberArray":r=Ir.parse(r);break;default:hr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Il(r,s.default,e.default)}wn.register(Do,{error:[{kind:"error"},[nr],(s,[e])=>{throw new Br(e.evaluate(s))}],typeof:[nr,[ar],(s,[e])=>Tr(Qr(e.evaluate(s)))],"to-rgba":[on(_t,4),[Cn],(s,[e])=>{const[r,a,u,p]=e.evaluate(s).rgb;return[255*r,255*a,255*u,p]}],rgb:[Cn,[_t,_t,_t],Ro],rgba:[Cn,[_t,_t,_t,_t],Ro],has:{type:ur,overloads:[[[nr],(s,[e])=>gu(e.evaluate(s),s.properties())],[[nr,Ba],(s,[e,r])=>gu(e.evaluate(s),r.evaluate(s))]]},get:{type:ar,overloads:[[[nr],(s,[e])=>xu(e.evaluate(s),s.properties())],[[nr,Ba],(s,[e,r])=>xu(e.evaluate(s),r.evaluate(s))]]},"feature-state":[ar,[nr],(s,[e])=>xu(e.evaluate(s),s.featureState||{})],properties:[Ba,[],s=>s.properties()],"geometry-type":[nr,[],s=>s.geometryType()],id:[ar,[],s=>s.id()],zoom:[_t,[],s=>s.globals.zoom],"heatmap-density":[_t,[],s=>s.globals.heatmapDensity||0],elevation:[_t,[],s=>s.globals.elevation||0],"line-progress":[_t,[],s=>s.globals.lineProgress||0],accumulated:[ar,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[_t,qa(_t),(s,e)=>{let r=0;for(const a of e)r+=a.evaluate(s);return r}],"*":[_t,qa(_t),(s,e)=>{let r=1;for(const a of e)r*=a.evaluate(s);return r}],"-":{type:_t,overloads:[[[_t,_t],(s,[e,r])=>e.evaluate(s)-r.evaluate(s)],[[_t],(s,[e])=>-e.evaluate(s)]]},"/":[_t,[_t,_t],(s,[e,r])=>e.evaluate(s)/r.evaluate(s)],"%":[_t,[_t,_t],(s,[e,r])=>e.evaluate(s)%r.evaluate(s)],ln2:[_t,[],()=>Math.LN2],pi:[_t,[],()=>Math.PI],e:[_t,[],()=>Math.E],"^":[_t,[_t,_t],(s,[e,r])=>Math.pow(e.evaluate(s),r.evaluate(s))],sqrt:[_t,[_t],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[_t,[_t],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[_t,[_t],(s,[e])=>Math.log(e.evaluate(s))],log2:[_t,[_t],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[_t,[_t],(s,[e])=>Math.sin(e.evaluate(s))],cos:[_t,[_t],(s,[e])=>Math.cos(e.evaluate(s))],tan:[_t,[_t],(s,[e])=>Math.tan(e.evaluate(s))],asin:[_t,[_t],(s,[e])=>Math.asin(e.evaluate(s))],acos:[_t,[_t],(s,[e])=>Math.acos(e.evaluate(s))],atan:[_t,[_t],(s,[e])=>Math.atan(e.evaluate(s))],min:[_t,qa(_t),(s,e)=>Math.min(...e.map((r=>r.evaluate(s))))],max:[_t,qa(_t),(s,e)=>Math.max(...e.map((r=>r.evaluate(s))))],abs:[_t,[_t],(s,[e])=>Math.abs(e.evaluate(s))],round:[_t,[_t],(s,[e])=>{const r=e.evaluate(s);return r<0?-Math.round(-r):Math.round(r)}],floor:[_t,[_t],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[_t,[_t],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[ur,[nr,ar],(s,[e,r])=>s.properties()[e.value]===r.value],"filter-id-==":[ur,[ar],(s,[e])=>s.id()===e.value],"filter-type-==":[ur,[nr],(s,[e])=>s.geometryType()===e.value],"filter-<":[ur,[nr,ar],(s,[e,r])=>{const a=s.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[ur,[ar],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[ur,[nr,ar],(s,[e,r])=>{const a=s.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[ur,[ar],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[ur,[nr,ar],(s,[e,r])=>{const a=s.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[ur,[ar],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[ur,[nr,ar],(s,[e,r])=>{const a=s.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[ur,[ar],(s,[e])=>{const r=s.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[ur,[ar],(s,[e])=>e.value in s.properties()],"filter-has-id":[ur,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ur,[on(nr)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[ur,[on(ar)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[ur,[nr,on(ar)],(s,[e,r])=>r.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[ur,[nr,on(ar)],(s,[e,r])=>(function(a,u,p,f){for(;p<=f;){const x=p+f>>1;if(u[x]===a)return!0;u[x]>a?f=x-1:p=x+1}return!1})(s.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ur,overloads:[[[ur,ur],(s,[e,r])=>e.evaluate(s)&&r.evaluate(s)],[qa(ur),(s,e)=>{for(const r of e)if(!r.evaluate(s))return!1;return!0}]]},any:{type:ur,overloads:[[[ur,ur],(s,[e,r])=>e.evaluate(s)||r.evaluate(s)],[qa(ur),(s,e)=>{for(const r of e)if(r.evaluate(s))return!0;return!1}]]},"!":[ur,[ur],(s,[e])=>!e.evaluate(s)],"is-supported-script":[ur,[nr],(s,[e])=>{const r=s.globals&&s.globals.isSupportedScript;return!r||r(e.evaluate(s))}],upcase:[nr,[nr],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[nr,[nr],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[nr,qa(ar),(s,e)=>e.map((r=>wa(r.evaluate(s)))).join("")],"resolved-locale":[nr,[ml],(s,[e])=>e.evaluate(s).resolvedLocale()]});class Fo{constructor(e,r,a){this.expression=e,this._warningHistory={},this._evaluator=new uc,this._defaultValue=r?(function(u){if(u.type==="color"&&_u(u.default))return new ir(0,0,0,0);switch(u.type){case"color":return ir.parse(u.default)||null;case"padding":return Ps.parse(u.default)||null;case"numberArray":return Ir.parse(u.default)||null;case"colorArray":return Xt.parse(u.default)||null;case"variableAnchorOffsetCollection":return bn.parse(u.default)||null;case"projectionDefinition":return Gs.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=a}evaluateWithoutErrorHandling(e,r,a,u,p,f){return this._globalState&&(e=Ji(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,p,f){this._globalState&&(e=Ji(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Br(`Expected value to be one of ${Object.keys(this._enumValues).map((v=>JSON.stringify(v))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Oo(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Do}function Bo(s,e,r){const a=new Gi(Do,bc,[],e?(function(p){const f={color:Cn,string:nr,number:_t,enum:nr,boolean:ur,formatted:gl,padding:Qc,numberArray:is,colorArray:xl,projectionDefinition:Jc,resolvedImage:yl,variableAnchorOffsetCollection:vo};return p.type==="array"?on(f[p.value]||ar,p.length):f[p.type]})(e):void 0),u=a.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?jd(new Fo(u,e,r)):Lo(a.errors)}class Xi{constructor(e,r,a){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Ml(r.expression),this.globalStateRefs=Ki(r.expression),this._globalState=a}evaluateWithoutErrorHandling(e,r,a,u,p,f){return this._globalState&&(e=Ji(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,p,f)}evaluate(e,r,a,u,p,f){return this._globalState&&(e=Ji(e,this._globalState)),this._styleExpression.evaluate(e,r,a,u,p,f)}}class zl{constructor(e,r,a,u,p){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ml(r.expression),this.globalStateRefs=Ki(r.expression),this.interpolationType=u,this._globalState=p}evaluateWithoutErrorHandling(e,r,a,u,p,f){return this._globalState&&(e=Ji(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,p,f)}evaluate(e,r,a,u,p,f){return this._globalState&&(e=Ji(e,this._globalState)),this._styleExpression.evaluate(e,r,a,u,p,f)}interpolationFactor(e,r,a){return this.interpolationType?Zs.interpolationFactor(this.interpolationType,e,r,a):0}}function Yi(s,e,r){const a=Bo(s,e,r);if(a.result==="error")return a;const u=a.value.expression,p=vc(u);if(!p&&!Wn(e))return Lo([new en("","data expressions not supported")]);const f=wc(u,["zoom"]);if(!f&&!yu(e))return Lo([new en("","zoom expressions not supported")]);const x=wu(u);return x||f?x instanceof en?Lo([x]):x instanceof Zs&&!kc(e)?Lo([new en("",'"interpolate" expressions cannot be used with this property')]):jd(x?new zl(p?"camera":"composite",a.value,x.labels,x instanceof Zs?x.interpolation:void 0,r):new Xi(p?"constant":"source",a.value,r)):Lo([new en("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Sc{constructor(e,r){this._parameters=e,this._specification=r,Us(this,vh(this._parameters,this._specification))}static deserialize(e){return new Sc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function wu(s){let e=null;if(s instanceof br)e=wu(s.result);else if(s instanceof Eo){for(const r of s.args)if(e=wu(r),e)break}else(s instanceof Ua||s instanceof Zs)&&s.input instanceof wn&&s.input.name==="zoom"&&(e=s);return e instanceof en||s.eachChild((r=>{const a=wu(r);a instanceof en?e=a:!e&&a?e=new en("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new en("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Ki(s,e=new Set){return s instanceof Ao&&e.add(s.key),s.eachChild((r=>{Ki(r,e)})),e}function Ji(s,e){const{zoom:r,heatmapDensity:a,elevation:u,lineProgress:p,isSupportedScript:f,accumulated:x}=s??{};return{zoom:r,heatmapDensity:a,elevation:u,lineProgress:p,isSupportedScript:f,accumulated:x,globalState:e}}function Al(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Al(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const ku={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vo(s,e){if(s==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Al(s)||(s=$o(s));const r=Bo(s,ku,e);if(r.result==="error")throw new Error(r.value.map((a=>`${a.key}: ${a.message}`)).join(", "));return{filter:(a,u,p)=>r.value.evaluate(a,u,{},p),needGeometry:ju(s),getGlobalStateRefs:()=>Ki(r.value.expression)}}function Sd(s,e){return s<e?-1:s>e?1:0}function ju(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(ju(s[e]))return!0;return!1}function $o(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Su(s[1],s[2],"=="):e==="!="?Tc(Su(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Su(s[1],s[2],e):e==="any"?(r=s.slice(1),["any"].concat(r.map($o))):e==="all"?["all"].concat(s.slice(1).map($o)):e==="none"?["all"].concat(s.slice(1).map($o).map(Tc)):e==="in"?Td(s[1],s.slice(2)):e==="!in"?Tc(Td(s[1],s.slice(2))):e==="has"?kh(s[1]):e!=="!has"||Tc(kh(s[1]));var r}function Su(s,e,r){switch(s){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,s,e]}}function Td(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((r=>typeof r!=typeof e[0]))?["filter-in-large",s,["literal",e.sort(Sd)]]:["filter-in-small",s,["literal",e]]}}function kh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Tc(s){return["!",s]}function Dl(s){const e=typeof s;if(e==="number"||e==="boolean"||e==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let u="[";for(const p of s)u+=`${Dl(p)},`;return`${u}]`}const r=Object.keys(s).sort();let a="{";for(let u=0;u<r.length;u++)a+=`${JSON.stringify(r[u])}:${Dl(s[r[u]])},`;return`${a}}`}function vi(s){let e="";for(const r of Or)e+=`/${Dl(s[r])}`;return e}function Nd(s){const e=s.value;return e?[new at(s.key,e,"constants have been deprecated as of v8")]:[]}function Hr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function cn(s){if(Array.isArray(s))return s.map(cn);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const r in s)e[r]=cn(s[r]);return e}return Hr(s)}function tn(s){const e=s.key,r=s.value,a=s.valueSpec||{},u=s.objectElementValidators||{},p=s.style,f=s.styleSpec,x=s.validateSpec;let v=[];const N=hr(r);if(N!=="object")return[new at(e,r,`object expected, ${N} found`)];for(const C in r){const A=C.split(".")[0],L=Nr(a,A)||a["*"];let O;if(Nr(u,A))O=u[A];else if(Nr(a,A)){if(r[C]===void 0)continue;O=x}else if(u["*"])O=u["*"];else{if(!a["*"]){v.push(new at(e,r[C],`unknown property "${C}"`));continue}O=x}v=v.concat(O({key:(e&&`${e}.`)+C,value:r[C],valueSpec:L,style:p,styleSpec:f,object:r,objectKey:C,validateSpec:x},r))}for(const C in a)u[C]||a[C].required&&a[C].default===void 0&&r[C]===void 0&&v.push(new at(e,r,`missing required property "${C}"`));return v}function aa(s){const e=s.value,r=s.valueSpec,a=s.style,u=s.styleSpec,p=s.key,f=s.arrayElementValidator||s.validateSpec;if(hr(e)!=="array")return[new at(p,e,`array expected, ${hr(e)} found`)];if(r.length&&e.length!==r.length)return[new at(p,e,`array length ${r.length} expected, length ${e.length} found`)];let x={type:r.value,values:r.values};u.$version<7&&(x.function=r.function),hr(r.value)==="object"&&(x=r.value);let v=[];for(let N=0;N<e.length;N++)v=v.concat(f({array:e,arrayIndex:N,value:e[N],valueSpec:x,validateSpec:s.validateSpec,style:a,styleSpec:u,key:`${p}[${N}]`}));return v}function Uo(s){const e=s.key,r=s.value,a=s.valueSpec;let u=hr(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new at(e,r,`number expected, ${u} found`)]:"minimum"in a&&r<a.minimum?[new at(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new at(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function Tu(s){const e=s.valueSpec,r=Hr(s.value.type);let a,u,p,f={};const x=r!=="categorical"&&s.value.property===void 0,v=!x,N=hr(s.value.stops)==="array"&&hr(s.value.stops[0])==="array"&&hr(s.value.stops[0][0])==="object",C=tn({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(O){if(r==="identity")return[new at(O.key,O.value,'identity function may not have a "stops" property')];let U=[];const q=O.value;return U=U.concat(aa({key:O.key,value:q,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:A})),hr(q)==="array"&&q.length===0&&U.push(new at(O.key,q,"array must have at least one stop")),U},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return r==="identity"&&x&&C.push(new at(s.key,s.value,'missing required property "property"')),r==="identity"||s.value.stops||C.push(new at(s.key,s.value,'missing required property "stops"')),r==="exponential"&&s.valueSpec.expression&&!kc(s.valueSpec)&&C.push(new at(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(v&&!Wn(s.valueSpec)?C.push(new at(s.key,s.value,"property functions not supported")):x&&!yu(s.valueSpec)&&C.push(new at(s.key,s.value,"zoom functions not supported"))),r!=="categorical"&&!N||s.value.property!==void 0||C.push(new at(s.key,s.value,'"property" property is required')),C;function A(O){let U=[];const q=O.value,Z=O.key;if(hr(q)!=="array")return[new at(Z,q,`array expected, ${hr(q)} found`)];if(q.length!==2)return[new at(Z,q,`array length 2 expected, length ${q.length} found`)];if(N){if(hr(q[0])!=="object")return[new at(Z,q,`object expected, ${hr(q[0])} found`)];if(q[0].zoom===void 0)return[new at(Z,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new at(Z,q,"object stop key must have value")];if(p&&p>Hr(q[0].zoom))return[new at(Z,q[0].zoom,"stop zoom values must appear in ascending order")];Hr(q[0].zoom)!==p&&(p=Hr(q[0].zoom),u=void 0,f={}),U=U.concat(tn({key:`${Z}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:Uo,value:L}}))}else U=U.concat(L({key:`${Z}[0]`,value:q[0],validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},q));return Oo(cn(q[1]))?U.concat([new at(`${Z}[1]`,q[1],"expressions are not allowed in function stops.")]):U.concat(O.validateSpec({key:`${Z}[1]`,value:q[1],valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function L(O,U){const q=hr(O.value),Z=Hr(O.value),te=O.value!==null?O.value:U;if(a){if(q!==a)return[new at(O.key,te,`${q} stop domain type must match previous stop domain type ${a}`)]}else a=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new at(O.key,te,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let pe=`number expected, ${q} found`;return Wn(e)&&r===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new at(O.key,te,pe)]}return r!=="categorical"||q!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&q==="number"&&u!==void 0&&Z<u?[new at(O.key,te,"stop domain values must appear in ascending order")]:(u=Z,r==="categorical"&&Z in f?[new at(O.key,te,"stop domain values must be unique")]:(f[Z]=!0,[])):[new at(O.key,te,`integer expected, found ${Z}`)]}}function Qi(s){const e=(s.expressionContext==="property"?Yi:Bo)(cn(s.value),s.valueSpec);if(e.result==="error")return e.value.map((a=>new at(`${s.key}${a.key}`,s.value,a.message)));const r=e.value.expression||e.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!r.outputDefined())return[new at(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!Ml(r))return[new at(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!Ml(r))return[new at(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!wc(r,["zoom","feature-state"]))return[new at(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!vc(r))return[new at(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ea(s){const e=s.key,r=s.value,a=hr(r);return a!=="string"?[new at(e,r,`color expected, ${a} found`)]:ir.parse(String(r))?[]:[new at(e,r,`color expected, "${r}" found`)]}function Ca(s){const e=s.key,r=s.value,a=s.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(Hr(r))===-1&&u.push(new at(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Hr(r))===-1&&u.push(new at(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function Pa(s){return Al(cn(s.value))?Qi(Us({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Nc(s)}function Nc(s){const e=s.value,r=s.key;if(hr(e)!=="array")return[new at(r,e,`array expected, ${hr(e)} found`)];const a=s.styleSpec;let u,p=[];if(e.length<1)return[new at(r,e,"filter array must have at least 1 element")];switch(p=p.concat(Ca({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:s.style,styleSpec:s.styleSpec})),Hr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Hr(e[1])==="$type"&&p.push(new at(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new at(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=hr(e[1]),u!=="string"&&p.push(new at(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let f=2;f<e.length;f++)u=hr(e[f]),Hr(e[1])==="$type"?p=p.concat(Ca({key:`${r}[${f}]`,value:e[f],valueSpec:a.geometry_type,style:s.style,styleSpec:s.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new at(`${r}[${f}]`,e[f],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)p=p.concat(Nc({key:`${r}[${f}]`,value:e[f],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":u=hr(e[1]),e.length!==2?p.push(new at(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new at(`${r}[1]`,e[1],`string expected, ${u} found`))}return p}function Nu(s,e){const r=s.key,a=s.validateSpec,u=s.style,p=s.styleSpec,f=s.value,x=s.objectKey,v=p[`${e}_${s.layerType}`];if(!v)return[];const N=x.match(/^(.*)-transition$/);if(e==="paint"&&N&&v[N[1]]&&v[N[1]].transition)return a({key:r,value:f,valueSpec:p.transition,style:u,styleSpec:p});const C=s.valueSpec||v[x];if(!C)return[new at(r,f,`unknown property "${x}"`)];let A;if(hr(f)==="string"&&Wn(C)&&!C.tokens&&(A=/^{([^}]+)}$/.exec(f)))return[new at(r,f,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const L=[];return s.layerType==="symbol"&&x==="text-font"&&_u(cn(f))&&Hr(f.type)==="identity"&&L.push(new at(r,f,'"text-font" does not support identity functions')),L.concat(a({key:s.key,value:f,valueSpec:C,style:u,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:x}))}function qo(s){return Nu(s,"paint")}function wi(s){return Nu(s,"layout")}function es(s){let e=[];const r=s.value,a=s.key,u=s.style,p=s.styleSpec;if(hr(r)!=="object")return[new at(a,r,`object expected, ${hr(r)} found`)];r.type||r.ref||e.push(new at(a,r,'either "type" or "ref" is required'));let f=Hr(r.type);const x=Hr(r.ref);if(r.id){const v=Hr(r.id);for(let N=0;N<s.arrayIndex;N++){const C=u.layers[N];Hr(C.id)===v&&e.push(new at(a,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach((N=>{N in r&&e.push(new at(a,r[N],`"${N}" is prohibited for ref layers`))})),u.layers.forEach((N=>{Hr(N.id)===x&&(v=N)})),v?v.ref?e.push(new at(a,r.ref,"ref cannot reference another ref layer")):f=Hr(v.type):e.push(new at(a,r.ref,`ref layer "${x}" not found`))}else if(f!=="background")if(r.source){const v=u.sources&&u.sources[r.source],N=v&&Hr(v.type);v?N==="vector"&&f==="raster"?e.push(new at(a,r.source,`layer "${r.id}" requires a raster source`)):N!=="raster-dem"&&f==="hillshade"||N!=="raster-dem"&&f==="color-relief"?e.push(new at(a,r.source,`layer "${r.id}" requires a raster-dem source`)):N==="raster"&&f!=="raster"?e.push(new at(a,r.source,`layer "${r.id}" requires a vector source`)):N!=="vector"||r["source-layer"]?N==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?e.push(new at(a,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||N==="geojson"&&v.lineMetrics||e.push(new at(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new at(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new at(a,r.source,`source "${r.source}" not found`))}else e.push(new at(a,r,'missing required property "source"'));return e=e.concat(tn({key:a,value:r,valueSpec:p.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${a}.type`,value:r.type,valueSpec:p.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:r,objectKey:"type"}),filter:Pa,layout:v=>tn({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":N=>wi(Us({layerType:f},N))}}),paint:v=>tn({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":N=>qo(Us({layerType:f},N))}})}})),e}function Er(s){const e=s.value,r=s.key,a=hr(e);return a!=="string"?[new at(r,e,`string expected, ${a} found`)]:[]}const Ga={promoteId:function({key:s,value:e}){if(hr(e)==="string")return Er({key:s,value:e});{const r=[];for(const a in e)r.push(...Er({key:`${s}.${a}`,value:e[a]}));return r}}};function Hs(s){const e=s.value,r=s.key,a=s.styleSpec,u=s.style,p=s.validateSpec;if(!e.type)return[new at(r,e,'"type" is required')];const f=Hr(e.type);let x;switch(f){case"vector":case"raster":return x=tn({key:r,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:s.style,styleSpec:a,objectElementValidators:Ga,validateSpec:p}),x;case"raster-dem":return x=(function(v){var N;const C=(N=v.sourceName)!==null&&N!==void 0?N:"",A=v.value,L=v.styleSpec,O=L.source_raster_dem,U=v.style;let q=[];const Z=hr(A);if(A===void 0)return q;if(Z!=="object")return q.push(new at("source_raster_dem",A,`object expected, ${Z} found`)),q;const te=Hr(A.encoding)==="custom",pe=["redFactor","greenFactor","blueFactor","baseShift"],ae=v.value.encoding?`"${v.value.encoding}"`:"Default";for(const oe in A)!te&&pe.includes(oe)?q.push(new at(oe,A[oe],`In "${C}": "${oe}" is only valid when "encoding" is set to "custom". ${ae} encoding found`)):O[oe]?q=q.concat(v.validateSpec({key:oe,value:A[oe],valueSpec:O[oe],validateSpec:v.validateSpec,style:U,styleSpec:L})):q.push(new at(oe,A[oe],`unknown property "${oe}"`));return q})({sourceName:r,value:e,style:s.style,styleSpec:a,validateSpec:p}),x;case"geojson":if(x=tn({key:r,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,validateSpec:p,objectElementValidators:Ga}),e.cluster)for(const v in e.clusterProperties){const[N,C]=e.clusterProperties[v],A=typeof N=="string"?[N,["accumulated"],["get",v]]:N;x.push(...Qi({key:`${r}.${v}.map`,value:C,expressionContext:"cluster-map"})),x.push(...Qi({key:`${r}.${v}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return x;case"video":return tn({key:r,value:e,valueSpec:a.source_video,style:u,validateSpec:p,styleSpec:a});case"image":return tn({key:r,value:e,valueSpec:a.source_image,style:u,validateSpec:p,styleSpec:a});case"canvas":return[new at(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ca({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ws(s){const e=s.value,r=s.styleSpec,a=r.light,u=s.style;let p=[];const f=hr(e);if(e===void 0)return p;if(f!=="object")return p=p.concat([new at("light",e,`object expected, ${f} found`)]),p;for(const x in e){const v=x.match(/^(.*)-transition$/);p=p.concat(v&&a[v[1]]&&a[v[1]].transition?s.validateSpec({key:x,value:e[x],valueSpec:r.transition,validateSpec:s.validateSpec,style:u,styleSpec:r}):a[x]?s.validateSpec({key:x,value:e[x],valueSpec:a[x],validateSpec:s.validateSpec,style:u,styleSpec:r}):[new at(x,e[x],`unknown property "${x}"`)])}return p}function eo(s){const e=s.value,r=s.styleSpec,a=r.sky,u=s.style,p=hr(e);if(e===void 0)return[];if(p!=="object")return[new at("sky",e,`object expected, ${p} found`)];let f=[];for(const x in e)f=f.concat(a[x]?s.validateSpec({key:x,value:e[x],valueSpec:a[x],style:u,styleSpec:r}):[new at(x,e[x],`unknown property "${x}"`)]);return f}function to(s){const e=s.value,r=s.styleSpec,a=r.terrain,u=s.style;let p=[];const f=hr(e);if(e===void 0)return p;if(f!=="object")return p=p.concat([new at("terrain",e,`object expected, ${f} found`)]),p;for(const x in e)p=p.concat(a[x]?s.validateSpec({key:x,value:e[x],valueSpec:a[x],validateSpec:s.validateSpec,style:u,styleSpec:r}):[new at(x,e[x],`unknown property "${x}"`)]);return p}function un(s){let e=[];const r=s.value,a=s.key;if(Array.isArray(r)){const u=[],p=[];for(const f in r)r[f].id&&u.includes(r[f].id)&&e.push(new at(a,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),u.push(r[f].id),r[f].url&&p.includes(r[f].url)&&e.push(new at(a,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),p.push(r[f].url),e=e.concat(tn({key:`${a}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return e}return Er({key:a,value:r})}function Ec(s){return!!s&&s.constructor===Object}function Eu(s){return Ec(s.value)?[]:[new at(s.key,s.value,`object expected, ${hr(s.value)} found`)]}const Cu={"*":()=>[],array:aa,boolean:function(s){const e=s.value,r=s.key,a=hr(e);return a!=="boolean"?[new at(r,e,`boolean expected, ${a} found`)]:[]},number:Uo,color:Ea,constants:Nd,enum:Ca,filter:Pa,function:Tu,layer:es,object:tn,source:Hs,light:Ws,sky:eo,terrain:to,projection:function(s){const e=s.value,r=s.styleSpec,a=r.projection,u=s.style,p=hr(e);if(e===void 0)return[];if(p!=="object")return[new at("projection",e,`object expected, ${p} found`)];let f=[];for(const x in e)f=f.concat(a[x]?s.validateSpec({key:x,value:e[x],valueSpec:a[x],style:u,styleSpec:r}):[new at(x,e[x],`unknown property "${x}"`)]);return f},projectionDefinition:function(s){const e=s.key;let r=s.value;r=r instanceof String?r.valueOf():r;const a=hr(r);return a!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(r)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(r)?["array","string"].includes(a)?[]:[new at(e,r,`projection expected, invalid type "${a}" found`)]:[new at(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Er,formatted:function(s){return Er(s).length===0?[]:Qi(s)},resolvedImage:function(s){return Er(s).length===0?[]:Qi(s)},padding:function(s){const e=s.key,r=s.value;if(hr(r)==="array"){if(r.length<1||r.length>4)return[new at(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let u=[];for(let p=0;p<r.length;p++)u=u.concat(s.validateSpec({key:`${e}[${p}]`,value:r[p],validateSpec:s.validateSpec,valueSpec:a}));return u}return Uo({key:e,value:r,valueSpec:{}})},numberArray:function(s){const e=s.key,r=s.value;if(hr(r)==="array"){const a={type:"number"};if(r.length<1)return[new at(e,r,"array length at least 1 expected, length 0 found")];let u=[];for(let p=0;p<r.length;p++)u=u.concat(s.validateSpec({key:`${e}[${p}]`,value:r[p],validateSpec:s.validateSpec,valueSpec:a}));return u}return Uo({key:e,value:r,valueSpec:{}})},colorArray:function(s){const e=s.key,r=s.value;if(hr(r)==="array"){if(r.length<1)return[new at(e,r,"array length at least 1 expected, length 0 found")];let a=[];for(let u=0;u<r.length;u++)a=a.concat(Ea({key:`${e}[${u}]`,value:r[u]}));return a}return Ea({key:e,value:r})},variableAnchorOffsetCollection:function(s){const e=s.key,r=s.value,a=hr(r),u=s.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new at(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let f=0;f<r.length;f+=2)p=p.concat(Ca({key:`${e}[${f}]`,value:r[f],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(aa({key:`${e}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:u}));return p},sprite:un,state:Eu,fontFaces:function(s){const e=s.key,r=s.value,a=s.validateSpec,u=s.styleSpec,p=s.style;if(!Ec(r))return[new at(e,r,`object expected, ${hr(r)} found`)];const f=[];for(const x in r){const v=r[x],N=hr(v);if(N==="string")f.push(...Er({key:`${e}.${x}`,value:v}));else if(N==="array"){const C={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[A,L]of v.entries())f.push(...tn({key:`${e}.${x}[${A}]`,value:L,valueSpec:C,styleSpec:u,style:p,validateSpec:a}))}else f.push(new at(`${e}.${x}`,v,`string or array expected, ${N} found`))}return f}};function Ma(s){const e=s.value,r=s.valueSpec,a=s.styleSpec;return s.validateSpec=Ma,r.expression&&_u(Hr(e))?Tu(s):r.expression&&Oo(cn(e))?Qi(s):r.type&&Cu[r.type]?Cu[r.type](s):tn(Us({},s,{valueSpec:r.type?a[r.type]:r}))}function Ed(s){const e=s.value,r=s.key,a=Er(s);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new at(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new at(r,e,'"glyphs" url must include a "{range}" token'))),a}function Is(s,e=Fe){let r=[];return r=r.concat(Ma({key:"",value:s,valueSpec:e.$root,styleSpec:e,style:s,validateSpec:Ma,objectElementValidators:{glyphs:Ed,"*":()=>[]}})),s.constants&&(r=r.concat(Nd({key:"constants",value:s.constants}))),Pu(r)}function In(s){return function(e){return s(Object.assign({},e,{validateSpec:Ma}))}}function Pu(s){return[].concat(s).sort(((e,r)=>e.line-r.line))}function ia(s){return function(...e){return Pu(s.apply(this,e))}}Is.source=ia(In(Hs)),Is.sprite=ia(In(un)),Is.glyphs=ia(In(Ed)),Is.light=ia(In(Ws)),Is.sky=ia(In(eo)),Is.terrain=ia(In(to)),Is.state=ia(In(Eu)),Is.layer=ia(In(es)),Is.filter=ia(In(Pa)),Is.paintProperty=ia(In(qo)),Is.layoutProperty=ia(In(wi));const op={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class oa{constructor(e,r){this._globalState=r,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const r=Bo(e,op,this._globalState);if(r.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(r.value.map((a=>`${a.key}: ${a.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=r.value,this._globalStateRefs=Ki(r.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Za=Fe,ys=Is,ro=ys.light,Cc=ys.sky,la=ys.paintProperty,ca=ys.layoutProperty;function ua(s,e){let r=!1;if(e&&e.length)for(const a of e)s.fire(new wr(new Error(a.message))),r=!0;return r}class zn{constructor(e,r,a){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const f=new Int32Array(this.arrayBuffer);e=f[0],this.d=(r=f[1])+2*(a=f[2]);for(let v=0;v<this.d*this.d;v++){const N=f[3+v],C=f[3+v+1];u.push(N===C?null:f.subarray(N,C))}const x=f[3+u.length+1];this.keys=f.subarray(f[3+u.length],x),this.bboxes=f.subarray(x),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let f=0;f<this.d*this.d;f++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const p=a/r*e;this.min=-p,this.max=e+p}insert(e,r,a,u,p){this._forEachCell(r,a,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,u,p,f){this.cells[p].push(f)}query(e,r,a,u,p){const f=this.min,x=this.max;if(e<=f&&r<=f&&x<=a&&x<=u&&!p)return Array.prototype.slice.call(this.keys);{const v=[];return this._forEachCell(e,r,a,u,this._queryCell,v,{},p),v}}_queryCell(e,r,a,u,p,f,x,v){const N=this.cells[p];if(N!==null){const C=this.keys,A=this.bboxes;for(let L=0;L<N.length;L++){const O=N[L];if(x[O]===void 0){const U=4*O;(v?v(A[U+0],A[U+1],A[U+2],A[U+3]):e<=A[U+2]&&r<=A[U+3]&&a>=A[U+0]&&u>=A[U+1])?(x[O]=!0,f.push(C[O])):x[O]=!1}}}}_forEachCell(e,r,a,u,p,f,x,v){const N=this._convertToCellCoord(e),C=this._convertToCellCoord(r),A=this._convertToCellCoord(a),L=this._convertToCellCoord(u);for(let O=N;O<=A;O++)for(let U=C;U<=L;U++){const q=this.d*U+O;if((!v||v(this._convertFromCellCoord(O),this._convertFromCellCoord(U),this._convertFromCellCoord(O+1),this._convertFromCellCoord(U+1)))&&p.call(this,e,r,a,u,q,f,x,v))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let f=0;f<this.cells.length;f++)a+=this.cells[f].length;const u=new Int32Array(r+a+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=r;for(let f=0;f<e.length;f++){const x=e[f];u[3+f]=p,u.set(x,p),p+=x.length}return u[3+e.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+e.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new zn(e.buffer)}}const Ls={};function bt(s,e,r={}){if(Ls[s])throw new Error(`${s} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:s,writeable:!1}),Ls[s]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}bt("Object",Object),bt("Set",Set),bt("TransferableGridIndex",zn),bt("Color",ir),bt("Error",Error),bt("AJAXError",Se),bt("ResolvedImage",Pn),bt("StylePropertyFunction",Sc),bt("StyleExpression",Fo,{omit:["_evaluator"]}),bt("ZoomDependentExpression",zl),bt("ZoomConstantExpression",Xi),bt("CompoundExpression",wn,{omit:["_evaluate"]});for(const s in Do)Do[s]._classRegistryKey||bt(`Expression_${s}`,Do[s]);function Pc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Mc(s){return s.$name||s.constructor._classRegistryKey}function so(s){return!(function(e){if(e===null||typeof e!="object")return!1;const r=Mc(e);return!(!r||r==="Object")})(s)&&(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||Pc(s)||fi(s)||ArrayBuffer.isView(s)||s instanceof ImageData)}function rn(s,e){if(so(s))return(Pc(s)||fi(s))&&e&&e.push(s),ArrayBuffer.isView(s)&&e&&e.push(s.buffer),s instanceof ImageData&&e&&e.push(s.data.buffer),s;if(Array.isArray(s)){const p=[];for(const f of s)p.push(rn(f,e));return p}if(typeof s!="object")throw new Error("can't serialize object of type "+typeof s);const r=Mc(s);if(!r)throw new Error(`can't serialize object of unregistered class ${s.constructor.name}`);if(!Ls[r])throw new Error(`${r} is not registered.`);const{klass:a}=Ls[r],u=a.serialize?a.serialize(s,e):{};if(a.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in s){if(!s.hasOwnProperty(p)||Ls[r].omit.indexOf(p)>=0)continue;const f=s[p];u[p]=Ls[r].shallow.indexOf(p)>=0?f:rn(f,e)}s instanceof Error&&(u.message=s.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(u.$name=r),u}function sn(s){if(so(s))return s;if(Array.isArray(s))return s.map(sn);if(typeof s!="object")throw new Error("can't deserialize object of type "+typeof s);const e=Mc(s)||"Object";if(!Ls[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Ls[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(s);const a=Object.create(r.prototype);for(const u of Object.keys(s)){if(u==="$name")continue;const p=s[u];a[u]=Ls[e].shallow.indexOf(u)>=0?p:sn(p)}return a}class ts{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}function kn(s){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(s))}function Mu(s){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(s))}function Cd(s){return/\s/u.test(String.fromCodePoint(s))}function no(s){for(const e of s)if(Mu(e.codePointAt(0)))return!0;return!1}function Pd(s){for(const e of s)if(!Md(e.codePointAt(0)))return!1;return!0}function Ic(s){const e=s.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(e.join("|"),"u")}const Go=Ic(["Arab","Dupl","Mong","Ougr","Syrc"]);function Md(s){return!Go.test(String.fromCodePoint(s))}function ao(s){return!(Mu(s)||(e=s,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Iu=Ic(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Id(s){return Iu.test(String.fromCodePoint(s))}function Zo(s,e){return!(!e&&Id(s)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(s)))}function zc(s){for(const e of s)if(Id(e.codePointAt(0)))return!0;return!1}const ki=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){if(ki.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(s,e){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(s.pluginStatus!=="loading")return this.setState(s),s;const r=s.pluginURL,a=new Promise((p=>{this.loadScriptResolve=p}));e(r);const u=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([a,u]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:r};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class Rr{constructor(e,r){this.isSupportedScript=Rl,this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new ts,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ts,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}function Rl(s){return(function(e,r){for(const a of e)if(!Zo(a.codePointAt(0),r))return!1;return!0})(s,ki.getRTLTextPluginStatus()==="loaded")}const Ll="-transition";class Ho{constructor(e,r,a){this.property=e,this.value=r,this.expression=(function(u,p,f){if(_u(u))return new Sc(u,p);if(Oo(u)){const x=Yi(u,p,f);if(x.result==="error")throw new Error(x.value.map((v=>`${v.key}: ${v.message}`)).join(", "));return x.value}{let x=u;return p.type==="color"&&typeof u=="string"?x=ir.parse(u):p.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?p.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?p.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?x=bn.parse(u):p.type==="projectionDefinition"&&typeof u=="string"&&(x=Gs.parse(u)):x=Xt.parse(u):x=Ir.parse(u):x=Ps.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>x}}})(r===void 0?e.specification.default:r,e.specification,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class Wo{constructor(e,r){this.property=e,this.value=new Ho(e,void 0,r)}transitioned(e,r){return new zu(this.property,this.value,r,er({},e.transition,this.transition),e.now)}untransitioned(){return new zu(this.property,this.value,null,{},0)}}class io{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=r}getValue(e){return Qn(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Wo(this._values[e].property,this._globalState)),this._values[e].value=new Ho(this._values[e].property,r===null?void 0:Qn(r),this._globalState)}getTransition(e){return Qn(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Wo(this._values[e].property,this._globalState)),this._values[e].transition=Qn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const u=this.getTransition(r);u!==void 0&&(e[`${r}${Ll}`]=u)}return e}transitioned(e,r){const a=new Au(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){const e=new Au(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class zu{constructor(e,r,a,u,p){this.property=e,this.value=r,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const u=e.now||0,p=this.value.possiblyEvaluate(e,r,a),f=this.prior;if(f){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return f.possiblyEvaluate(e,r,a);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,a),p,qt(x))}}return p}}class Au{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const u=new Ha(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,r,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Du{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=r}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Qn(this._values[e].value)}setValue(e,r){this._values[e]=new Ho(this._values[e].property,r===null?void 0:Qn(r),this._globalState)}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const u=new Ha(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,r,a);return u}}class Xn{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class Ha{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Et{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const u=os[this.specification.type];return u?u(e,r,a):e}}class Rt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new Xn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Xn(this,{kind:"constant",value:void 0},e.parameters);const u=os[this.specification.type];if(u){const p=u(e.value.value,r.value.value,a);return new Xn(this,{kind:"constant",value:p},e.parameters)}return e}evaluate(e,r,a,u,p,f){return e.kind==="constant"?e.value:e.evaluate(r,a,u,p,f)}}class Xo extends Rt{possiblyEvaluate(e,r,a,u){if(e.value===void 0)return new Xn(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},a,u),f=e.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,x=this._calculate(f,f,f,r);return new Xn(this,{kind:"constant",value:x},r)}if(e.expression.kind==="camera"){const p=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Xn(this,{kind:"constant",value:p},r)}return new Xn(this,e.expression,r)}evaluate(e,r,a,u,p,f){if(e.kind==="source"){const x=e.evaluate(r,a,u,p,f);return this._calculate(x,x,x,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,u),e.evaluate({zoom:Math.floor(r.zoom)},a,u),e.evaluate({zoom:Math.floor(r.zoom)+1},a,u),r):e.value}_calculate(e,r,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class Ac{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const p=e.expression.evaluate(r,null,{},a,u);return this._calculate(p,p,p,r)}return this._calculate(e.expression.evaluate(new Rr(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Rr(Math.floor(r.zoom),r)),e.expression.evaluate(new Rr(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class da{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class ws{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new Ho(a,void 0,void 0),p=this.defaultTransitionablePropertyValues[r]=new Wo(a,void 0);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}bt("DataDrivenProperty",Rt),bt("DataConstantProperty",Et),bt("CrossFadedDataDrivenProperty",Xo),bt("CrossFadedProperty",Ac),bt("ColorRampProperty",da);class An extends xr{constructor(e,r,a){if(super(),this.id=e.id,this.type=e.type,this._globalState=a,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(u,p){return new oa(u,p)})(this.visibility,a),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Vo(e.filter,a)),r.layout&&(this._unevaluatedLayout=new Du(r.layout,a)),r.paint)){this._transitionablePaint=new io(r.paint,a);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ha(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=Vo(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const r of this._visibilityExpression.getGlobalStateRefs())e.add(r);if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const a=this._unevaluatedLayout._values[r];for(const u of a.getGlobalStateRefs())e.add(u)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const a in this._transitionablePaint._values){const u=this._transitionablePaint._values[a].value;for(const p of u.getGlobalStateRefs()){const f=(e=r.get(p))!==null&&e!==void 0?e:[];f.push({name:a,value:u.value}),r.set(p,f)}}return r}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,r,a={}){if(r==null||!this._validate(ca,`layers.${this.id}.layout.${e}`,e,r,a))return e==="visibility"?(this.visibility=r,this._visibilityExpression.setValue(r),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,r)}getPaintProperty(e){return e.endsWith(Ll)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(la,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(Ll))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],p=u.property.specification["property-type"]==="cross-faded-data-driven",f=u.value.isDataDriven(),x=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||f||p||this._handleOverridablePaintPropertyUpdate(e,x,v)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e=this.minzoom,r=!1){return!!(this.minzoom&&e<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),_a(e,((r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length)))}_validate(e,r,a,u,p={}){return(!p||p.validate!==!1)&&ua(this,e.call(ys,{key:r,layerType:this.type,objectKey:a,value:u,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Xn&&Wn(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let Ru;var Wa={get paint(){return Ru=Ru||new ws({"raster-opacity":new Et(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Et(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(Fe.paint_raster["raster-saturation"]),"raster-contrast":new Et(Fe.paint_raster["raster-contrast"]),"raster-resampling":new Et(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(Fe.paint_raster["raster-fade-duration"])})}};class oo extends An{constructor(e,r){super(e,Wa,r)}}const Lu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fl{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _s(s,e=1){let r=0,a=0;return{members:s.map((u=>{const p=Lu[u.type].BYTES_PER_ELEMENT,f=r=Ia(r,Math.max(e,p)),x=u.components||1;return a=Math.max(a,p),r+=p*x,{name:u.name,type:u.type,components:x,offset:f}})),size:Ia(r,Math.max(a,e)),alignment:e}}function Ia(s,e){return Math.ceil(s/e)*e}class Dn extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}Dn.prototype.bytesPerElement=4,bt("StructArrayLayout2i4",Dn);class lo extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=a,this.int16[p+2]=u,e}}lo.prototype.bytesPerElement=6,bt("StructArrayLayout3i6",lo);class Yo extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,u)}emplace(e,r,a,u,p){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=u,this.int16[f+3]=p,e}}Yo.prototype.bytesPerElement=8,bt("StructArrayLayout4i8",Yo);class Xa extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,a,u,p,f)}emplace(e,r,a,u,p,f,x){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=u,this.int16[v+3]=p,this.int16[v+4]=f,this.int16[v+5]=x,e}}Xa.prototype.bytesPerElement=12,bt("StructArrayLayout2i4i12",Xa);class Dc extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,a,u,p,f)}emplace(e,r,a,u,p,f,x){const v=4*e,N=8*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.uint8[N+4]=u,this.uint8[N+5]=p,this.uint8[N+6]=f,this.uint8[N+7]=x,e}}Dc.prototype.bytesPerElement=8,bt("StructArrayLayout2i4ub8",Dc);class Ya extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}Ya.prototype.bytesPerElement=8,bt("StructArrayLayout2f8",Ya);class Ka extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f,x,v,N,C){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,a,u,p,f,x,v,N,C)}emplace(e,r,a,u,p,f,x,v,N,C,A){const L=10*e;return this.uint16[L+0]=r,this.uint16[L+1]=a,this.uint16[L+2]=u,this.uint16[L+3]=p,this.uint16[L+4]=f,this.uint16[L+5]=x,this.uint16[L+6]=v,this.uint16[L+7]=N,this.uint16[L+8]=C,this.uint16[L+9]=A,e}}Ka.prototype.bytesPerElement=20,bt("StructArrayLayout10ui20",Ka);class Ol extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f,x,v){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,a,u,p,f,x,v)}emplace(e,r,a,u,p,f,x,v,N){const C=8*e;return this.uint16[C+0]=r,this.uint16[C+1]=a,this.uint16[C+2]=u,this.uint16[C+3]=p,this.uint16[C+4]=f,this.uint16[C+5]=x,this.uint16[C+6]=v,this.uint16[C+7]=N,e}}Ol.prototype.bytesPerElement=16,bt("StructArrayLayout8ui16",Ol);class Xr extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f,x,v,N,C,A,L){const O=this.length;return this.resize(O+1),this.emplace(O,e,r,a,u,p,f,x,v,N,C,A,L)}emplace(e,r,a,u,p,f,x,v,N,C,A,L,O){const U=12*e;return this.int16[U+0]=r,this.int16[U+1]=a,this.int16[U+2]=u,this.int16[U+3]=p,this.uint16[U+4]=f,this.uint16[U+5]=x,this.uint16[U+6]=v,this.uint16[U+7]=N,this.int16[U+8]=C,this.int16[U+9]=A,this.int16[U+10]=L,this.int16[U+11]=O,e}}Xr.prototype.bytesPerElement=24,bt("StructArrayLayout4i4ui4i24",Xr);class Ko extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=a,this.float32[p+2]=u,e}}Ko.prototype.bytesPerElement=12,bt("StructArrayLayout3f12",Ko);class Jo extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Jo.prototype.bytesPerElement=4,bt("StructArrayLayout1ul4",Jo);class Rc extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f,x,v,N){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,a,u,p,f,x,v,N)}emplace(e,r,a,u,p,f,x,v,N,C){const A=10*e,L=5*e;return this.int16[A+0]=r,this.int16[A+1]=a,this.int16[A+2]=u,this.int16[A+3]=p,this.int16[A+4]=f,this.int16[A+5]=x,this.uint32[L+3]=v,this.uint16[A+8]=N,this.uint16[A+9]=C,e}}Rc.prototype.bytesPerElement=20,bt("StructArrayLayout6i1ul2ui20",Rc);class ji extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,a,u,p,f)}emplace(e,r,a,u,p,f,x){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=a,this.int16[v+2]=u,this.int16[v+3]=p,this.int16[v+4]=f,this.int16[v+5]=x,e}}ji.prototype.bytesPerElement=12,bt("StructArrayLayout2i2i2i12",ji);class Si extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,p)}emplace(e,r,a,u,p,f){const x=4*e,v=8*e;return this.float32[x+0]=r,this.float32[x+1]=a,this.float32[x+2]=u,this.int16[v+6]=p,this.int16[v+7]=f,e}}Si.prototype.bytesPerElement=16,bt("StructArrayLayout2f1f2i16",Si);class Ti extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,a,u,p,f)}emplace(e,r,a,u,p,f,x){const v=16*e,N=4*e,C=8*e;return this.uint8[v+0]=r,this.uint8[v+1]=a,this.float32[N+1]=u,this.float32[N+2]=p,this.int16[C+6]=f,this.int16[C+7]=x,e}}Ti.prototype.bytesPerElement=16,bt("StructArrayLayout2ub2f2i16",Ti);class Yr extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=a,this.uint16[p+2]=u,e}}Yr.prototype.bytesPerElement=6,bt("StructArrayLayout3ui6",Yr);class cs extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f,x,v,N,C,A,L,O,U,q,Z,te){const pe=this.length;return this.resize(pe+1),this.emplace(pe,e,r,a,u,p,f,x,v,N,C,A,L,O,U,q,Z,te)}emplace(e,r,a,u,p,f,x,v,N,C,A,L,O,U,q,Z,te,pe){const ae=24*e,oe=12*e,fe=48*e;return this.int16[ae+0]=r,this.int16[ae+1]=a,this.uint16[ae+2]=u,this.uint16[ae+3]=p,this.uint32[oe+2]=f,this.uint32[oe+3]=x,this.uint32[oe+4]=v,this.uint16[ae+10]=N,this.uint16[ae+11]=C,this.uint16[ae+12]=A,this.float32[oe+7]=L,this.float32[oe+8]=O,this.uint8[fe+36]=U,this.uint8[fe+37]=q,this.uint8[fe+38]=Z,this.uint32[oe+10]=te,this.int16[ae+22]=pe,e}}cs.prototype.bytesPerElement=48,bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",cs);class zs extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,p,f,x,v,N,C,A,L,O,U,q,Z,te,pe,ae,oe,fe,_e,De,Je,We,tt,gt,st){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,r,a,u,p,f,x,v,N,C,A,L,O,U,q,Z,te,pe,ae,oe,fe,_e,De,Je,We,tt,gt,st)}emplace(e,r,a,u,p,f,x,v,N,C,A,L,O,U,q,Z,te,pe,ae,oe,fe,_e,De,Je,We,tt,gt,st,Ke){const qe=32*e,Pt=16*e;return this.int16[qe+0]=r,this.int16[qe+1]=a,this.int16[qe+2]=u,this.int16[qe+3]=p,this.int16[qe+4]=f,this.int16[qe+5]=x,this.int16[qe+6]=v,this.int16[qe+7]=N,this.uint16[qe+8]=C,this.uint16[qe+9]=A,this.uint16[qe+10]=L,this.uint16[qe+11]=O,this.uint16[qe+12]=U,this.uint16[qe+13]=q,this.uint16[qe+14]=Z,this.uint16[qe+15]=te,this.uint16[qe+16]=pe,this.uint16[qe+17]=ae,this.uint16[qe+18]=oe,this.uint16[qe+19]=fe,this.uint16[qe+20]=_e,this.uint16[qe+21]=De,this.uint16[qe+22]=Je,this.uint32[Pt+12]=We,this.float32[Pt+13]=tt,this.float32[Pt+14]=gt,this.uint16[qe+30]=st,this.uint16[qe+31]=Ke,e}}zs.prototype.bytesPerElement=64,bt("StructArrayLayout8i15ui1ul2f2ui64",zs);class Qo extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Qo.prototype.bytesPerElement=4,bt("StructArrayLayout1f4",Qo);class co extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const p=3*e;return this.uint16[6*e+0]=r,this.float32[p+1]=a,this.float32[p+2]=u,e}}co.prototype.bytesPerElement=12,bt("StructArrayLayout1ui2f12",co);class el extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const p=4*e;return this.uint32[2*e+0]=r,this.uint16[p+2]=a,this.uint16[p+3]=u,e}}el.prototype.bytesPerElement=8,bt("StructArrayLayout1ul2ui8",el);class m extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}m.prototype.bytesPerElement=4,bt("StructArrayLayout2ui4",m);class t extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}t.prototype.bytesPerElement=2,bt("StructArrayLayout1ui2",t);class n extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,a,u)}emplace(e,r,a,u,p){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=u,this.float32[f+3]=p,e}}n.prototype.bytesPerElement=16,bt("StructArrayLayout4f16",n);class l extends Fl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new V(this.anchorPointX,this.anchorPointY)}}l.prototype.size=20;class h extends Rc{get(e){return new l(this,e)}}bt("CollisionBoxArray",h);class g extends Fl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}g.prototype.size=48;class _ extends cs{get(e){return new g(this,e)}}bt("PlacedSymbolArray",_);class j extends Fl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}j.prototype.size=64;class E extends zs{get(e){return new j(this,e)}}bt("SymbolInstanceArray",E);class M extends Qo{getoffsetX(e){return this.float32[1*e+0]}}bt("GlyphOffsetArray",M);class D extends lo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}bt("SymbolLineVertexArray",D);class $ extends Fl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}$.prototype.size=12;class B extends co{get(e){return new $(this,e)}}bt("TextAnchorOffsetArray",B);class G extends Fl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}G.prototype.size=8;class J extends el{get(e){return new G(this,e)}}bt("FeatureIndexArray",J);class le extends Dn{}class ue extends Dn{}class ce extends Dn{}class de extends Xa{}class xe extends Dc{}class he extends Ya{}class ge extends Ka{}class we extends Ol{}class me extends Xr{}class Ne extends Ko{}class Ue extends Jo{}class Re extends ji{}class Oe extends Ti{}class Be extends Yr{}class ot extends m{}const ct=_s([{name:"a_pos",components:2,type:"Int16"}],4),{members:et}=ct;class xt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,a,u){const p=this.segments[this.segments.length-1];return e>xt.MAX_VERTEX_ARRAY_LENGTH&&Cs(`Max vertices per segment is ${xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${xt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+e>xt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u?this.createNewSegment(r,a,u):p}createNewSegment(e,r,a){const u={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return a!==void 0&&(u.sortKey=a),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,r,a){return this.prepareSegment(0,e,r,a)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new xt([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function rr(s,e){return 256*(s=Ht(Math.floor(s),0,255))+Ht(Math.floor(e),0,255)}xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bt("SegmentVector",xt);const zr=_s([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),rs=_s([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Vr,ss,$r,ns={exports:{}},us={exports:{}},Xs={exports:{}},js=(function(){if($r)return ns.exports;$r=1;var s=(Vr||(Vr=1,us.exports=function(r,a){var u,p,f,x,v,N,C,A;for(p=r.length-(u=3&r.length),f=a,v=3432918353,N=461845907,A=0;A<p;)C=255&r.charCodeAt(A)|(255&r.charCodeAt(++A))<<8|(255&r.charCodeAt(++A))<<16|(255&r.charCodeAt(++A))<<24,++A,f=27492+(65535&(x=5*(65535&(f=(f^=C=(65535&(C=(C=(65535&C)*v+(((C>>>16)*v&65535)<<16)&4294967295)<<15|C>>>17))*N+(((C>>>16)*N&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(C=0,u){case 3:C^=(255&r.charCodeAt(A+2))<<16;case 2:C^=(255&r.charCodeAt(A+1))<<8;case 1:f^=C=(65535&(C=(C=(65535&(C^=255&r.charCodeAt(A)))*v+(((C>>>16)*v&65535)<<16)&4294967295)<<15|C>>>17))*N+(((C>>>16)*N&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),us.exports),e=(ss||(ss=1,Xs.exports=function(r,a){for(var u,p=r.length,f=a^p,x=0;p>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(x)|(255&r.charCodeAt(++x))<<8|(255&r.charCodeAt(++x))<<16|(255&r.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:f^=(255&r.charCodeAt(x+2))<<16;case 2:f^=(255&r.charCodeAt(x+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(x)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Xs.exports);return ns.exports=s,ns.exports.murmur3=s,ns.exports.murmur2=e,ns.exports})(),Pr=W(js);class Fs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push(za(e)),this.positions.push(r,a,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=za(e);let a=0,u=this.ids.length-1;for(;a<u;){const f=a+u>>1;this.ids[f]>=r?u=f:a=f+1}const p=[];for(;this.ids[a]===r;)p.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return p}static serialize(e,r){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Ja(a,u,0,a.length-1),r&&r.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const r=new Fs;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function za(s){const e=+s;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Pr(String(s))}function Ja(s,e,r,a){for(;r<a;){const u=s[r+a>>1];let p=r-1,f=a+1;for(;;){do p++;while(s[p]<u);do f--;while(s[f]>u);if(p>=f)break;Aa(s,p,f),Aa(e,3*p,3*f),Aa(e,3*p+1,3*f+1),Aa(e,3*p+2,3*f+2)}f-r<a-f?(Ja(s,e,r,f),r=f+1):(Ja(s,e,f+1,a),a=f)}}function Aa(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}bt("FeaturePositionMap",Fs);class jn{constructor(e,r){this.gl=e.gl,this.location=r}}class Ni extends jn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Qa extends jn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ei extends jn{constructor(e,r){super(e,r),this.current=ir.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Rn=new Float32Array(16);function ei(s){return[rr(255*s.r,255*s.g),rr(255*s.b,255*s.a)]}class ha{constructor(e,r,a){this.value=e,this.uniformNames=r.map((u=>`u_${u}`)),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new Ei(e,r):new Ni(e,r)}}class pa{constructor(e,r){this.uniformNames=r.map((a=>`u_${a}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,r){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(e,r,a,u){let p=null;u==="u_pattern_to"?p=this.patternTo:u==="u_pattern_from"?p=this.patternFrom:u==="u_dasharray_to"?p=this.dashTo:u==="u_dasharray_from"?p=this.dashFrom:u==="u_pixel_ratio_to"?p=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&e.set(p)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"||a.substr(0,12)==="u_dasharray_"?new Qa(e,r):new Ni(e,r)}}class qr{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map((p=>({name:`a_${p}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,r,a){const u=this.paintVertexArray.length,p=this.expression.evaluate(new Rr(0,a),r,{},a.canonical,[],a.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,p)}updatePaintArray(e,r,a,u,p){const f=this.expression.evaluate(new Rr(0,p),a,u);this._setPaintValue(e,r,f)}_setPaintValue(e,r,a){if(this.type==="color"){const u=ei(a);for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ur{constructor(e,r,a,u,p,f){this.expression=e,this.uniformNames=r.map((x=>`u_${x}_t`)),this.type=a,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map((x=>({name:`a_${x}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new f}populatePaintArray(e,r,a){const u=this.expression.evaluate(new Rr(this.zoom,a),r,{},a.canonical,[],a.formattedSection),p=this.expression.evaluate(new Rr(this.zoom+1,a),r,{},a.canonical,[],a.formattedSection),f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(f,e,u,p)}updatePaintArray(e,r,a,u,p){const f=this.expression.evaluate(new Rr(this.zoom,p),a,u),x=this.expression.evaluate(new Rr(this.zoom+1,p),a,u);this._setPaintValue(e,r,f,x)}_setPaintValue(e,r,a,u){if(this.type==="color"){const p=ei(a),f=ei(u);for(let x=e;x<r;x++)this.paintVertexArray.emplace(x,p[0],p[1],f[0],f[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=Ht(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,a){return new Ni(e,r)}}class As{constructor(e,r,a,u,p,f){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=u,this.layerId=f,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,r,a){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(r),a)}updatePaintArray(e,r,a,u,p){this._setPaintValues(e,r,this.getPositionIds(a),p)}_setPaintValues(e,r,a,u){const p=this.getPositions(u);if(!p||!a)return;const f=p[a.min],x=p[a.mid],v=p[a.max];if(f&&x&&v)for(let N=e;N<r;N++)this.emplace(this.zoomInPaintVertexArray,N,x,f),this.emplace(this.zoomOutPaintVertexArray,N,x,v)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Os extends As{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return zr.members}emplace(e,r,a,u){e.emplace(r,a.tlbr[0],a.tlbr[1],a.tlbr[2],a.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],a.pixelRatio,u.pixelRatio)}}class Sn extends As{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return rs.members}emplace(e,r,a,u){e.emplace(r,0,a.y,a.height,a.width,0,u.y,u.height,u.width)}}class dn{constructor(e,r,a){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!a(p))continue;const f=e.paint.get(p);if(!(f instanceof Xn&&Wn(f.property.specification)))continue;const x=jh(p,e.type),v=f.value,N=f.property.specification.type,C=f.property.useIntegerZoom,A=f.property.specification["property-type"],L=A==="cross-faded"||A==="cross-faded-data-driven";if(v.kind==="constant")this.binders[p]=L?new pa(v.value,x):new ha(v.value,x,N),u.push(`/u_${p}`);else if(v.kind==="source"||L){const O=zd(p,N,"source");this.binders[p]=L?p==="line-dasharray"?new Sn(v,N,C,r,O,e.id):new Os(v,N,C,r,O,e.id):new qr(v,x,N,O),u.push(`/a_${p}`)}else{const O=zd(p,N,"composite");this.binders[p]=new Ur(v,x,N,C,r,O),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof qr||r instanceof Ur?r.maxValue:0}populatePaintArrays(e,r,a){for(const u in this.binders){const p=this.binders[u];(p instanceof qr||p instanceof Ur||p instanceof As)&&p.populatePaintArray(e,r,a)}}setConstantPatternPositions(e,r){for(const a in this.binders){const u=this.binders[a];u instanceof pa&&u.setConstantPatternPositions(e,r)}}setConstantDashPositions(e,r){for(const a in this.binders){const u=this.binders[a];u instanceof pa&&u.setConstantDashPositions(e,r)}}updatePaintArrays(e,r,a,u,p){let f=!1;for(const x in e){const v=r.getPositions(x);for(const N of v){const C=a.feature(N.index);for(const A in this.binders){const L=this.binders[A];if((L instanceof qr||L instanceof Ur||L instanceof As)&&L.expression.isStateDependent===!0){const O=u.paint.get(A);L.expression=O.value,L.updatePaintArray(N.start,N.end,C,e[x],p),f=!0}}}}return f}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof ha||a instanceof pa)&&e.push(...a.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof qr||a instanceof Ur)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name);else if(a instanceof As){const u=a.getVertexAttributes();for(const p of u)e.push(p.name)}}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof ha||a instanceof pa||a instanceof Ur)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof ha||p instanceof pa||p instanceof Ur){for(const f of p.uniformNames)if(r[f]){const x=p.getBinding(e,r[f],f);a.push({name:f,property:u,binding:x})}}}return a}setUniforms(e,r,a,u){for(const{name:p,property:f,binding:x}of r)this.binders[f].setUniform(x,u,a.get(f),p)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof As){const u=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(a instanceof qr||a instanceof Ur)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof qr||a instanceof Ur||a instanceof As)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof qr||r instanceof Ur||r instanceof As)&&r.destroy()}}}class uo{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new dn(u,r,a);this.needsUpload=!1,this._featureMap=new Fs,this._bufferOffset=0}populatePaintArrays(e,r,a,u){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,r,u);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u){for(const p of a)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function jh(s,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}function zd(s,e,r){const a={color:{source:Ya,composite:n},number:{source:Qo,composite:Ya}},u=(function(p){return{"line-pattern":{source:ge,composite:ge},"fill-pattern":{source:ge,composite:ge},"fill-extrusion-pattern":{source:ge,composite:ge},"line-dasharray":{source:we,composite:we}}[p]})(s);return u&&u[r]||a[e][r]}bt("ConstantBinder",ha),bt("CrossFadedConstantBinder",pa),bt("SourceExpressionBinder",qr),bt("CrossFadedPatternBinder",Os),bt("CrossFadedDasharrayBinder",Sn),bt("CompositeExpressionBinder",Ur),bt("ProgramConfiguration",dn,{omit:["_buffers"]}),bt("ProgramConfigurationSet",uo);const Fu=Math.pow(2,14)-1,Ci=-Fu-1;function ti(s){const e=ht/s.extent,r=s.loadGeometry();for(let a=0;a<r.length;a++){const u=r[a];for(let p=0;p<u.length;p++){const f=u[p],x=Math.round(f.x*e),v=Math.round(f.y*e);f.x=Ht(x,Ci,Fu),f.y=Ht(v,Ci,Fu),(x<f.x||x>f.x+1||v<f.y||v>f.y+1)&&Cs("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Pi(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?ti(s):[]}}const Lc=-32768;function Ou(s,e,r,a,u){s.emplaceBack(Lc+8*e+a,Lc+8*r+u)}class Fc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ue,this.indexArray=new Be,this.segments=new xt,this.programConfigurations=new uo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,a){const u=this.layers[0],p=[];let f=null,x=!1,v=u.type==="heatmap";if(u.type==="circle"){const C=u;f=C.layout.get("circle-sort-key"),x=!f.isConstant(),v=v||C.paint.get("circle-pitch-alignment")==="map"}const N=v?r.subdivisionGranularity.circle:1;for(const{feature:C,id:A,index:L,sourceLayerIndex:O}of e){const U=this.layers[0]._featureFilter.needGeometry,q=Pi(C,U);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),q,a))continue;const Z=x?f.evaluate(q,{},a):void 0,te={id:A,properties:C.properties,type:C.type,sourceLayerIndex:O,index:L,geometry:U?q.geometry:ti(C),patterns:{},sortKey:Z};p.push(te)}x&&p.sort(((C,A)=>C.sortKey-A.sortKey));for(const C of p){const{geometry:A,index:L,sourceLayerIndex:O}=C,U=e[L].feature;this.addFeature(C,A,L,a,N),r.featureIndex.insert(U,A,L,O,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:a})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,et),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u,p=1){let f;switch(p){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const x=f.length;for(const v of r)for(const N of v){const C=N.x,A=N.y;if(C<0||C>=ht||A<0||A>=ht)continue;const L=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,e.sortKey),O=L.vertexLength;for(let U=0;U<x;U++)for(let q=0;q<x;q++)Ou(this.layoutVertexArray,C,A,f[q],f[U]);for(let U=0;U<x-1;U++)for(let q=0;q<x-1;q++){const Z=O+U*x+q,te=O+(U+1)*x+q;this.indexArray.emplaceBack(Z,te+1,Z+1),this.indexArray.emplaceBack(Z,te,te+1)}L.vertexLength+=x*x,L.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{imagePositions:{},canonical:u})}}function Bl(s,e){for(let r=0;r<s.length;r++)if(tl(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(tl(s,e[r]))return!0;return!!Vu(s,e)}function Bu(s,e,r){return!!tl(s,e)||!!Sh(e,s,r)}function lp(s,e){if(s.length===1)return up(e,s[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let u=0;u<a.length;u++)if(tl(s,a[u]))return!0}for(let r=0;r<s.length;r++)if(up(e,s[r]))return!0;for(let r=0;r<e.length;r++)if(Vu(s,e[r]))return!0;return!1}function cp(s,e,r){if(s.length>1){if(Vu(s,e))return!0;for(let a=0;a<e.length;a++)if(Sh(e[a],s,r))return!0}for(let a=0;a<s.length;a++)if(Sh(s[a],e,r))return!0;return!1}function Vu(s,e){if(s.length===0||e.length===0)return!1;for(let r=0;r<s.length-1;r++){const a=s[r],u=s[r+1];for(let p=0;p<e.length-1;p++)if(wm(a,u,e[p],e[p+1]))return!0}return!1}function wm(s,e,r,a){return Gn(s,r,a)!==Gn(e,r,a)&&Gn(s,e,r)!==Gn(s,e,a)}function Sh(s,e,r){const a=r*r;if(e.length===1)return s.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(Th(s,e[u-1],e[u])<a)return!0;return!1}function Th(s,e,r){const a=e.distSqr(r);if(a===0)return s.distSqr(e);const u=((s.x-e.x)*(r.x-e.x)+(s.y-e.y)*(r.y-e.y))/a;return s.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function up(s,e){let r,a,u,p=!1;for(let f=0;f<s.length;f++){r=s[f];for(let x=0,v=r.length-1;x<r.length;v=x++)a=r[x],u=r[v],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(p=!p)}return p}function tl(s,e){let r=!1;for(let a=0,u=s.length-1;a<s.length;u=a++){const p=s[a],f=s[u];p.y>e.y!=f.y>e.y&&e.x<(f.x-p.x)*(e.y-p.y)/(f.y-p.y)+p.x&&(r=!r)}return r}function rl(s,e,r){const a=r[0],u=r[2];if(s.x<a.x&&e.x<a.x||s.x>u.x&&e.x>u.x||s.y<a.y&&e.y<a.y||s.y>u.y&&e.y>u.y)return!1;const p=Gn(s,e,r[0]);return p!==Gn(s,e,r[1])||p!==Gn(s,e,r[2])||p!==Gn(s,e,r[3])}function $u(s,e,r){const a=e.paint.get(s).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(s)}function Ad(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Uu(s,e,r,a,u){if(!e[0]&&!e[1])return s;const p=V.convert(e)._mult(u);r==="viewport"&&p._rotate(-a);const f=[];for(let x=0;x<s.length;x++)f.push(s[x].sub(p));return f}function rf(s){const e=[];for(let r=0;r<s.length;r++){const a=s[r],u=e.at(-1);(r===0||u&&!a.equals(u))&&e.push(a)}return e}function sf({queryGeometry:s,size:e},r){return Bu(s,r,e)}function Dd({queryGeometry:s,size:e,transform:r,unwrappedTileID:a,getElevation:u},p){return Bu(s,p,e*(r.projectTileCoordinates(p.x,p.y,a,u).signedDistanceFromCamera/r.cameraToCenterDistance))}function Ln({queryGeometry:s,size:e,transform:r,unwrappedTileID:a,getElevation:u},p){const f=r.projectTileCoordinates(p.x,p.y,a,u).signedDistanceFromCamera,x=e*(r.cameraToCenterDistance/f);return Bu(s,qu(p,r,a,u),x)}function km({queryGeometry:s,size:e,transform:r,unwrappedTileID:a,getElevation:u},p){return Bu(s,qu(p,r,a,u),e)}function nf({queryGeometry:s,size:e,transform:r,unwrappedTileID:a,getElevation:u,pitchAlignment:p="map",pitchScale:f="map"},x){const v=p==="map"?f==="map"?sf:Dd:f==="map"?Ln:km,N={queryGeometry:s,size:e,transform:r,unwrappedTileID:a,getElevation:u};for(const C of x)for(const A of C)if(v(N,A))return!0;return!1}function qu(s,e,r,a){const u=e.projectTileCoordinates(s.x,s.y,r,a).point;return new V((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let Tn,af;bt("CircleBucket",Fc,{omit:["layers"]});var Ot={get paint(){return af=af||new ws({"circle-radius":new Rt(Fe.paint_circle["circle-radius"]),"circle-color":new Rt(Fe.paint_circle["circle-color"]),"circle-blur":new Rt(Fe.paint_circle["circle-blur"]),"circle-opacity":new Rt(Fe.paint_circle["circle-opacity"]),"circle-translate":new Et(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rt(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rt(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rt(Fe.paint_circle["circle-stroke-opacity"])})},get layout(){return Tn=Tn||new ws({"circle-sort-key":new Rt(Fe.layout_circle["circle-sort-key"])})}};class Gu extends An{constructor(e,r){super(e,Ot,r)}createBucket(e){return new Fc(e)}queryRadius(e){const r=e;return $u("circle-radius",this,r)+$u("circle-stroke-width",this,r)+Ad(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:a,geometry:u,transform:p,pixelsToTileUnits:f,unwrappedTileID:x,getElevation:v}){const N=Uu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,f),C=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),A=this.paint.get("circle-pitch-scale"),L=this.paint.get("circle-pitch-alignment");let O,U;return L==="map"?(O=N,U=C*f):(O=(function(q,Z,te,pe){return q.map((ae=>qu(ae,Z,te,pe)))})(N,p,x,v),U=C),nf({queryGeometry:O,size:U,transform:p,unwrappedTileID:x,getElevation:v,pitchAlignment:L,pitchScale:A},u)}}class Nh extends Fc{}let dp;bt("HeatmapBucket",Nh,{omit:["layers"]});var jm={get paint(){return dp=dp||new ws({"heatmap-radius":new Rt(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rt(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new da(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(Fe.paint_heatmap["heatmap-opacity"])})}};function Oc(s,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*r*a}`)}else u=new Uint8Array(e*r*a);return s.width=e,s.height=r,s.data=u,s}function Rd(s,{width:e,height:r},a){if(e===s.width&&r===s.height)return;const u=Oc({},{width:e,height:r},a);Ld(s,u,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,e),height:Math.min(s.height,r)},a),s.width=e,s.height=r,s.data=u.data}function Ld(s,e,r,a,u,p){if(u.width===0||u.height===0)return e;if(u.width>s.width||u.height>s.height||r.x>s.width-u.width||r.y>s.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const f=s.data,x=e.data;if(f===x)throw new Error("srcData equals dstData, so image is already copied");for(let v=0;v<u.height;v++){const N=((r.y+v)*s.width+r.x)*p,C=((a.y+v)*e.width+a.x)*p;for(let A=0;A<u.width*p;A++)x[C+A]=f[N+A]}return e}class Zu{constructor(e,r){Oc(this,e,1,r)}resize(e){Rd(this,e,1)}clone(){return new Zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,p){Ld(e,r,a,u,p,1)}}class Fn{constructor(e,r){Oc(this,e,4,r)}resize(e){Rd(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,p){Ld(e,r,a,u,p,4)}setPixel(e,r,a){const u=4*(e*this.width+r);this.data[u+0]=Math.round(255*a.r/a.a),this.data[u+1]=Math.round(255*a.g/a.a),this.data[u+2]=Math.round(255*a.b/a.a),this.data[u+3]=Math.round(255*a.a)}}function hp(s){const e={},r=s.resolution||256,a=s.clips?s.clips.length:1,u=s.image||new Fn({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(f,x,v)=>{e[s.evaluationKey]=v;const N=s.expression.evaluate(e);u.setPixel(f/4/r,x/4,N)};if(s.clips)for(let f=0,x=0;f<a;++f,x+=4*r)for(let v=0,N=0;v<r;v++,N+=4){const C=v/(r-1),{start:A,end:L}=s.clips[f];p(x,N,A*(1-C)+L*C)}else for(let f=0,x=0;f<r;f++,x+=4)p(0,x,f/(r-1));return u}bt("AlphaImage",Zu),bt("RGBAImage",Fn);const Fd="big-fb";class pp extends An{createBucket(e){return new Nh(e)}constructor(e,r){super(e,jm,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Fd)&&this.heatmapFbos.delete(Fd)}queryRadius(e){return $u("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:a,geometry:u,transform:p,pixelsToTileUnits:f,unwrappedTileID:x,getElevation:v}){return nf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(r,a)*f,transform:p,unwrappedTileID:x,getElevation:v},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let hn;var Mi={get paint(){return hn=hn||new ws({"hillshade-illumination-direction":new Et(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Et(Fe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Et(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(Fe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Et(Fe.paint_hillshade["hillshade-method"])})}};class Vl extends An{constructor(e,r){super(e,Mi,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,a=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const p=Math.max(e.length,r.length,a.length,u.length);e=e.concat(Array(p-e.length).fill(e.at(-1))),r=r.concat(Array(p-r.length).fill(r.at(-1))),a=a.concat(Array(p-a.length).fill(a.at(-1))),u=u.concat(Array(p-u.length).fill(u.at(-1)));const f=r.map(bo);return{directionRadians:e.map(bo),altitudeRadians:f,shadowColor:u,highlightColor:a}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let fp;var of={get paint(){return fp=fp||new ws({"color-relief-opacity":new Et(Fe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new da(Fe["paint_color-relief"]["color-relief-color"])})}};class Da{constructor(e,r,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,a){const{width:u,height:p}=e,f=!(this.size&&this.size[0]===u&&this.size[1]===p||a),{context:x}=this,{gl:v}=x;if(this.useMipmap=!!(r&&r.useMipmap),v.bindTexture(v.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!r||r.premultiply!==!1)),f)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||fi(e)?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,u,p,0,this.format,v.UNSIGNED_BYTE,e.data);else{const{x:N,y:C}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||fi(e)?v.texSubImage2D(v.TEXTURE_2D,0,N,C,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,N,C,u,p,v.RGBA,v.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&v.generateMipmap(v.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,a){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),a!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,a||e),this.filter=e),r!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class mp{constructor(e,r,a,u=1,p=1,f=1,x=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Cs(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const v=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=f,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let N=0;N<v;N++)this.data[this._idx(-1,N)]=this.data[this._idx(0,N)],this.data[this._idx(v,N)]=this.data[this._idx(v-1,N)],this.data[this._idx(N,-1)]=this.data[this._idx(N,0)],this.data[this._idx(N,v)]=this.data[this._idx(N,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let N=0;N<v;N++)for(let C=0;C<v;C++){const A=this.get(N,C);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(e,r){const a=new Uint8Array(this.data.buffer),u=4*this._idx(e,r);return this.unpack(a[u],a[u+1],a[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${r}, dim: ${this.dim}`);return(r+1)*this.stride+(e+1)}unpack(e,r,a){return e*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}pack(e){return Ii(e,this.getUnpackVector())}getPixels(){return new Fn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,p=r*this.dim+this.dim,f=a*this.dim,x=a*this.dim+this.dim;switch(r){case-1:u=p-1;break;case 1:p=u+1}switch(a){case-1:f=x-1;break;case 1:x=f+1}const v=-r*this.dim,N=-a*this.dim;for(let C=f;C<x;C++)for(let A=u;A<p;A++)this.data[this._idx(A,C)]=e.data[this._idx(A+v,C+N)]}}function Ii(s,e){const r=e[0],a=e[1],u=e[2],p=e[3],f=Math.min(r,a,u),x=Math.round((s+p)/f);return{r:Math.floor(x*f/r)%256,g:Math.floor(x*f/a)%256,b:Math.floor(x*f/u)%256}}bt("DEMData",mp);class Sm extends An{constructor(e,r){super(e,of,r)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},a=this._transitionablePaint._values["color-relief-color"].value.expression;if(a instanceof Xi&&a._styleExpression.expression instanceof Zs){this.colorRampExpression=a;const f=a._styleExpression.expression;r.elevationStops=f.labels,r.colorStops=[];for(const x of r.elevationStops)r.colorStops.push(f.evaluate({globals:{elevation:x}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[ir.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const u={elevationStops:[],colorStops:[]},p=(r.elevationStops.length-1)/(e-1);for(let f=0;f<r.elevationStops.length-.5;f+=p)u.elevationStops.push(r.elevationStops[Math.round(f)]),u.colorStops.push(r.colorStops[Math.round(f)]);return Cs(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${r.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,a){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(r),p=new Fn({width:u.colorStops.length,height:1}),f=new Fn({width:u.colorStops.length,height:1});for(let x=0;x<u.elevationStops.length;x++){const v=Ii(u.elevationStops[x],a);f.setPixel(0,x,new ir(v.r/255,v.g/255,v.b/255,1)),p.setPixel(0,x,u.colorStops[x])}return this.colorRampTextures={elevationTexture:new Da(e,f,e.gl.RGBA),colorTexture:new Da(e,p,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const lf=_s([{name:"a_pos",components:2,type:"Int16"}],4),{members:cf}=lf;function Od(s,e,r){const a=r.patternDependencies;let u=!1;for(const p of e){const f=p.paint.get(`${s}-pattern`);f.isConstant()||(u=!0);const x=f.constantOr(null);x&&(u=!0,a[x.to]=!0,a[x.from]=!0)}return u}function Eh(s,e,r,a,u){const{zoom:p}=a,f=u.patternDependencies;for(const x of e){const v=x.paint.get(`${s}-pattern`).value;if(v.kind!=="constant"){let N=v.evaluate({zoom:p-1},r,{},u.availableImages),C=v.evaluate({zoom:p},r,{},u.availableImages),A=v.evaluate({zoom:p+1},r,{},u.availableImages);N=N&&N.name?N.name:N,C=C&&C.name?C.name:C,A=A&&A.name?A.name:A,f[N]=!0,f[C]=!0,f[A]=!0,r.patterns[x.id]={min:N,mid:C,max:A}}}return r}function uf(s,e,r,a,u){let p;if(u===(function(f,x,v,N){let C=0;for(let A=x,L=v-N;A<v;A+=N)C+=(f[L]-f[A])*(f[A+1]+f[L+1]),L=A;return C})(s,e,r,a)>0)for(let f=e;f<r;f+=a)p=nl(f/a|0,s[f],s[f+1],p);else for(let f=r-a;f>=e;f-=a)p=nl(f/a|0,s[f],s[f+1],p);return p&&nn(p,p.next)&&(Gl(p),p=p.next),p}function ho(s,e){if(!s)return s;e||(e=s);let r,a=s;do if(r=!1,a.steiner||!nn(a,a.next)&&ds(a.prev,a,a.next)!==0)a=a.next;else{if(Gl(a),a=e=a.prev,a===a.next)break;r=!0}while(r||a!==e);return e}function Bc(s,e,r,a,u,p,f){if(!s)return;!f&&p&&(function(v,N,C,A){let L=v;do L.z===0&&(L.z=Bs(L.x,L.y,N,C,A)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==v);L.prevZ.nextZ=null,L.prevZ=null,(function(O){let U,q=1;do{let Z,te=O;O=null;let pe=null;for(U=0;te;){U++;let ae=te,oe=0;for(let _e=0;_e<q&&(oe++,ae=ae.nextZ,ae);_e++);let fe=q;for(;oe>0||fe>0&&ae;)oe!==0&&(fe===0||!ae||te.z<=ae.z)?(Z=te,te=te.nextZ,oe--):(Z=ae,ae=ae.nextZ,fe--),pe?pe.nextZ=Z:O=Z,Z.prevZ=pe,pe=Z;te=ae}pe.nextZ=null,q*=2}while(U>1)})(L)})(s,a,u,p);let x=s;for(;s.prev!==s.next;){const v=s.prev,N=s.next;if(p?Ar(s,a,u,p):ri(s))e.push(v.i,s.i,N.i),Gl(s),s=N.next,x=N.next;else if((s=N)===x){f?f===1?Bc(s=pn(ho(s),e),e,r,a,u,p,2):f===2&&Ys(s,e,r,a,u,p):Bc(ho(s),e,r,a,u,p,1);break}}}function ri(s){const e=s.prev,r=s,a=s.next;if(ds(e,r,a)>=0)return!1;const u=e.x,p=r.x,f=a.x,x=e.y,v=r.y,N=a.y,C=Math.min(u,p,f),A=Math.min(x,v,N),L=Math.max(u,p,f),O=Math.max(x,v,N);let U=a.next;for(;U!==e;){if(U.x>=C&&U.x<=L&&U.y>=A&&U.y<=O&&Ul(u,x,p,v,f,N,U.x,U.y)&&ds(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Ar(s,e,r,a){const u=s.prev,p=s,f=s.next;if(ds(u,p,f)>=0)return!1;const x=u.x,v=p.x,N=f.x,C=u.y,A=p.y,L=f.y,O=Math.min(x,v,N),U=Math.min(C,A,L),q=Math.max(x,v,N),Z=Math.max(C,A,L),te=Bs(O,U,e,r,a),pe=Bs(q,Z,e,r,a);let ae=s.prevZ,oe=s.nextZ;for(;ae&&ae.z>=te&&oe&&oe.z<=pe;){if(ae.x>=O&&ae.x<=q&&ae.y>=U&&ae.y<=Z&&ae!==u&&ae!==f&&Ul(x,C,v,A,N,L,ae.x,ae.y)&&ds(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,oe.x>=O&&oe.x<=q&&oe.y>=U&&oe.y<=Z&&oe!==u&&oe!==f&&Ul(x,C,v,A,N,L,oe.x,oe.y)&&ds(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;ae&&ae.z>=te;){if(ae.x>=O&&ae.x<=q&&ae.y>=U&&ae.y<=Z&&ae!==u&&ae!==f&&Ul(x,C,v,A,N,L,ae.x,ae.y)&&ds(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;oe&&oe.z<=pe;){if(oe.x>=O&&oe.x<=q&&oe.y>=U&&oe.y<=Z&&oe!==u&&oe!==f&&Ul(x,C,v,A,N,L,oe.x,oe.y)&&ds(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function pn(s,e){let r=s;do{const a=r.prev,u=r.next.next;!nn(a,u)&&Ch(a,r,r.next,u)&&ql(a,u)&&ql(u,a)&&(e.push(a.i,r.i,u.i),Gl(r),Gl(r.next),r=s=u),r=r.next}while(r!==s);return ho(r)}function Ys(s,e,r,a,u,p){let f=s;do{let x=f.next.next;for(;x!==f.prev;){if(f.i!==x.i&&gp(f,x)){let v=Ph(f,x);return f=ho(f,f.next),v=ho(v,v.next),Bc(f,e,r,a,u,p,0),void Bc(v,e,r,a,u,p,0)}x=x.next}f=f.next}while(f!==s)}function Nn(s,e){let r=s.x-e.x;return r===0&&(r=s.y-e.y,r===0)&&(r=(s.next.y-s.y)/(s.next.x-s.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function Ra(s,e){const r=(function(u,p){let f=p;const x=u.x,v=u.y;let N,C=-1/0;if(nn(u,f))return f;do{if(nn(u,f.next))return f.next;if(v<=f.y&&v>=f.next.y&&f.next.y!==f.y){const q=f.x+(v-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(q<=x&&q>C&&(C=q,N=f.x<f.next.x?f:f.next,q===x))return N}f=f.next}while(f!==p);if(!N)return null;const A=N,L=N.x,O=N.y;let U=1/0;f=N;do{if(x>=f.x&&f.x>=L&&x!==f.x&&$l(v<O?x:C,v,L,O,v<O?C:x,v,f.x,f.y)){const q=Math.abs(v-f.y)/(x-f.x);ql(f,u)&&(q<U||q===U&&(f.x>N.x||f.x===N.x&&Hu(N,f)))&&(N=f,U=q)}f=f.next}while(f!==A);return N})(s,e);if(!r)return e;const a=Ph(r,s);return ho(a,a.next),ho(r,r.next)}function Hu(s,e){return ds(s.prev,s,e.prev)<0&&ds(e.next,s,s.next)<0}function Bs(s,e,r,a,u){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-r)*u|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Bd(s){let e=s,r=s;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==s);return r}function $l(s,e,r,a,u,p,f,x){return(u-f)*(e-x)>=(s-f)*(p-x)&&(s-f)*(a-x)>=(r-f)*(e-x)&&(r-f)*(p-x)>=(u-f)*(a-x)}function Ul(s,e,r,a,u,p,f,x){return!(s===f&&e===x)&&$l(s,e,r,a,u,p,f,x)}function gp(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!(function(r,a){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&Ch(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1})(s,e)&&(ql(s,e)&&ql(e,s)&&(function(r,a){let u=r,p=!1;const f=(r.x+a.x)/2,x=(r.y+a.y)/2;do u.y>x!=u.next.y>x&&u.next.y!==u.y&&f<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==r);return p})(s,e)&&(ds(s.prev,s,e.prev)||ds(s,e.prev,e))||nn(s,e)&&ds(s.prev,s,s.next)>0&&ds(e.prev,e,e.next)>0)}function ds(s,e,r){return(e.y-s.y)*(r.x-e.x)-(e.x-s.x)*(r.y-e.y)}function nn(s,e){return s.x===e.x&&s.y===e.y}function Ch(s,e,r,a){const u=si(ds(s,e,r)),p=si(ds(s,e,a)),f=si(ds(r,a,s)),x=si(ds(r,a,e));return u!==p&&f!==x||!(u!==0||!sl(s,r,e))||!(p!==0||!sl(s,a,e))||!(f!==0||!sl(r,s,a))||!(x!==0||!sl(r,e,a))}function sl(s,e,r){return e.x<=Math.max(s.x,r.x)&&e.x>=Math.min(s.x,r.x)&&e.y<=Math.max(s.y,r.y)&&e.y>=Math.min(s.y,r.y)}function si(s){return s>0?1:s<0?-1:0}function ql(s,e){return ds(s.prev,s,s.next)<0?ds(s,e,s.next)>=0&&ds(s,s.prev,e)>=0:ds(s,e,s.prev)<0||ds(s,s.next,e)<0}function Ph(s,e){const r=po(s.i,s.x,s.y),a=po(e.i,e.x,e.y),u=s.next,p=e.prev;return s.next=e,e.prev=s,r.next=u,u.prev=r,a.next=r,r.prev=a,p.next=a,a.prev=p,a}function nl(s,e,r,a){const u=po(s,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Gl(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function po(s,e,r){return{i:s,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class al{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Zl{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Zl.noSubdivision=new Zl({fill:new al(0,0),line:new al(0,0),tile:new al(0,0),stencil:new al(0,0),circle:1}),bt("SubdivisionGranularityExpression",al),bt("SubdivisionGranularitySetting",Zl);const Hl=-32768,Wl=32767;class Mh{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=ht/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const a=0|Math.round(e),u=0|Math.round(r),p=this._getKey(a,u);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const f=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,f),this._vertexBuffer.push(a,u),f}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,p){const f=[];for(let x=0;x<p.length;x+=3){const v=p[x],N=p[x+1],C=p[x+2],A=u[2*v],L=u[2*v+1];(u[2*N]-A)*(u[2*C+1]-L)-(u[2*N+1]-L)*(u[2*C]-A)>0?(f.push(v),f.push(C),f.push(N)):(f.push(v),f.push(N),f.push(C))}return f})(this._vertexBuffer,e);const r=[],a=e.length;for(let u=0;u<a;u+=3){const p=[e[u+0],e[u+1],e[u+2]],f=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let x=1/0,v=1/0,N=-1/0,C=-1/0;for(let q=0;q<3;q++){const Z=f[2*q],te=f[2*q+1];x=Math.min(x,Z),N=Math.max(N,Z),v=Math.min(v,te),C=Math.max(C,te)}if(x===N||v===C)continue;const A=Math.floor(x/this._granularityCellSize),L=Math.ceil(N/this._granularityCellSize),O=Math.floor(v/this._granularityCellSize),U=Math.ceil(C/this._granularityCellSize);if(A!==L||O!==U)for(let q=O;q<U;q++){const Z=this._scanlineGenerateVertexRingForCellRow(q,f,p);zi(this._vertexBuffer,Z,r)}else r.push(...p)}return r}_scanlineGenerateVertexRingForCellRow(e,r,a){const u=e*this._granularityCellSize,p=u+this._granularityCellSize,f=[];for(let x=0;x<3;x++){const v=r[2*x],N=r[2*x+1],C=r[2*(x+1)%6],A=r[(2*(x+1)+1)%6],L=r[2*(x+2)%6],O=r[(2*(x+2)+1)%6],U=C-v,q=A-N,Z=U===0,te=q===0,pe=(u-N)/q,ae=(p-N)/q,oe=Math.min(pe,ae),fe=Math.max(pe,ae);if(!te&&(oe>=1||fe<=0)||te&&(N<u||N>p)){A>=u&&A<=p&&f.push(a[(x+1)%3]);continue}!te&&oe>0&&f.push(this._vertexToIndex(v+U*oe,N+q*oe));const _e=v+U*Math.max(oe,0),De=v+U*Math.min(fe,1);Z||this._generateIntraEdgeVertices(f,v,N,C,A,_e,De),!te&&fe<1&&f.push(this._vertexToIndex(v+U*fe,N+q*fe)),(te||A>=u&&A<=p)&&f.push(a[(x+1)%3]),!te&&(A<=u||A>=p)&&this._generateInterEdgeVertices(f,v,N,C,A,L,O,De,u,p)}return f}_generateIntraEdgeVertices(e,r,a,u,p,f,x){const v=u-r,N=p-a,C=N===0,A=C?Math.min(r,u):Math.min(f,x),L=C?Math.max(r,u):Math.max(f,x),O=Math.floor(A/this._granularityCellSize)+1,U=Math.ceil(L/this._granularityCellSize)-1;if(C?r<u:f<x)for(let q=O;q<=U;q++){const Z=q*this._granularityCellSize;e.push(this._vertexToIndex(Z,a+N*(Z-r)/v))}else for(let q=U;q>=O;q--){const Z=q*this._granularityCellSize;e.push(this._vertexToIndex(Z,a+N*(Z-r)/v))}}_generateInterEdgeVertices(e,r,a,u,p,f,x,v,N,C){const A=p-a,L=f-u,O=x-p,U=(N-p)/O,q=(C-p)/O,Z=Math.min(U,q),te=Math.max(U,q),pe=u+L*Z;let ae=Math.floor(Math.min(pe,v)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(pe,v)/this._granularityCellSize)-1,fe=v<pe;const _e=O===0;if(_e&&(x===N||x===C))return;if(_e||Z>=1||te<=0){const Je=a-x,We=f+(r-f)*Math.min((N-x)/Je,(C-x)/Je);ae=Math.floor(Math.min(We,v)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(We,v)/this._granularityCellSize)-1,fe=v<We}const De=A>0?C:N;if(fe)for(let Je=ae;Je<=oe;Je++)e.push(this._vertexToIndex(Je*this._granularityCellSize,De));else for(let Je=oe;Je>=ae;Je--)e.push(this._vertexToIndex(Je*this._granularityCellSize,De))}_generateOutline(e){const r=[];for(const a of e){const u=fa(a,this._granularity,!0),p=this._pointArrayToIndices(u),f=[];for(let x=1;x<p.length;x++)f.push(p[x-1]),f.push(p[x]);r.push(f)}return r}_handlePoles(e){let r=!1,a=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(a=!0)),(r||a)&&this._fillPoles(e,r,a)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const a=e[r+1];a===Hl&&(e[r+1]=-32767),a===Wl&&(e[r+1]=32766)}}_generatePoleQuad(e,r,a,u,p,f){u>p!=(f===Hl)?(e.push(r),e.push(a),e.push(this._vertexToIndex(u,f)),e.push(a),e.push(this._vertexToIndex(p,f)),e.push(this._vertexToIndex(u,f))):(e.push(a),e.push(r),e.push(this._vertexToIndex(u,f)),e.push(this._vertexToIndex(p,f)),e.push(a),e.push(this._vertexToIndex(u,f)))}_fillPoles(e,r,a){const u=this._vertexBuffer,p=ht,f=e.length;for(let x=2;x<f;x+=3){const v=e[x-2],N=e[x-1],C=e[x],A=u[2*v],L=u[2*v+1],O=u[2*N],U=u[2*N+1],q=u[2*C],Z=u[2*C+1];r&&(L===0&&U===0&&this._generatePoleQuad(e,v,N,A,O,Hl),U===0&&Z===0&&this._generatePoleQuad(e,N,C,O,q,Hl),Z===0&&L===0&&this._generatePoleQuad(e,C,v,q,A,Hl)),a&&(L===p&&U===p&&this._generatePoleQuad(e,v,N,A,O,Wl),U===p&&Z===p&&this._generatePoleQuad(e,N,C,O,q,Wl),Z===p&&L===p&&this._generatePoleQuad(e,C,v,q,A,Wl))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:a,holeIndices:u}=(function(x){const v=[],N=[];for(const C of x)if(C.length!==0){C!==x[0]&&v.push(N.length/2);for(let A=0;A<C.length;A++)N.push(C[A].x),N.push(C[A].y)}return{flattened:N,holeIndices:v}})(e);let p;this._initializeVertices(a);try{const x=(function(N,C,A=2){const L=C&&C.length,O=L?C[0]*A:N.length;let U=uf(N,0,O,A,!0);const q=[];if(!U||U.next===U.prev)return q;let Z,te,pe;if(L&&(U=(function(ae,oe,fe,_e){const De=[];for(let Je=0,We=oe.length;Je<We;Je++){const tt=uf(ae,oe[Je]*_e,Je<We-1?oe[Je+1]*_e:ae.length,_e,!1);tt===tt.next&&(tt.steiner=!0),De.push(Bd(tt))}De.sort(Nn);for(let Je=0;Je<De.length;Je++)fe=Ra(De[Je],fe);return fe})(N,C,U,A)),N.length>80*A){Z=N[0],te=N[1];let ae=Z,oe=te;for(let fe=A;fe<O;fe+=A){const _e=N[fe],De=N[fe+1];_e<Z&&(Z=_e),De<te&&(te=De),_e>ae&&(ae=_e),De>oe&&(oe=De)}pe=Math.max(ae-Z,oe-te),pe=pe!==0?32767/pe:0}return Bc(U,q,A,Z,te,pe,0),q})(a,u),v=this._convertIndices(a,x);p=this._subdivideTrianglesScanline(v)}catch(x){console.error(x)}let f=[];return r&&(f=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:f}}_convertIndices(e,r){const a=[];for(let u=0;u<r.length;u++)a.push(this._vertexToIndex(e[2*r[u]],e[2*r[u]+1]));return a}_pointArrayToIndices(e){const r=[];for(let a=0;a<e.length;a++){const u=e[a];r.push(this._vertexToIndex(u.x,u.y))}return r}}function On(s,e,r,a=!0){return new Mh(r,e).subdividePolygonInternal(s,a)}function fa(s,e,r=!1){if(!s||s.length<1)return[];if(s.length<2)return[];const a=s[0],u=s[s.length-1],p=r&&(a.x!==u.x||a.y!==u.y);if(e<2)return p?[...s,s[0]]:[...s];const f=Math.floor(ht/e),x=[];x.push(new V(s[0].x,s[0].y));const v=s.length,N=p?v:v-1;for(let C=0;C<N;C++){const A=s[C],L=C<v-1?s[C+1]:s[0],O=A.x,U=A.y,q=L.x,Z=L.y,te=O!==q,pe=U!==Z;if(!te&&!pe)continue;const ae=q-O,oe=Z-U,fe=Math.abs(ae),_e=Math.abs(oe);let De=O,Je=U;for(;;){const tt=ae>0?(Math.floor(De/f)+1)*f:(Math.ceil(De/f)-1)*f,gt=oe>0?(Math.floor(Je/f)+1)*f:(Math.ceil(Je/f)-1)*f,st=Math.abs(De-tt),Ke=Math.abs(Je-gt),qe=Math.abs(De-q),Pt=Math.abs(Je-Z),jt=te?st/fe:Number.POSITIVE_INFINITY,Mt=pe?Ke/_e:Number.POSITIVE_INFINITY;if((qe<=st||!te)&&(Pt<=Ke||!pe))break;if(jt<Mt&&te||!pe){De=tt,Je+=oe*jt;const vt=new V(De,Math.round(Je));x[x.length-1].x===vt.x&&x[x.length-1].y===vt.y||x.push(vt)}else{De+=ae*Mt,Je=gt;const vt=new V(Math.round(De),Je);x[x.length-1].x===vt.x&&x[x.length-1].y===vt.y||x.push(vt)}}const We=new V(q,Z);x[x.length-1].x===We.x&&x[x.length-1].y===We.y||x.push(We)}return x}function zi(s,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let a=0,u=s[2*e[0]];for(let v=1;v<e.length;v++){const N=s[2*e[v]];N<u&&(u=N,a=v)}const p=e.length;let f=a,x=(f+1)%p;for(;;){const v=f-1>=0?f-1:p-1,N=(x+1)%p,C=s[2*e[v]],A=s[2*e[N]],L=s[2*e[f]],O=s[2*e[f]+1],U=s[2*e[x]+1];let q=!1;if(C<A)q=!0;else if(C>A)q=!1;else{const Z=U-O,te=-(s[2*e[x]]-L),pe=O<U?1:-1;((C-L)*Z+(s[2*e[v]+1]-O)*te)*pe>((A-L)*Z+(s[2*e[N]+1]-O)*te)*pe&&(q=!0)}if(q){const Z=e[v],te=e[f],pe=e[x];Z!==te&&Z!==pe&&te!==pe&&r.push(pe,te,Z),f--,f<0&&(f=p-1)}else{const Z=e[N],te=e[f],pe=e[x];Z!==te&&Z!==pe&&te!==pe&&r.push(pe,te,Z),x++,x>=p&&(x=0)}if(v===N)break}}function Yn(s,e,r,a,u,p,f,x,v){const N=u.length/2,C=f&&x&&v;if(N<xt.MAX_VERTEX_ARRAY_LENGTH){const A=e.prepareSegment(N,r,a),L=A.vertexLength;for(let q=0;q<p.length;q+=3)a.emplaceBack(L+p[q],L+p[q+1],L+p[q+2]);let O,U;A.vertexLength+=N,A.primitiveLength+=p.length/3,C&&(U=f.prepareSegment(N,r,x),O=U.vertexLength,U.vertexLength+=N);for(let q=0;q<u.length;q+=2)s(u[q],u[q+1]);if(C)for(let q=0;q<v.length;q++){const Z=v[q];for(let te=1;te<Z.length;te+=2)x.emplaceBack(O+Z[te-1],O+Z[te]);U.primitiveLength+=Z.length/2}}else(function(A,L,O,U,q,Z){const te=[];for(let _e=0;_e<U.length/2;_e++)te.push(-1);const pe={count:0};let ae=0,oe=A.getOrCreateLatestSegment(L,O),fe=oe.vertexLength;for(let _e=2;_e<q.length;_e+=3){const De=q[_e-2],Je=q[_e-1],We=q[_e];let tt=te[De]<ae,gt=te[Je]<ae,st=te[We]<ae;oe.vertexLength+((tt?1:0)+(gt?1:0)+(st?1:0))>xt.MAX_VERTEX_ARRAY_LENGTH&&(oe=A.createNewSegment(L,O),ae=pe.count,tt=!0,gt=!0,st=!0,fe=0);const Ke=Wu(te,U,Z,pe,De,tt,oe),qe=Wu(te,U,Z,pe,Je,gt,oe),Pt=Wu(te,U,Z,pe,We,st,oe);O.emplaceBack(fe+Ke-ae,fe+qe-ae,fe+Pt-ae),oe.primitiveLength++}})(e,r,a,u,p,s),C&&(function(A,L,O,U,q,Z){const te=[];for(let _e=0;_e<U.length/2;_e++)te.push(-1);const pe={count:0};let ae=0,oe=A.getOrCreateLatestSegment(L,O),fe=oe.vertexLength;for(let _e=0;_e<q.length;_e++){const De=q[_e];for(let Je=1;Je<q[_e].length;Je+=2){const We=De[Je-1],tt=De[Je];let gt=te[We]<ae,st=te[tt]<ae;oe.vertexLength+((gt?1:0)+(st?1:0))>xt.MAX_VERTEX_ARRAY_LENGTH&&(oe=A.createNewSegment(L,O),ae=pe.count,gt=!0,st=!0,fe=0);const Ke=Wu(te,U,Z,pe,We,gt,oe),qe=Wu(te,U,Z,pe,tt,st,oe);O.emplaceBack(fe+Ke-ae,fe+qe-ae),oe.primitiveLength++}}})(f,r,x,u,v,s),e.forceNewSegmentOnNextPrepare(),f?.forceNewSegmentOnNextPrepare()}function Wu(s,e,r,a,u,p,f){if(p){const x=a.count;return r(e[2*u],e[2*u+1]),s[u]=a.count,a.count++,f.vertexLength++,x}return s[u]}class Vd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ce,this.indexArray=new Be,this.indexArray2=new ot,this.programConfigurations=new uo(e.layers,e.zoom),this.segments=new xt,this.segments2=new xt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,a){this.hasDependencies=Od("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),f=[];for(const{feature:x,id:v,index:N,sourceLayerIndex:C}of e){const A=this.layers[0]._featureFilter.needGeometry,L=Pi(x,A);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),L,a))continue;const O=p?u.evaluate(L,{},a,r.availableImages):void 0,U={id:v,properties:x.properties,type:x.type,sourceLayerIndex:C,index:N,geometry:A?L.geometry:ti(x),patterns:{},sortKey:O};f.push(U)}p&&f.sort(((x,v)=>x.sortKey-v.sortKey));for(const x of f){const{geometry:v,index:N,sourceLayerIndex:C}=x;if(this.hasDependencies){const A=Eh("fill",this.layers,x,{zoom:this.zoom},r);this.patternFeatures.push(A)}else this.addFeature(x,v,N,a,{},r.subdivisionGranularity);r.featureIndex.insert(e[N].feature,v,N,C,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:a})}addFeatures(e,r,a){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,a,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,u,p,f){for(const x of mc(r,500)){const v=On(x,u,f.fill.getGranularityForZoomLevel(u.z)),N=this.layoutVertexArray;Yn(((C,A)=>{N.emplaceBack(C,A)}),this.segments,this.layoutVertexArray,this.indexArray,v.verticesFlattened,v.indicesTriangles,this.segments2,this.indexArray2,v.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{imagePositions:p,canonical:u})}}let Ih,df;bt("FillBucket",Vd,{omit:["layers","patternFeatures"]});var Xl={get paint(){return df=df||new ws({"fill-antialias":new Et(Fe.paint_fill["fill-antialias"]),"fill-opacity":new Rt(Fe.paint_fill["fill-opacity"]),"fill-color":new Rt(Fe.paint_fill["fill-color"]),"fill-outline-color":new Rt(Fe.paint_fill["fill-outline-color"]),"fill-translate":new Et(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xo(Fe.paint_fill["fill-pattern"])})},get layout(){return Ih=Ih||new ws({"fill-sort-key":new Rt(Fe.layout_fill["fill-sort-key"])})}};class hf extends An{constructor(e,r){super(e,Xl,r)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Vd(e)}queryRadius(){return Ad(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:a,pixelsToTileUnits:u}){return lp(Uu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-a.bearingInRadians,u),r)}isTileClipped(){return!0}}const xp=_s([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Vc=_s([{name:"a_centroid",components:2,type:"Int16"}],4),{members:yp}=xp;class Ai{constructor(e,r,a,u,p){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=p,e.readFields(pf,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,a=[];let u,p=1,f=0,x=0,v=0;for(;e.pos<r;){if(f<=0){const N=e.readVarint();p=7&N,f=N>>3}if(f--,p===1||p===2)x+=e.readSVarint(),v+=e.readSVarint(),p===1&&(u&&a.push(u),u=[]),u&&u.push(new V(x,v));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&a.push(u),a}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let a=1,u=0,p=0,f=0,x=1/0,v=-1/0,N=1/0,C=-1/0;for(;e.pos<r;){if(u<=0){const A=e.readVarint();a=7&A,u=A>>3}if(u--,a===1||a===2)p+=e.readSVarint(),f+=e.readSVarint(),p<x&&(x=p),p>v&&(v=p),f<N&&(N=f),f>C&&(C=f);else if(a!==7)throw new Error(`unknown command ${a}`)}return[x,N,v,C]}toGeoJSON(e,r,a){const u=this.extent*Math.pow(2,a),p=this.extent*e,f=this.extent*r,x=this.loadGeometry();function v(L){return[360*(L.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+f)/u)*Math.PI))-90]}function N(L){return L.map(v)}let C;if(this.type===1){const L=[];for(const U of x)L.push(U[0]);const O=N(L);C=L.length===1?{type:"Point",coordinates:O[0]}:{type:"MultiPoint",coordinates:O}}else if(this.type===2){const L=x.map(N);C=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=_p(x),O=[];for(const U of L)O.push(U.map(N));C=O.length===1?{type:"Polygon",coordinates:O[0]}:{type:"MultiPolygon",coordinates:O}}}const A={type:"Feature",geometry:C,properties:this.properties};return this.id!=null&&(A.id=this.id),A}}function pf(s,e,r){s===1?e.id=r.readVarint():s===2?(function(a,u){const p=a.readVarint()+a.pos;for(;a.pos<p;){const f=u._keys[a.readVarint()],x=u._values[a.readVarint()];u.properties[f]=x}})(r,e):s===3?e.type=r.readVarint():s===4&&(e._geometry=r.pos)}function _p(s){const e=s.length;if(e<=1)return[s];const r=[];let a,u;for(let p=0;p<e;p++){const f=bp(s[p]);f!==0&&(u===void 0&&(u=f<0),u===f<0?(a&&r.push(a),a=[s[p]]):a&&a.push(s[p]))}return a&&r.push(a),r}function bp(s){let e=0;for(let r,a,u=0,p=s.length,f=p-1;u<p;f=u++)r=s[u],a=s[f],e+=(a.x-r.x)*(r.y+a.y);return e}Ai.types=["Unknown","Point","LineString","Polygon"];class zh{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Tm,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new Ai(this._pbf,r,this.extent,this._keys,this._values)}}function Tm(s,e,r){s===15?e.version=r.readVarint():s===1?e.name=r.readString():s===5?e.extent=r.readVarint():s===2?e._features.push(r.pos):s===3?e._keys.push(r.readString()):s===4&&e._values.push((function(a){let u=null;const p=a.readVarint()+a.pos;for(;a.pos<p;){const f=a.readVarint()>>3;u=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(r))}class ff{constructor(e,r){this.layers=e.readFields(mf,{},r)}}function mf(s,e,r){if(s===3){const a=new zh(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}const Ah=Math.pow(2,13);function Di(s,e,r,a,u,p,f,x){s.emplaceBack(e,r,2*Math.floor(a*Ah)+f,u*Ah*2,p*Ah*2,Math.round(x))}class vp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new de,this.centroidVertexArray=new le,this.indexArray=new Be,this.programConfigurations=new uo(e.layers,e.zoom),this.segments=new xt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,a){this.features=[],this.hasDependencies=Od("fill-extrusion",this.layers,r);for(const{feature:u,id:p,index:f,sourceLayerIndex:x}of e){const v=this.layers[0]._featureFilter.needGeometry,N=Pi(u,v);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),N,a))continue;const C={id:p,sourceLayerIndex:x,index:f,geometry:v?N.geometry:ti(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Eh("fill-extrusion",this.layers,C,{zoom:this.zoom},r)):this.addFeature(C,C.geometry,f,a,{},r.subdivisionGranularity),r.featureIndex.insert(u,C.geometry,f,x,this.index,!0)}}addFeatures(e,r,a){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,r,a,e.subdivisionGranularity)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:a})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yp),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Vc.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,u,p,f){for(const x of mc(r,500)){const v={x:0,y:0,sampleCount:0},N=this.layoutVertexArray.length;this.processPolygon(v,u,e,x,f);const C=this.layoutVertexArray.length-N,A=Math.floor(v.x/v.sampleCount),L=Math.floor(v.y/v.sampleCount);for(let O=0;O<C;O++)this.centroidVertexArray.emplaceBack(A,L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{imagePositions:p,canonical:u})}processPolygon(e,r,a,u,p){if(u.length<1||Ss(u[0]))return;for(const A of u)A.length!==0&&Xu(e,A);const f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=p.fill.getGranularityForZoomLevel(r.z),v=Ai.types[a.type]==="Polygon";for(const A of u){if(A.length===0||Ss(A))continue;const L=fa(A,x,v);this._generateSideFaces(L,f)}if(!v)return;const N=On(u,r,x,!1),C=this.layoutVertexArray;Yn(((A,L)=>{Di(C,A,L,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,N.verticesFlattened,N.indicesTriangles)}_generateSideFaces(e,r){let a=0;for(let u=1;u<e.length;u++){const p=e[u],f=e[u-1];if(gf(p,f))continue;r.segment.vertexLength+4>xt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=p.sub(f)._perp()._unit(),v=f.dist(p);a+v>32768&&(a=0),Di(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,0,a),Di(this.layoutVertexArray,p.x,p.y,x.x,x.y,0,1,a),a+=v,Di(this.layoutVertexArray,f.x,f.y,x.x,x.y,0,0,a),Di(this.layoutVertexArray,f.x,f.y,x.x,x.y,0,1,a);const N=r.segment.vertexLength;this.indexArray.emplaceBack(N,N+2,N+1),this.indexArray.emplaceBack(N+1,N+2,N+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Xu(s,e){for(let r=0;r<e.length;r++){const a=e[r];r===e.length-1&&e[0].x===a.x&&e[0].y===a.y||(s.x+=a.x,s.y+=a.y,s.sampleCount++)}}function gf(s,e){return s.x===e.x&&(s.x<0||s.x>ht)||s.y===e.y&&(s.y<0||s.y>ht)}function Ss(s){return s.every((e=>e.x<0))||s.every((e=>e.x>ht))||s.every((e=>e.y<0))||s.every((e=>e.y>ht))}let xf;bt("FillExtrusionBucket",vp,{omit:["layers","features"]});var yf={get paint(){return xf=xf||new ws({"fill-extrusion-opacity":new Et(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rt(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xo(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rt(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rt(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Et(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Nm extends An{constructor(e,r){super(e,yf,r)}createBucket(e){return new vp(e)}queryRadius(){return Ad(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:a,geometry:u,transform:p,pixelsToTileUnits:f,pixelPosMatrix:x}){const v=Uu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,f),N=this.paint.get("fill-extrusion-height").evaluate(r,a),C=this.paint.get("fill-extrusion-base").evaluate(r,a),A=(function(O,U){const q=[];for(const Z of O){const te=[Z.x,Z.y,0,1];Me(te,te,U),q.push(new V(te[0]/te[3],te[1]/te[3]))}return q})(v,x),L=(function(O,U,q,Z){const te=[],pe=[],ae=Z[8]*U,oe=Z[9]*U,fe=Z[10]*U,_e=Z[11]*U,De=Z[8]*q,Je=Z[9]*q,We=Z[10]*q,tt=Z[11]*q;for(const gt of O){const st=[],Ke=[];for(const qe of gt){const Pt=qe.x,jt=qe.y,Mt=Z[0]*Pt+Z[4]*jt+Z[12],vt=Z[1]*Pt+Z[5]*jt+Z[13],Bt=Z[2]*Pt+Z[6]*jt+Z[14],kr=Z[3]*Pt+Z[7]*jt+Z[15],gr=Bt+fe,bs=kr+_e,$n=Mt+De,Js=vt+Je,vs=Bt+We,ms=kr+tt,Fr=new V((Mt+ae)/bs,(vt+oe)/bs);Fr.z=gr/bs,st.push(Fr);const Ns=new V($n/ms,Js/ms);Ns.z=vs/ms,Ke.push(Ns)}te.push(st),pe.push(Ke)}return[te,pe]})(u,C,N,x);return(function(O,U,q){let Z=1/0;lp(q,U)&&(Z=wp(q,U[0]));for(let te=0;te<U.length;te++){const pe=U[te],ae=O[te];for(let oe=0;oe<pe.length-1;oe++){const fe=pe[oe],_e=[fe,pe[oe+1],ae[oe+1],ae[oe],fe];Bl(q,_e)&&(Z=Math.min(Z,wp(q,_e)))}}return Z!==1/0&&Z})(L[0],L[1],A)}}function $d(s,e){return s.x*e.x+s.y*e.y}function wp(s,e){if(s.length===1){let r=0;const a=e[r++];let u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const p=e[r],f=s[0],x=u.sub(a),v=p.sub(a),N=f.sub(a),C=$d(x,x),A=$d(x,v),L=$d(v,v),O=$d(N,x),U=$d(N,v),q=C*L-A*A,Z=(L*O-A*U)/q,te=(C*U-A*O)/q,pe=a.z*(1-Z-te)+u.z*Z+p.z*te;if(isFinite(pe))return pe}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const _f=_s([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Em}=_f,ni=_s([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:kp}=ni,Cm=Math.cos(Math.PI/180*37.5),il=Math.pow(2,14)/.5;class Yu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new xe,this.layoutVertexArray2=new he,this.indexArray=new Be,this.programConfigurations=new uo(e.layers,e.zoom),this.segments=new xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,a){this.hasDependencies=Od("line",this.layers,r)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),f=[];for(const{feature:x,id:v,index:N,sourceLayerIndex:C}of e){const A=this.layers[0]._featureFilter.needGeometry,L=Pi(x,A);if(!this.layers[0]._featureFilter.filter(new Rr(this.zoom),L,a))continue;const O=p?u.evaluate(L,{},a):void 0,U={id:v,properties:x.properties,type:x.type,sourceLayerIndex:C,index:N,geometry:A?L.geometry:ti(x),patterns:{},dashes:{},sortKey:O};f.push(U)}p&&f.sort(((x,v)=>x.sortKey-v.sortKey));for(const x of f){const{geometry:v,index:N,sourceLayerIndex:C}=x;this.hasDependencies?(Od("line",this.layers,r)?Eh("line",this.layers,x,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,x,this.zoom,r),this.patternFeatures.push(x)):this.addFeature(x,v,N,a,{},{},r.subdivisionGranularity),r.featureIndex.insert(e[N].feature,v,N,C,this.index)}}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:a,dashPositions:u})}addFeatures(e,r,a,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,a,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,kp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Em),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,p,f,x){const v=this.layers[0].layout,N=v.get("line-join").evaluate(e,{}),C=v.get("line-cap"),A=v.get("line-miter-limit"),L=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const O of r)this.addLine(O,e,N,C,A,L,u,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{imagePositions:p,dashPositions:f,canonical:u})}addLine(e,r,a,u,p,f,x,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=fa(e,x?v.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<e.length-1;ae++)this.totalDistance+=e[ae].dist(e[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const N=Ai.types[r.type]==="Polygon";let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let A=0;for(;A<C-1&&e[A].equals(e[A+1]);)A++;if(C<(N?3:2))return;a==="bevel"&&(p=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let U,q,Z,te,pe;this.e1=this.e2=-1,N&&(U=e[C-2],pe=e[A].sub(U)._unit()._perp());for(let ae=A;ae<C;ae++){if(Z=ae===C-1?N?e[A+1]:void 0:e[ae+1],Z&&e[ae].equals(Z))continue;pe&&(te=pe),U&&(q=U),U=e[ae],pe=Z?Z.sub(U)._unit()._perp():te,te=te||pe;let oe=te.add(pe);oe.x===0&&oe.y===0||oe._unit();const fe=te.x*pe.x+te.y*pe.y,_e=oe.x*pe.x+oe.y*pe.y,De=_e!==0?1/_e:1/0,Je=2*Math.sqrt(2-2*_e),We=_e<Cm&&q&&Z,tt=te.x*pe.y-te.y*pe.x>0;if(We&&ae>A){const Ke=U.dist(q);if(Ke>2*L){const qe=U.sub(U.sub(q)._mult(L/Ke)._round());this.updateDistance(q,qe),this.addCurrentVertex(qe,te,0,0,O),q=qe}}const gt=q&&Z;let st=gt?a:N?"butt":u;if(gt&&st==="round"&&(De<f?st="miter":De<=2&&(st="fakeround")),st==="miter"&&De>p&&(st="bevel"),st==="bevel"&&(De>2&&(st="flipbevel"),De<p&&(st="miter")),q&&this.updateDistance(q,U),st==="miter")oe._mult(De),this.addCurrentVertex(U,oe,0,0,O);else if(st==="flipbevel"){if(De>100)oe=pe.mult(-1);else{const Ke=De*te.add(pe).mag()/te.sub(pe).mag();oe._perp()._mult(Ke*(tt?-1:1))}this.addCurrentVertex(U,oe,0,0,O),this.addCurrentVertex(U,oe.mult(-1),0,0,O)}else if(st==="bevel"||st==="fakeround"){const Ke=-Math.sqrt(De*De-1),qe=tt?Ke:0,Pt=tt?0:Ke;if(q&&this.addCurrentVertex(U,te,qe,Pt,O),st==="fakeround"){const jt=Math.round(180*Je/Math.PI/20);for(let Mt=1;Mt<jt;Mt++){let vt=Mt/jt;if(vt!==.5){const kr=vt-.5;vt+=vt*kr*(vt-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*kr*kr+(.848013+fe*(.215638*fe-1.06021)))}const Bt=pe.sub(te)._mult(vt)._add(te)._unit()._mult(tt?-1:1);this.addHalfVertex(U,Bt.x,Bt.y,!1,tt,0,O)}}Z&&this.addCurrentVertex(U,pe,-qe,-Pt,O)}else if(st==="butt")this.addCurrentVertex(U,oe,0,0,O);else if(st==="square"){const Ke=q?1:-1;this.addCurrentVertex(U,oe,Ke,Ke,O)}else st==="round"&&(q&&(this.addCurrentVertex(U,te,0,0,O),this.addCurrentVertex(U,te,1,1,O,!0)),Z&&(this.addCurrentVertex(U,pe,-1,-1,O,!0),this.addCurrentVertex(U,pe,0,0,O)));if(We&&ae<C-1){const Ke=U.dist(Z);if(Ke>2*L){const qe=U.add(Z.sub(U)._mult(L/Ke)._round());this.updateDistance(U,qe),this.addCurrentVertex(qe,pe,0,0,O),U=qe}}}}addCurrentVertex(e,r,a,u,p,f=!1){const x=r.y*u-r.x,v=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,f,!1,a,p),this.addHalfVertex(e,x,v,f,!0,-u,p),this.distance>il/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,u,p,f))}addHalfVertex({x:e,y:r},a,u,p,f,x,v){const N=.5*(this.lineClips?this.scaledDistance*(il-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),v.primitiveLength++),f?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}hasLineDasharray(e){for(const r of e){const a=r.paint.get("line-dasharray");if(a&&!a.isConstant())return!0}return!1}addLineDashDependencies(e,r,a,u){for(const p of e){const f=p.paint.get("line-dasharray");if(!f||f.value.kind==="constant")continue;const x=p.layout.get("line-cap")==="round",v={dasharray:f.value.evaluate({zoom:a-1},r,{}),round:x},N={dasharray:f.value.evaluate({zoom:a},r,{}),round:x},C={dasharray:f.value.evaluate({zoom:a+1},r,{}),round:x},A=`${v.dasharray.join(",")},${v.round}`,L=`${N.dasharray.join(",")},${N.round}`,O=`${C.dasharray.join(",")},${C.round}`;u.dashDependencies[A]=v,u.dashDependencies[L]=N,u.dashDependencies[O]=C,r.dashes[p.id]={min:A,mid:L,max:O}}}}let Yl,Ud;bt("LineBucket",Yu,{omit:["layers","patternFeatures"]});var Dh={get paint(){return Ud=Ud||new ws({"line-opacity":new Rt(Fe.paint_line["line-opacity"]),"line-color":new Rt(Fe.paint_line["line-color"]),"line-translate":new Et(Fe.paint_line["line-translate"]),"line-translate-anchor":new Et(Fe.paint_line["line-translate-anchor"]),"line-width":new Rt(Fe.paint_line["line-width"]),"line-gap-width":new Rt(Fe.paint_line["line-gap-width"]),"line-offset":new Rt(Fe.paint_line["line-offset"]),"line-blur":new Rt(Fe.paint_line["line-blur"]),"line-dasharray":new Xo(Fe.paint_line["line-dasharray"]),"line-pattern":new Xo(Fe.paint_line["line-pattern"]),"line-gradient":new da(Fe.paint_line["line-gradient"])})},get layout(){return Yl=Yl||new ws({"line-cap":new Et(Fe.layout_line["line-cap"]),"line-join":new Rt(Fe.layout_line["line-join"]),"line-miter-limit":new Et(Fe.layout_line["line-miter-limit"]),"line-round-limit":new Et(Fe.layout_line["line-round-limit"]),"line-sort-key":new Rt(Fe.layout_line["line-sort-key"])})}};class jp extends Rt{possiblyEvaluate(e,r){return r=new Rr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,u){return r=er({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,u)}}let Rh;class Sp extends An{constructor(e,r){super(e,Dh,r),this.gradientVersion=0,Rh||(Rh=new jp(Dh.paint.properties["line-width"].specification),Rh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(a){return a._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof Ua,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Rh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Yu(e)}queryRadius(e){const r=e,a=bf($u("line-width",this,r),$u("line-gap-width",this,r)),u=$u("line-offset",this,r);return a/2+Math.abs(u)+Ad(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:a,geometry:u,transform:p,pixelsToTileUnits:f}){const x=Uu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,f),v=f/2*bf(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),N=this.paint.get("line-offset").evaluate(r,a);return N&&(u=(function(C,A){const L=[];for(let O=0;O<C.length;O++){const U=rf(C[O]),q=[];for(let Z=0;Z<U.length;Z++){const te=U[Z],pe=U[Z-1],ae=U[Z+1],oe=Z===0?new V(0,0):te.sub(pe)._unit()._perp(),fe=Z===U.length-1?new V(0,0):ae.sub(te)._unit()._perp(),_e=oe._add(fe)._unit(),De=_e.x*fe.x+_e.y*fe.y;De!==0&&_e._mult(1/De),q.push(_e._mult(A)._add(te))}L.push(q)}return L})(u,N*f)),(function(C,A,L){for(let O=0;O<A.length;O++){const U=A[O];if(C.length>=3){for(let q=0;q<U.length;q++)if(tl(C,U[q]))return!0}if(cp(C,U,L))return!0}return!1})(x,u,v)}isTileClipped(){return!0}}function bf(s,e){return e>0?e+2*s:s}const vf=_s([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),wf=_s([{name:"a_projected_pos",components:3,type:"Float32"}],4);_s([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Lh=_s([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_s([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qd=_s([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kf=_s([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Tp(s,e,r){return s.sections.forEach((a=>{a.text=(function(u,p,f){const x=p.layout.get("text-transform").evaluate(f,{});return x==="uppercase"?u=u.toLocaleUpperCase():x==="lowercase"&&(u=u.toLocaleLowerCase()),ki.applyArabicShaping&&(u=ki.applyArabicShaping(u)),u})(a.text,e,r)})),s}_s([{name:"triangle",components:3,type:"Uint16"}]),_s([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_s([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_s([{type:"Float32",name:"offsetX"}]),_s([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_s([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Ks=24;const Ku={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Np={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Fh={40:!0};function Oh(s,e,r,a,u,p){if("fontStack"in e){const f=r[e.fontStack],x=f&&f[s];return x?x.metrics.advance*e.scale+u:0}{const f=a[e.imageName];return f?f.displaySize[0]*e.scale*Ks/p+u:0}}function Gd(s,e,r,a){const u=Math.pow(s-e,2);return a?s<e?u/2:2*u:u+Math.abs(r)*r}function jf(s,e,r){let a=0;return s===10&&(a-=1e4),r&&(a+=150),s!==40&&s!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Sf(s,e,r,a,u,p){let f=null,x=Gd(e,r,u,p);for(const v of a){const N=Gd(e-v.x,r,u,p)+v.badness;N<=x&&(f=v,x=N)}return{index:s,x:e,priorBreak:f,badness:x}}function Zd(s){return s?Zd(s.priorBreak).concat(s.index):[]}class Ju{constructor(e="",r=[],a=[]){this.text=e,this.sections=r,this.sectionIndex=a,this.imageSectionID=null}static fromFeature(e,r){const a=new Ju;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?a.addImageSection(p):a.addTextSection(p,r)}return a}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let r="",a={premature:!0,value:void 0};const u=e[Symbol.iterator]();let p=u.next();const f=e[Symbol.iterator]();f.next();let x=f.next();for(;!p.done;)r+=!x.done&&ao(x.value.codePointAt(0))&&!Ku[x.value]||!a.premature&&ao(a.value.codePointAt(0))&&!Ku[a.value]||!Ku[p.value]?p.value:Ku[p.value],a={value:p.value,premature:!1},p=u.next(),x=f.next();return r})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),r=e?e[0].length:0,a=this.text.match(/\S\s*$/),u=a?a[0].length-1:0;this.text=this.text.substring(r,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(r,this.sectionIndex.length-u)}substring(e,r){const a=[...this.text].slice(e,r).join(""),u=this.sectionIndex.slice(e,r);return new Ju(a,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,r)=>Math.max(e,this.sections[r].scale)),0)}getMaxImageSize(e){let r=0,a=0;for(let u=0;u<this.length();u++){const p=this.getSection(u);if("imageName"in p){const f=e[p.imageName];if(!f)continue;const x=f.displaySize;r=Math.max(r,x[0]),a=Math.max(a,x[1])}}return{maxImageWidth:r,maxImageHeight:a}}addTextSection(e,r){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||r});const a=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>a)))}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Cs("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:r}),this.sectionIndex.push(this.sections.length-1)):Cs("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,r,a,u,p){const f=[],x=this.determineAverageLineWidth(e,r,a,u,p),v=this.hasZeroWidthSpaces();let N=0,C=0;const A=this.text[Symbol.iterator]();let L=A.next();const O=this.text[Symbol.iterator]();O.next();let U=O.next();const q=this.text[Symbol.iterator]();q.next(),q.next();let Z=q.next();for(;!L.done;){const te=this.getSection(C),pe=L.value.codePointAt(0);if(Cd(pe)||(N+=Oh(pe,te,a,u,e,p)),!U.done){const ae=kn(pe),oe=U.value.codePointAt(0);(Np[pe]||ae||"imageName"in te||!Z.done&&Fh[oe])&&f.push(Sf(C+1,N,x,f,jf(pe,oe,ae&&v),!1))}C++,L=A.next(),U=O.next(),Z=q.next()}return Zd(Sf(this.length(),N,x,f,0,!0))}determineAverageLineWidth(e,r,a,u,p){let f=0,x=0;for(const v of this.text){const N=this.getSection(x);f+=Oh(v.codePointAt(0),N,a,u,e,p),x++}return f/Math.max(1,Math.ceil(f/r))}}const $c=4294967296,Tf=1/$c,Hd=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class o{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,a=this.length){for(;this.pos<a;){const u=this.readVarint(),p=u>>3,f=this.pos;this.type=7&u,e(p,r,this),this.pos===f&&this.skip(u)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*$c;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*$c;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let a,u;return u=r[this.pos++],a=127&u,u<128?a:(u=r[this.pos++],a|=(127&u)<<7,u<128?a:(u=r[this.pos++],a|=(127&u)<<14,u<128?a:(u=r[this.pos++],a|=(127&u)<<21,u<128?a:(u=r[this.pos],a|=(15&u)<<28,(function(p,f,x){const v=x.buf;let N,C;if(C=v[x.pos++],N=(112&C)>>4,C<128||(C=v[x.pos++],N|=(127&C)<<3,C<128)||(C=v[x.pos++],N|=(127&C)<<10,C<128)||(C=v[x.pos++],N|=(127&C)<<17,C<128)||(C=v[x.pos++],N|=(127&C)<<24,C<128)||(C=v[x.pos++],N|=(1&C)<<31,C<128))return d(p,N,f);throw new Error("Expected varint not more than 10 bytes")})(a,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&Hd?Hd.decode(this.buf.subarray(r,e)):(function(a,u,p){let f="",x=u;for(;x<p;){const v=a[x];let N,C,A,L=null,O=v>239?4:v>223?3:v>191?2:1;if(x+O>p)break;O===1?v<128&&(L=v):O===2?(N=a[x+1],(192&N)==128&&(L=(31&v)<<6|63&N,L<=127&&(L=null))):O===3?(N=a[x+1],C=a[x+2],(192&N)==128&&(192&C)==128&&(L=(15&v)<<12|(63&N)<<6|63&C,(L<=2047||L>=55296&&L<=57343)&&(L=null))):O===4&&(N=a[x+1],C=a[x+2],A=a[x+3],(192&N)==128&&(192&C)==128&&(192&A)==128&&(L=(15&v)<<18|(63&N)<<12|(63&C)<<6|63&A,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,O=1):L>65535&&(L-=65536,f+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),f+=String.fromCharCode(L),x+=O}return f})(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const a=this.readPackedEnd();for(;this.pos<a;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Tf),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Tf),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(r,a){let u,p;if(r>=0?(u=r%4294967296|0,p=r/4294967296|0):(u=~(-r%4294967296),p=~(-r/4294967296),4294967295^u?u=u+1|0:(u=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(f,x,v){v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,v.buf[v.pos]=127&(f>>>=7)})(u,0,a),(function(f,x){const v=(7&f)<<4;x.buf[x.pos++]|=v|((f>>>=3)?128:0),f&&(x.buf[x.pos++]=127&f|((f>>>=7)?128:0),f&&(x.buf[x.pos++]=127&f|((f>>>=7)?128:0),f&&(x.buf[x.pos++]=127&f|((f>>>=7)?128:0),f&&(x.buf[x.pos++]=127&f|((f>>>=7)?128:0),f&&(x.buf[x.pos++]=127&f)))))})(p,a)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=(function(u,p,f){for(let x,v,N=0;N<p.length;N++){if(x=p.charCodeAt(N),x>55295&&x<57344){if(!v){x>56319||N+1===p.length?(u[f++]=239,u[f++]=191,u[f++]=189):v=x;continue}if(x<56320){u[f++]=239,u[f++]=191,u[f++]=189,v=x;continue}x=v-55296<<10|x-56320|65536,v=null}else v&&(u[f++]=239,u[f++]=191,u[f++]=189,v=null);x<128?u[f++]=x:(x<2048?u[f++]=x>>6|192:(x<65536?u[f++]=x>>12|224:(u[f++]=x>>18|240,u[f++]=x>>12&63|128),u[f++]=x>>6&63|128),u[f++]=63&x|128)}return f})(this.buf,e,this.pos);const a=this.pos-r;a>=128&&y(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let a=0;a<r;a++)this.buf[this.pos++]=e[a]}writeRawMessage(e,r){this.pos++;const a=this.pos;e(r,this);const u=this.pos-a;u>=128&&y(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u}writeMessage(e,r,a){this.writeTag(e,2),this.writeRawMessage(r,a)}writePackedVarint(e,r){r.length&&this.writeMessage(e,S,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,z,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,ye,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,F,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,Q,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,Te,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,He,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,dt,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,ft,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function d(s,e,r){return r?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function y(s,e,r){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(let u=r.pos-1;u>=s;u--)r.buf[u+a]=r.buf[u]}function S(s,e){for(let r=0;r<s.length;r++)e.writeVarint(s[r])}function z(s,e){for(let r=0;r<s.length;r++)e.writeSVarint(s[r])}function F(s,e){for(let r=0;r<s.length;r++)e.writeFloat(s[r])}function Q(s,e){for(let r=0;r<s.length;r++)e.writeDouble(s[r])}function ye(s,e){for(let r=0;r<s.length;r++)e.writeBoolean(s[r])}function Te(s,e){for(let r=0;r<s.length;r++)e.writeFixed32(s[r])}function He(s,e){for(let r=0;r<s.length;r++)e.writeSFixed32(s[r])}function dt(s,e){for(let r=0;r<s.length;r++)e.writeFixed64(s[r])}function ft(s,e){for(let r=0;r<s.length;r++)e.writeSFixed64(s[r])}function ut(s,e,r){s===1&&r.readMessage(Dt,e)}function Dt(s,e,r){if(s===3){const{id:a,bitmap:u,width:p,height:f,left:x,top:v,advance:N}=r.readMessage($t,{});e.push({id:a,bitmap:new Zu({width:p+6,height:f+6},u),metrics:{width:p,height:f,left:x,top:v,advance:N}})}}function $t(s,e,r){s===1?e.id=r.readVarint():s===2?e.bitmap=r.readBytes():s===3?e.width=r.readVarint():s===4?e.height=r.readVarint():s===5?e.left=r.readSVarint():s===6?e.top=r.readSVarint():s===7&&(e.advance=r.readVarint())}function Ut(s){let e=0,r=0;for(const f of s)e+=f.w*f.h,r=Math.max(r,f.w);s.sort(((f,x)=>x.h-f.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,p=0;for(const f of s)for(let x=a.length-1;x>=0;x--){const v=a[x];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,p=Math.max(p,f.y+f.h),u=Math.max(u,f.x+f.w),f.w===v.w&&f.h===v.h){const N=a.pop();N&&x<a.length&&(a[x]=N)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(a.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}class Ts{constructor(e,{pixelRatio:r,version:a,stretchX:u,stretchY:p,content:f,textFitWidth:x,textFitHeight:v}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=p,this.content=f,this.version=a,this.textFitWidth=x,this.textFitHeight=v}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ve{constructor(e,r){const a={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,a,p),this.addImages(r,u,p);const{w:f,h:x}=Ut(p),v=new Fn({width:f||1,height:x||1});for(const N in e){const C=e[N],A=a[N].paddedRect;Fn.copy(C.data,v,{x:0,y:0},{x:A.x+1,y:A.y+1},C.data)}for(const N in r){const C=r[N],A=u[N].paddedRect,L=A.x+1,O=A.y+1,U=C.data.width,q=C.data.height;Fn.copy(C.data,v,{x:0,y:0},{x:L,y:O},C.data),Fn.copy(C.data,v,{x:0,y:q-1},{x:L,y:O-1},{width:U,height:1}),Fn.copy(C.data,v,{x:0,y:0},{x:L,y:O+q},{width:U,height:1}),Fn.copy(C.data,v,{x:U-1,y:0},{x:L-1,y:O},{width:1,height:q}),Fn.copy(C.data,v,{x:0,y:0},{x:L+U,y:O},{width:1,height:q})}this.image=v,this.iconPositions=a,this.patternPositions=u}addImages(e,r,a){for(const u in e){const p=e[u],f={x:0,y:0,w:p.data.width+2,h:p.data.height+2};a.push(f),r[u]=new Ts(f,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,p]=e.tl;a.update(r.data,void 0,{x:u,y:p})}}var Ee;function Ge(s,e,r,a,u,p,f,x,v,N,C,A,L,O,U){const q=Ju.fromFeature(s,u);let Z;A===T.az.vertical&&q.verticalizePunctuation();let te=q.determineLineBreaks(N,p,e,a,O);const{processBidirectionalText:pe,processStyledBidirectionalText:ae}=ki;if(pe&&q.sections.length===1){Z=[],te=te.map((De=>q.toCodeUnitIndex(De)));const _e=pe(q.toString(),te);for(const De of _e){const Je=[...De].map((()=>0));Z.push(new Ju(De,q.sections,Je))}}else if(ae){Z=[],te=te.map((We=>q.toCodeUnitIndex(We)));let _e=0;const De=[];for(const We of q.text)De.push(...Array(We.length).fill(q.sectionIndex[_e])),_e++;const Je=ae(q.text,De,te);for(const We of Je){const tt=[];let gt="";for(const st of We[0])tt.push(We[1][gt.length]),gt+=st;Z.push(new Ju(We[0],q.sections,tt))}}else Z=(function(_e,De){const Je=[];let We=0;for(const tt of De)Je.push(_e.substring(We,tt)),We=tt;return We<_e.length()&&Je.push(_e.substring(We,_e.length())),Je})(q,te);const oe=[],fe={positionedLines:oe,text:q.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:A,iconsInText:!1,verticalizable:!1};return(function(_e,De,Je,We,tt,gt,st,Ke,qe,Pt,jt,Mt){let vt=0,Bt=0,kr=0,gr=0;const bs=Ke==="right"?1:Ke==="left"?0:.5,$n=Ks/Mt;let Js=0;for(const Fr of tt){Fr.trim();const Ns=Fr.getMaxScale(),Ds={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Js]=Ds;const hs=Ds.positionedGlyphs;let La=0;if(!Fr.length()){Bt+=gt,++Js;continue}const Un=Gt(We,Fr,$n);let Fa=0;for(const xn of Fr.text){const ks=Fr.getSection(Fa),Qs=xn.codePointAt(0),Es=sr(qe,jt,Qs),yn={glyph:Qs,imageName:null,x:vt,y:Bt+-17,vertical:Es,scale:1,fontStack:"",sectionIndex:Fr.getSectionIndex(Fa),metrics:null,rect:null};let Gc;if("fontStack"in ks){if(Gc=lr(ks,Qs,Es,Un,De,Je),!Gc)continue;yn.fontStack=ks.fontStack}else{if(_e.iconsInText=!0,ks.scale*=$n,Gc=fn(ks,Es,Ns,Un,We),!Gc)continue;La=Math.max(La,Gc.imageOffset),yn.imageName=ks.imageName}const{rect:cl,metrics:Ap,baselineOffset:sd}=Gc;yn.y+=sd,yn.scale=ks.scale,yn.metrics=Ap,yn.rect=cl,hs.push(yn),Es?(_e.verticalizable=!0,vt+=("imageName"in ks?Ap.advance:Ks)*ks.scale+Pt):vt+=Ap.advance*ks.scale+Pt,Fa++}hs.length!==0&&(kr=Math.max(vt-Pt,kr),Lr(hs,0,hs.length-1,bs)),vt=0,Ds.lineOffset=Math.max(La,(Ns-1)*Ks);const fo=gt*Ns+La;Bt+=fo,gr=Math.max(fo,gr),++Js}const{horizontalAlign:vs,verticalAlign:ms}=yt(st);(function(Fr,Ns,Ds,hs,La,Un,Fa,fo,xn){const ks=(Ns-Ds)*La;let Qs=0;Qs=Un!==Fa?-fo*hs- -17:-hs*xn*Fa+.5*Fa;for(const Es of Fr)for(const yn of Es.positionedGlyphs)yn.x+=ks,yn.y+=Qs})(_e.positionedLines,bs,vs,ms,kr,gr,gt,Bt,tt.length),_e.top+=-ms*Bt,_e.bottom=_e.top+Bt,_e.left+=-vs*kr,_e.right=_e.left+kr})(fe,e,r,a,Z,f,x,v,A,N,L,U),!(function(_e){for(const De of _e)if(De.positionedGlyphs.length!==0)return!1;return!0})(oe)&&fe}function yt(s){let e=.5,r=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Gt(s,e,r){const a=e.getMaxScale()*Ks,{maxImageWidth:u,maxImageHeight:p}=e.getMaxImageSize(s),f=Math.max(a,p*r);return{verticalLineContentWidth:Math.max(a,u*r),horizontalLineContentHeight:f}}function Qt(s){switch(s){case"top":return 0;case"center":return .5;default:return 1}}function sr(s,e,r){return!(s===T.az.horizontal||!e&&!Mu(r)||e&&(Cd(r)||(a=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(a)))));var a}function lr(s,e,r,a,u,p){const f=p[s.fontStack],x=(function(N,C,A,L){if(N&&N.rect)return N;const O=C[A.fontStack],U=O&&O[L];return U?{rect:null,metrics:U.metrics}:null})(f&&f[e],u,s,e);if(x===null)return null;let v;if(r)v=a.verticalLineContentWidth-s.scale*Ks;else{const N=Qt(s.verticalAlign);v=(a.horizontalLineContentHeight-s.scale*Ks)*N}return{rect:x.rect,metrics:x.metrics,baselineOffset:v}}function fn(s,e,r,a,u){const p=u[s.imageName];if(!p)return null;const f=p.paddedRect,x=p.displaySize,v={width:x[0],height:x[1],left:1,top:-3,advance:e?x[1]:x[0]};let N;if(e)N=a.verticalLineContentWidth-x[1]*s.scale;else{const C=Qt(s.verticalAlign);N=(a.horizontalLineContentHeight-x[1]*s.scale)*C}return{rect:f,metrics:v,baselineOffset:N,imageOffset:(e?x[0]:x[1])*s.scale-Ks*r}}function Lr(s,e,r,a){if(a===0)return;const u=s[r],p=(s[r].x+u.metrics.advance*u.scale)*a;for(let f=e;f<=r;f++)s[f].x-=p}function Kl(s,e,r){const{horizontalAlign:a,verticalAlign:u}=yt(r),p=e[0]-s.displaySize[0]*a,f=e[1]-s.displaySize[1]*u;return{image:s,top:f,bottom:f+s.displaySize[1],left:p,right:p+s.displaySize[0]}}function Nf(s){var e,r;let a=s.left,u=s.top,p=s.right-a,f=s.bottom-u;const x=(e=s.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",v=(r=s.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",N=(s.image.content[2]-s.image.content[0])/(s.image.content[3]-s.image.content[1]);if(v==="proportional"){if(x==="stretchOnly"&&p/f<N||x==="proportional"){const C=Math.ceil(f*N);a*=C/p,p=C}}else if(x==="proportional"&&v==="stretchOnly"&&N!==0&&p/f>N){const C=Math.ceil(p/N);u*=C/f,f=C}return{x1:a,y1:u,x2:a+p,y2:u+f}}function og(s,e,r,a,u,p){const f=s.image;let x;if(f.content){const Z=f.content,te=f.pixelRatio||1;x=[Z[0]/te,Z[1]/te,f.displaySize[0]-Z[2]/te,f.displaySize[1]-Z[3]/te]}const v=e.left*p,N=e.right*p;let C,A,L,O;r==="width"||r==="both"?(O=u[0]+v-a[3],A=u[0]+N+a[1]):(O=u[0]+(v+N-f.displaySize[0])/2,A=O+f.displaySize[0]);const U=e.top*p,q=e.bottom*p;return r==="height"||r==="both"?(C=u[1]+U-a[0],L=u[1]+q+a[2]):(C=u[1]+(U+q-f.displaySize[1])/2,L=C+f.displaySize[1]),{image:f,top:C,right:A,bottom:L,left:O,collisionPadding:x}}bt("ImagePosition",Ts),bt("ImageAtlas",Ve),T.az=void 0,(Ee=T.az||(T.az={}))[Ee.none=0]="none",Ee[Ee.horizontal=1]="horizontal",Ee[Ee.vertical=2]="vertical",Ee[Ee.horizontalOnly=3]="horizontalOnly";const Uc=128,Qu=32640;function lg(s,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Rr(s+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=r;let p=0;for(;p<a.length&&a[p]<=s;)p++;p=Math.max(0,p-1);let f=p;for(;f<a.length&&a[f]<s+1;)f++;f=Math.min(a.length-1,f);const x=a[p],v=a[f];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:v,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:v,minSize:r.evaluate(new Rr(x)),maxSize:r.evaluate(new Rr(v)),interpolationType:u}}}function Pm(s,e,r){let a="never";const u=s.get(e);return u?a=u:s.get(r)&&(a="always"),a}const A_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ef(s,e,r,a,u,p,f,x,v,N,C,A,L){const O=x?Math.min(Qu,Math.round(x[0])):0,U=x?Math.min(Qu,Math.round(x[1])):0;s.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),p,f,(O<<1)+(v?1:0),U,16*N,16*C,256*A,256*L)}function Mm(s,e,r){s.emplaceBack(e.x,e.y,r),s.emplaceBack(e.x,e.y,r),s.emplaceBack(e.x,e.y,r),s.emplaceBack(e.x,e.y,r)}function D_(s){for(const e of s.sections)if(zc(e.text))return!0;return!1}class Im{constructor(e){this.layoutVertexArray=new me,this.indexArray=new Be,this.programConfigurations=e,this.segments=new xt,this.dynamicLayoutVertexArray=new Ne,this.opacityVertexArray=new Ue,this.hasVisibleVertices=!1,this.placedSymbolArray=new _}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,wf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,A_,!0),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}bt("SymbolBuffers",Im);class zm{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new xt,this.collisionVertexArray=new Oe}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Lh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}bt("CollisionBuffers",zm);class Bh{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((f=>f.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lg(this.zoom,r["text-size"]),this.iconSizeData=lg(this.zoom,r["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=Pm(a,"text-overlap","text-allow-overlap")!=="never"||Pm(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map((f=>T.az[f]))),this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Im(new uo(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Im(new uo(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new M,this.lineVertexArray=new D,this.symbolInstances=new E,this.textAnchorOffsets=new B}calculateGlyphDependencies(e,r,a,u,p){for(const f of e)if(r[f.codePointAt(0)]=!0,(a||u)&&p){const x=Ku[f];x&&(r[x.codePointAt(0)]=!0)}}populate(e,r,a){const u=this.layers[0],p=u.layout,f=p.get("text-font"),x=p.get("text-field"),v=p.get("icon-image"),N=(x.value.kind!=="constant"||x.value.value instanceof qs&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),C=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,A=p.get("symbol-sort-key");if(this.features=[],!N&&!C)return;const L=r.iconDependencies,O=r.glyphDependencies,U=r.availableImages,q=new Rr(this.zoom);for(const{feature:Z,id:te,index:pe,sourceLayerIndex:ae}of e){const oe=u._featureFilter.needGeometry,fe=Pi(Z,oe);if(!u._featureFilter.filter(q,fe,a))continue;let _e,De;if(oe||(fe.geometry=ti(Z)),N){const We=u.getValueAndResolveTokens("text-field",fe,a,U),tt=qs.factory(We),gt=this.hasRTLText=this.hasRTLText||D_(tt);(!gt||ki.getRTLTextPluginStatus()==="unavailable"||gt&&ki.isParsed())&&(_e=Tp(tt,u,fe))}if(C){const We=u.getValueAndResolveTokens("icon-image",fe,a,U);De=We instanceof Pn?We:Pn.fromString(We)}if(!_e&&!De)continue;const Je=this.sortFeaturesByKey?A.evaluate(fe,{},a):void 0;if(this.features.push({id:te,text:_e,icon:De,index:pe,sourceLayerIndex:ae,geometry:fe.geometry,properties:Z.properties,type:Ai.types[Z.type],sortKey:Je}),De&&(L[De.name]=!0),_e){const We=f.evaluate(fe,{},a).join(","),tt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.az.vertical)>=0;for(const gt of _e.sections)if(gt.image)L[gt.image.name]=!0;else{const st=no(_e.toString()),Ke=gt.fontStack||We,qe=O[Ke]=O[Ke]||{};this.calculateGlyphDependencies(gt.text,qe,tt,this.allowVerticalPlacement,st)}}}p.get("symbol-placement")==="line"&&(this.features=(function(Z){const te={},pe={},ae=[];let oe=0;function fe(We){ae.push(Z[We]),oe++}function _e(We,tt,gt){const st=pe[We];return delete pe[We],pe[tt]=st,ae[st].geometry[0].pop(),ae[st].geometry[0]=ae[st].geometry[0].concat(gt[0]),st}function De(We,tt,gt){const st=te[tt];return delete te[tt],te[We]=st,ae[st].geometry[0].shift(),ae[st].geometry[0]=gt[0].concat(ae[st].geometry[0]),st}function Je(We,tt,gt){const st=gt?tt[0][tt[0].length-1]:tt[0][0];return`${We}:${st.x}:${st.y}`}for(let We=0;We<Z.length;We++){const tt=Z[We],gt=tt.geometry,st=tt.text?tt.text.toString():null;if(!st){fe(We);continue}const Ke=Je(st,gt),qe=Je(st,gt,!0);if(Ke in pe&&qe in te&&pe[Ke]!==te[qe]){const Pt=De(Ke,qe,gt),jt=_e(Ke,qe,ae[Pt].geometry);delete te[Ke],delete pe[qe],pe[Je(st,ae[jt].geometry,!0)]=jt,ae[Pt].geometry=null}else Ke in pe?_e(Ke,qe,gt):qe in te?De(Ke,qe,gt):(fe(We),te[Ke]=oe-1,pe[qe]=oe-1)}return ae.filter((We=>We.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Z,te)=>Z.sortKey-te.sortKey))}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:a}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:a}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),p=e.dist(r[e.segment]);const f={};for(let x=e.segment+1;x<r.length;x++)f[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:u},x<r.length-1&&(u+=r[x+1].dist(r[x]));for(let x=e.segment||0;x>=0;x--)f[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=r[x-1].dist(r[x]));for(let x=0;x<r.length;x++){const v=f[x];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,p,f,x,v,N,C,A,L){const O=e.indexArray,U=e.layoutVertexArray,q=e.segments.prepareSegment(4*r.length,U,O,this.canOverlap?f.sortKey:void 0),Z=this.glyphOffsetArray.length,te=q.vertexLength,pe=this.allowVerticalPlacement&&x===T.az.vertical?Math.PI/2:0,ae=f.text&&f.text.sections;for(let oe=0;oe<r.length;oe++){const{tl:fe,tr:_e,bl:De,br:Je,tex:We,pixelOffsetTL:tt,pixelOffsetBR:gt,minFontScaleX:st,minFontScaleY:Ke,glyphOffset:qe,isSDF:Pt,sectionIndex:jt}=r[oe],Mt=q.vertexLength,vt=qe[1];Ef(U,v.x,v.y,fe.x,vt+fe.y,We.x,We.y,a,Pt,tt.x,tt.y,st,Ke),Ef(U,v.x,v.y,_e.x,vt+_e.y,We.x+We.w,We.y,a,Pt,gt.x,tt.y,st,Ke),Ef(U,v.x,v.y,De.x,vt+De.y,We.x,We.y+We.h,a,Pt,tt.x,gt.y,st,Ke),Ef(U,v.x,v.y,Je.x,vt+Je.y,We.x+We.w,We.y+We.h,a,Pt,gt.x,gt.y,st,Ke),Mm(e.dynamicLayoutVertexArray,v,pe),O.emplaceBack(Mt,Mt+2,Mt+1),O.emplaceBack(Mt+1,Mt+2,Mt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qe[0]),oe!==r.length-1&&jt===r[oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,f,f.index,{imagePositions:{},canonical:L,formattedSection:ae&&ae[jt]})}e.placedSymbolArray.emplaceBack(v.x,v.y,Z,this.glyphOffsetArray.length-Z,te,N,C,v.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],x,0,!1,0,A)}_addCollisionDebugVertex(e,r,a,u,p,f){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,u,p,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(e,r,a,u,p,f,x){const v=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),N=v.vertexLength,C=p.layoutVertexArray,A=p.collisionVertexArray,L=x.anchorX,O=x.anchorY;this._addCollisionDebugVertex(C,A,f,L,O,new V(e,r)),this._addCollisionDebugVertex(C,A,f,L,O,new V(a,r)),this._addCollisionDebugVertex(C,A,f,L,O,new V(a,u)),this._addCollisionDebugVertex(C,A,f,L,O,new V(e,u)),v.vertexLength+=4;const U=p.indexArray;U.emplaceBack(N,N+1),U.emplaceBack(N+1,N+2),U.emplaceBack(N+2,N+3),U.emplaceBack(N+3,N),v.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,u){for(let p=e;p<r;p++){const f=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,u?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zm(Re,qd.members,ot),this.iconCollisionBox=new zm(Re,qd.members,ot);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,u,p,f,x,v,N){const C={};for(let A=r;A<a;A++){const L=e.get(A);C.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},C.textFeatureIndex=L.featureIndex;break}for(let A=u;A<p;A++){const L=e.get(A);C.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},C.verticalTextFeatureIndex=L.featureIndex;break}for(let A=f;A<x;A++){const L=e.get(A);C.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},C.iconFeatureIndex=L.featureIndex;break}for(let A=v;A<N;A++){const L=e.get(A);C.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},C.verticalIconFeatureIndex=L.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+2,p+1),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),u=[],p=[],f=[];for(let x=0;x<this.symbolInstances.length;++x){f.push(x);const v=this.symbolInstances.get(x);u.push(0|Math.round(r*v.anchorX+a*v.anchorY)),p.push(v.featureIndex)}return f.sort(((x,v)=>u[x]-u[v]||p[v]-p[x])),f}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach(((u,p,f)=>{u>=0&&f.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)})),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let cg,ug;bt("SymbolBucket",Bh,{omit:["layers","collisionBoxArray","features","compareText"]}),Bh.MAX_GLYPHS=65535,Bh.addDynamicAttributes=Mm;var Am={get paint(){return ug=ug||new ws({"icon-opacity":new Rt(Fe.paint_symbol["icon-opacity"]),"icon-color":new Rt(Fe.paint_symbol["icon-color"]),"icon-halo-color":new Rt(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rt(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rt(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Rt(Fe.paint_symbol["text-opacity"]),"text-color":new Rt(Fe.paint_symbol["text-color"],{runtimeType:Cn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Rt(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new Rt(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Rt(Fe.paint_symbol["text-halo-blur"]),"text-translate":new Et(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new Et(Fe.paint_symbol["text-translate-anchor"])})},get layout(){return cg=cg||new ws({"symbol-placement":new Et(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rt(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Et(Fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Et(Fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Et(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rt(Fe.layout_symbol["icon-size"]),"icon-text-fit":new Et(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rt(Fe.layout_symbol["icon-image"]),"icon-rotate":new Rt(Fe.layout_symbol["icon-rotate"]),"icon-padding":new Rt(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Rt(Fe.layout_symbol["icon-offset"]),"icon-anchor":new Rt(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new Rt(Fe.layout_symbol["text-field"]),"text-font":new Rt(Fe.layout_symbol["text-font"]),"text-size":new Rt(Fe.layout_symbol["text-size"]),"text-max-width":new Rt(Fe.layout_symbol["text-max-width"]),"text-line-height":new Et(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Rt(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new Rt(Fe.layout_symbol["text-justify"]),"text-radial-offset":new Rt(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(Fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Rt(Fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Rt(Fe.layout_symbol["text-anchor"]),"text-max-angle":new Et(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new Rt(Fe.layout_symbol["text-rotate"]),"text-padding":new Et(Fe.layout_symbol["text-padding"]),"text-keep-upright":new Et(Fe.layout_symbol["text-keep-upright"]),"text-transform":new Rt(Fe.layout_symbol["text-transform"]),"text-offset":new Rt(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new Et(Fe.layout_symbol["text-allow-overlap"]),"text-overlap":new Et(Fe.layout_symbol["text-overlap"]),"text-ignore-placement":new Et(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new Et(Fe.layout_symbol["text-optional"])})}};class dg{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ea,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bt("FormatSectionOverride",dg,{omit:["defaultValue"]});class Cf extends An{constructor(e,r){super(e,Am,r)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const p of a)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,u){const p=this.layout.get(e).evaluate(r,{},a,u),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Oo(f.value)||!p?p:(function(x,v){return v.replace(/{([^{}]+)}/g,((N,C)=>x&&C in x?String(x[C]):""))})(r.properties,p)}createBucket(e){return new Bh(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Am.paint.overridableProperties){if(!Cf.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new dg(r),u=new Fo(a,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new Xi("source",u):new zl("composite",u,r.value.zoomStops),this.paint._values[e]=new Xn(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Cf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),u=Am.paint.properties[r];let p=!1;const f=x=>{for(const v of x)if(u.overrides&&u.overrides.hasOverride(v))return void(p=!0)};if(a.value.kind==="constant"&&a.value.value instanceof qs)f(a.value.value.sections);else if(a.value.kind==="source"||a.value.kind==="composite"){const x=N=>{p||(N instanceof vn&&Qr(N.value)===gl?f(N.value.sections):N instanceof pc?f(N.sections):N.eachChild(x))},v=a.value;v._styleExpression&&x(v._styleExpression.expression)}return p}}let hg;var R_={get paint(){return hg=hg||new ws({"background-color":new Et(Fe.paint_background["background-color"]),"background-pattern":new Ac(Fe.paint_background["background-pattern"]),"background-opacity":new Et(Fe.paint_background["background-opacity"])})}};class L_ extends An{constructor(e,r){super(e,R_,r)}}class F_ extends An{constructor(e,r){super(e,{},r),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class O_{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const B_={once:!0},Dm=63710088e-1;class ed{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ed(At(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,u=e.lat*r,p=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return Dm*Math.acos(Math.min(p,1))}static convert(e){if(e instanceof ed)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ed(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ed(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const pg=2*Math.PI*Dm;function fg(s){return pg*Math.cos(s*Math.PI/180)}function mg(s){return(180+s)/360}function gg(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function xg(s,e){return s/fg(e)}function yg(s){return 360*s-180}function Pf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function _g(s,e){return s*fg(Pf(e))}class Ep{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=ed.convert(e);return new Ep(mg(a.lng),gg(a.lat),xg(r,a.lat))}toLngLat(){return new ed(yg(this.x),Pf(this.y))}toAltitude(){return _g(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/pg*(e=Pf(this.y),1/Math.cos(e*Math.PI/180));var e}}function bg(s,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[s*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Rm{constructor(e,r,a){if(!(function(u,p,f){return!(u<0||u>25||f<0||f>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))})(e,r,a))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=Vh(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const u=(function(f,x,v){var N=bg(256*f,256*(x=Math.pow(2,v)-x-1),v),C=bg(256*(f+1),256*(x+1),v);return N[0]+","+N[1]+","+C[0]+","+C[1]})(this.x,this.y,this.z),p=(function(f,x,v){let N,C="";for(let A=f;A>0;A--)N=1<<A-1,C+=(x&N?1:0)+(v&N?2:0);return C})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,p).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new V((e.x*r-this.x)*ht,(e.y*r-this.y)*ht)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vg{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Vh(e,r.z,r.z,r.x,r.y)}}class Ri{constructor(e,r,a,u,p){if(this.terrainRttPosMatrix32f=null,e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Rm(a,+u,+p),this.key=Vh(r,e,a,u,p)}clone(){return new Ri(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Ri(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ri(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Vh(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Vh(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-e.canonical.z;return!(r<0)&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Ri(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new Ri(r,this.wrap,r,a,u),new Ri(r,this.wrap,r,a+1,u),new Ri(r,this.wrap,r,a,u+1),new Ri(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ri(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ri(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ep(e.x-this.wrap,e.y))}}function Vh(s,e,r,a,u){(s*=2)<0&&(s=-1*s-1);const p=1<<r;return(p*p*s+p*u+a).toString(36)+r.toString(36)+e.toString(36)}function Lm(s,e){return e?s.properties[e]:s.id}function V_(s,e){const r={id:s.id};if(e.removeAllProperties&&(delete s.removeProperties,delete s.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const a of e.removeProperties){const u=s.addOrUpdateProperties.findIndex((p=>p.key===a));u>-1&&s.addOrUpdateProperties.splice(u,1)}return(s.removeAllProperties||e.removeAllProperties)&&(r.removeAllProperties=!0),(s.removeProperties||e.removeProperties)&&(r.removeProperties=[...s.removeProperties||[],...e.removeProperties||[]]),(s.addOrUpdateProperties||e.addOrUpdateProperties)&&(r.addOrUpdateProperties=[...s.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(s.newGeometry||e.newGeometry)&&(r.newGeometry=e.newGeometry||s.newGeometry),r}function wg(s){var e,r;if(!s)return{};const a={};return a.removeAll=s.removeAll,a.remove=new Set(s.remove||[]),a.add=new Map((e=s.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),a.update=new Map((r=s.update)===null||r===void 0?void 0:r.map((u=>[u.id,u]))),a}bt("CanonicalTileID",Rm),bt("OverscaledTileID",Ri,{omit:["terrainRttPosMatrix32f"]});class Wd{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new Wd;return r.extend(e(new V(this.minX,this.minY))),r.extend(e(new V(this.maxX,this.minY))),r.extend(e(new V(this.minX,this.maxY))),r.extend(e(new V(this.maxX,this.maxY))),r}static fromPoints(e){const r=new Wd;for(const a of e)r.extend(a);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class kg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class jg{constructor(e,r,a,u,p){this.type="Feature",this._vectorTileFeature=e,this._x=a,this._y=u,this._z=r,this.properties=e.properties,this.id=p}projectPoint(e,r,a,u){return[360*(e.x+r)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+a)/u)*Math.PI))-90]}projectLine(e,r,a,u){return e.map((p=>this.projectPoint(p,r,a,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,r=e.extent*Math.pow(2,this._z),a=e.extent*this._x,u=e.extent*this._y,p=e.loadGeometry();switch(e.type){case 1:{const f=[];for(const v of p)f.push(v[0]);const x=this.projectLine(f,a,u,r);this._geometry=f.length===1?{type:"Point",coordinates:x[0]}:{type:"MultiPoint",coordinates:x};break}case 2:{const f=p.map((x=>this.projectLine(x,a,u,r)));this._geometry=f.length===1?{type:"LineString",coordinates:f[0]}:{type:"MultiLineString",coordinates:f};break}case 3:{const f=_p(p),x=[];for(const v of f)x.push(v.map((N=>this.projectLine(N,a,u,r))));this._geometry=x.length===1?{type:"Polygon",coordinates:x[0]}:{type:"MultiPolygon",coordinates:x};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&r!=="_x"&&r!=="_y"&&r!=="_z"&&(e[r]=this[r]);return e}}class $h{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,r,a){this._name=e,this.dataBuffer=r,typeof a=="number"?this._size=a:(this.nullabilityBuffer=a,this._size=a.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Mf extends $h{}class Fm extends Mf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Om extends Mf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Sg extends $h{delta;constructor(e,r,a,u){super(e,r,u),this.delta=a}}class Bm extends Sg{constructor(e,r,a,u){super(e,Int32Array.of(r),a,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Vm extends $h{constructor(e,r,a){super(e,Int32Array.of(r),a)}getValueFromBuffer(e){return this.dataBuffer[0]}}class $_{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,r,a,u,p=4096){this._name=e,this._geometryVector=r,this._idVector=a,this._propertyVectors=u,this._extent=p}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((r=>[r.name,r])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let r=0;for(;r<this.numFeatures;){let a;this.idVector&&(a=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(r)):this.idVector.getValue(r));const u=e?.next().value,p={};for(const f of this.propertyVectors){if(!f)continue;const x=f.name,v=f.getValue(r);v!==null&&(p[x]=v)}r++,yield{id:a,geometry:u,properties:p}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],r=this.geometryVector.getGeometries();for(let a=0;a<this.numFeatures;a++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(a)):this.idVector.getValue(a));const p={coordinates:r[a],type:this.geometryVector.geometryType(a)},f={};for(const x of this.propertyVectors){if(!x)continue;const v=x.name,N=x.getValue(a);N!==null&&(f[v]=N)}e.push({id:u,geometry:p,properties:f})}return e}containsMaxSaveIntegerValues(e){return e instanceof Fm||e instanceof Vm&&e instanceof Bm||e instanceof Om}}class U_{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var yr,qc,Bn,ol,Xd,ai,mn,gn,Tg,Li;function En(s,e,r){const a=new Int32Array(r);let u=0,p=e.get();for(let f=0;f<a.length;f++){let x=s[p++],v=127&x;x<128||(x=s[p++],v|=(127&x)<<7,x<128||(x=s[p++],v|=(127&x)<<14,x<128||(x=s[p++],v|=(127&x)<<21,x<128||(x=s[p++],v|=(15&x)<<28)))),a[u++]=v}return e.set(p),a}function If(s,e,r){const a=new BigInt64Array(r);for(let u=0;u<a.length;u++)a[u]=G_(s,e);return a}function q_(s,e){let r,a;return a=s[e.get()],e.increment(),r=127&a,a<128?r:(a=s[e.get()],e.increment(),r|=(127&a)<<7,a<128?r:(a=s[e.get()],e.increment(),r|=(127&a)<<14,a<128?r:(a=s[e.get()],e.increment(),r|=(127&a)<<21,a<128?r:(a=s[e.get()],r|=(15&a)<<28,(function(u,p,f){let x,v;if(v=p[f.get()],f.increment(),x=(112&v)>>4,v<128||(v=p[f.get()],f.increment(),x|=(127&v)<<3,v<128)||(v=p[f.get()],f.increment(),x|=(127&v)<<10,v<128)||(v=p[f.get()],f.increment(),x|=(127&v)<<17,v<128)||(v=p[f.get()],f.increment(),x|=(127&v)<<24,v<128)||(v=p[f.get()],f.increment(),x|=(1&v)<<31,v<128))return 4294967296*x+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(r,s,e)))))}function Ng(s,e,r,a){throw new Error("FastPFor is not implemented yet.")}function Yd(s){return s>>>1^-(1&s)}function Uh(s){return s>>1n^-(1n&s)}function G_(s,e){let r=0n,a=0,u=e.get();for(;u<s.length;){const p=s[u++];if(r|=BigInt(127&p)<<BigInt(a),!(128&p))break;if(a+=7,a>=64)throw new Error("Varint too long")}return e.set(u),r}function Eg(s,e,r){const a=new Int32Array(r);let u=0;for(let p=0;p<e;p++){const f=s[p];a.fill(s[p+e],u,u+f),u+=f}return a}function Cg(s,e,r){const a=new BigInt64Array(r);let u=0;for(let p=0;p<e;p++){const f=Number(s[p]);a.fill(s[p+e],u,u+f),u+=f}return a}function Pg(s,e,r){const a=new Float64Array(r);let u=0;for(let p=0;p<e;p++){const f=s[p];a.fill(s[p+e],u,u+f),u+=f}return a}function $m(s){const e=s.length/4*4;let r=1;if(e>=4)for(let a=s[0];r<e-4;r+=4)a=s[r]+=a,a=s[r+1]+=a,a=s[r+2]+=a,a=s[r+3]+=a;for(;r!=s.length;)s[r]+=s[r-1],++r}function Mg(s){s[0]=s[0]>>>1^-(1&s[0]),s[1]=s[1]>>>1^-(1&s[1]);const e=s.length/4*4;let r=2;if(e>=4)for(;r<e-4;r+=4){const a=s[r],u=s[r+1],p=s[r+2],f=s[r+3];s[r]=(a>>>1^-(1&a))+s[r-2],s[r+1]=(u>>>1^-(1&u))+s[r-1],s[r+2]=(p>>>1^-(1&p))+s[r],s[r+3]=(f>>>1^-(1&f))+s[r+1]}for(;r!=s.length;r+=2)s[r]=(s[r]>>>1^-(1&s[r]))+s[r-2],s[r+1]=(s[r+1]>>>1^-(1&s[r+1]))+s[r-1]}(function(s){s.NONE="NONE",s.DELTA="DELTA",s.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",s.RLE="RLE",s.MORTON="MORTON",s.PDE="PDE"})(yr||(yr={})),(function(s){s.NONE="NONE",s.FAST_PFOR="FAST_PFOR",s.VARINT="VARINT",s.ALP="ALP"})(qc||(qc={})),(function(s){s.PRESENT="PRESENT",s.DATA="DATA",s.OFFSET="OFFSET",s.LENGTH="LENGTH"})(Bn||(Bn={}));class Um{_dictionaryType;_offsetType;_lengthType;constructor(e,r,a){this._dictionaryType=e,this._offsetType=r,this._lengthType=a}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function ma(s,e){const r=(function(a,u){const p=a[u.get()],f=Object.values(Bn)[p>>4];let x=null;switch(f){case Bn.DATA:x=new Um(Object.values(ol)[15&p]);break;case Bn.OFFSET:x=new Um(null,Object.values(Xd)[15&p]);break;case Bn.LENGTH:x=new Um(null,null,Object.values(ai)[15&p])}u.increment();const v=a[u.get()],N=Object.values(yr)[v>>5],C=Object.values(yr)[v>>2&7],A=Object.values(qc)[3&v];u.increment();const L=En(a,u,2),O=L[0];return{physicalStreamType:f,logicalStreamType:x,logicalLevelTechnique1:N,logicalLevelTechnique2:C,physicalLevelTechnique:A,numValues:O,byteLength:L[1],decompressedCount:O}})(s,e);return r.logicalLevelTechnique1===yr.MORTON?(function(a,u,p){const f=En(u,p,2);return{physicalStreamType:a.physicalStreamType,logicalStreamType:a.logicalStreamType,logicalLevelTechnique1:a.logicalLevelTechnique1,logicalLevelTechnique2:a.logicalLevelTechnique2,physicalLevelTechnique:a.physicalLevelTechnique,numValues:a.numValues,byteLength:a.byteLength,decompressedCount:a.decompressedCount,numBits:f[0],coordinateShift:f[1]}})(r,s,e):yr.RLE!==r.logicalLevelTechnique1&&yr.RLE!==r.logicalLevelTechnique2||qc.NONE===r.physicalLevelTechnique?r:(function(a,u,p){const f=En(u,p,2);return{physicalStreamType:a.physicalStreamType,logicalStreamType:a.logicalStreamType,logicalLevelTechnique1:a.logicalLevelTechnique1,logicalLevelTechnique2:a.logicalLevelTechnique2,physicalLevelTechnique:a.physicalLevelTechnique,numValues:a.numValues,byteLength:a.byteLength,decompressedCount:f[1],runs:f[0],numRleValues:f[1]}})(r,s,e)}(function(s){s.NONE="NONE",s.SINGLE="SINGLE",s.SHARED="SHARED",s.VERTEX="VERTEX",s.MORTON="MORTON",s.FSST="FSST"})(ol||(ol={})),(function(s){s.VERTEX="VERTEX",s.INDEX="INDEX",s.STRING="STRING",s.KEY="KEY"})(Xd||(Xd={})),(function(s){s.VAR_BINARY="VAR_BINARY",s.GEOMETRIES="GEOMETRIES",s.PARTS="PARTS",s.RINGS="RINGS",s.TRIANGLES="TRIANGLES",s.SYMBOL="SYMBOL",s.DICTIONARY="DICTIONARY"})(ai||(ai={})),(function(s){s[s.FLAT=0]="FLAT",s[s.CONST=1]="CONST",s[s.SEQUENCE=2]="SEQUENCE",s[s.DICTIONARY=3]="DICTIONARY",s[s.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(mn||(mn={}));class ll{values;_size;constructor(e,r){this.values=e,this._size=r}get(e){const r=Math.floor(e/8);return(this.values[r]>>e%8&1)==1}set(e,r){const a=Math.floor(e/8);this.values[a]=this.values[a]|(r?1:0)<<e%8}getInt(e){const r=Math.floor(e/8);return this.values[r]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function ga(s,e,r,a,u){return(function(p,f,x){switch(f.logicalLevelTechnique1){case yr.DELTA:return f.logicalLevelTechnique2===yr.RLE?(function(v,N,C){const A=new Int32Array(C);let L=0,O=0;for(let U=0;U<N;U++){const q=v[U],Z=Yd(v[U+N]);for(let te=0;te<q;te++)O+=Z,A[L++]=O}return A})(p,f.runs,f.numRleValues):((function(v){v[0]=v[0]>>>1^-(1&v[0]);const N=v.length/4*4;let C=1;if(N>=4)for(;C<N-4;C+=4){const A=v[C],L=v[C+1],O=v[C+2],U=v[C+3];v[C]=(A>>>1^-(1&A))+v[C-1],v[C+1]=(L>>>1^-(1&L))+v[C],v[C+2]=(O>>>1^-(1&O))+v[C+1],v[C+3]=(U>>>1^-(1&U))+v[C+2]}for(;C!=v.length;++C)v[C]=(v[C]>>>1^-(1&v[C]))+v[C-1]})(p),p);case yr.RLE:return(function(v,N,C){return C?(function(A,L,O){const U=new Int32Array(O);let q=0;for(let Z=0;Z<L;Z++){const te=A[Z];let pe=A[Z+L];pe=pe>>>1^-(1&pe),U.fill(pe,q,q+te),q+=te}return U})(v,N.runs,N.numRleValues):Eg(v,N.runs,N.numRleValues)})(p,f,x);case yr.MORTON:return $m(p),p;case yr.COMPONENTWISE_DELTA:return Mg(p),p;case yr.NONE:return x&&(function(v){for(let N=0;N<v.length;N++){const C=v[N];v[N]=C>>>1^-(1&C)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}})(zf(s,e,r),r,a)}function td(s,e,r){return(function(a,u){if(u.logicalLevelTechnique1===yr.DELTA&&u.logicalLevelTechnique2===yr.NONE)return(function(f){const x=new Int32Array(f.length+1);x[0]=0,x[1]=Yd(f[0]);let v=x[1],N=2;for(;N!=x.length;++N){const C=f[N-1];v+=C>>>1^-(1&C),x[N]=x[N-1]+v}return x})(a);if(u.logicalLevelTechnique1===yr.RLE&&u.logicalLevelTechnique2===yr.NONE)return(function(f,x,v){const N=new Int32Array(v+1);N[0]=0;let C=1,A=N[0];for(let L=0;L<x;L++){const O=f[L],U=f[L+x];for(let q=C;q<C+O;q++)N[q]=U+A,A=N[q];C+=O}return N})(a,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===yr.NONE&&u.logicalLevelTechnique2===yr.NONE){(function(f){let x=0;for(let v=0;v<f.length;v++)f[v]+=x,x=f[v]})(a);const p=new Int32Array(u.numValues+1);return p[0]=0,p.set(a,1),p}if(u.logicalLevelTechnique1===yr.DELTA&&u.logicalLevelTechnique2===yr.RLE){const p=(function(f,x,v){const N=new Int32Array(v+1);N[0]=0;let C=1,A=N[0];for(let L=0;L<x;L++){const O=f[L];let U=f[L+x];U=U>>>1^-(1&U);for(let q=C;q<C+O;q++)N[q]=U+A,A=N[q];C+=O}return N})(a,u.runs,u.numRleValues);return $m(p),p}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(zf(s,e,r),r)}function zf(s,e,r){const a=r.physicalLevelTechnique;if(a===qc.FAST_PFOR)return Ng();if(a===qc.VARINT)return En(s,e,r.numValues);if(a===qc.NONE){const u=e.get();e.add(r.byteLength);const p=s.subarray(u,e.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function qm(s,e,r,a){const u=zf(s,e,r);if(u.length===1){const p=u[0];return a?Yd(p):p}return a?(function(p){return Yd(p[1])})(u):(function(p){return p[1]})(u)}function Ig(s,e,r){return(function(a){if(a.length==2){const u=Yd(a[1]);return[u,u]}return[Yd(a[2]),Yd(a[3])]})(zf(s,e,r))}function zg(s,e,r){return(function(a){if(a.length==2){const u=Uh(a[1]);return[u,u]}return[Uh(a[2]),Uh(a[3])]})(If(s,e,r.numValues))}function Ag(s,e,r,a){return(function(u,p,f){switch(p.logicalLevelTechnique1){case yr.DELTA:return p.logicalLevelTechnique2===yr.RLE?(function(x,v,N){const C=new BigInt64Array(N);let A=0,L=0n;for(let O=0;O<v;O++){const U=Number(x[O]),q=Uh(x[O+v]);for(let Z=0;Z<U;Z++)L+=q,C[A++]=L}return C})(u,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>1n^-(1n&x[0]);const v=x.length/4*4;let N=1;if(v>=4)for(;N<v-4;N+=4){const C=x[N],A=x[N+1],L=x[N+2],O=x[N+3];x[N]=(C>>1n^-(1n&C))+x[N-1],x[N+1]=(A>>1n^-(1n&A))+x[N],x[N+2]=(L>>1n^-(1n&L))+x[N+1],x[N+3]=(O>>1n^-(1n&O))+x[N+2]}for(;N!=x.length;++N)x[N]=(x[N]>>1n^-(1n&x[N]))+x[N-1]})(u),u);case yr.RLE:return(function(x,v,N){return N?(function(C,A,L){const O=new BigInt64Array(L);let U=0;for(let q=0;q<A;q++){const Z=Number(C[q]);let te=C[q+A];te=te>>1n^-(1n&te),O.fill(te,U,U+Z),U+=Z}return O})(x,v.runs,v.numRleValues):Cg(x,v.runs,v.numRleValues)})(u,p,f);case yr.NONE:return f&&(function(x){for(let v=0;v<x.length;v++){const N=x[v];x[v]=N>>1n^-(1n&N)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(If(s,e,r.numValues),r,a)}function Dg(s,e,r,a){const u=If(s,e,r.numValues);if(u.length===1){const p=u[0];return a?Uh(p):p}return a?(function(p){return Uh(p[1])})(u):(function(p){return p[1]})(u)}function Gm(s,e,r,a,u){return(function(p,f,x,v){switch(f.logicalLevelTechnique1){case yr.DELTA:return f.logicalLevelTechnique2===yr.RLE&&(p=Eg(p,f.runs,f.numRleValues)),(function(N,C){const A=new Int32Array(N.size());let L=0;N.get(0)?(A[0]=N.get(0)?C[0]>>>1^-(1&C[0]):0,L=1):A[0]=0;let O=1;for(;O!=A.length;++O)A[O]=N.get(O)?A[O-1]+(C[L]>>>1^-(1&C[L++])):A[O-1];return A})(v,p);case yr.RLE:return(function(N,C,A,L){const O=C;return A?(function(U,q,Z){const te=new Int32Array(U.size());let pe=0;for(let ae=0;ae<Z;ae++){const oe=q[ae];let fe=q[ae+Z];fe=fe>>>1^-(1&fe);for(let _e=pe;_e<pe+oe;_e++)U.get(_e)?te[_e]=fe:(te[_e]=0,pe++);pe+=oe}return te})(L,N,O.runs):(function(U,q,Z){const te=new Int32Array(U.size());let pe=0;for(let ae=0;ae<Z;ae++){const oe=q[ae],fe=q[ae+Z];for(let _e=pe;_e<pe+oe;_e++)U.get(_e)?te[_e]=fe:(te[_e]=0,pe++);pe+=oe}return te})(L,N,O.runs)})(p,f,x,v);case yr.MORTON:return $m(p),p;case yr.COMPONENTWISE_DELTA:return Mg(p),p;case yr.NONE:return p=x?(function(N,C){const A=new Int32Array(N.size());let L=0,O=0;for(;O!=A.length;++O)if(N.get(O)){const U=C[L++];A[O]=U>>>1^-(1&U)}else A[O]=0;return A})(v,p):(function(N,C){const A=new Int32Array(N.size());let L=0,O=0;for(;O!=A.length;++O)A[O]=N.get(O)?C[L++]:0;return A})(v,p),p;default:throw new Error("The specified Logical level technique is not supported")}})(r.physicalLevelTechnique===qc.FAST_PFOR?Ng():En(s,e,r.numValues),r,a,u)}function Af(s,e,r,a){const u=s.logicalLevelTechnique1;if(u===yr.RLE)return s.runs===1?mn.CONST:mn.FLAT;const p=e instanceof ll?e.size():e;if(u===yr.DELTA&&s.logicalLevelTechnique2===yr.RLE){const f=s.runs,x=2;if(s.numRleValues!==p)return mn.FLAT;if(f===1)return mn.SEQUENCE;if(f===2){const v=a.get();let N;if(s.physicalLevelTechnique===qc.VARINT)N=En(r,a,4);else{const C=a.get();N=new Int32Array(r.buffer,r.byteOffset+C,4)}if(a.set(v),N[2]===x&&N[3]===x)return mn.SEQUENCE}}return s.numValues===1?mn.CONST:mn.FLAT}class Rg extends Mf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Lg extends Sg{constructor(e,r,a,u){super(e,BigInt64Array.of(r),a,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class qh{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,r,a){this._geometryOffsets=e,this._partOffsets=r,this._ringOffsets=a}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Zm(s,e,r){return{x:Fg(s,e)-r,y:Fg(s>>1,e)-r}}function Fg(s,e){let r=0;for(let a=0;a<e;a++)r|=(s&1<<2*a)>>a;return r}(function(s){s[s.POINT=0]="POINT",s[s.LINESTRING=1]="LINESTRING",s[s.POLYGON=2]="POLYGON",s[s.MULTIPOINT=3]="MULTIPOINT",s[s.MULTILINESTRING=4]="MULTILINESTRING",s[s.MULTIPOLYGON=5]="MULTIPOLYGON"})(gn||(gn={})),(function(s){s[s.POINT=0]="POINT",s[s.LINESTRING=1]="LINESTRING",s[s.POLYGON=2]="POLYGON"})(Tg||(Tg={})),(function(s){s[s.MORTON=0]="MORTON",s[s.VEC_2=1]="VEC_2",s[s.VEC_3=2]="VEC_3"})(Li||(Li={}));class Z_{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((r=>[r]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,r){return[e].concat(r)}createMultiPolygon(e){return e.flat()}}function Og(s){const e=new Array(s.numGeometries);let r=1,a=1,u=1,p=0;const f=new Z_;let x=0,v=0;const N=s.mortonSettings,C=s.topologyVector,A=C.geometryOffsets,L=C.partOffsets,O=C.ringOffsets,U=s.vertexOffsets,q=s.containsPolygonGeometry(),Z=s.vertexBuffer;for(let te=0;te<s.numGeometries;te++){const pe=s.geometryType(te);if(pe===gn.POINT){if(U&&U.length!==0)if(s.vertexBufferType===Li.VEC_2){const ae=2*U[v++],oe=new V(Z[ae],Z[ae+1]);e[p++]=f.createPoint(oe)}else{const ae=Zm(Z[U[v++]],N.numBits,N.coordinateShift),oe=new V(ae.x,ae.y);e[p++]=f.createPoint(oe)}else{const ae=new V(Z[x++],Z[x++]);e[p++]=f.createPoint(ae)}A&&u++,L&&r++,O&&a++}else if(pe===gn.MULTIPOINT){const ae=A[u]-A[u-1];u++;const oe=new Array(ae);if(U&&U.length!==0){for(let fe=0;fe<ae;fe++){const _e=2*U[v++];oe[fe]=new V(Z[_e],Z[_e+1])}e[p++]=f.createMultiPoint(oe)}else{for(let fe=0;fe<ae;fe++){const _e=Z[x++],De=Z[x++];oe[fe]=new V(_e,De)}e[p++]=f.createMultiPoint(oe)}}else if(pe===gn.LINESTRING){let ae,oe=0;q?(oe=O[a]-O[a-1],a++):oe=L[r]-L[r-1],r++,U&&U.length!==0?(ae=s.vertexBufferType===Li.VEC_2?Wm(Z,U,v,oe,!1):Xm(Z,U,v,oe,!1,N),v+=oe):(ae=Hm(Z,x,oe,!1),x+=2*oe),e[p++]=f.createLineString(ae),A&&u++}else if(pe===gn.POLYGON){const ae=L[r]-L[r-1];r++;const oe=new Array(ae-1);let fe=O[a]-O[a-1];if(a++,U&&U.length!==0){const _e=s.vertexBufferType===Li.VEC_2?Rf(Z,U,v,fe):Lf(Z,U,v,fe,0,N);v+=fe;for(let De=0;De<oe.length;De++)fe=O[a]-O[a-1],a++,oe[De]=s.vertexBufferType===Li.VEC_2?Rf(Z,U,v,fe):Lf(Z,U,v,fe,0,N),v+=fe;e[p++]=f.createPolygon(_e,oe)}else{const _e=Df(Z,x,fe);x+=2*fe;for(let De=0;De<oe.length;De++)fe=O[a]-O[a-1],a++,oe[De]=Df(Z,x,fe),x+=2*fe;e[p++]=f.createPolygon(_e,oe)}A&&u++}else if(pe===gn.MULTILINESTRING){const ae=A[u]-A[u-1];u++;const oe=new Array(ae);if(U&&U.length!==0){for(let fe=0;fe<ae;fe++){let _e=0;q?(_e=O[a]-O[a-1],a++):_e=L[r]-L[r-1],r++;const De=s.vertexBufferType===Li.VEC_2?Wm(Z,U,v,_e,!1):Xm(Z,U,v,_e,!1,N);oe[fe]=De,v+=_e}e[p++]=f.createMultiLineString(oe)}else{for(let fe=0;fe<ae;fe++){let _e=0;q?(_e=O[a]-O[a-1],a++):_e=L[r]-L[r-1],r++,oe[fe]=Hm(Z,x,_e,!1),x+=2*_e}e[p++]=f.createMultiLineString(oe)}}else{if(pe!==gn.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ae=A[u]-A[u-1];u++;const oe=new Array(ae);let fe=0;if(U&&U.length!==0){for(let _e=0;_e<ae;_e++){const De=L[r]-L[r-1];r++;const Je=new Array(De-1);fe=O[a]-O[a-1],a++;const We=s.vertexBufferType===Li.VEC_2?Rf(Z,U,v,fe):Lf(Z,U,v,fe,0,N);v+=fe;for(let tt=0;tt<Je.length;tt++)fe=O[a]-O[a-1],a++,Je[tt]=s.vertexBufferType===Li.VEC_2?Rf(Z,U,v,fe):Lf(Z,U,v,fe,0,N),v+=fe;oe[_e]=f.createPolygon(We,Je)}e[p++]=f.createMultiPolygon(oe)}else{for(let _e=0;_e<ae;_e++){const De=L[r]-L[r-1];r++;const Je=new Array(De-1);fe=O[a]-O[a-1],a++;const We=Df(Z,x,fe);x+=2*fe;for(let tt=0;tt<Je.length;tt++){const gt=O[a]-O[a-1];a++,Je[tt]=Df(Z,x,gt),x+=2*gt}oe[_e]=f.createPolygon(We,Je)}e[p++]=f.createMultiPolygon(oe)}}}}return e}function Df(s,e,r){return Hm(s,e,r,!0)}function Rf(s,e,r,a){return Wm(s,e,r,a,!0)}function Lf(s,e,r,a,u,p){return Xm(s,e,r,a,!0,p)}function Hm(s,e,r,a){const u=new Array(a?r+1:r);for(let p=0;p<2*r;p+=2)u[p/2]=new V(s[e+p],s[e+p+1]);return a&&(u[u.length-1]=u[0]),u}function Wm(s,e,r,a,u){const p=new Array(u?a+1:a);for(let f=0;f<2*a;f+=2){const x=2*e[r+f/2];p[f/2]=new V(s[x],s[x+1])}return u&&(p[p.length-1]=p[0]),p}function Xm(s,e,r,a,u,p){const f=new Array(u?a+1:a);for(let x=0;x<a;x++){const v=Zm(s[e[r+x]],p.numBits,p.coordinateShift);f[x]=new V(v.x,v.y)}return u&&(f[f.length-1]=f[0]),f}class Bg{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,r,a,u,p){this._vertexBufferType=e,this._topologyVector=r,this._vertexOffsets=a,this._vertexBuffer=u,this._mortonSettings=p}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Og(this);let r=0;for(;r<this.numGeometries;)yield{coordinates:e[r],type:this.geometryType(r)},r++}getSimpleEncodedVertex(e){const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const a=Zm(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[a.x,a.y]}const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getGeometries(){return Og(this)}get mortonSettings(){return this._mortonSettings}}class Vg extends Bg{_numGeometries;_geometryType;constructor(e,r,a,u,p,f,x){super(a,u,p,f,x),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===gn.POLYGON||this._geometryType===gn.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class $g extends Bg{_geometryTypes;constructor(e,r,a,u,p,f){super(e,a,u,p,f),this._geometryTypes=r}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===gn.POLYGON||this.geometryType(e)===gn.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Ug{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,r,a,u){this._triangleOffsets=e,this._indexBuffer=r,this._vertexBuffer=a,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),r=this._topologyVector,a=r.partOffsets,u=r.ringOffsets,p=r.geometryOffsets;let f=0,x=1,v=1,N=1;for(let C=0;C<this.numGeometries;C++)switch(this.geometryType(C)){case gn.POLYGON:{const A=a[x]-a[x-1];x++;const L=[];for(let O=0;O<A;O++){const U=u[v]-u[v-1];v++;const q=[];for(let Z=0;Z<U;Z++){const te=this._vertexBuffer[f++],pe=this._vertexBuffer[f++];q.push(new V(te,pe))}q.length>0&&q.push(q[0]),L.push(q)}e[C]=L,p&&N++}break;case gn.MULTIPOLYGON:{const A=p[N]-p[N-1];N++;const L=[];for(let O=0;O<A;O++){const U=a[x]-a[x-1];x++;for(let q=0;q<U;q++){const Z=u[v]-u[v-1];v++;const te=[];for(let pe=0;pe<Z;pe++){const ae=this._vertexBuffer[f++],oe=this._vertexBuffer[f++];te.push(new V(ae,oe))}te.length>0&&te.push(te[0]),L.push(te)}}e[C]=L}}return e}[Symbol.iterator](){return null}}function qg(s,e,r,a,u,p){return new H_(s,e,r,a,u,p)}class H_ extends Ug{_numGeometries;_geometryType;constructor(e,r,a,u,p,f){super(a,u,p,f),this._numGeometries=e,this._geometryType=r}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Gg(s,e,r,a,u){return new W_(s,e,r,a,u)}class W_ extends Ug{_geometryTypes;constructor(e,r,a,u,p){super(r,a,u,p),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function X_(s,e,r,a,u){const p=ma(s,r);let f=null,x=null,v=null,N=null,C=null,A=null,L=null,O=null;if(Af(p,a,s,r)===mn.CONST){const q=qm(s,r,p,!1);for(let Z=0;Z<e-1;Z++){const te=ma(s,r);switch(te.physicalStreamType){case Bn.LENGTH:switch(te.logicalStreamType.lengthType){case ai.GEOMETRIES:f=td(s,r,te);break;case ai.PARTS:x=td(s,r,te);break;case ai.RINGS:v=td(s,r,te);break;case ai.TRIANGLES:L=td(s,r,te)}break;case Bn.OFFSET:switch(te.logicalStreamType.offsetType){case Xd.VERTEX:N=ga(s,r,te,!1);break;case Xd.INDEX:O=ga(s,r,te,!1)}break;case Bn.DATA:ol.VERTEX===te.logicalStreamType.dictionaryType?C=ga(s,r,te,!0):(A={numBits:te.numBits,coordinateShift:te.coordinateShift},C=ga(s,r,te,!1))}}return O!==null?f!=null||x!=null?qg(a,q,L,O,C,new qh(f,x,v)):qg(a,q,L,O,C):A===null?(function(Z,te,pe,ae,oe){return new Vg(Z,te,Li.VEC_2,pe,ae,oe)})(a,q,new qh(f,x,v),N,C):(function(Z,te,pe,ae,oe,fe){return new Vg(Z,te,Li.MORTON,pe,ae,oe,fe)})(a,q,new qh(f,x,v),N,C,A)}const U=ga(s,r,p,!1);for(let q=0;q<e-1;q++){const Z=ma(s,r);switch(Z.physicalStreamType){case Bn.LENGTH:switch(Z.logicalStreamType.lengthType){case ai.GEOMETRIES:f=ga(s,r,Z,!1);break;case ai.PARTS:x=ga(s,r,Z,!1);break;case ai.RINGS:v=ga(s,r,Z,!1);break;case ai.TRIANGLES:L=td(s,r,Z)}break;case Bn.OFFSET:switch(Z.logicalStreamType.offsetType){case Xd.VERTEX:N=ga(s,r,Z,!1);break;case Xd.INDEX:O=ga(s,r,Z,!1)}break;case Bn.DATA:ol.VERTEX===Z.logicalStreamType.dictionaryType?C=ga(s,r,Z,!0):(A={numBits:Z.numBits,coordinateShift:Z.coordinateShift},C=ga(s,r,Z,!1))}}return O!==null&&x===null?Gg(U,L,O,C):(f!==null?(f=Ym(U,f,2),x!==null&&v!==null?(x=Zg(U,f,x,!1),v=(function(q,Z,te,pe){const ae=new Int32Array(te[te.length-1]+1);let oe=0;ae[0]=oe;let fe=1,_e=1,De=0;for(let Je=0;Je<q.length;Je++){const We=q[Je],tt=Z[Je+1]-Z[Je];if(We!==0&&We!==3)for(let gt=0;gt<tt;gt++){const st=te[fe]-te[fe-1];fe++;for(let Ke=0;Ke<st;Ke++)oe=ae[_e++]=oe+pe[De++]}else for(let gt=0;gt<tt;gt++)ae[_e++]=++oe,fe++}return ae})(U,f,x,v)):x!==null&&(x=(function(q,Z,te){const pe=new Int32Array(Z[Z.length-1]+1);let ae=0;pe[0]=ae;let oe=1,fe=0;for(let _e=0;_e<q.length;_e++){const De=q[_e],Je=Z[_e+1]-Z[_e];if(De===4||De===1)for(let We=0;We<Je;We++)ae=pe[oe++]=ae+te[fe++];else for(let We=0;We<Je;We++)pe[oe++]=++ae}return pe})(U,f,x))):x!==null&&v!==null?(x=Ym(U,x,1),v=Zg(U,x,v,!0)):x!==null&&(x=Ym(U,x,0)),O!==null?Gg(U,L,O,C,new qh(f,x,v)):A===null?(function(q,Z,te,pe){return new $g(Li.VEC_2,q,Z,te,pe)})(U,new qh(f,x,v),N,C):(function(q,Z,te,pe,ae){return new $g(Li.MORTON,q,Z,te,pe,ae)})(U,new qh(f,x,v),N,C,A))}function Ym(s,e,r){const a=new Int32Array(s.length+1);let u=0;a[0]=u;let p=0;for(let f=0;f<s.length;f++)u=a[f+1]=u+(s[f]>r?e[p++]:1);return a}function Zg(s,e,r,a){const u=new Int32Array(e[e.length-1]+1);let p=0;u[0]=p;let f=1,x=0;for(let v=0;v<s.length;v++){const N=s[v],C=e[v+1]-e[v];if(N===5||N===2||a&&(N===4||N===1))for(let A=0;A<C;A++)p=u[f++]=p+r[x++];else for(let A=0;A<C;A++)u[f++]=++p}return u}class Y_ extends $h{dataVector;constructor(e,r,a){super(e,r.getBuffer(),a),this.dataVector=r}getValueFromBuffer(e){return this.dataVector.get(e)}}class K_ extends Mf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Hg extends $h{constructor(e,r,a){super(e,BigInt64Array.of(r),a)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Cp(s,e,r){return Wg(s,Math.ceil(e/8),r)}function Wg(s,e,r){const a=new Uint8Array(e);let u=0;for(;u<e;){const p=s[r.increment()];if(p<=127){const f=p+3,x=s[r.increment()],v=u+f;a.fill(x,u,v),u=v}else{const f=256-p;for(let x=0;x<f;x++)a[u++]=s[r.increment()]}}return a}const J_=new TextDecoder;function Km(s,e,r){return r-e>=12?J_.decode(s.subarray(e,r)):(function(a,u,p){let f="",x=u;for(;x<p;){const v=a[x];let N,C,A,L=null,O=v>239?4:v>223?3:v>191?2:1;if(x+O>p)break;O===1?v<128&&(L=v):O===2?(N=a[x+1],(192&N)==128&&(L=(31&v)<<6|63&N,L<=127&&(L=null))):O===3?(N=a[x+1],C=a[x+2],(192&N)==128&&(192&C)==128&&(L=(15&v)<<12|(63&N)<<6|63&C,(L<=2047||L>=55296&&L<=57343)&&(L=null))):O===4&&(N=a[x+1],C=a[x+2],A=a[x+3],(192&N)==128&&(192&C)==128&&(192&A)==128&&(L=(15&v)<<18|(63&N)<<12|(63&C)<<6|63&A,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,O=1):L>65535&&(L-=65536,f+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),f+=String.fromCharCode(L),x+=O}return f})(s,e,r)}class Jm extends $h{offsetBuffer;constructor(e,r,a,u){super(e,a,u),this.offsetBuffer=r}}class Xg extends Jm{textEncoder;constructor(e,r,a,u){super(e,r,a,u??r.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Km(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Gh extends Jm{indexBuffer;textEncoder;constructor(e,r,a,u,p){super(e,a,u,p??r.length),this.indexBuffer=r,this.indexBuffer=r,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const r=this.indexBuffer[e];return Km(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class Yg extends Jm{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,r,a,u,p,f,x){super(e,a,u,x),this.indexBuffer=r,this.symbolOffsetBuffer=p,this.symbolTableBuffer=f,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(a,u,p){const f=[],x=new Array(u.length).fill(0);for(let v=1;v<u.length;v++)x[v]=x[v-1]+u[v-1];for(let v=0;v<p.length;v++)if(p[v]===255)f.push(p[++v]);else{const N=u[p[v]],C=x[p[v]];for(let A=0;A<N;A++)f.push(a[C+A])}return new Uint8Array(f)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const r=this.indexBuffer[e];return Km(this.decodedDictionary,this.offsetBuffer[r],this.offsetBuffer[r+1])}offsetToLengthBuffer(e){const r=new Uint32Array(e.length-1);let a=e[0];for(let u=1;u<e.length;u++){const p=e[u];r[u-1]=p-a,a=p}return r}}function Q_(s,e,r,a,u,p){return r.type==="scalarType"?(function(f,x,v,N,C,A){let L=null,O=0;if(f===0)return null;if(A.nullable){const q=ma(x,v);O=q.numValues;const Z=v.get(),te=Cp(x,O,v);v.set(Z+q.byteLength),L=new ll(te,q.numValues)}const U=L??N;switch(C.physicalType){case 4:case 3:return(function(q,Z,te,pe,ae){const oe=ma(q,Z),fe=Af(oe,ae,q,Z),_e=pe.physicalType===3;if(fe===mn.FLAT){const De=Pp(ae)?Gm(q,Z,oe,_e,ae):ga(q,Z,oe,_e);return new Fm(te.name,De,ae)}if(fe===mn.SEQUENCE){const De=Ig(q,Z,oe);return new Bm(te.name,De[0],De[1],oe.numRleValues)}{const De=qm(q,Z,oe,_e);return new Vm(te.name,De,ae)}})(x,v,A,C,U);case 9:return(function(q,Z,te,pe,ae){let oe=null,fe=null,_e=null,De=null,Je=null,We=null,tt=null,gt=null;for(let st=0;st<pe;st++){const Ke=ma(Z,te);if(Ke.byteLength!==0)switch(Ke.physicalStreamType){case Bn.PRESENT:{const qe=Cp(Z,Ke.numValues,te);We=new ll(qe,Ke.numValues);break}case Bn.OFFSET:fe=ae!=null||We!=null?Gm(Z,te,Ke,!1,ae??We):ga(Z,te,Ke,!1);break;case Bn.LENGTH:{const qe=td(Z,te,Ke);ai.DICTIONARY===Ke.logicalStreamType.lengthType?oe=qe:ai.SYMBOL===Ke.logicalStreamType.lengthType?De=qe:tt=qe;break}case Bn.DATA:{const qe=Z.subarray(te.get(),te.get()+Ke.byteLength);te.add(Ke.byteLength);const Pt=Ke.logicalStreamType.dictionaryType;ol.FSST===Pt?Je=qe:ol.SINGLE===Pt||ol.SHARED===Pt?_e=qe:ol.NONE===Pt&&(gt=qe);break}}}return(function(st,Ke,qe,Pt,jt,Mt,vt){return Ke?new Yg(st,qe,Pt,jt,Mt,Ke,vt):null})(q,Je,fe,oe,_e,De,ae??We)??(function(st,Ke,qe,Pt,jt){return Ke?jt?new Gh(st,qe,Pt,Ke,jt):new Gh(st,qe,Pt,Ke):null})(q,_e,fe,oe,ae??We)??(function(st,Ke,qe,Pt,jt){if(!Ke||!qe)return null;if(Pt)return jt?new Gh(st,Pt,Ke,qe,jt):new Gh(st,Pt,Ke,qe);if(jt&&jt.size()!==Ke.length-1){const Mt=new Int32Array(jt.size());let vt=0;for(let Bt=0;Bt<jt.size();Bt++)Mt[Bt]=jt.get(Bt)?vt++:0;return new Gh(st,Mt,Ke,qe,jt)}return jt?new Xg(st,Ke,qe,jt):new Xg(st,Ke,qe)})(q,tt,gt,fe,ae??We)})(A.name,x,v,A.nullable?f-1:f,L);case 0:return(function(q,Z,te,pe,ae){const oe=ma(q,Z),fe=oe.numValues,_e=Z.get(),De=Pp(ae)?(function(We,tt,gt,st){const Ke=Wg(We,Math.ceil(tt/8),gt),qe=new ll(Ke,tt),Pt=st.size(),jt=new ll(new Uint8Array(Pt),Pt);let Mt=0;for(let vt=0;vt<st.size();vt++){const Bt=!!st.get(vt)&&qe.get(Mt++);jt.set(vt,Bt)}return jt.getBuffer()})(q,fe,Z,ae):Cp(q,fe,Z);Z.set(_e+oe.byteLength);const Je=new ll(De,fe);return new Y_(te.name,Je,ae)})(x,v,A,0,U);case 6:case 5:return(function(q,Z,te,pe,ae){const oe=ma(q,Z),fe=Af(oe,pe,q,Z),_e=ae.physicalType===5;if(fe===mn.FLAT){const De=Pp(pe)?(function(Je,We,tt,gt,st){return(function(Ke,qe,Pt,jt){switch(qe.logicalLevelTechnique1){case yr.DELTA:return qe.logicalLevelTechnique2===yr.RLE&&(Ke=Cg(Ke,qe.runs,qe.numRleValues)),(function(Mt,vt){const Bt=new BigInt64Array(Mt.size());let kr=0;Mt.get(0)?(Bt[0]=Mt.get(0)?vt[0]>>1n^-(1n&vt[0]):0n,kr=1):Bt[0]=0n;let gr=1;for(;gr!=Bt.length;++gr)Bt[gr]=Mt.get(gr)?Bt[gr-1]+(vt[kr]>>1n^-(1n&vt[kr++])):Bt[gr-1];return Bt})(jt,Ke);case yr.RLE:return(function(Mt,vt,Bt,kr){const gr=vt;return Bt?(function(bs,$n,Js){const vs=new BigInt64Array(bs.size());let ms=0;for(let Fr=0;Fr<Js;Fr++){const Ns=Number($n[Fr]);let Ds=$n[Fr+Js];Ds=Ds>>1n^-(1n&Ds);for(let hs=ms;hs<ms+Ns;hs++)bs.get(hs)?vs[hs]=Ds:(vs[hs]=0n,ms++);ms+=Ns}return vs})(kr,Mt,gr.runs):(function(bs,$n,Js){const vs=new BigInt64Array(bs.size());let ms=0;for(let Fr=0;Fr<Js;Fr++){const Ns=Number($n[Fr]),Ds=$n[Fr+Js];for(let hs=ms;hs<ms+Ns;hs++)bs.get(hs)?vs[hs]=Ds:(vs[hs]=0n,ms++);ms+=Ns}return vs})(kr,Mt,gr.runs)})(Ke,qe,Pt,jt);case yr.NONE:return Ke=Pt?(function(Mt,vt){const Bt=new BigInt64Array(Mt.size());let kr=0,gr=0;for(;gr!=Bt.length;++gr)if(Mt.get(gr)){const bs=vt[kr++];Bt[gr]=bs>>1n^-(1n&bs)}else Bt[gr]=0n;return Bt})(jt,Ke):(function(Mt,vt){const Bt=new BigInt64Array(Mt.size());let kr=0,gr=0;for(;gr!=Bt.length;++gr)Bt[gr]=Mt.get(gr)?vt[kr++]:0n;return Bt})(jt,Ke),Ke;default:throw new Error("The specified Logical level technique is not supported")}})(If(Je,We,tt.numValues),tt,gt,st)})(q,Z,oe,_e,pe):Ag(q,Z,oe,_e);return new Rg(te.name,De,pe)}if(fe===mn.SEQUENCE){const De=zg(q,Z,oe);return new Lg(te.name,De[0],De[1],oe.numRleValues)}{const De=Dg(q,Z,oe,_e);return new Hg(te.name,De,pe)}})(x,v,A,U,C);case 7:return(function(q,Z,te,pe){const ae=ma(q,Z),oe=Pp(pe)?(function(fe,_e,De,Je){const We=_e.get(),tt=We+Je*Float32Array.BYTES_PER_ELEMENT,gt=new Uint8Array(fe.subarray(We,tt)).buffer,st=new Float32Array(gt);_e.set(tt);const Ke=De.size(),qe=new Float32Array(Ke);let Pt=0;for(let jt=0;jt<Ke;jt++)qe[jt]=De.get(jt)?st[Pt++]:0;return qe})(q,Z,pe,ae.numValues):(function(fe,_e,De){const Je=_e.get(),We=Je+De*Float32Array.BYTES_PER_ELEMENT,tt=new Uint8Array(fe.subarray(Je,We)).buffer,gt=new Float32Array(tt);return _e.set(We),gt})(q,Z,ae.numValues);return new K_(te.name,oe,pe)})(x,v,A,U);case 8:return(function(q,Z,te,pe){const ae=ma(q,Z),oe=Pp(pe)?(function(fe,_e,De,Je){const We=_e.get(),tt=We+Je*Float64Array.BYTES_PER_ELEMENT,gt=new Uint8Array(fe.subarray(We,tt)).buffer,st=new Float64Array(gt);_e.set(tt);const Ke=De.size(),qe=new Float64Array(Ke);let Pt=0;for(let jt=0;jt<Ke;jt++)qe[jt]=De.get(jt)?st[Pt++]:0;return qe})(q,Z,pe,ae.numValues):(function(fe,_e,De){const Je=_e.get(),We=Je+De*Float64Array.BYTES_PER_ELEMENT,tt=new Uint8Array(fe.subarray(Je,We)).buffer,gt=new Float64Array(tt);return _e.set(We),gt})(q,Z,ae.numValues);return new Om(te.name,oe,pe)})(x,v,A,U);default:throw new Error(`The specified data type for the field is currently not supported: ${C}`)}})(a,s,e,u,r.scalarType,r):a!=1?null:(function(f,x,v,N){let C=null,A=null,L=null,O=null,U=!1;for(;!U;){const pe=ma(f,x);switch(pe.physicalStreamType){case Bn.LENGTH:ai.DICTIONARY===pe.logicalStreamType.lengthType?C=td(f,x,pe):L=td(f,x,pe);break;case Bn.DATA:ol.SINGLE===pe.logicalStreamType.dictionaryType||ol.SHARED===pe.logicalStreamType.dictionaryType?(A=f.subarray(x.get(),x.get()+pe.byteLength),U=!0):O=f.subarray(x.get(),x.get()+pe.byteLength),x.add(pe.byteLength)}}const q=v.complexType.children,Z=[];let te=0;for(const pe of q){const ae=En(f,x,1)[0];if(ae==0)continue;const oe=`${v.name}${pe.name==="default"?"":":"+pe.name}`;if(ae!==2||pe.type!=="scalarField"||pe.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const fe=ma(f,x),_e=Cp(f,fe.numValues,x),De=ma(f,x),Je=De.decompressedCount!==N?Gm(f,x,De,!1,new ll(_e,fe.numValues)):ga(f,x,De,!1);Z[te++]=O?new Yg(oe,Je,C,A,L,O,new ll(_e,fe.numValues)):new Gh(oe,Je,C,A,new ll(_e,fe.numValues))}return Z})(s,e,r,u)}function Pp(s){return s instanceof ll}function eb(s){if(s.name==="id")return!1;if(s.type==="scalarType"){const e=s.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(s.type==="complexType"){const e=s.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",s),!1}const tb=new TextDecoder;function Kg(s,e){const r=En(s,e,1)[0];if(r===0)return"";const a=e.get(),u=s.subarray(a,a+r);return e.add(r),tb.decode(u)}function Jg(s,e){const r=En(s,e,1)[0]>>>0,a=!!(4&r),u=!!(2&r),p=En(s,e,1)[0]>>>0,f={};if(1&r&&(f.nullable=!0),u){const x={};if(a?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),8&r){const v=En(s,e,1)[0]>>>0;x.children=new Array(v);for(let N=0;N<v;N++)x.children[N]=Jg(s,e)}f.type="complexField",f.complexField=x}else{const x={};a?(x.type="logicalType",x.logicalType=p):(x.type="physicalType",x.physicalType=p),f.type="scalarField",f.scalarField=x}return f}function rb(s,e){const r=En(s,e,1)[0]>>>0,a=(function(u){switch(u){case 0:case 1:case 2:case 3:{const p={};p.nullable=!!(1&u),p.columnScope=0;const f={};return f.physicalType=u>1?6:4,f.type="physicalType",p.scalarType=f,p.type="scalarType",p}case 4:{const p={nullable:!1,columnScope:0},f={type:"physicalType",physicalType:0};return p.type="complexType",p.complexType=f,p}case 30:{const p={nullable:!1,columnScope:0},f={type:"physicalType",physicalType:1};return p.type="complexType",p.complexType=f,p}default:return(function(p){let f=null;switch(p){case 10:case 11:f=0;break;case 12:case 13:f=1;break;case 14:case 15:f=2;break;case 16:case 17:f=3;break;case 18:case 19:f=4;break;case 20:case 21:f=5;break;case 22:case 23:f=6;break;case 24:case 25:f=7;break;case 26:case 27:f=8;break;case 28:case 29:f=9;break;default:return null}const x={};x.nullable=!!(1&p),x.columnScope=0;const v={type:"physicalType"};return v.physicalType=f,x.type="scalarType",x.scalarType=v,x})(u)}})(r);if(!a)throw new Error(`Unsupported column type code: ${r}`);if((function(u){return u>=10})(r)?a.name=Kg(s,e):r>=0&&r<=3?a.name="id":r===4&&(a.name="geometry"),(function(u){return u===30})(r)){const u=En(s,e,1)[0]>>>0,p=a.complexType;p.children=new Array(u);for(let f=0;f<u;f++)p.children[f]=Jg(s,e)}return a}function sb(s,e){const r={featureTables:[]},a={};a.name=Kg(s,e);const u=En(s,e,1)[0]>>>0,p=En(s,e,1)[0]>>>0;a.columns=new Array(p);for(let f=0;f<p;f++)a.columns[f]=rb(s,e);return r.featureTables.push(a),[r,u]}function nb(s,e,r,a,u,p,f=!1){const x=e.scalarType.physicalType,v=Af(u,p,s,r);if(x===4)switch(v){case mn.FLAT:{const N=ga(s,r,u,!1);return new Fm(a,N,p)}case mn.SEQUENCE:{const N=Ig(s,r,u);return new Bm(a,N[0],N[1],u.numRleValues)}case mn.CONST:{const N=qm(s,r,u,!1);return new Vm(a,N,p)}}else switch(v){case mn.FLAT:{if(f){const C=(function(A,L,O,U){const q=(function(Z,te,pe){const ae=new Float64Array(te);for(let oe=0;oe<te;oe++)ae[oe]=q_(Z,pe);return ae})(A,O.numValues,L);return(function(Z,te,pe){switch(te.logicalLevelTechnique1){case yr.DELTA:return te.logicalLevelTechnique2===yr.RLE&&(Z=Pg(Z,te.runs,te.numRleValues)),(function(ae){ae[0]=ae[0]%2==1?(ae[0]+1)/-2:ae[0]/2;const oe=ae.length/4*4;let fe=1;if(oe>=4)for(;fe<oe-4;fe+=4){const _e=ae[fe],De=ae[fe+1],Je=ae[fe+2],We=ae[fe+3];ae[fe]=(_e%2==1?(_e+1)/-2:_e/2)+ae[fe-1],ae[fe+1]=(De%2==1?(De+1)/-2:De/2)+ae[fe],ae[fe+2]=(Je%2==1?(Je+1)/-2:Je/2)+ae[fe+1],ae[fe+3]=(We%2==1?(We+1)/-2:We/2)+ae[fe+2]}for(;fe!=ae.length;++fe)ae[fe]=(ae[fe]%2==1?(ae[fe]+1)/-2:ae[fe]/2)+ae[fe-1]})(Z),Z;case yr.RLE:return(function(ae,oe,fe){return Pg(ae,oe.runs,oe.numRleValues)})(Z,te);case yr.NONE:return Z;default:throw new Error(`The specified Logical level technique is not supported: ${te.logicalLevelTechnique1}`)}})(q,O)})(s,r,u);return new Om(a,C,p)}const N=Ag(s,r,u,!1);return new Rg(a,N,p)}case mn.SEQUENCE:{const N=zg(s,r,u);return new Lg(a,N[0],N[1],u.numRleValues)}case mn.CONST:{const N=Dg(s,r,u,!1);return new Hg(a,N,p)}}throw new Error("Vector type not supported for id column.")}class ab{constructor(e,r){var a;switch(this._featureData=e,this.properties=this._featureData.properties||{},(a=this._featureData.geometry)===null||a===void 0?void 0:a.type){case gn.POINT:case gn.MULTIPOINT:this.type=1;break;case gn.LINESTRING:case gn.MULTILINESTRING:this.type=2;break;case gn.POLYGON:case gn.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=r,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const r of this._featureData.geometry.coordinates){const a=[];for(const u of r)a.push(new V(u.x,u.y));e.push(a)}return e}}class ib{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new ab(this.features[e],this.extent)}}class Qg{constructor(e){this.layers={};const r=(function(a,u,p=!0){const f=new U_(0),x=[];for(;f.get()<a.length;){const v=En(a,f,1)[0]>>>0,N=f.get()+v;if(N>a.length)throw new Error(`Block overruns tile: ${N} > ${a.length}`);if(En(a,f,1)[0]>>>0!=1){f.set(N);continue}const C=sb(a,f),A=C[1],L=C[0].featureTables[0];let O=null,U=null;const q=[];let Z=0;for(const pe of L.columns){const ae=pe.name;if(ae==="id"){let oe=null;if(pe.nullable){const _e=ma(a,f),De=f.get(),Je=Cp(a,_e.numValues,f);f.set(De+_e.byteLength),oe=new ll(Je,_e.numValues)}const fe=ma(a,f);Z=fe.decompressedCount,O=nb(a,pe,f,ae,fe,oe??Z,p)}else if(ae==="geometry"){const oe=En(a,f,1)[0];if(Z===0){const fe=f.get();Z=ma(a,f).decompressedCount,f.set(fe)}U=X_(a,oe,f,Z)}else{const oe=eb(pe)?En(a,f,1)[0]:1;if(oe===0&&pe.type==="scalarType")continue;const fe=Q_(a,f,pe,oe,Z);if(fe)if(Array.isArray(fe))for(const _e of fe)q.push(_e);else q.push(fe)}}const te=new $_(L.name,U,O,q,A);x.push(te),f.set(N)}return x})(new Uint8Array(e));this.layers=r.reduce(((a,u)=>Object.assign(Object.assign({},a),{[u.name]:new ib(u)})),{})}}class ob{constructor(e,r){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=r,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const a of r){const u=[];for(const p of a)u.push(new V(p[0],p[1]));e.push(u)}return e}}const Mp="_geojsonTileLayer";function lb(s,e){e.writeVarintField(15,s.version||1),e.writeStringField(1,s.name||""),e.writeVarintField(5,s.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let p=0;p<s.length;p++)r.feature=s.feature(p),e.writeMessage(2,cb,r);const a=r.keys;for(const p of a)e.writeStringField(3,p);const u=r.values;for(const p of u)e.writeMessage(4,hb,p)}function cb(s,e){if(!s.feature)return;const r=s.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,ub,s),e.writeVarintField(3,r.type),e.writeMessage(4,db,r)}function ub(s,e){for(const r in s.feature?.properties){let a=s.feature.properties[r],u=s.keycache[r];if(a==null)continue;u===void 0&&(s.keys.push(r),u=s.keys.length-1,s.keycache[r]=u),e.writeVarint(u),typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"&&(a=JSON.stringify(a));const p=typeof a+":"+a;let f=s.valuecache[p];f===void 0&&(s.values.push(a),f=s.values.length-1,s.valuecache[p]=f),e.writeVarint(f)}}function Qm(s,e){return(e<<3)+(7&s)}function ex(s){return s<<1^s>>31}function db(s,e){const r=s.loadGeometry(),a=s.type;let u=0,p=0;for(const f of r){let x=1;a===1&&(x=f.length),e.writeVarint(Qm(1,x));const v=a===3?f.length-1:f.length;for(let N=0;N<v;N++){N===1&&a!==1&&e.writeVarint(Qm(2,v-1));const C=f[N].x-u,A=f[N].y-p;e.writeVarint(ex(C)),e.writeVarint(ex(A)),u+=C,p+=A}s.type===3&&e.writeVarint(Qm(7,1))}}function hb(s,e){const r=typeof s;r==="string"?e.writeStringField(1,s):r==="boolean"?e.writeBooleanField(7,s):r==="number"&&(s%1!=0?e.writeDoubleField(3,s):s<0?e.writeSVarintField(6,s):e.writeVarintField(5,s))}class tx{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zn(ht,16,0),this.grid3D=new zn(ht,16,0),this.featureIndexArray=new J,this.promoteId=r}insert(e,r,a,u,p,f){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,p);const v=f?this.grid3D:this.grid;for(let N=0;N<r.length;N++){const C=r[N],A=[1/0,1/0,-1/0,-1/0];for(let L=0;L<C.length;L++){const O=C[L];A[0]=Math.min(A[0],O.x),A[1]=Math.min(A[1],O.y),A[2]=Math.max(A[2],O.x),A[3]=Math.max(A[3],O.y)}A[0]<ht&&A[1]<ht&&A[2]>=0&&A[3]>=0&&v.insert(x,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new ff(new o(this.rawTileData)).layers:new Qg(this.rawTileData).layers,this.sourceLayerCoder=new kg(this.vtLayers?Object.keys(this.vtLayers).sort():[Mp])),this.vtLayers}query(e,r,a,u){this.loadVTLayers();const p=e.params,f=ht/e.tileSize/e.scale,x=Vo(p.filter,p.globalState),v=e.queryGeometry,N=e.queryPadding*f,C=Wd.fromPoints(v),A=this.grid.query(C.minX-N,C.minY-N,C.maxX+N,C.maxY+N),L=Wd.fromPoints(e.cameraQueryGeometry).expandBy(N),O=this.grid3D.query(L.minX,L.minY,L.maxX,L.maxY,((Z,te,pe,ae)=>(function(oe,fe,_e,De,Je){for(const tt of oe)if(fe<=tt.x&&_e<=tt.y&&De>=tt.x&&Je>=tt.y)return!0;const We=[new V(fe,_e),new V(fe,Je),new V(De,Je),new V(De,_e)];if(oe.length>2){for(const tt of We)if(tl(oe,tt))return!0}for(let tt=0;tt<oe.length-1;tt++)if(rl(oe[tt],oe[tt+1],We))return!0;return!1})(e.cameraQueryGeometry,Z-N,te-N,pe+N,ae+N)));for(const Z of O)A.push(Z);A.sort(pb);const U={};let q;for(let Z=0;Z<A.length;Z++){const te=A[Z];if(te===q)continue;q=te;const pe=this.featureIndexArray.get(te);let ae=null;this.loadMatchingFeature(U,pe.bucketIndex,pe.sourceLayerIndex,pe.featureIndex,x,p.layers,p.availableImages,r,a,u,((oe,fe,_e)=>(ae||(ae=ti(oe)),fe.queryIntersectsFeature({queryGeometry:v,feature:oe,featureState:_e,geometry:ae,zoom:this.z,transform:e.transform,pixelsToTileUnits:f,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return U}loadMatchingFeature(e,r,a,u,p,f,x,v,N,C,A){const L=this.bucketLayerIDs[r];if(f&&!L.some((Z=>f.has(Z))))return;const O=this.sourceLayerCoder.decode(a),U=this.vtLayers[O].feature(u);if(p.needGeometry){const Z=Pi(U,!0);if(!p.filter(new Rr(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!p.filter(new Rr(this.tileID.overscaledZ),U))return;const q=this.getId(U,O);for(let Z=0;Z<L.length;Z++){const te=L[Z];if(f&&!f.has(te))continue;const pe=v[te];if(!pe)continue;let ae={};q&&C&&(ae=C.getState(pe.sourceLayer||Mp,q));const oe=er({},N[te]);oe.paint=rx(oe.paint,pe.paint,U,ae,x),oe.layout=rx(oe.layout,pe.layout,U,ae,x);const fe=!A||A(U,pe,ae);if(!fe)continue;const _e=new jg(U,this.z,this.x,this.y,q);_e.layer=oe;let De=e[te];De===void 0&&(De=e[te]=[]),De.push({featureIndex:u,feature:_e,intersectionZ:fe})}}lookupSymbolFeatures(e,r,a,u,p,f,x,v){const N={};this.loadVTLayers();const C=Vo(p.filterSpec,p.globalState);for(const A of e)this.loadMatchingFeature(N,a,u,A,C,f,x,v,r);return N}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){var a;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((a=e.properties)===null||a===void 0)&&a.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function rx(s,e,r,a,u){return Jr(s,((p,f)=>{const x=e instanceof Ha?e.get(f):null;return x&&x.evaluate?x.evaluate(r,a,u):x}))}function pb(s,e){return e-s}function sx(s,e,r,a,u){const p=[];for(let f=0;f<s.length;f++){const x=s[f];let v;for(let N=0;N<x.length-1;N++){let C=x[N],A=x[N+1];C.x<e&&A.x<e||(C.x<e?C=new V(e,C.y+(e-C.x)/(A.x-C.x)*(A.y-C.y))._round():A.x<e&&(A=new V(e,C.y+(e-C.x)/(A.x-C.x)*(A.y-C.y))._round()),C.y<r&&A.y<r||(C.y<r?C=new V(C.x+(r-C.y)/(A.y-C.y)*(A.x-C.x),r)._round():A.y<r&&(A=new V(C.x+(r-C.y)/(A.y-C.y)*(A.x-C.x),r)._round()),C.x>=a&&A.x>=a||(C.x>=a?C=new V(a,C.y+(a-C.x)/(A.x-C.x)*(A.y-C.y))._round():A.x>=a&&(A=new V(a,C.y+(a-C.x)/(A.x-C.x)*(A.y-C.y))._round()),C.y>=u&&A.y>=u||(C.y>=u?C=new V(C.x+(u-C.y)/(A.y-C.y)*(A.x-C.x),u)._round():A.y>=u&&(A=new V(C.x+(u-C.y)/(A.y-C.y)*(A.x-C.x),u)._round()),v&&C.equals(v[v.length-1])||(v=[C],p.push(v)),v.push(A)))))}}return p}function nx(s,e,r,a,u){switch(e){case 1:return(function(p,f,x,v){const N=[];for(const C of p)for(const A of C){const L=v===0?A.x:A.y;L>=f&&L<=x&&N.push([A])}return N})(s,r,a,u);case 2:return ax(s,r,a,u,!1);case 3:return ax(s,r,a,u,!0)}return[]}function fb(s,e,r,a,u){const p=a===0?mb:gb;let f=[];const x=[];for(let C=0;C<s.length-1;C++){const A=s[C],L=s[C+1],O=a===0?A.x:A.y,U=a===0?L.x:L.y;let q=!1;O<e?U>e&&f.push(p(A,L,e)):O>r?U<r&&f.push(p(A,L,r)):f.push(A),U<e&&O>=e&&(f.push(p(A,L,e)),q=!0),U>r&&O<=r&&(f.push(p(A,L,r)),q=!0),!u&&q&&(x.push(f),f=[])}const v=s.length-1,N=a===0?s[v].x:s[v].y;return N>=e&&N<=r&&f.push(s[v]),u&&f.length>0&&!f[0].equals(f[f.length-1])&&f.push(new V(f[0].x,f[0].y)),f.length>0&&x.push(f),x}function ax(s,e,r,a,u){const p=[];for(const f of s){const x=fb(f,e,r,a,u);x.length>0&&p.push(...x)}return p}function mb(s,e,r){return new V(r,s.y+(r-s.x)/(e.x-s.x)*(e.y-s.y))}function gb(s,e,r){return new V(s.x+(r-s.y)/(e.y-s.y)*(e.x-s.x),r)}bt("FeatureIndex",tx,{omit:["rawTileData","sourceLayerCoder"]});class rd extends V{constructor(e,r,a,u){super(e,r),this.angle=a,u!==void 0&&(this.segment=u)}clone(){return new rd(this.x,this.y,this.angle,this.segment)}}function ix(s,e,r,a,u){if(e.segment===void 0||r===0)return!0;let p=e,f=e.segment+1,x=0;for(;x>-r/2;){if(f--,f<0)return!1;x-=s[f].dist(p),p=s[f]}x+=s[f].dist(s[f+1]),f++;const v=[];let N=0;for(;x<r/2;){const C=s[f],A=s[f+1];if(!A)return!1;let L=s[f-1].angleTo(C)-C.angleTo(A);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:x,angleDelta:L}),N+=L;x-v[0].distance>a;)N-=v.shift().angleDelta;if(N>u)return!1;f++,x+=C.dist(A)}return!0}function ox(s){let e=0;for(let r=0;r<s.length-1;r++)e+=s[r].dist(s[r+1]);return e}function lx(s,e,r){return s?.6*e*r:0}function cx(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function xb(s,e,r,a,u,p){const f=lx(r,u,p),x=cx(r,a)*p;let v=0;const N=ox(s)/2;for(let C=0;C<s.length-1;C++){const A=s[C],L=s[C+1],O=A.dist(L);if(v+O>N){const U=(N-v)/O,q=os.number(A.x,L.x,U),Z=os.number(A.y,L.y,U),te=new rd(q,Z,L.angleTo(A),C);return te._round(),!f||ix(s,te,x,f,e)?te:void 0}v+=O}}function yb(s,e,r,a,u,p,f,x,v){const N=lx(a,p,f),C=cx(a,u),A=C*f,L=s[0].x===0||s[0].x===v||s[0].y===0||s[0].y===v;return e-A<e/4&&(e=A+e/4),ux(s,L?e/2*x%e:(C/2+2*p)*f*x%e,e,N,r,A,L,!1,v)}function ux(s,e,r,a,u,p,f,x,v){const N=p/2,C=ox(s);let A=0,L=e-r,O=[];for(let U=0;U<s.length-1;U++){const q=s[U],Z=s[U+1],te=q.dist(Z),pe=Z.angleTo(q);for(;L+r<A+te;){L+=r;const ae=(L-A)/te,oe=os.number(q.x,Z.x,ae),fe=os.number(q.y,Z.y,ae);if(oe>=0&&oe<v&&fe>=0&&fe<v&&L-N>=0&&L+N<=C){const _e=new rd(oe,fe,pe,U);_e._round(),a&&!ix(s,_e,p,a,u)||O.push(_e)}}A+=te}return x||O.length||f||(O=ux(s,A/2,r,a,u,p,f,!0,v)),O}function dx(s,e,r,a){const u=[],p=s.image,f=p.pixelRatio,x=p.paddedRect.w-2,v=p.paddedRect.h-2;let N={x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};const C=p.stretchX||[[0,x]],A=p.stretchY||[[0,v]],L=(qe,Pt)=>qe+Pt[1]-Pt[0],O=C.reduce(L,0),U=A.reduce(L,0),q=x-O,Z=v-U;let te=0,pe=O,ae=0,oe=U,fe=0,_e=q,De=0,Je=Z;if(p.content&&a){const qe=p.content,Pt=qe[2]-qe[0],jt=qe[3]-qe[1];(p.textFitWidth||p.textFitHeight)&&(N=Nf(s)),te=Ff(C,0,qe[0]),ae=Ff(A,0,qe[1]),pe=Ff(C,qe[0],qe[2]),oe=Ff(A,qe[1],qe[3]),fe=qe[0]-te,De=qe[1]-ae,_e=Pt-pe,Je=jt-oe}const We=N.x1,tt=N.y1,gt=N.x2-We,st=N.y2-tt,Ke=(qe,Pt,jt,Mt)=>{const vt=Of(qe.stretch-te,pe,gt,We),Bt=Bf(qe.fixed-fe,_e,qe.stretch,O),kr=Of(Pt.stretch-ae,oe,st,tt),gr=Bf(Pt.fixed-De,Je,Pt.stretch,U),bs=Of(jt.stretch-te,pe,gt,We),$n=Bf(jt.fixed-fe,_e,jt.stretch,O),Js=Of(Mt.stretch-ae,oe,st,tt),vs=Bf(Mt.fixed-De,Je,Mt.stretch,U),ms=new V(vt,kr),Fr=new V(bs,kr),Ns=new V(bs,Js),Ds=new V(vt,Js),hs=new V(Bt/f,gr/f),La=new V($n/f,vs/f),Un=e*Math.PI/180;if(Un){const xn=Math.sin(Un),ks=Math.cos(Un),Qs=[ks,-xn,xn,ks];ms._matMult(Qs),Fr._matMult(Qs),Ds._matMult(Qs),Ns._matMult(Qs)}const Fa=qe.stretch+qe.fixed,fo=Pt.stretch+Pt.fixed;return{tl:ms,tr:Fr,bl:Ds,br:Ns,tex:{x:p.paddedRect.x+1+Fa,y:p.paddedRect.y+1+fo,w:jt.stretch+jt.fixed-Fa,h:Mt.stretch+Mt.fixed-fo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hs,pixelOffsetBR:La,minFontScaleX:_e/f/gt,minFontScaleY:Je/f/st,isSDF:r}};if(a&&(p.stretchX||p.stretchY)){const qe=hx(C,q,O),Pt=hx(A,Z,U);for(let jt=0;jt<qe.length-1;jt++){const Mt=qe[jt],vt=qe[jt+1];for(let Bt=0;Bt<Pt.length-1;Bt++)u.push(Ke(Mt,Pt[Bt],vt,Pt[Bt+1]))}}else u.push(Ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:v+1}));return u}function Ff(s,e,r){let a=0;for(const u of s)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function hx(s,e,r){const a=[{fixed:-1,stretch:0}];for(const[u,p]of s){const f=a[a.length-1];a.push({fixed:u-f.stretch,stretch:f.stretch}),a.push({fixed:u-f.stretch,stretch:f.stretch+(p-u)})}return a.push({fixed:e+1,stretch:r}),a}function Of(s,e,r,a){return s/e*r+a}function Bf(s,e,r,a){return s-e*r/a}bt("Anchor",rd);class Vf{constructor(e,r,a,u,p,f,x,v,N,C){var A;if(this.boxStartIndex=e.length,N){let L=f.top,O=f.bottom;const U=f.collisionPadding;U&&(L-=U[1],O+=U[3]);let q=O-L;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const L=!((A=f.image)===null||A===void 0)&&A.content&&(f.image.textFitWidth||f.image.textFitHeight)?Nf(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};L.y1=L.y1*x-v[0],L.y2=L.y2*x+v[2],L.x1=L.x1*x-v[3],L.x2=L.x2*x+v[1];const O=f.collisionPadding;if(O&&(L.x1-=O[0]*x,L.y1-=O[1]*x,L.x2+=O[2]*x,L.y2+=O[3]*x),C){const U=new V(L.x1,L.y1),q=new V(L.x2,L.y1),Z=new V(L.x1,L.y2),te=new V(L.x2,L.y2),pe=C*Math.PI/180;U._rotate(pe),q._rotate(pe),Z._rotate(pe),te._rotate(pe),L.x1=Math.min(U.x,q.x,Z.x,te.x),L.x2=Math.max(U.x,q.x,Z.x,te.x),L.y1=Math.min(U.y,q.y,Z.y,te.y),L.y2=Math.max(U.y,q.y,Z.y,te.y)}e.emplaceBack(r.x,r.y,L.x1,L.y1,L.x2,L.y2,a,u,p)}this.boxEndIndex=e.length}}class _b{constructor(e=[],r=(a,u)=>a<u?-1:a>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,u=r[e];for(;e>0;){const p=e-1>>1,f=r[p];if(a(u,f)>=0)break;r[e]=f,e=p}r[e]=u}_down(e){const{data:r,compare:a}=this,u=this.length>>1,p=r[e];for(;e<u;){let f=1+(e<<1);const x=f+1;if(x<this.length&&a(r[x],r[f])<0&&(f=x),a(r[f],p)>=0)break;r[e]=r[f],e=f}r[e]=p}}function bb(s,e=1,r=!1){const a=Wd.fromPoints(s[0]),u=Math.min(a.width(),a.height());let p=u/2;const f=new _b([],vb),{minX:x,minY:v,maxX:N,maxY:C}=a;if(u===0)return new V(x,v);for(let O=x;O<N;O+=u)for(let U=v;U<C;U+=u)f.push(new Zh(O+p,U+p,p,s));let A=(function(O){let U=0,q=0,Z=0;const te=O[0];for(let pe=0,ae=te.length,oe=ae-1;pe<ae;oe=pe++){const fe=te[pe],_e=te[oe],De=fe.x*_e.y-_e.x*fe.y;q+=(fe.x+_e.x)*De,Z+=(fe.y+_e.y)*De,U+=3*De}return new Zh(q/U,Z/U,0,O)})(s),L=f.length;for(;f.length;){const O=f.pop();(O.d>A.d||!A.d)&&(A=O,r&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,L)),O.max-A.d<=e||(p=O.h/2,f.push(new Zh(O.p.x-p,O.p.y-p,p,s)),f.push(new Zh(O.p.x+p,O.p.y-p,p,s)),f.push(new Zh(O.p.x-p,O.p.y+p,p,s)),f.push(new Zh(O.p.x+p,O.p.y+p,p,s)),L+=4)}return r&&(console.log(`num probes: ${L}`),console.log(`best distance: ${A.d}`)),A.p}function vb(s,e){return e.max-s.max}function Zh(s,e,r,a){this.p=new V(s,e),this.h=r,this.d=(function(u,p){let f=!1,x=1/0;for(let v=0;v<p.length;v++){const N=p[v];for(let C=0,A=N.length,L=A-1;C<A;L=C++){const O=N[C],U=N[L];O.y>u.y!=U.y>u.y&&u.x<(U.x-O.x)*(u.y-O.y)/(U.y-O.y)+O.x&&(f=!f),x=Math.min(x,Th(u,O,U))}}return(f?1:-1)*Math.sqrt(x)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Vn;T.aP=void 0,(Vn=T.aP||(T.aP={}))[Vn.center=1]="center",Vn[Vn.left=2]="left",Vn[Vn.right=3]="right",Vn[Vn.top=4]="top",Vn[Vn.bottom=5]="bottom",Vn[Vn["top-left"]=6]="top-left",Vn[Vn["top-right"]=7]="top-right",Vn[Vn["bottom-left"]=8]="bottom-left",Vn[Vn["bottom-right"]=9]="bottom-right";const e0=Number.POSITIVE_INFINITY;function px(s,e){return e[1]!==e0?(function(r,a,u){let p=0,f=0;switch(a=Math.abs(a),u=Math.abs(u),r){case"top-right":case"top-left":case"top":f=u-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-u}switch(r){case"top-right":case"bottom-right":case"right":p=-a;break;case"top-left":case"bottom-left":case"left":p=a}return[p,f]})(s,e[0],e[1]):(function(r,a){let u=0,p=0;a<0&&(a=0);const f=a/Math.SQRT2;switch(r){case"top-right":case"top-left":p=f-7;break;case"bottom-right":case"bottom-left":p=7-f;break;case"bottom":p=7-a;break;case"top":p=a-7}switch(r){case"top-right":case"bottom-right":u=-f;break;case"top-left":case"bottom-left":u=f;break;case"left":u=a;break;case"right":u=-a}return[u,p]})(s,e[0])}function fx(s,e,r){var a;const u=s.layout,p=(a=u.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},r);if(p){const x=p.values,v=[];for(let N=0;N<x.length;N+=2){const C=v[N]=x[N],A=x[N+1].map((L=>L*Ks));C.startsWith("top")?A[1]-=7:C.startsWith("bottom")&&(A[1]+=7),v[N+1]=A}return new bn(v)}const f=u.get("text-variable-anchor");if(f){let x;x=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},r)*Ks,e0]:u.get("text-offset").evaluate(e,{},r).map((N=>N*Ks));const v=[];for(const N of f)v.push(N,px(N,x));return new bn(v)}return null}function t0(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wb(s,e,r,a,u,p,f,x,v,N,C,A){let L=p.textMaxSize.evaluate(e,{});L===void 0&&(L=f);const O=s.layers[0].layout,U=O.get("icon-offset").evaluate(e,{},C),q=gx(r.horizontal),Z=f/24,te=s.tilePixelRatio*Z,pe=s.tilePixelRatio*L/24,ae=s.tilePixelRatio*x,oe=s.tilePixelRatio*O.get("symbol-spacing"),fe=O.get("text-padding")*s.tilePixelRatio,_e=(function(jt,Mt,vt,Bt=1){const kr=jt.get("icon-padding").evaluate(Mt,{},vt),gr=kr&&kr.values;return[gr[0]*Bt,gr[1]*Bt,gr[2]*Bt,gr[3]*Bt]})(O,e,C,s.tilePixelRatio),De=O.get("text-max-angle")/180*Math.PI,Je=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",We=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",tt=O.get("symbol-placement"),gt=oe/2,st=O.get("icon-text-fit");let Ke;a&&st!=="none"&&(s.allowVerticalPlacement&&r.vertical&&(Ke=og(a,r.vertical,st,O.get("icon-text-fit-padding"),U,Z)),q&&(a=og(a,q,st,O.get("icon-text-fit-padding"),U,Z)));const qe=C?A.line.getGranularityForZoomLevel(C.z):1,Pt=(jt,Mt)=>{Mt.x<0||Mt.x>=ht||Mt.y<0||Mt.y>=ht||(function(vt,Bt,kr,gr,bs,$n,Js,vs,ms,Fr,Ns,Ds,hs,La,Un,Fa,fo,xn,ks,Qs,Es,yn,Gc,cl,Ap){const sd=vt.addToLineVertexArray(Bt,kr);let Kd,Hh,Wh,Xh,bx=0,vx=0,wx=0,kx=0,c0=-1,u0=-1;const Zc={};let jx=Pr("");if(vt.allowVerticalPlacement&&gr.vertical){const Kn=vs.layout.get("text-rotate").evaluate(Es,{},cl)+90;Wh=new Vf(ms,Bt,Fr,Ns,Ds,gr.vertical,hs,La,Un,Kn),Js&&(Xh=new Vf(ms,Bt,Fr,Ns,Ds,Js,fo,xn,Un,Kn))}if(bs){const Kn=vs.layout.get("icon-rotate").evaluate(Es,{}),Fi=vs.layout.get("icon-text-fit")!=="none",Jd=dx(bs,Kn,Gc,Fi),dl=Js?dx(Js,Kn,Gc,Fi):void 0;Hh=new Vf(ms,Bt,Fr,Ns,Ds,bs,fo,xn,!1,Kn),bx=4*Jd.length;const Qd=vt.iconSizeData;let Jl=null;Qd.kind==="source"?(Jl=[Uc*vs.layout.get("icon-size").evaluate(Es,{})],Jl[0]>Qu&&Cs(`${vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Qd.kind==="composite"&&(Jl=[Uc*yn.compositeIconSizes[0].evaluate(Es,{},cl),Uc*yn.compositeIconSizes[1].evaluate(Es,{},cl)],(Jl[0]>Qu||Jl[1]>Qu)&&Cs(`${vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),vt.addSymbols(vt.icon,Jd,Jl,Qs,ks,Es,T.az.none,Bt,sd.lineStartIndex,sd.lineLength,-1,cl),c0=vt.icon.placedSymbolArray.length-1,dl&&(vx=4*dl.length,vt.addSymbols(vt.icon,dl,Jl,Qs,ks,Es,T.az.vertical,Bt,sd.lineStartIndex,sd.lineLength,-1,cl),u0=vt.icon.placedSymbolArray.length-1)}const Sx=Object.keys(gr.horizontal);for(const Kn of Sx){const Fi=gr.horizontal[Kn];if(!Kd){jx=Pr(Fi.text);const dl=vs.layout.get("text-rotate").evaluate(Es,{},cl);Kd=new Vf(ms,Bt,Fr,Ns,Ds,Fi,hs,La,Un,dl)}const Jd=Fi.positionedLines.length===1;if(wx+=mx(vt,Bt,Fi,$n,vs,Un,Es,Fa,sd,gr.vertical?T.az.horizontal:T.az.horizontalOnly,Jd?Sx:[Kn],Zc,c0,yn,cl),Jd)break}gr.vertical&&(kx+=mx(vt,Bt,gr.vertical,$n,vs,Un,Es,Fa,sd,T.az.vertical,["vertical"],Zc,u0,yn,cl));const Sb=Kd?Kd.boxStartIndex:vt.collisionBoxArray.length,Tb=Kd?Kd.boxEndIndex:vt.collisionBoxArray.length,Nb=Wh?Wh.boxStartIndex:vt.collisionBoxArray.length,Eb=Wh?Wh.boxEndIndex:vt.collisionBoxArray.length,Cb=Hh?Hh.boxStartIndex:vt.collisionBoxArray.length,Pb=Hh?Hh.boxEndIndex:vt.collisionBoxArray.length,Mb=Xh?Xh.boxStartIndex:vt.collisionBoxArray.length,Ib=Xh?Xh.boxEndIndex:vt.collisionBoxArray.length;let ul=-1;const Uf=(Kn,Fi)=>Kn&&Kn.circleDiameter?Math.max(Kn.circleDiameter,Fi):Fi;ul=Uf(Kd,ul),ul=Uf(Wh,ul),ul=Uf(Hh,ul),ul=Uf(Xh,ul);const Tx=ul>-1?1:0;Tx&&(ul*=Ap/Ks),vt.glyphOffsetArray.length>=Bh.MAX_GLYPHS&&Cs("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Es.sortKey!==void 0&&vt.addToSortKeyRanges(vt.symbolInstances.length,Es.sortKey);const zb=fx(vs,Es,cl),[Ab,Db]=(function(Kn,Fi){const Jd=Kn.length,dl=Fi?.values;if(dl?.length>0)for(let Qd=0;Qd<dl.length;Qd+=2){const Jl=dl[Qd+1];Kn.emplaceBack(T.aP[dl[Qd]],Jl[0],Jl[1])}return[Jd,Kn.length]})(vt.textAnchorOffsets,zb);vt.symbolInstances.emplaceBack(Bt.x,Bt.y,Zc.right>=0?Zc.right:-1,Zc.center>=0?Zc.center:-1,Zc.left>=0?Zc.left:-1,Zc.vertical||-1,c0,u0,jx,Sb,Tb,Nb,Eb,Cb,Pb,Mb,Ib,Fr,wx,kx,bx,vx,Tx,0,hs,ul,Ab,Db)})(s,Mt,jt,r,a,u,Ke,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,te,[fe,fe,fe,fe],Je,v,ae,_e,We,U,e,p,N,C,f)};if(tt==="line")for(const jt of sx(e.geometry,0,0,ht,ht)){const Mt=fa(jt,qe),vt=yb(Mt,oe,De,r.vertical||q,a,24,pe,s.overscaling,ht);for(const Bt of vt)q&&kb(s,q.text,gt,Bt)||Pt(Mt,Bt)}else if(tt==="line-center"){for(const jt of e.geometry)if(jt.length>1){const Mt=fa(jt,qe),vt=xb(Mt,De,r.vertical||q,a,24,pe);vt&&Pt(Mt,vt)}}else if(e.type==="Polygon")for(const jt of mc(e.geometry,0)){const Mt=bb(jt,16);Pt(fa(jt[0],qe,!0),new rd(Mt.x,Mt.y,0))}else if(e.type==="LineString")for(const jt of e.geometry){const Mt=fa(jt,qe);Pt(Mt,new rd(Mt[0].x,Mt[0].y,0))}else if(e.type==="Point")for(const jt of e.geometry)for(const Mt of jt)Pt([Mt],new rd(Mt.x,Mt.y,0))}function mx(s,e,r,a,u,p,f,x,v,N,C,A,L,O,U){const q=(function(pe,ae,oe,fe,_e,De,Je,We){const tt=fe.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,gt=[];for(const st of ae.positionedLines)for(const Ke of st.positionedGlyphs){if(!Ke.rect)continue;const qe=Ke.rect||{};let Pt=4,jt=!0,Mt=1,vt=0;const Bt=(_e||We)&&Ke.vertical,kr=Ke.metrics.advance*Ke.scale/2;if(We&&ae.verticalizable&&(vt=st.lineOffset/2-(Ke.imageName?-(Ks-Ke.metrics.width*Ke.scale)/2:(Ke.scale-1)*Ks)),Ke.imageName){const xn=Je[Ke.imageName];jt=xn.sdf,Mt=xn.pixelRatio,Pt=1/Mt}const gr=_e?[Ke.x+kr,Ke.y]:[0,0];let bs=_e?[0,0]:[Ke.x+kr+oe[0],Ke.y+oe[1]-vt],$n=[0,0];Bt&&($n=bs,bs=[0,0]);const Js=Ke.metrics.isDoubleResolution?2:1,vs=(Ke.metrics.left-Pt)*Ke.scale-kr+bs[0],ms=(-Ke.metrics.top-Pt)*Ke.scale+bs[1],Fr=vs+qe.w/Js*Ke.scale/Mt,Ns=ms+qe.h/Js*Ke.scale/Mt,Ds=new V(vs,ms),hs=new V(Fr,ms),La=new V(vs,Ns),Un=new V(Fr,Ns);if(Bt){const xn=new V(-kr,kr- -17),ks=-Math.PI/2,Qs=12-kr,Es=new V(22-Qs,-(Ke.imageName?Qs:0)),yn=new V(...$n);Ds._rotateAround(ks,xn)._add(Es)._add(yn),hs._rotateAround(ks,xn)._add(Es)._add(yn),La._rotateAround(ks,xn)._add(Es)._add(yn),Un._rotateAround(ks,xn)._add(Es)._add(yn)}if(tt){const xn=Math.sin(tt),ks=Math.cos(tt),Qs=[ks,-xn,xn,ks];Ds._matMult(Qs),hs._matMult(Qs),La._matMult(Qs),Un._matMult(Qs)}const Fa=new V(0,0),fo=new V(0,0);gt.push({tl:Ds,tr:hs,bl:La,br:Un,tex:qe,writingMode:ae.writingMode,glyphOffset:gr,sectionIndex:Ke.sectionIndex,isSDF:jt,pixelOffsetTL:Fa,pixelOffsetBR:fo,minFontScaleX:0,minFontScaleY:0})}return gt})(0,r,x,u,p,f,a,s.allowVerticalPlacement),Z=s.textSizeData;let te=null;Z.kind==="source"?(te=[Uc*u.layout.get("text-size").evaluate(f,{})],te[0]>Qu&&Cs(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Z.kind==="composite"&&(te=[Uc*O.compositeTextSizes[0].evaluate(f,{},U),Uc*O.compositeTextSizes[1].evaluate(f,{},U)],(te[0]>Qu||te[1]>Qu)&&Cs(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,q,te,x,p,f,N,e,v.lineStartIndex,v.lineLength,L,U);for(const pe of C)A[pe]=s.text.placedSymbolArray.length-1;return 4*q.length}function gx(s){for(const e in s)return s[e];return null}function kb(s,e,r,a){const u=s.compareText;if(e in u){const p=u[e];for(let f=p.length-1;f>=0;f--)if(a.dist(p[f])<r)return!0}else u[e]=[];return u[e].push(a),!1}const xx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class r0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=xx[15&a];if(!p)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new r0(x,f,p,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=xx.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+x+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return s0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:f,nodeSize:x}=this,v=[0,p.length-1,0],N=[];for(;v.length;){const C=v.pop()||0,A=v.pop()||0,L=v.pop()||0;if(A-L<=x){for(let Z=L;Z<=A;Z++){const te=f[2*Z],pe=f[2*Z+1];te>=e&&te<=a&&pe>=r&&pe<=u&&N.push(p[Z])}continue}const O=L+A>>1,U=f[2*O],q=f[2*O+1];U>=e&&U<=a&&q>=r&&q<=u&&N.push(p[O]),(C===0?e<=U:r<=q)&&(v.push(L),v.push(O-1),v.push(1-C)),(C===0?a>=U:u>=q)&&(v.push(O+1),v.push(A),v.push(1-C))}return N}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:f}=this,x=[0,u.length-1,0],v=[],N=a*a;for(;x.length;){const C=x.pop()||0,A=x.pop()||0,L=x.pop()||0;if(A-L<=f){for(let Z=L;Z<=A;Z++)_x(p[2*Z],p[2*Z+1],e,r)<=N&&v.push(u[Z]);continue}const O=L+A>>1,U=p[2*O],q=p[2*O+1];_x(U,q,e,r)<=N&&v.push(u[O]),(C===0?e-a<=U:r-a<=q)&&(x.push(L),x.push(O-1),x.push(1-C)),(C===0?e+a>=U:r+a>=q)&&(x.push(O+1),x.push(A),x.push(1-C))}return v}}function s0(s,e,r,a,u,p){if(u-a<=r)return;const f=a+u>>1;yx(s,e,f,a,u,p),s0(s,e,r,a,f-1,1-p),s0(s,e,r,f+1,u,1-p)}function yx(s,e,r,a,u,p){for(;u>a;){if(u-a>600){const N=u-a+1,C=r-a+1,A=Math.log(N),L=.5*Math.exp(2*A/3),O=.5*Math.sqrt(A*L*(N-L)/N)*(C-N/2<0?-1:1);yx(s,e,r,Math.max(a,Math.floor(r-C*L/N+O)),Math.min(u,Math.floor(r+(N-C)*L/N+O)),p)}const f=e[2*r+p];let x=a,v=u;for(Ip(s,e,a,r),e[2*u+p]>f&&Ip(s,e,a,u);x<v;){for(Ip(s,e,x,v),x++,v--;e[2*x+p]<f;)x++;for(;e[2*v+p]>f;)v--}e[2*a+p]===f?Ip(s,e,a,v):(v++,Ip(s,e,v,u)),v<=r&&(a=v+1),r<=v&&(u=v-1)}}function Ip(s,e,r,a){n0(s,r,a),n0(e,2*r,2*a),n0(e,2*r+1,2*a+1)}function n0(s,e,r){const a=s[e];s[e]=s[r],s[r]=a}function _x(s,e,r,a){const u=s-r,p=e-a;return u*u+p*p}var a0;T.cH=void 0,(a0=T.cH||(T.cH={})).create="create",a0.load="load",a0.fullLoad="fullLoad";let $f=null,zp=[];const i0=1e3/60,o0="loadTime",l0="fullLoadTime",jb={mark(s){performance.mark(s)},frame(s){const e=s;$f!=null&&zp.push(e-$f),$f=e},clearMetrics(){$f=null,zp=[],performance.clearMeasures(o0),performance.clearMeasures(l0);for(const s in T.cH)performance.clearMarks(T.cH[s])},getPerformanceMetrics(){performance.measure(o0,T.cH.create,T.cH.load),performance.measure(l0,T.cH.create,T.cH.fullLoad);const s=performance.getEntriesByName(o0)[0].duration,e=performance.getEntriesByName(l0)[0].duration,r=zp.length,a=1/(zp.reduce(((p,f)=>p+f),0)/r/1e3),u=zp.filter((p=>p>i0)).reduce(((p,f)=>p+(f-i0)/i0),0);return{loadTime:s,fullLoadTime:e,fps:a,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};T.$=H,T.A=ze,T.B=ua,T.C=ys,T.D=Et,T.E=xr,T.F=function([s,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:s*Math.cos(e)*Math.sin(r),y:s*Math.sin(e)*Math.sin(r),z:s*Math.cos(r)}},T.G=os,T.H=Rr,T.I=Ts,T.J=Cc,T.K=function(s){if(as==null){const e=s.navigator?s.navigator.userAgent:null;as=!!s.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return as},T.L=class{constructor(s,e){this.target=s,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new O_((()=>this.process())),this.subscription=_o(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=ba(self)?s:window}registerMessageHandler(s,e){this.messageHandlers[s]=e}unregisterMessageHandler(s){delete this.messageHandlers[s]}sendAsync(s,e){return new Promise(((r,a)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=e?_o(e.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[u];const v={id:u,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)}),B_):null;this.resolveRejects[u]={resolve:v=>{p?.unsubscribe(),r(v)},reject:v=>{p?.unsubscribe(),a(v)}};const f=[],x=Object.assign(Object.assign({},s),{id:u,sourceMapId:this.mapId,origin:location.origin,data:rn(s.data,f)});this.target.postMessage(x,{transfer:f})}))}receive(s){const e=s.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(ba(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),e=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(s,e)}processTask(s,e){return c(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[s];return delete this.resolveRejects[s],u?void(e.error?u.reject(sn(e.error)):u.resolve(sn(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=sn(e.data),a=new AbortController;this.abortControllers[s]=a;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,r,a);this.completeTask(s,null,u)}catch(u){this.completeTask(s,u)}}))}completeTask(s,e,r){const a=[];delete this.abortControllers[s];const u={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?rn(e):null,data:rn(r,a)};this.target.postMessage(u,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.M=Ie,T.N=function(){var s=new ze(16);return ze!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},T.O=function(s,e,r){var a,u,p,f,x,v,N,C,A,L,O,U,q=r[0],Z=r[1],te=r[2];return e===s?(s[12]=e[0]*q+e[4]*Z+e[8]*te+e[12],s[13]=e[1]*q+e[5]*Z+e[9]*te+e[13],s[14]=e[2]*q+e[6]*Z+e[10]*te+e[14],s[15]=e[3]*q+e[7]*Z+e[11]*te+e[15]):(u=e[1],p=e[2],f=e[3],x=e[4],v=e[5],N=e[6],C=e[7],A=e[8],L=e[9],O=e[10],U=e[11],s[0]=a=e[0],s[1]=u,s[2]=p,s[3]=f,s[4]=x,s[5]=v,s[6]=N,s[7]=C,s[8]=A,s[9]=L,s[10]=O,s[11]=U,s[12]=a*q+x*Z+A*te+e[12],s[13]=u*q+v*Z+L*te+e[13],s[14]=p*q+N*Z+O*te+e[14],s[15]=f*q+C*Z+U*te+e[15]),s},T.P=V,T.Q=function(s,e,r){var a=r[0],u=r[1],p=r[2];return s[0]=e[0]*a,s[1]=e[1]*a,s[2]=e[2]*a,s[3]=e[3]*a,s[4]=e[4]*u,s[5]=e[5]*u,s[6]=e[6]*u,s[7]=e[7]*u,s[8]=e[8]*p,s[9]=e[9]*p,s[10]=e[10]*p,s[11]=e[11]*p,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s},T.R=Fn,T.S=function(s,e,r){var a=e[0],u=e[1],p=e[2],f=e[3],x=e[4],v=e[5],N=e[6],C=e[7],A=e[8],L=e[9],O=e[10],U=e[11],q=e[12],Z=e[13],te=e[14],pe=e[15],ae=r[0],oe=r[1],fe=r[2],_e=r[3];return s[0]=ae*a+oe*x+fe*A+_e*q,s[1]=ae*u+oe*v+fe*L+_e*Z,s[2]=ae*p+oe*N+fe*O+_e*te,s[3]=ae*f+oe*C+fe*U+_e*pe,s[4]=(ae=r[4])*a+(oe=r[5])*x+(fe=r[6])*A+(_e=r[7])*q,s[5]=ae*u+oe*v+fe*L+_e*Z,s[6]=ae*p+oe*N+fe*O+_e*te,s[7]=ae*f+oe*C+fe*U+_e*pe,s[8]=(ae=r[8])*a+(oe=r[9])*x+(fe=r[10])*A+(_e=r[11])*q,s[9]=ae*u+oe*v+fe*L+_e*Z,s[10]=ae*p+oe*N+fe*O+_e*te,s[11]=ae*f+oe*C+fe*U+_e*pe,s[12]=(ae=r[12])*a+(oe=r[13])*x+(fe=r[14])*A+(_e=r[15])*q,s[13]=ae*u+oe*v+fe*L+_e*Z,s[14]=ae*p+oe*N+fe*O+_e*te,s[15]=ae*f+oe*C+fe*U+_e*pe,s},T.T=Da,T.U=function(s,e){const r={};for(let a=0;a<e.length;a++){const u=e[a];u in s&&(r[u]=s[u])}return r},T.V=ed,T.W=At,T.X=gg,T.Y=mg,T.Z=be,T._=c,T.a=ie,T.a$=mt,T.a0=Ze,T.a1=Oa,T.a2=Ri,T.a3=yg,T.a4=Pf,T.a5=ht,T.a6=function(s,e,r){if(!s)return e||{};if(!e)return s||{};const a=wg(s),u=wg(e);(function(f,x){x.removeAll&&(f.add.clear(),f.update.clear(),f.remove.clear(),x.remove.clear());for(const v of x.remove)f.add.delete(v),f.update.delete(v);for(const[v,N]of x.update){const C=f.update.get(v);C&&(x.update.set(v,V_(C,N)),f.update.delete(v))}})(a,u);const p={};if((a.removeAll||u.removeAll)&&(p.removeAll=!0),p.remove=new Set([...a.remove,...u.remove]),p.add=new Map([...a.add,...u.add]),p.update=new Map([...a.update,...u.update]),p.remove.size&&p.add.size)for(const f of p.add.keys())p.remove.delete(f);return(function(f){const x={};return f.removeAll&&(x.removeAll=f.removeAll),f.remove&&(x.remove=Array.from(f.remove)),f.add&&(x.add=Array.from(f.add.values())),f.update&&(x.update=Array.from(f.update.values())),x})(p)},T.a7=function(s,e){const r=new Map;if(s==null||s.type==null)return r;if(s.type==="Feature"){const a=Lm(s,e);return a==null?void 0:(r.set(a,s),r)}if(s.type==="FeatureCollection"){const a=new Set;for(const u of s.features){const p=Lm(u,e);if(p==null||a.has(p))return;a.add(p),r.set(p,u)}return r}},T.a8=function(s,e,r){var a,u;const p=[];if(e.removeAll)s.clear();else if(e.remove)for(const f of e.remove){const x=s.get(f);x&&(p.push(x.geometry),s.delete(f))}if(e.add)for(const f of e.add){const x=Lm(f,r);if(x==null)continue;const v=s.get(x);v&&p.push(v.geometry),p.push(f.geometry),s.set(x,f)}if(e.update)for(const f of e.update){const x=s.get(f.id);if(!x)continue;const v=!!f.newGeometry,N=f.removeAllProperties||((a=f.removeProperties)===null||a===void 0?void 0:a.length)>0||((u=f.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!v&&!N)continue;p.push(x.geometry);const C=Object.assign({},x);if(s.set(f.id,C),v&&(p.push(f.newGeometry),C.geometry=f.newGeometry),N){if(C.properties=f.removeAllProperties?{}:Object.assign({},C.properties||{}),f.removeProperties)for(const A of f.removeProperties)delete C.properties[A];if(f.addOrUpdateProperties)for(const{key:A,value:L}of f.addOrUpdateProperties)C.properties[A]=L}}return p},T.a9=Ep,T.aA=function(s,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return s.kind==="source"?a/Uc:s.kind==="composite"?os.number(a/Uc,u/Uc,r):e},T.aB=function(s,e){var r=e[0],a=e[1],u=e[2],p=e[3],f=e[4],x=e[5],v=e[6],N=e[7],C=e[8],A=e[9],L=e[10],O=e[11],U=e[12],q=e[13],Z=e[14],te=e[15],pe=r*x-a*f,ae=r*v-u*f,oe=r*N-p*f,fe=a*v-u*x,_e=a*N-p*x,De=u*N-p*v,Je=C*q-A*U,We=C*Z-L*U,tt=C*te-O*U,gt=A*Z-L*q,st=A*te-O*q,Ke=L*te-O*Z,qe=pe*Ke-ae*st+oe*gt+fe*tt-_e*We+De*Je;return qe?(s[0]=(x*Ke-v*st+N*gt)*(qe=1/qe),s[1]=(u*st-a*Ke-p*gt)*qe,s[2]=(q*De-Z*_e+te*fe)*qe,s[3]=(L*_e-A*De-O*fe)*qe,s[4]=(v*tt-f*Ke-N*We)*qe,s[5]=(r*Ke-u*tt+p*We)*qe,s[6]=(Z*oe-U*De-te*ae)*qe,s[7]=(C*De-L*oe+O*ae)*qe,s[8]=(f*st-x*tt+N*Je)*qe,s[9]=(a*tt-r*st-p*Je)*qe,s[10]=(U*_e-q*oe+te*pe)*qe,s[11]=(A*oe-C*_e-O*pe)*qe,s[12]=(x*We-f*gt-v*Je)*qe,s[13]=(r*gt-a*We+u*Je)*qe,s[14]=(q*ae-U*fe-Z*pe)*qe,s[15]=(C*fe-A*ae+L*pe)*qe,s):null},T.aC=Tt,T.aD=function(s){var e=s[0],r=s[1];return Math.sqrt(e*e+r*r)},T.aE=function(s){return s[0]=0,s[1]=0,s},T.aF=function(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s},T.aG=Mm,T.aH=Me,T.aI=function(s,e,r,a){const u=e.y-s.y,p=e.x-s.x,f=a.y-r.y,x=a.x-r.x,v=f*p-x*u;if(v===0)return null;const N=(x*(s.y-r.y)-f*(s.x-r.x))/v;return new V(s.x+N*p,s.y+N*u)},T.aJ=sx,T.aK=Bl,T.aL=function(s){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const p of s)e=Math.min(e,p.x),r=Math.min(r,p.y),a=Math.max(a,p.x),u=Math.max(u,p.y);return[e,r,a,u]},T.aM=Ks,T.aN=pt,T.aO=function(s,e,r,a,u=!1){if(!r[0]&&!r[1])return[0,0];const p=u?a==="map"?-s.bearingInRadians:0:a==="viewport"?s.bearingInRadians:0;if(p){const f=Math.sin(p),x=Math.cos(p);r=[r[0]*x-r[1]*f,r[0]*f+r[1]*x]}return[u?r[0]:pt(e,r[0],s.zoom),u?r[1]:pt(e,r[1],s.zoom)]},T.aQ=Pm,T.aR=t0,T.aS=yt,T.aT=r0,T.aU=_s,T.aV=Zl,T.aW=le,T.aX=xt,T.aY=Be,T.aZ=_n,T.a_=_g,T.aa=Wd,T.ab=25,T.ac=Rm,T.ad=s=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((r=>{e.onloadstart=()=>{r(e)};for(const a of s){const u=window.document.createElement("source");Qe(a)||(e.crossOrigin="Anonymous"),u.src=a,e.appendChild(u)}}))},T.ae=at,T.af=function(){return Sr++},T.ag=h,T.ah=Bh,T.ai=Mp,T.aj=Vo,T.ak=Pi,T.al=jg,T.am=function(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,a,u,p)=>{const f=u||p;return e[a]=!f||f.toLowerCase(),""})),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},T.an=Ht,T.ao=85.051129,T.ap=bo,T.aq=function(s){return Math.pow(2,s)},T.ar=Nt,T.as=xg,T.at=function(s){return Math.log(s)/Math.LN2},T.au=function(s){var e=s[0],r=s[1];return e*e+r*r},T.av=function(s){if(!s.length)return new Set;const e=Math.max(...s.map((v=>v.canonical.z)));let r=1/0,a=-1/0,u=1/0,p=-1/0;const f=[];for(const v of s){const{x:N,y:C,z:A}=v.canonical,L=Math.pow(2,e-A),O=N*L,U=C*L;f.push({id:v,x:O,y:U}),O<r&&(r=O),O>a&&(a=O),U<u&&(u=U),U>p&&(p=U)}const x=new Set;for(const v of f)v.x!==r&&v.x!==a&&v.y!==u&&v.y!==p||x.add(v.id);return x},T.aw=function(s,e){const r=Math.abs(2*s.wrap)-+(s.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return s.overscaledZ-e.overscaledZ||a-r||e.canonical.y-s.canonical.y||e.canonical.x-s.canonical.x},T.ax=class{constructor(s,e){this.max=s,this.onRemove=e,this.reset()}reset(){for(const s in this.data)for(const e of this.data[s])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(s,e,r){const a=s.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const u={value:e,timeout:void 0};if(r!==void 0&&(u.timeout=setTimeout((()=>{this.remove(s,u)}),r)),this.data[a].push(u),this.order.push(a),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const e=this.data[s].shift();return e.timeout&&clearTimeout(e.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),e.value}getByKey(s){const e=this.data[s];return e?e[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,e){if(!this.has(s))return this;const r=s.wrapped().key,a=e===void 0?0:this.data[r].indexOf(e),u=this.data[r][a];return this.data[r].splice(a,1),u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(u.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(s){const e=[];for(const r in this.data)for(const a of this.data[r])s(a.value)||e.push(a);for(const r of e)this.remove(r.value.tileID,r)}},T.ay=function(s,e){let r=0,a=0;if(s.kind==="constant")a=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:f}=s,x=u?Ht(Zs.interpolationFactor(u,e,p,f),0,1):0;s.kind==="camera"?a=os.number(s.minSize,s.maxSize,x):r=x}return{uSizeT:r,uSize:a}},T.b=fi,T.b$=Ei,T.b0=Zt,T.b1=function(s){var e=new ze(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e},T.b2=function(s,e,r){return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],s},T.b3=function(s,e){var r=e[0],a=e[1],u=e[2],p=r*r+a*a+u*u;return p>0&&(p=1/Math.sqrt(p)),s[0]=e[0]*p,s[1]=e[1]*p,s[2]=e[2]*p,s},T.b4=fr,T.b5=function(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]},T.b6=function(s,e,r){return s[0]=e[0]*r[0],s[1]=e[1]*r[1],s[2]=e[2]*r[2],s[3]=e[3]*r[3],s},T.b7=Ft,T.b8=function(s,e,r){const a=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return a===0?null:(-(s[0]*r[0]+s[1]*r[1]+s[2]*r[2])-r[3])/a},T.b9=Wt,T.bA=function(s,e,r,a){return s[0]=e[0]+r[0]*a,s[1]=e[1]+r[1]*a,s[2]=e[2]+r[2]*a,s},T.bB=it,T.bC=function(s,e,r){var a=r[0],u=r[1],p=r[2],f=r[3],x=e[0],v=e[1],N=e[2],C=u*N-p*v,A=p*x-a*N,L=a*v-u*x;return s[0]=x+f*(C+=C)+u*(L+=L)-p*(A+=A),s[1]=v+f*A+p*C-a*L,s[2]=N+f*L+a*A-u*C,s},T.bD=function(s,e,r){const a=(function(v){var N=v[3],C=v[4],A=v[5],L=v[6],O=v[7],U=v[8];return v[0]*(U*C-A*O)+v[1]*(-U*N+A*L)+v[2]*(O*N-C*L)})([s[0],s[1],s[2],e[0],e[1],e[2],r[0],r[1],r[2]]);if(a===0)return null;const u=fr([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),p=fr([],[r[0],r[1],r[2]],[s[0],s[1],s[2]]),f=fr([],[s[0],s[1],s[2]],[e[0],e[1],e[2]]),x=mt([],u,-s[3]);return Zt(x,x,mt([],p,-e[3])),Zt(x,x,mt([],f,-r[3])),mt(x,x,1/a),x},T.bE=Dm,T.bF=function(){return new Float64Array(4)},T.bG=function(s,e,r,a){var u=[],p=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],p[0]=u[0]*Math.cos(a)-u[1]*Math.sin(a),p[1]=u[0]*Math.sin(a)+u[1]*Math.cos(a),p[2]=u[2],s[0]=p[0]+r[0],s[1]=p[1]+r[1],s[2]=p[2]+r[2],s},T.bH=function(s,e,r,a){var u=[],p=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],p[0]=u[0],p[1]=u[1]*Math.cos(a)-u[2]*Math.sin(a),p[2]=u[1]*Math.sin(a)+u[2]*Math.cos(a),s[0]=p[0]+r[0],s[1]=p[1]+r[1],s[2]=p[2]+r[2],s},T.bI=function(s,e,r,a){var u=[],p=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],p[0]=u[2]*Math.sin(a)+u[0]*Math.cos(a),p[1]=u[1],p[2]=u[2]*Math.cos(a)-u[0]*Math.sin(a),s[0]=p[0]+r[0],s[1]=p[1]+r[1],s[2]=p[2]+r[2],s},T.bJ=function(s,e,r){var a=Math.sin(r),u=Math.cos(r),p=e[0],f=e[1],x=e[2],v=e[3],N=e[8],C=e[9],A=e[10],L=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=p*u-N*a,s[1]=f*u-C*a,s[2]=x*u-A*a,s[3]=v*u-L*a,s[8]=p*a+N*u,s[9]=f*a+C*u,s[10]=x*a+A*u,s[11]=v*a+L*u,s},T.bK=function(s,e){const r=Ce(s,360),a=Ce(e,360),u=a-r,p=a>r?u-360:u+360;return Math.abs(u)<Math.abs(p)?u:p},T.bL=function(s){return s[0]=0,s[1]=0,s[2]=0,s},T.bM=function(s,e,r,a){const u=Math.sqrt(s*s+e*e),p=Math.sqrt(r*r+a*a);s/=u,e/=u,r/=p,a/=p;const f=Math.acos(s*r+e*a);return-e*r+s*a>0?f:-f},T.bN=function(s,e){const r=Ce(s,2*Math.PI),a=Ce(e,2*Math.PI);return Math.min(Math.abs(r-a),Math.abs(r-a+2*Math.PI),Math.abs(r-a-2*Math.PI))},T.bO=function(){const s={},e=Fe.$version;for(const r in Fe.$root){const a=Fe.$root[r];if(a.required){let u=null;u=r==="version"?e:a.type==="array"?[]:{},u!=null&&(s[r]=u)}}return s},T.bP=$e,T.bQ=ts,T.bR=function s(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!s(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!s(e[a],r[a]))return!1;return!0}return e===r},T.bS=function(s){s=s.slice();const e=Object.create(null);for(let r=0;r<s.length;r++)e[s[r].id]=s[r];for(let r=0;r<s.length;r++)"ref"in s[r]&&(s[r]=$s(s[r],e[s[r].ref]));return s},T.bT=function(s,e){if(s.type==="custom")return new F_(s,e);switch(s.type){case"background":return new L_(s,e);case"circle":return new Gu(s,e);case"color-relief":return new Sm(s,e);case"fill":return new hf(s,e);case"fill-extrusion":return new Nm(s,e);case"heatmap":return new pp(s,e);case"hillshade":return new Vl(s,e);case"line":return new Sp(s,e);case"raster":return new oo(s,e);case"symbol":return new Cf(s,e)}},T.bU=s=>s.type==="raster",T.bV=Qn,T.bW=function(s,e){if(!s)return[{command:"setStyle",args:[e]}];let r=[];try{if(!tr(s.version,e.version))return[{command:"setStyle",args:[e]}];tr(s.center,e.center)||r.push({command:"setCenter",args:[e.center]}),tr(s.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),tr(s.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),tr(s.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),tr(s.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),tr(s.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),tr(s.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),tr(s.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),tr(s.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),tr(s.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),tr(s.light,e.light)||r.push({command:"setLight",args:[e.light]}),tr(s.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),tr(s.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),tr(s.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const a={},u=[];(function(f,x,v,N){let C;for(C in x=x||{},f=f||{})Object.prototype.hasOwnProperty.call(f,C)&&(Object.prototype.hasOwnProperty.call(x,C)||Gr(C,v,N));for(C in x)Object.prototype.hasOwnProperty.call(x,C)&&(Object.prototype.hasOwnProperty.call(f,C)?tr(f[C],x[C])||(f[C].type==="geojson"&&x[C].type==="geojson"&&Dr(f,x,C)?Mr(v,{command:"setGeoJSONSourceData",args:[C,x[C].data]}):Zr(C,x,v,N)):Rs(C,x,v))})(s.sources,e.sources,u,a);const p=[];s.layers&&s.layers.forEach((f=>{"source"in f&&a[f.source]?r.push({command:"removeLayer",args:[f.id]}):p.push(f)})),r=r.concat(u),(function(f,x,v){x=x||[];const N=(f=f||[]).map(sc),C=x.map(sc),A=f.reduce(gi,{}),L=x.reduce(gi,{}),O=N.slice(),U=Object.create(null);let q,Z,te,pe,ae;for(let oe=0,fe=0;oe<N.length;oe++)q=N[oe],Object.prototype.hasOwnProperty.call(L,q)?fe++:(Mr(v,{command:"removeLayer",args:[q]}),O.splice(O.indexOf(q,fe),1));for(let oe=0,fe=0;oe<C.length;oe++)q=C[C.length-1-oe],O[O.length-1-oe]!==q&&(Object.prototype.hasOwnProperty.call(A,q)?(Mr(v,{command:"removeLayer",args:[q]}),O.splice(O.lastIndexOf(q,O.length-fe),1)):fe++,pe=O[O.length-oe],Mr(v,{command:"addLayer",args:[L[q],pe]}),O.splice(O.length-oe,0,q),U[q]=!0);for(let oe=0;oe<C.length;oe++)if(q=C[oe],Z=A[q],te=L[q],!U[q]&&!tr(Z,te))if(tr(Z.source,te.source)&&tr(Z["source-layer"],te["source-layer"])&&tr(Z.type,te.type)){for(ae in ps(Z.layout,te.layout,v,q,null,"setLayoutProperty"),ps(Z.paint,te.paint,v,q,null,"setPaintProperty"),tr(Z.filter,te.filter)||Mr(v,{command:"setFilter",args:[q,te.filter]}),tr(Z.minzoom,te.minzoom)&&tr(Z.maxzoom,te.maxzoom)||Mr(v,{command:"setLayerZoomRange",args:[q,te.minzoom,te.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?ps(Z[ae],te[ae],v,q,ae.slice(6),"setPaintProperty"):tr(Z[ae],te[ae])||Mr(v,{command:"setLayerProperty",args:[q,ae,te[ae]]}));for(ae in te)Object.prototype.hasOwnProperty.call(te,ae)&&!Object.prototype.hasOwnProperty.call(Z,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?ps(Z[ae],te[ae],v,q,ae.slice(6),"setPaintProperty"):tr(Z[ae],te[ae])||Mr(v,{command:"setLayerProperty",args:[q,ae,te[ae]]}))}else Mr(v,{command:"removeLayer",args:[q]}),pe=O[O.lastIndexOf(q)+1],Mr(v,{command:"addLayer",args:[te,pe]})})(p,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[e]}]}return r},T.bX=function(s){const e=[],r=s.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},T.bY=Jr,T.bZ=_a,T.b_=class extends jn{constructor(s,e){super(s,e),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},T.ba=function(s,e,r){return s[0]=e[0]*r,s[1]=e[1]*r,s[2]=e[2]*r,s[3]=e[3]*r,s},T.bb=function(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]+s[3]},T.bc=vg,T.bd=Vh,T.be=function(s,e,r,a,u){var p=1/Math.tan(e/2);if(s[0]=p/r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,u!=null&&u!==1/0){var f=1/(a-u);s[10]=(u+a)*f,s[14]=2*u*a*f}else s[10]=-1,s[14]=-2*a;return s},T.bf=function(s){var e=new ze(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},T.bg=function(s,e,r){var a=Math.sin(r),u=Math.cos(r),p=e[0],f=e[1],x=e[2],v=e[3],N=e[4],C=e[5],A=e[6],L=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=p*u+N*a,s[1]=f*u+C*a,s[2]=x*u+A*a,s[3]=v*u+L*a,s[4]=N*u-p*a,s[5]=C*u-f*a,s[6]=A*u-x*a,s[7]=L*u-v*a,s},T.bh=function(s,e,r){var a=Math.sin(r),u=Math.cos(r),p=e[4],f=e[5],x=e[6],v=e[7],N=e[8],C=e[9],A=e[10],L=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=p*u+N*a,s[5]=f*u+C*a,s[6]=x*u+A*a,s[7]=v*u+L*a,s[8]=N*u-p*a,s[9]=C*u-f*a,s[10]=A*u-x*a,s[11]=L*u-v*a,s},T.bi=function(){const s=new Float32Array(16);return Nt(s),s},T.bj=function(){const s=new Float64Array(16);return Nt(s),s},T.bk=function(){return new Float64Array(16)},T.bl=function(s,e,r){const a=new Float64Array(4);return it(a,s,e-90,r),a},T.bm=function(s,e,r,a){var u,p,f,x,v,N=e[0],C=e[1],A=e[2],L=e[3],O=r[0],U=r[1],q=r[2],Z=r[3];return(p=N*O+C*U+A*q+L*Z)<0&&(p=-p,O=-O,U=-U,q=-q,Z=-Z),1-p>Pe?(u=Math.acos(p),f=Math.sin(u),x=Math.sin((1-a)*u)/f,v=Math.sin(a*u)/f):(x=1-a,v=a),s[0]=x*N+v*O,s[1]=x*C+v*U,s[2]=x*A+v*q,s[3]=x*L+v*Z,s},T.bn=function(s){const e=new Float64Array(9);(function(p,f){var x=f[0],v=f[1],N=f[2],C=f[3],A=x+x,L=v+v,O=N+N,U=x*A,q=v*A,Z=v*L,te=N*A,pe=N*L,ae=N*O,oe=C*A,fe=C*L,_e=C*O;p[0]=1-Z-ae,p[3]=q-_e,p[6]=te+fe,p[1]=q+_e,p[4]=1-U-ae,p[7]=pe-oe,p[2]=te-fe,p[5]=pe+oe,p[8]=1-U-Z})(e,s);const r=_n(-Math.asin(Ht(e[2],-1,1)));let a,u;return Math.hypot(e[5],e[8])<.001?(a=0,u=-_n(Math.atan2(e[3],e[4]))):(a=_n(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=_n(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:a,pitch:r+90,bearing:u}},T.bo=function(s,e){return s.roll==e.roll&&s.pitch==e.pitch&&s.bearing==e.bearing},T.bp=ir,T.bq=Ni,T.br=Hl,T.bs=Wl,T.bt=al,T.bu=Ye,T.bv=qt,T.bw=Gs,T.bx=function(s,e,r,a,u){return Ye(a,u,Ht((s-e)/(r-e),0,1))},T.by=Ce,T.bz=function(){return new Float64Array(3)},T.c=ve,T.c$=function(s,e,r,a,u){return c(this,void 0,void 0,(function*(){if(Ze())try{return yield Oa(s,e,r,a,u)}catch{}return(function(p,f,x,v,N){const C=p.width,A=p.height;Zn&&Hn||(Zn=new OffscreenCanvas(C,A),Hn=Zn.getContext("2d",{willReadFrequently:!0})),Zn.width=C,Zn.height=A,Hn.drawImage(p,0,0,C,A);const L=Hn.getImageData(f,x,v,N);return Hn.clearRect(0,0,C,A),L.data})(s,e,r,a,u)}))},T.c0=class extends jn{constructor(s,e){super(s,e),this.current=Rn}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let e=1;e<16;e++)if(s[e]!==this.current[e]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},T.c1=Qa,T.c2=class extends jn{constructor(s,e){super(s,e),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},T.c3=class extends jn{constructor(s,e){super(s,e),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},T.c4=lt,T.c5=function(s,e){var r=Math.sin(e),a=Math.cos(e);return s[0]=a,s[1]=r,s[2]=0,s[3]=-r,s[4]=a,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},T.c6=function(s,e,r){var a=e[0],u=e[1],p=e[2];return s[0]=a*r[0]+u*r[3]+p*r[6],s[1]=a*r[1]+u*r[4]+p*r[7],s[2]=a*r[2]+u*r[5]+p*r[8],s},T.c7=function(s,e,r,a,u,p,f){var x=1/(e-r),v=1/(a-u),N=1/(p-f);return s[0]=-2*x,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*v,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*N,s[11]=0,s[12]=(e+r)*x,s[13]=(u+a)*v,s[14]=(f+p)*N,s[15]=1,s},T.c8=class extends jn{constructor(s,e){super(s,e),this.current=new Array}set(s){if(s!=this.current){this.current=s;const e=new Float32Array(4*s.length);for(let r=0;r<s.length;r++)e[4*r]=s[r].r,e[4*r+1]=s[r].g,e[4*r+2]=s[r].b,e[4*r+3]=s[r].a;this.gl.uniform4fv(this.location,e)}}},T.c9=class extends jn{constructor(s,e){super(s,e),this.current=new Array}set(s){if(s!=this.current){this.current=s;const e=new Float32Array(s);this.gl.uniform1fv(this.location,e)}}},T.cA=function(s,e){return Ae[e]&&"touches"in s},T.cB=function(s){return Ae[s]||Y[s]},T.cC=function(s,e,r){var a=e[0],u=e[1];return s[0]=r[0]*a+r[4]*u+r[12],s[1]=r[1]*a+r[5]*u+r[13],s},T.cD=function(s,e){const{x:r,y:a}=Ep.fromLngLat(e);return!(s<0||s>25||a<0||a>=1||r<0||r>=1)},T.cE=function(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},T.cF=class extends lo{},T.cG=jb,T.cI=Se,T.cJ=function(s,e){ve.REGISTERED_PROTOCOLS[s]=e},T.cK=function(s){delete ve.REGISTERED_PROTOCOLS[s]},T.cL=function(s,e){const r={};for(let u=0;u<s.length;u++){const p=e&&e[s[u].id]||vi(s[u]);e&&(e[s[u].id]=p);let f=r[p];f||(f=r[p]=[]),f.push(s[u])}const a=[];for(const u in r)a.push(r[u]);return a},T.cM=bt,T.cN=kg,T.cO=tx,T.cP=Ve,T.cQ=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=ht/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const e=s.bucket.layers[0],r=e.layout,a=e._unevaluatedLayout._values,u={layoutIconSize:a["icon-size"].possiblyEvaluate(new Rr(s.bucket.zoom+1),s.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Rr(s.bucket.zoom+1),s.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Rr(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:C}=s.bucket.textSizeData;u.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Rr(N),s.canonical),a["text-size"].possiblyEvaluate(new Rr(C),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:C}=s.bucket.iconSizeData;u.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Rr(N),s.canonical),a["icon-size"].possiblyEvaluate(new Rr(C),s.canonical)]}const p=r.get("text-line-height")*Ks,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",x=r.get("text-keep-upright"),v=r.get("text-size");for(const N of s.bucket.features){const C=r.get("text-font").evaluate(N,{},s.canonical).join(","),A=v.evaluate(N,{},s.canonical),L=u.layoutTextSize.evaluate(N,{},s.canonical),O=u.layoutIconSize.evaluate(N,{},s.canonical),U={horizontal:{},vertical:void 0},q=N.text;let Z,te=[0,0];if(q){const oe=q.toString(),fe=r.get("text-letter-spacing").evaluate(N,{},s.canonical)*Ks,_e=Pd(oe)?fe:0,De=r.get("text-anchor").evaluate(N,{},s.canonical),Je=fx(e,N,s.canonical);if(!Je){const st=r.get("text-radial-offset").evaluate(N,{},s.canonical);te=st?px(De,[st*Ks,e0]):r.get("text-offset").evaluate(N,{},s.canonical).map((Ke=>Ke*Ks))}let We=f?"center":r.get("text-justify").evaluate(N,{},s.canonical);const tt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(N,{},s.canonical)*Ks:1/0,gt=()=>{s.bucket.allowVerticalPlacement&&no(oe)&&(U.vertical=Ge(q,s.glyphMap,s.glyphPositions,s.imagePositions,C,tt,p,De,"left",_e,te,T.az.vertical,!0,L,A))};if(!f&&Je){const st=new Set;if(We==="auto")for(let qe=0;qe<Je.values.length;qe+=2)st.add(t0(Je.values[qe]));else st.add(We);let Ke=!1;for(const qe of st)if(!U.horizontal[qe])if(Ke)U.horizontal[qe]=U.horizontal[0];else{const Pt=Ge(q,s.glyphMap,s.glyphPositions,s.imagePositions,C,tt,p,"center",qe,_e,te,T.az.horizontal,!1,L,A);Pt&&(U.horizontal[qe]=Pt,Ke=Pt.positionedLines.length===1)}gt()}else{We==="auto"&&(We=t0(De));const st=Ge(q,s.glyphMap,s.glyphPositions,s.imagePositions,C,tt,p,De,We,_e,te,T.az.horizontal,!1,L,A);st&&(U.horizontal[We]=st),gt(),no(oe)&&f&&x&&(U.vertical=Ge(q,s.glyphMap,s.glyphPositions,s.imagePositions,C,tt,p,De,We,_e,te,T.az.vertical,!1,L,A))}}let pe=!1;if(N.icon&&N.icon.name){const oe=s.imageMap[N.icon.name];oe&&(Z=Kl(s.imagePositions[N.icon.name],r.get("icon-offset").evaluate(N,{},s.canonical),r.get("icon-anchor").evaluate(N,{},s.canonical)),pe=!!oe.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=pe:s.bucket.sdfIcons!==pe&&Cs("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==s.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const ae=gx(U.horizontal)||U.vertical;s.bucket.iconsInText=!!ae&&ae.iconsInText,(ae||Z)&&wb(s.bucket,N,U,Z,s.imageMap,u,L,O,te,pe,s.canonical,s.subdivisionGranularity)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},T.cR=Vd,T.cS=vp,T.cT=Yu,T.cU=function(s){const e=new o;return(function(r,a){for(const u in r.layers)a.writeMessage(3,lb,r.layers[u])})(s,e),e.finish()},T.cV=function(s,e,r,a,u,p){let f=nx(s,e,r,u,0);return f=nx(f,e,a,p,1),f},T.cW=class{constructor(s){this.maxEntries=s,this.map=new Map}get(s){const e=this.map.get(s);return e!==void 0&&(this.map.delete(s),this.map.set(s,e)),e}set(s,e){if(this.map.has(s))this.map.delete(s);else if(this.map.size>=this.maxEntries){const r=this.map.keys().next().value;this.map.delete(r)}this.map.set(s,e)}clear(){this.map.clear()}},T.cX=ff,T.cY=o,T.cZ=Qg,T.c_=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},T.ca=class extends Si{},T.cb=kf,T.cc=class extends Yr{},T.cd=Fd,T.ce=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},T.cf=hp,T.cg=function(s,e,r){var a=e[0],u=e[1],p=e[2],f=r[3]*a+r[7]*u+r[11]*p+r[15];return s[0]=(r[0]*a+r[4]*u+r[8]*p+r[12])/(f=f||1),s[1]=(r[1]*a+r[5]*u+r[9]*p+r[13])/f,s[2]=(r[2]*a+r[6]*u+r[10]*p+r[14])/f,s},T.ch=class extends Yo{},T.ci=class extends t{},T.cj=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]&&s[4]===e[4]&&s[5]===e[5]&&s[6]===e[6]&&s[7]===e[7]&&s[8]===e[8]&&s[9]===e[9]&&s[10]===e[10]&&s[11]===e[11]&&s[12]===e[12]&&s[13]===e[13]&&s[14]===e[14]&&s[15]===e[15]},T.ck=function(s,e){var r=s[0],a=s[1],u=s[2],p=s[3],f=s[4],x=s[5],v=s[6],N=s[7],C=s[8],A=s[9],L=s[10],O=s[11],U=s[12],q=s[13],Z=s[14],te=s[15],pe=e[0],ae=e[1],oe=e[2],fe=e[3],_e=e[4],De=e[5],Je=e[6],We=e[7],tt=e[8],gt=e[9],st=e[10],Ke=e[11],qe=e[12],Pt=e[13],jt=e[14],Mt=e[15];return Math.abs(r-pe)<=Pe*Math.max(1,Math.abs(r),Math.abs(pe))&&Math.abs(a-ae)<=Pe*Math.max(1,Math.abs(a),Math.abs(ae))&&Math.abs(u-oe)<=Pe*Math.max(1,Math.abs(u),Math.abs(oe))&&Math.abs(p-fe)<=Pe*Math.max(1,Math.abs(p),Math.abs(fe))&&Math.abs(f-_e)<=Pe*Math.max(1,Math.abs(f),Math.abs(_e))&&Math.abs(x-De)<=Pe*Math.max(1,Math.abs(x),Math.abs(De))&&Math.abs(v-Je)<=Pe*Math.max(1,Math.abs(v),Math.abs(Je))&&Math.abs(N-We)<=Pe*Math.max(1,Math.abs(N),Math.abs(We))&&Math.abs(C-tt)<=Pe*Math.max(1,Math.abs(C),Math.abs(tt))&&Math.abs(A-gt)<=Pe*Math.max(1,Math.abs(A),Math.abs(gt))&&Math.abs(L-st)<=Pe*Math.max(1,Math.abs(L),Math.abs(st))&&Math.abs(O-Ke)<=Pe*Math.max(1,Math.abs(O),Math.abs(Ke))&&Math.abs(U-qe)<=Pe*Math.max(1,Math.abs(U),Math.abs(qe))&&Math.abs(q-Pt)<=Pe*Math.max(1,Math.abs(q),Math.abs(Pt))&&Math.abs(Z-jt)<=Pe*Math.max(1,Math.abs(Z),Math.abs(jt))&&Math.abs(te-Mt)<=Pe*Math.max(1,Math.abs(te),Math.abs(Mt))},T.cl=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s},T.cm=s=>s.type==="symbol",T.cn=s=>s.type==="circle",T.co=s=>s.type==="heatmap",T.cp=s=>s.type==="line",T.cq=s=>s.type==="fill",T.cr=s=>s.type==="fill-extrusion",T.cs=s=>s.type==="hillshade",T.ct=s=>s.type==="color-relief",T.cu=s=>s.type==="background",T.cv=s=>s.type==="custom",T.cw=Yt,T.cx=function(s,e,r){const a=nt(e.x-r.x,e.y-r.y),u=nt(s.x-r.x,s.y-r.y),p=Math.atan2(a[0]*u[1]-a[1]*u[0],(function(f,x){return f[0]*x[0]+f[1]*x[1]})(a,u));return _n(p)},T.cy=wt,T.cz=function(s,e){return Y[e]&&(s instanceof MouseEvent||s instanceof WheelEvent)},T.d=Qe,T.d0=mp,T.d1=W,T.d2=class{constructor(s,e){this.layers={[Mp]:this},this.name=Mp,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=s.length,this.features=s}feature(s){return new ob(this.features[s],this.extent)}},T.d3=Bo,T.d4=ki,T.e=er,T.f=s=>c(void 0,void 0,void 0,(function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),T.g=Le,T.h=s=>new Promise(((e,r)=>{const a=new Image;a.onload=()=>{e(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame((()=>{a.src=mi}))},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(s)],{type:"image/png"});a.src=s.byteLength?URL.createObjectURL(u):mi})),T.i=ba,T.j=(s,e)=>rt(er(s,{type:"json"}),e),T.k=wr,T.l=Jt,T.m=rt,T.n=(s,e)=>rt(er(s,{type:"arrayBuffer"}),e),T.o=function(s){return new o(s).readFields(ut,[])},T.p=Ut,T.q=function(s){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(s))},T.r=Zu,T.s=_o,T.t=ws,T.u=Fe,T.v=Za,T.w=Cs,T.x=io,T.y=ro,T.z=Ll})),I("worker",["./shared"],(function(T){class c{constructor(Y,X){this.keyCache={},Y&&this.replace(Y,X)}replace(Y,X){this._layerConfigs={},this._layers={},this.update(Y,[],X)}update(Y,X,ie){for(const ve of Y){this._layerConfigs[ve.id]=ve;const Le=this._layers[ve.id]=T.bT(ve,ie);Le._featureFilter=T.aj(Le.filter,ie),this.keyCache[ve.id]&&delete this.keyCache[ve.id]}for(const ve of X)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const be=T.cL(Object.values(this._layerConfigs),this.keyCache);for(const ve of be){const Le=ve.map((kt=>this._layers[kt.id])),Ie=Le[0];if(Ie.isHidden())continue;const Se=Ie.source||"";let $e=this.familiesBySource[Se];$e||($e=this.familiesBySource[Se]={});const rt=Ie.sourceLayer||T.ai;let Qe=$e[rt];Qe||(Qe=$e[rt]=[]),Qe.push(Le)}}}class V{constructor(Y){const X={},ie=[];for(const Ie in Y){const Se=Y[Ie],$e=X[Ie]={};for(const rt in Se){const Qe=Se[+rt];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const kt={x:0,y:0,w:Qe.bitmap.width+2,h:Qe.bitmap.height+2};ie.push(kt),$e[rt]={rect:kt,metrics:Qe.metrics}}}const{w:be,h:ve}=T.p(ie),Le=new T.r({width:be||1,height:ve||1});for(const Ie in Y){const Se=Y[Ie];for(const $e in Se){const rt=Se[+$e];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const Qe=X[Ie][$e].rect;T.r.copy(rt.bitmap,Le,{x:0,y:0},{x:Qe.x+1,y:Qe.y+1},rt.bitmap)}}this.image=Le,this.positions=X}}T.cM("GlyphAtlas",V);class W{constructor(Y){this.tileID=new T.a2(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId,this.inFlightDependencies=[]}parse(Y,X,ie,be,ve){return T._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Y,this.collisionBoxArray=new T.ag;const Le=new T.cN(Object.keys(Y.layers).sort()),Ie=new T.cO(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const Se={},$e={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ie,subdivisionGranularity:ve},rt=X.familiesBySource[this.source];for(const Dr in rt){const ps=Y.layers[Dr];if(!ps)continue;ps.version===1&&T.w(`Vector tile source "${this.source}" layer "${Dr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const sc=Le.encode(Dr),gi=[];for(let at=0;at<ps.length;at++){const Us=ps.feature(at),en=Ie.getId(Us,Dr);gi.push({feature:Us,id:en,index:at,sourceLayerIndex:sc})}for(const at of rt[Dr]){const Us=at[0];Us.source!==this.source&&T.w(`layer.source = ${Us.source} does not equal this.source = ${this.source}`),Us.isHidden(this.zoom,!0)||(se(at,this.zoom,ie),(Se[Us.id]=Us.createBucket({index:Ie.bucketLayerIDs.length,layers:at,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:sc,sourceID:this.source})).populate(gi,$e,this.tileID.canonical),Ie.bucketLayerIDs.push(at.map((en=>en.id))))}}const Qe=T.bY($e.glyphDependencies,(Dr=>Object.keys(Dr).map(Number)));this.inFlightDependencies.forEach((Dr=>Dr?.abort())),this.inFlightDependencies=[];let kt=Promise.resolve({});if(Object.keys(Qe).length){const Dr=new AbortController;this.inFlightDependencies.push(Dr),kt=be.sendAsync({type:"GG",data:{stacks:Qe,source:this.source,tileID:this.tileID,type:"glyphs"}},Dr)}const It=Object.keys($e.iconDependencies);let Jt=Promise.resolve({});if(It.length){const Dr=new AbortController;this.inFlightDependencies.push(Dr),Jt=be.sendAsync({type:"GI",data:{icons:It,source:this.source,tileID:this.tileID,type:"icons"}},Dr)}const wr=Object.keys($e.patternDependencies);let xr=Promise.resolve({});if(wr.length){const Dr=new AbortController;this.inFlightDependencies.push(Dr),xr=be.sendAsync({type:"GI",data:{icons:wr,source:this.source,tileID:this.tileID,type:"patterns"}},Dr)}const Fe=$e.dashDependencies;let Or=Promise.resolve({});if(Object.keys(Fe).length){const Dr=new AbortController;this.inFlightDependencies.push(Dr),Or=be.sendAsync({type:"GDA",data:{dashes:Fe}},Dr)}const[$s,tr,Mr,Rs]=yield Promise.all([kt,Jt,xr,Or]),Gr=new V($s),Zr=new T.cP(tr,Mr);for(const Dr in Se){const ps=Se[Dr];ps instanceof T.ah?(se(ps.layers,this.zoom,ie),T.cQ({bucket:ps,glyphMap:$s,glyphPositions:Gr.positions,imageMap:tr,imagePositions:Zr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:$e.subdivisionGranularity})):ps.hasDependencies&&(ps instanceof T.cR||ps instanceof T.cS||ps instanceof T.cT)&&(se(ps.layers,this.zoom,ie),ps.addFeatures($e,this.tileID.canonical,Zr.patternPositions,Rs))}return this.status="done",{buckets:Object.values(Se).filter((Dr=>!Dr.isEmpty())),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gr.image,imageAtlas:Zr,dashPositions:Rs,glyphMap:this.returnDependencies?$s:null,iconMap:this.returnDependencies?tr:null,glyphPositions:this.returnDependencies?Gr.positions:null}}))}}function se(Ae,Y,X){const ie=new T.H(Y);for(const be of Ae)be.recalculate(ie,X)}class ee{constructor(Y,X,ie,be,ve){this.type=Y,this.properties=ie||{},this.extent=ve,this.pointsArray=X,this.id=be}loadGeometry(){return this.pointsArray.map((Y=>Y.map((X=>new T.P(X.x,X.y)))))}}class ne{constructor(Y,X,ie){this.version=2,this._myFeatures=Y,this.name=X,this.length=Y.length,this.extent=ie}feature(Y){return this._myFeatures[Y]}}class ke{constructor(){this.layers={}}addLayer(Y){this.layers[Y.name]=Y}}function je(Ae){let Y=T.cU(Ae);return Y.byteOffset===0&&Y.byteLength===Y.buffer.byteLength||(Y=new Uint8Array(Y)),{vectorTile:Ae,rawData:Y.buffer}}function re(Ae,Y,X){const{extent:ie}=Ae,be=Math.pow(2,X.z-Y.z),ve=(X.x-Y.x*be)*ie,Le=(X.y-Y.y*be)*ie,Ie=[];for(let Se=0;Se<Ae.length;Se++){const $e=Ae.feature(Se);let rt=$e.loadGeometry();for(const kt of rt)for(const It of kt)It.x=It.x*be-ve,It.y=It.y*be-Le;const Qe=128;rt=T.cV(rt,$e.type,-Qe,-Qe,ie+Qe,ie+Qe),rt.length!==0&&Ie.push(new ee($e.type,rt,$e.properties,$e.id,ie))}return new ne(Ie,Ae.name,ie)}class H{constructor(Y,X,ie){this.actor=Y,this.layerIndex=X,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new T.cW(1e3)}loadVectorTile(Y,X){return T._(this,void 0,void 0,(function*(){const ie=yield T.n(Y.request,X);try{return{vectorTile:Y.encoding!=="mlt"?new T.cX(new T.cY(ie.data)):new T.cZ(ie.data),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(be){const ve=new Uint8Array(ie.data);let Le=`Unable to parse the tile at ${Y.request.url}, `;throw Le+=ve[0]===31&&ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${be.message}`,new Error(Le)}}))}loadTile(Y){return T._(this,void 0,void 0,(function*(){const{uid:X,overzoomParameters:ie}=Y;ie&&(Y.request=ie.overzoomRequest);const be=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new T.c_(Y.request),ve=new W(Y);this.loading[X]=ve;const Le=new AbortController;ve.abort=Le;try{const Ie=yield this.loadVectorTile(Y,Le);if(delete this.loading[X],!Ie)return null;if(ie){const kt=this._getOverzoomTile(Y,Ie.vectorTile);Ie.rawData=kt.rawData,Ie.vectorTile=kt.vectorTile}const Se=Ie.rawData,$e={};Ie.expires&&($e.expires=Ie.expires),Ie.cacheControl&&($e.cacheControl=Ie.cacheControl);const rt={};if(be){const kt=be.finish();kt&&(rt.resourceTiming=JSON.parse(JSON.stringify(kt)))}ve.vectorTile=Ie.vectorTile;const Qe=ve.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity);this.loaded[X]=ve,this.fetching[X]={rawTileData:Se,cacheControl:$e,resourceTiming:rt};try{const kt=yield Qe;return T.e({rawTileData:Se.slice(0),encoding:Y.encoding},kt,$e,rt)}finally{delete this.fetching[X]}}catch(Ie){throw delete this.loading[X],ve.status="done",this.loaded[X]=ve,Ie}}))}_getOverzoomTile(Y,X){const{tileID:ie,source:be,overzoomParameters:ve}=Y,{maxZoomTileID:Le}=ve,Ie=`${Le.key}_${ie.key}`,Se=this.overzoomedTileResultCache.get(Ie);if(Se)return Se;const $e=new ke,rt=this.layerIndex.familiesBySource[be];for(const kt in rt){const It=X.layers[kt];if(!It)continue;const Jt=re(It,Le,ie.canonical);Jt.length>0&&$e.addLayer(Jt)}const Qe=je($e);return this.overzoomedTileResultCache.set(Ie,Qe),Qe}reloadTile(Y){return T._(this,void 0,void 0,(function*(){const X=Y.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[X];if(ie.showCollisionBoxes=Y.showCollisionBoxes,ie.status==="parsing"){const be=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity);let ve;if(this.fetching[X]){const{rawTileData:Le,cacheControl:Ie,resourceTiming:Se}=this.fetching[X];delete this.fetching[X],ve=T.e({rawTileData:Le.slice(0),encoding:Y.encoding},be,Ie,Se)}else ve=be;return ve}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,Y.subdivisionGranularity)}))}abortTile(Y){return T._(this,void 0,void 0,(function*(){const X=this.loading,ie=Y.uid;X&&X[ie]&&X[ie].abort&&(X[ie].abort.abort(),delete X[ie])}))}removeTile(Y){return T._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Y.uid]&&delete this.loaded[Y.uid]}))}}class Ze{constructor(){this.loaded={}}loadTile(Y){return T._(this,void 0,void 0,(function*(){const{uid:X,encoding:ie,rawImageData:be,redFactor:ve,greenFactor:Le,blueFactor:Ie,baseShift:Se}=Y,$e=be.width+2,rt=be.height+2,Qe=T.b(be)?new T.R({width:$e,height:rt},yield T.c$(be,-1,-1,$e,rt)):be,kt=new T.d0(X,Qe,ie,ve,Le,Ie,Se);return this.loaded=this.loaded||{},this.loaded[X]=kt,kt}))}removeTile(Y){const X=this.loaded,ie=Y.uid;X&&X[ie]&&delete X[ie]}}var Pe,ze,lt=(function(){if(ze)return Pe;function Ae(X,ie){if(X.length!==0){Y(X[0],ie);for(var be=1;be<X.length;be++)Y(X[be],!ie)}}function Y(X,ie){for(var be=0,ve=0,Le=0,Ie=X.length,Se=Ie-1;Le<Ie;Se=Le++){var $e=(X[Le][0]-X[Se][0])*(X[Se][1]+X[Le][1]),rt=be+$e;ve+=Math.abs(be)>=Math.abs($e)?be-rt+$e:$e-rt+be,be=rt}be+ve>=0!=!!ie&&X.reverse()}return ze=1,Pe=function X(ie,be){var ve,Le=ie&&ie.type;if(Le==="FeatureCollection")for(ve=0;ve<ie.features.length;ve++)X(ie.features[ve],be);else if(Le==="GeometryCollection")for(ve=0;ve<ie.geometries.length;ve++)X(ie.geometries[ve],be);else if(Le==="Feature")X(ie.geometry,be);else if(Le==="Polygon")Ae(ie.coordinates,be);else if(Le==="MultiPolygon")for(ve=0;ve<ie.coordinates.length;ve++)Ae(ie.coordinates[ve],be);return ie}})(),Nt=T.d1(lt);const zt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},Ft=Math.fround||(Vt=new Float32Array(1),Ae=>(Vt[0]=+Ae,Vt[0]));var Vt;class Zt{constructor(Y){this.options=Object.assign(Object.create(zt),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:X,minZoom:ie,maxZoom:be}=this.options;X&&console.time("total time");const ve=`prepare ${Y.length} points`;X&&console.time(ve),this.points=Y;const Le=[];for(let Se=0;Se<Y.length;Se++){const $e=Y[Se];if(!$e.geometry)continue;const[rt,Qe]=$e.geometry.coordinates,kt=Ft(Kt(rt)),It=Ft(Wt(Qe));Le.push(kt,It,1/0,Se,-1,1),this.options.reduce&&Le.push(0)}let Ie=this.trees[be+1]=this._createTree(Le);X&&console.timeEnd(ve);for(let Se=be;Se>=ie;Se--){const $e=+Date.now();Ie=this.trees[Se]=this._createTree(this._cluster(Ie,Se)),X&&console.log("z%d: %d clusters in %dms",Se,Ie.numItems,+Date.now()-$e)}return X&&console.timeEnd("total time"),this}getClusters(Y,X){let ie=((Y[0]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,Y[1]));let ve=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ie=-180,ve=180;else if(ie>ve){const Qe=this.getClusters([ie,be,180,Le],X),kt=this.getClusters([-180,be,ve,Le],X);return Qe.concat(kt)}const Ie=this.trees[this._limitZoom(X)],Se=Ie.range(Kt(ie),Wt(Le),Kt(ve),Wt(be)),$e=Ie.data,rt=[];for(const Qe of Se){const kt=this.stride*Qe;rt.push($e[kt+5]>1?mt($e,kt,this.clusterProps):this.points[$e[kt+3]])}return rt}getChildren(Y){const X=this._getOriginId(Y),ie=this._getOriginZoom(Y),be="No cluster with the specified id.",ve=this.trees[ie];if(!ve)throw new Error(be);const Le=ve.data;if(X*this.stride>=Le.length)throw new Error(be);const Ie=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Se=ve.within(Le[X*this.stride],Le[X*this.stride+1],Ie),$e=[];for(const rt of Se){const Qe=rt*this.stride;Le[Qe+4]===Y&&$e.push(Le[Qe+5]>1?mt(Le,Qe,this.clusterProps):this.points[Le[Qe+3]])}if($e.length===0)throw new Error(be);return $e}getLeaves(Y,X,ie){const be=[];return this._appendLeaves(be,Y,X=X||10,ie=ie||0,0),be}getTile(Y,X,ie){const be=this.trees[this._limitZoom(Y)],ve=Math.pow(2,Y),{extent:Le,radius:Ie}=this.options,Se=Ie/Le,$e=(ie-Se)/ve,rt=(ie+1+Se)/ve,Qe={features:[]};return this._addTileFeatures(be.range((X-Se)/ve,$e,(X+1+Se)/ve,rt),be.data,X,ie,ve,Qe),X===0&&this._addTileFeatures(be.range(1-Se/ve,$e,1,rt),be.data,ve,ie,ve,Qe),X===ve-1&&this._addTileFeatures(be.range(0,$e,Se/ve,rt),be.data,-1,ie,ve,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(Y){let X=this._getOriginZoom(Y)-1;for(;X<=this.options.maxZoom;){const ie=this.getChildren(Y);if(X++,ie.length!==1)break;Y=ie[0].properties.cluster_id}return X}_appendLeaves(Y,X,ie,be,ve){const Le=this.getChildren(X);for(const Ie of Le){const Se=Ie.properties;if(Se&&Se.cluster?ve+Se.point_count<=be?ve+=Se.point_count:ve=this._appendLeaves(Y,Se.cluster_id,ie,be,ve):ve<be?ve++:Y.push(Ie),Y.length===ie)break}return ve}_createTree(Y){const X=new T.aT(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<Y.length;ie+=this.stride)X.add(Y[ie],Y[ie+1]);return X.finish(),X.data=Y,X}_addTileFeatures(Y,X,ie,be,ve,Le){for(const Ie of Y){const Se=Ie*this.stride,$e=X[Se+5]>1;let rt,Qe,kt;if($e)rt=fr(X,Se,this.clusterProps),Qe=X[Se],kt=X[Se+1];else{const wr=this.points[X[Se+3]];rt=wr.properties;const[xr,Fe]=wr.geometry.coordinates;Qe=Kt(xr),kt=Wt(Fe)}const It={type:1,geometry:[[Math.round(this.options.extent*(Qe*ve-ie)),Math.round(this.options.extent*(kt*ve-be))]],tags:rt};let Jt;Jt=$e||this.options.generateId?X[Se+3]:this.points[X[Se+3]].id,Jt!==void 0&&(It.id=Jt),Le.features.push(It)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,X){const{radius:ie,extent:be,reduce:ve,minPoints:Le}=this.options,Ie=ie/(be*Math.pow(2,X)),Se=Y.data,$e=[],rt=this.stride;for(let Qe=0;Qe<Se.length;Qe+=rt){if(Se[Qe+2]<=X)continue;Se[Qe+2]=X;const kt=Se[Qe],It=Se[Qe+1],Jt=Y.within(Se[Qe],Se[Qe+1],Ie),wr=Se[Qe+5];let xr=wr;for(const Fe of Jt){const Or=Fe*rt;Se[Or+2]>X&&(xr+=Se[Or+5])}if(xr>wr&&xr>=Le){let Fe,Or=kt*wr,$s=It*wr,tr=-1;const Mr=(Qe/rt<<5)+(X+1)+this.points.length;for(const Rs of Jt){const Gr=Rs*rt;if(Se[Gr+2]<=X)continue;Se[Gr+2]=X;const Zr=Se[Gr+5];Or+=Se[Gr]*Zr,$s+=Se[Gr+1]*Zr,Se[Gr+4]=Mr,ve&&(Fe||(Fe=this._map(Se,Qe,!0),tr=this.clusterProps.length,this.clusterProps.push(Fe)),ve(Fe,this._map(Se,Gr)))}Se[Qe+4]=Mr,$e.push(Or/xr,$s/xr,1/0,Mr,-1,xr),ve&&$e.push(tr)}else{for(let Fe=0;Fe<rt;Fe++)$e.push(Se[Qe+Fe]);if(xr>1)for(const Fe of Jt){const Or=Fe*rt;if(!(Se[Or+2]<=X)){Se[Or+2]=X;for(let $s=0;$s<rt;$s++)$e.push(Se[Or+$s])}}}}return $e}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,X,ie){if(Y[X+5]>1){const Le=this.clusterProps[Y[X+6]];return ie?Object.assign({},Le):Le}const be=this.points[Y[X+3]].properties,ve=this.options.map(be);return ie&&ve===be?Object.assign({},ve):ve}}function mt(Ae,Y,X){return{type:"Feature",id:Ae[Y+3],properties:fr(Ae,Y,X),geometry:{type:"Point",coordinates:[(ie=Ae[Y],360*(ie-.5)),Me(Ae[Y+1])]}};var ie}function fr(Ae,Y,X){const ie=Ae[Y+5],be=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,ve=Ae[Y+6],Le=ve===-1?{}:Object.assign({},X[ve]);return Object.assign(Le,{cluster:!0,cluster_id:Ae[Y+3],point_count:ie,point_count_abbreviated:be})}function Kt(Ae){return Ae/360+.5}function Wt(Ae){const Y=Math.sin(Ae*Math.PI/180),X=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return X<0?0:X>1?1:X}function Me(Ae){const Y=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Ct(Ae,Y,X,ie){let be=ie;const ve=Y+(X-Y>>1);let Le,Ie=X-Y;const Se=Ae[Y],$e=Ae[Y+1],rt=Ae[X],Qe=Ae[X+1];for(let kt=Y+3;kt<X;kt+=3){const It=it(Ae[kt],Ae[kt+1],Se,$e,rt,Qe);if(It>be)Le=kt,be=It;else if(It===be){const Jt=Math.abs(kt-ve);Jt<Ie&&(Le=kt,Ie=Jt)}}be>ie&&(Le-Y>3&&Ct(Ae,Y,Le,ie),Ae[Le+2]=be,X-Le>3&&Ct(Ae,Le,X,ie))}function it(Ae,Y,X,ie,be,ve){let Le=be-X,Ie=ve-ie;if(Le!==0||Ie!==0){const Se=((Ae-X)*Le+(Y-ie)*Ie)/(Le*Le+Ie*Ie);Se>1?(X=be,ie=ve):Se>0&&(X+=Le*Se,ie+=Ie*Se)}return Le=Ae-X,Ie=Y-ie,Le*Le+Ie*Ie}function Tt(Ae,Y,X,ie){const be={id:Ae??null,type:Y,geometry:X,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")nt(be,X);else if(Y==="Polygon")nt(be,X[0]);else if(Y==="MultiLineString")for(const ve of X)nt(be,ve);else if(Y==="MultiPolygon")for(const ve of X)nt(be,ve[0]);return be}function nt(Ae,Y){for(let X=0;X<Y.length;X+=3)Ae.minX=Math.min(Ae.minX,Y[X]),Ae.minY=Math.min(Ae.minY,Y[X+1]),Ae.maxX=Math.max(Ae.maxX,Y[X]),Ae.maxY=Math.max(Ae.maxY,Y[X+1])}function ht(Ae,Y,X,ie){if(!Y.geometry)return;const be=Y.geometry.coordinates;if(be&&be.length===0)return;const ve=Y.geometry.type,Le=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Ie=[],Se=Y.id;if(X.promoteId?Se=Y.properties[X.promoteId]:X.generateId&&(Se=ie||0),ve==="Point")pt(be,Ie);else if(ve==="MultiPoint")for(const $e of be)pt($e,Ie);else if(ve==="LineString")Ce(be,Ie,Le,!1);else if(ve==="MultiLineString"){if(X.lineMetrics){for(const $e of be)Ie=[],Ce($e,Ie,Le,!1),Ae.push(Tt(Se,"LineString",Ie,Y.properties));return}Ye(be,Ie,Le,!1)}else if(ve==="Polygon")Ye(be,Ie,Le,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const $e of Y.geometry.geometries)ht(Ae,{id:Se,geometry:$e,properties:Y.properties},X,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const $e of be){const rt=[];Ye($e,rt,Le,!0),Ie.push(rt)}}Ae.push(Tt(Se,ve,Ie,Y.properties))}function pt(Ae,Y){Y.push(qt(Ae[0]),Yt(Ae[1]),0)}function Ce(Ae,Y,X,ie){let be,ve,Le=0;for(let Se=0;Se<Ae.length;Se++){const $e=qt(Ae[Se][0]),rt=Yt(Ae[Se][1]);Y.push($e,rt,0),Se>0&&(Le+=ie?(be*rt-$e*ve)/2:Math.sqrt(Math.pow($e-be,2)+Math.pow(rt-ve,2))),be=$e,ve=rt}const Ie=Y.length-3;Y[2]=1,Ct(Y,0,Ie,X),Y[Ie+2]=1,Y.size=Math.abs(Le),Y.start=0,Y.end=Y.size}function Ye(Ae,Y,X,ie){for(let be=0;be<Ae.length;be++){const ve=[];Ce(Ae[be],ve,X,ie),Y.push(ve)}}function qt(Ae){return Ae/360+.5}function Yt(Ae){const Y=Math.sin(Ae*Math.PI/180),X=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return X<0?0:X>1?1:X}function wt(Ae,Y,X,ie,be,ve,Le,Ie){if(ie/=Y,ve>=(X/=Y)&&Le<ie)return Ae;if(Le<X||ve>=ie)return null;const Se=[];for(const $e of Ae){const rt=$e.geometry;let Qe=$e.type;const kt=be===0?$e.minX:$e.minY,It=be===0?$e.maxX:$e.maxY;if(kt>=X&&It<ie){Se.push($e);continue}if(It<X||kt>=ie)continue;let Jt=[];if(Qe==="Point"||Qe==="MultiPoint")Ht(rt,Jt,X,ie,be);else if(Qe==="LineString")At(rt,Jt,X,ie,be,!1,Ie.lineMetrics);else if(Qe==="MultiLineString")Sr(rt,Jt,X,ie,be,!1);else if(Qe==="Polygon")Sr(rt,Jt,X,ie,be,!0);else if(Qe==="MultiPolygon")for(const wr of rt){const xr=[];Sr(wr,xr,X,ie,be,!0),xr.length&&Jt.push(xr)}if(Jt.length){if(Ie.lineMetrics&&Qe==="LineString"){for(const wr of Jt)Se.push(Tt($e.id,Qe,wr,$e.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(Jt.length===1?(Qe="LineString",Jt=Jt[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=Jt.length===3?"Point":"MultiPoint"),Se.push(Tt($e.id,Qe,Jt,$e.tags))}}return Se.length?Se:null}function Ht(Ae,Y,X,ie,be){for(let ve=0;ve<Ae.length;ve+=3){const Le=Ae[ve+be];Le>=X&&Le<=ie&&Jr(Y,Ae[ve],Ae[ve+1],Ae[ve+2])}}function At(Ae,Y,X,ie,be,ve,Le){let Ie=er(Ae);const Se=be===0?_a:Qn;let $e,rt,Qe=Ae.start;for(let xr=0;xr<Ae.length-3;xr+=3){const Fe=Ae[xr],Or=Ae[xr+1],$s=Ae[xr+2],tr=Ae[xr+3],Mr=Ae[xr+4],Rs=be===0?Fe:Or,Gr=be===0?tr:Mr;let Zr=!1;Le&&($e=Math.sqrt(Math.pow(Fe-tr,2)+Math.pow(Or-Mr,2))),Rs<X?Gr>X&&(rt=Se(Ie,Fe,Or,tr,Mr,X),Le&&(Ie.start=Qe+$e*rt)):Rs>ie?Gr<ie&&(rt=Se(Ie,Fe,Or,tr,Mr,ie),Le&&(Ie.start=Qe+$e*rt)):Jr(Ie,Fe,Or,$s),Gr<X&&Rs>=X&&(rt=Se(Ie,Fe,Or,tr,Mr,X),Zr=!0),Gr>ie&&Rs<=ie&&(rt=Se(Ie,Fe,Or,tr,Mr,ie),Zr=!0),!ve&&Zr&&(Le&&(Ie.end=Qe+$e*rt),Y.push(Ie),Ie=er(Ae)),Le&&(Qe+=$e)}let kt=Ae.length-3;const It=Ae[kt],Jt=Ae[kt+1],wr=be===0?It:Jt;wr>=X&&wr<=ie&&Jr(Ie,It,Jt,Ae[kt+2]),kt=Ie.length-3,ve&&kt>=3&&(Ie[kt]!==Ie[0]||Ie[kt+1]!==Ie[1])&&Jr(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&Y.push(Ie)}function er(Ae){const Y=[];return Y.size=Ae.size,Y.start=Ae.start,Y.end=Ae.end,Y}function Sr(Ae,Y,X,ie,be,ve){for(const Le of Ae)At(Le,Y,X,ie,be,ve,!1)}function Jr(Ae,Y,X,ie){Ae.push(Y,X,ie)}function _a(Ae,Y,X,ie,be,ve){const Le=(ve-Y)/(ie-Y);return Jr(Ae,ve,X+(be-X)*Le,1),Le}function Qn(Ae,Y,X,ie,be,ve){const Le=(ve-X)/(be-X);return Jr(Ae,Y+(ie-Y)*Le,ve,1),Le}function Oi(Ae,Y){const X=[];for(let ie=0;ie<Ae.length;ie++){const be=Ae[ie],ve=be.type;let Le;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Le=Cs(be.geometry,Y);else if(ve==="MultiLineString"||ve==="Polygon"){Le=[];for(const Ie of be.geometry)Le.push(Cs(Ie,Y))}else if(ve==="MultiPolygon"){Le=[];for(const Ie of be.geometry){const Se=[];for(const $e of Ie)Se.push(Cs($e,Y));Le.push(Se)}}X.push(Tt(be.id,ve,Le,be.tags))}return X}function Cs(Ae,Y){const X=[];X.size=Ae.size,Ae.start!==void 0&&(X.start=Ae.start,X.end=Ae.end);for(let ie=0;ie<Ae.length;ie+=3)X.push(Ae[ie]+Y,Ae[ie+1],Ae[ie+2]);return X}function Gn(Ae,Y){if(Ae.transformed)return Ae;const X=1<<Ae.z,ie=Ae.x,be=Ae.y;for(const ve of Ae.features){const Le=ve.geometry,Ie=ve.type;if(ve.geometry=[],Ie===1)for(let Se=0;Se<Le.length;Se+=2)ve.geometry.push(ba(Le[Se],Le[Se+1],Y,X,ie,be));else for(let Se=0;Se<Le.length;Se++){const $e=[];for(let rt=0;rt<Le[Se].length;rt+=2)$e.push(ba(Le[Se][rt],Le[Se][rt+1],Y,X,ie,be));ve.geometry.push($e)}}return Ae.transformed=!0,Ae}function ba(Ae,Y,X,ie,be,ve){return[Math.round(X*(Ae*ie-be)),Math.round(X*(Y*ie-ve))]}function as(Ae,Y,X,ie,be){const ve=Y===be.maxZoom?0:be.tolerance/((1<<Y)*be.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:Ae.length,source:null,x:X,y:ie,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ie of Ae)fi(Le,Ie,ve,be);return Le}function fi(Ae,Y,X,ie){const be=Y.geometry,ve=Y.type,Le=[];if(Ae.minX=Math.min(Ae.minX,Y.minX),Ae.minY=Math.min(Ae.minY,Y.minY),Ae.maxX=Math.max(Ae.maxX,Y.maxX),Ae.maxY=Math.max(Ae.maxY,Y.maxY),ve==="Point"||ve==="MultiPoint")for(let Ie=0;Ie<be.length;Ie+=3)Le.push(be[Ie],be[Ie+1]),Ae.numPoints++,Ae.numSimplified++;else if(ve==="LineString")mi(Le,be,Ae,X,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let Ie=0;Ie<be.length;Ie++)mi(Le,be[Ie],Ae,X,ve==="Polygon",Ie===0);else if(ve==="MultiPolygon")for(let Ie=0;Ie<be.length;Ie++){const Se=be[Ie];for(let $e=0;$e<Se.length;$e++)mi(Le,Se[$e],Ae,X,!0,$e===0)}if(Le.length){let Ie=Y.tags||null;if(ve==="LineString"&&ie.lineMetrics){Ie={};for(const $e in Y.tags)Ie[$e]=Y.tags[$e];Ie.mapbox_clip_start=be.start/be.size,Ie.mapbox_clip_end=be.end/be.size}const Se={geometry:Le,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:Ie};Y.id!==null&&(Se.id=Y.id),Ae.features.push(Se)}}function mi(Ae,Y,X,ie,be,ve){const Le=ie*ie;if(ie>0&&Y.size<(be?Le:ie))return void(X.numPoints+=Y.length/3);const Ie=[];for(let Se=0;Se<Y.length;Se+=3)(ie===0||Y[Se+2]>Le)&&(X.numSimplified++,Ie.push(Y[Se],Y[Se+1])),X.numPoints++;be&&(function(Se,$e){let rt=0;for(let Qe=0,kt=Se.length,It=kt-2;Qe<kt;It=Qe,Qe+=2)rt+=(Se[Qe]-Se[It])*(Se[Qe+1]+Se[It+1]);if(rt>0===$e)for(let Qe=0,kt=Se.length;Qe<kt/2;Qe+=2){const It=Se[Qe],Jt=Se[Qe+1];Se[Qe]=Se[kt-2-Qe],Se[Qe+1]=Se[kt-1-Qe],Se[kt-2-Qe]=It,Se[kt-1-Qe]=Jt}})(Ie,ve),Ae.push(Ie)}const Oa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Zn{constructor(Y,X){const ie=(X=this.options=(function(ve,Le){for(const Ie in Le)ve[Ie]=Le[Ie];return ve})(Object.create(Oa),X)).debug;if(ie&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let be=(function(ve,Le){const Ie=[];if(ve.type==="FeatureCollection")for(let Se=0;Se<ve.features.length;Se++)ht(Ie,ve.features[Se],Le,Se);else ht(Ie,ve.type==="Feature"?ve:{geometry:ve},Le);return Ie})(Y,X);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),be=(function(ve,Le){const Ie=Le.buffer/Le.extent;let Se=ve;const $e=wt(ve,1,-1-Ie,Ie,0,-1,2,Le),rt=wt(ve,1,1-Ie,2+Ie,0,-1,2,Le);return($e||rt)&&(Se=wt(ve,1,-Ie,1+Ie,0,-1,2,Le)||[],$e&&(Se=Oi($e,1).concat(Se)),rt&&(Se=Se.concat(Oi(rt,-1)))),Se})(be,X),be.length&&this.splitTile(be,0,0,0),ie&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,X,ie,be,ve,Le,Ie){const Se=[Y,X,ie,be],$e=this.options,rt=$e.debug;for(;Se.length;){be=Se.pop(),ie=Se.pop(),X=Se.pop(),Y=Se.pop();const Qe=1<<X,kt=Hn(X,ie,be);let It=this.tiles[kt];if(!It&&(rt>1&&console.time("creation"),It=this.tiles[kt]=as(Y,X,ie,be,$e),this.tileCoords.push({z:X,x:ie,y:be}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,ie,be,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));const Zr=`z${X}`;this.stats[Zr]=(this.stats[Zr]||0)+1,this.total++}if(It.source=Y,ve==null){if(X===$e.indexMaxZoom||It.numPoints<=$e.indexMaxPoints)continue}else{if(X===$e.maxZoom||X===ve)continue;if(ve!=null){const Zr=ve-X;if(ie!==Le>>Zr||be!==Ie>>Zr)continue}}if(It.source=null,Y.length===0)continue;rt>1&&console.time("clipping");const Jt=.5*$e.buffer/$e.extent,wr=.5-Jt,xr=.5+Jt,Fe=1+Jt;let Or=null,$s=null,tr=null,Mr=null,Rs=wt(Y,Qe,ie-Jt,ie+xr,0,It.minX,It.maxX,$e),Gr=wt(Y,Qe,ie+wr,ie+Fe,0,It.minX,It.maxX,$e);Y=null,Rs&&(Or=wt(Rs,Qe,be-Jt,be+xr,1,It.minY,It.maxY,$e),$s=wt(Rs,Qe,be+wr,be+Fe,1,It.minY,It.maxY,$e),Rs=null),Gr&&(tr=wt(Gr,Qe,be-Jt,be+xr,1,It.minY,It.maxY,$e),Mr=wt(Gr,Qe,be+wr,be+Fe,1,It.minY,It.maxY,$e),Gr=null),rt>1&&console.timeEnd("clipping"),Se.push(Or||[],X+1,2*ie,2*be),Se.push($s||[],X+1,2*ie,2*be+1),Se.push(tr||[],X+1,2*ie+1,2*be),Se.push(Mr||[],X+1,2*ie+1,2*be+1)}}getTile(Y,X,ie){Y=+Y,X=+X,ie=+ie;const be=this.options,{extent:ve,debug:Le}=be;if(Y<0||Y>24)return null;const Ie=1<<Y,Se=Hn(Y,X=X+Ie&Ie-1,ie);if(this.tiles[Se])return Gn(this.tiles[Se],ve);Le>1&&console.log("drilling down to z%d-%d-%d",Y,X,ie);let $e,rt=Y,Qe=X,kt=ie;for(;!$e&&rt>0;)rt--,Qe>>=1,kt>>=1,$e=this.tiles[Hn(rt,Qe,kt)];return $e&&$e.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",rt,Qe,kt),console.time("drilling down")),this.splitTile($e.source,rt,Qe,kt,Y,X,ie),Le>1&&console.timeEnd("drilling down"),this.tiles[Se]?Gn(this.tiles[Se],ve):null):null}}function Hn(Ae,Y,X){return 32*((1<<Ae)*X+Y)+Ae}class _o extends H{constructor(Y,X,ie,be=bo){super(Y,X,ie),this._dataUpdateable=new Map,this._createGeoJSONIndex=be}loadVectorTile(Y,X){return T._(this,void 0,void 0,(function*(){const ie=Y.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const be=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);return be?je(new T.d2(be.features,{version:2,extent:T.a5})):null}))}loadData(Y){return T._(this,void 0,void 0,(function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const ie=this._startPerformance(Y);this._pendingRequest=new AbortController;try{(!this._pendingData||Y.request||Y.data||Y.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(Y,this._pendingRequest));const be=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(be,Y),this.loaded={};const ve={};return Y.request&&(ve.data=be),this._finishPerformance(ie,Y,ve),ve}catch(be){if(delete this._pendingRequest,T.Z(be))return{abandoned:!0};throw be}}))}_startPerformance(Y){var X;if(!((X=Y?.request)===null||X===void 0)&&X.collectResourceTiming)return new T.c_(Y.request)}_finishPerformance(Y,X,ie){if(!Y)return;const be=Y.finish();be&&(ie.resourceTiming={},ie.resourceTiming[X.source]=JSON.parse(JSON.stringify(be)))}getData(){return T._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Y){const X=this.loaded;return X&&X[Y.uid]?super.reloadTile(Y):this.loadTile(Y)}loadAndProcessGeoJSON(Y,X){return T._(this,void 0,void 0,(function*(){let ie;if(Y.request?ie=yield this.loadGeoJSONFromUrl(Y.request,Y.promoteId,X):Y.data?ie=this._loadGeoJSONFromObject(Y.data,Y.promoteId):Y.dataDiff&&(ie=this._loadGeoJSONFromDiff(Y.dataDiff,Y.promoteId,Y.source)),delete this._pendingRequest,typeof ie!="object")throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);return Nt(ie,!0),Y.filter&&(ie=this._filterGeoJSON(ie,Y.filter)),ie}))}loadGeoJSONFromUrl(Y,X,ie){return T._(this,void 0,void 0,(function*(){const be=yield T.j(Y,ie);return this._dataUpdateable=T.a7(be.data,X),be.data}))}_loadGeoJSONFromObject(Y,X){return this._dataUpdateable=T.a7(Y,X),Y}_loadGeoJSONFromDiff(Y,X,ie){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ie}`);T.a8(this._dataUpdateable,Y,X);const be=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(be)}_filterGeoJSON(Y,X){const ie=T.d3(X,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map((ve=>`${ve.key}: ${ve.message}`)).join(", "));const be=Y.features.filter((ve=>ie.value.evaluate({zoom:0},ve)));return this._toFeatureCollection(be)}_toFeatureCollection(Y){return{type:"FeatureCollection",features:Y}}removeSource(Y){return T._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Y){return this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId)}getClusterChildren(Y){return this._geoJSONIndex.getChildren(Y.clusterId)}getClusterLeaves(Y){return this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset)}}function bo(Ae,Y){return Y.cluster?new Zt((function({superclusterOptions:X,clusterProperties:ie}){if(!ie||!X)return X;const be={},ve={},Le={accumulated:null,zoom:0},Ie={properties:null},Se=Object.keys(ie);for(const $e of Se){const[rt,Qe]=ie[$e],kt=T.d3(Qe),It=T.d3(typeof rt=="string"?[rt,["accumulated"],["get",$e]]:rt);be[$e]=kt.value,ve[$e]=It.value}return X.map=$e=>{Ie.properties=$e;const rt={};for(const Qe of Se)rt[Qe]=be[Qe].evaluate(Le,Ie);return rt},X.reduce=($e,rt)=>{Ie.properties=rt;for(const Qe of Se)Le.accumulated=$e[Qe],$e[Qe]=ve[Qe].evaluate(Le,Ie)},X})(Y)).load(Ae.features):(function(X,ie){return new Zn(X,ie)})(Ae,Y.geojsonVtOptions)}class _n{constructor(Y){this.self=Y,this.actor=new T.L(Y),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(X,ie)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=ie},this.self.addProtocol=T.cJ,this.self.removeProtocol=T.cK,this.self.registerRTLTextPlugin=X=>{T.d4.setMethods(X)},this.actor.registerMessageHandler("LDT",((X,ie)=>this._getDEMWorkerSource(X,ie.source).loadTile(ie))),this.actor.registerMessageHandler("RDT",((X,ie)=>T._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(X,ie.source).removeTile(ie)})))),this.actor.registerMessageHandler("GCEZ",((X,ie)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,ie.type,ie.source).getClusterExpansionZoom(ie)})))),this.actor.registerMessageHandler("GCC",((X,ie)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,ie.type,ie.source).getClusterChildren(ie)})))),this.actor.registerMessageHandler("GCL",((X,ie)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(X,ie.type,ie.source).getClusterLeaves(ie)})))),this.actor.registerMessageHandler("LD",((X,ie)=>this._getWorkerSource(X,ie.type,ie.source).loadData(ie))),this.actor.registerMessageHandler("GD",((X,ie)=>this._getWorkerSource(X,ie.type,ie.source).getData())),this.actor.registerMessageHandler("LT",((X,ie)=>this._getWorkerSource(X,ie.type,ie.source).loadTile(ie))),this.actor.registerMessageHandler("RT",((X,ie)=>this._getWorkerSource(X,ie.type,ie.source).reloadTile(ie))),this.actor.registerMessageHandler("AT",((X,ie)=>this._getWorkerSource(X,ie.type,ie.source).abortTile(ie))),this.actor.registerMessageHandler("RMT",((X,ie)=>this._getWorkerSource(X,ie.type,ie.source).removeTile(ie))),this.actor.registerMessageHandler("RS",((X,ie)=>T._(this,void 0,void 0,(function*(){if(!this.workerSources[X]||!this.workerSources[X][ie.type]||!this.workerSources[X][ie.type][ie.source])return;const be=this.workerSources[X][ie.type][ie.source];delete this.workerSources[X][ie.type][ie.source],be.removeSource!==void 0&&be.removeSource(ie)})))),this.actor.registerMessageHandler("RM",(X=>T._(this,void 0,void 0,(function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],this.globalStates.delete(X)})))),this.actor.registerMessageHandler("SR",((X,ie)=>T._(this,void 0,void 0,(function*(){this.referrer=ie})))),this.actor.registerMessageHandler("SRPS",((X,ie)=>this._syncRTLPluginState(X,ie))),this.actor.registerMessageHandler("IS",((X,ie)=>T._(this,void 0,void 0,(function*(){this.self.importScripts(ie)})))),this.actor.registerMessageHandler("SI",((X,ie)=>this._setImages(X,ie))),this.actor.registerMessageHandler("UL",((X,ie)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(X).update(ie.layers,ie.removedIds,this._getGlobalState(X))})))),this.actor.registerMessageHandler("UGS",((X,ie)=>T._(this,void 0,void 0,(function*(){const be=this._getGlobalState(X);for(const ve in ie)be[ve]=ie[ve]})))),this.actor.registerMessageHandler("SL",((X,ie)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(X).replace(ie,this._getGlobalState(X))}))))}_getGlobalState(Y){let X=this.globalStates.get(Y);return X||(X={},this.globalStates.set(Y,X)),X}_setImages(Y,X){return T._(this,void 0,void 0,(function*(){this.availableImages[Y]=X;for(const ie in this.workerSources[Y]){const be=this.workerSources[Y][ie];for(const ve in be)be[ve].availableImages=X}}))}_syncRTLPluginState(Y,X){return T._(this,void 0,void 0,(function*(){return yield T.d4.syncState(X,this.self.importScripts)}))}_getAvailableImages(Y){let X=this.availableImages[Y];return X||(X=[]),X}_getLayerIndex(Y){let X=this.layerIndexes[Y];return X||(X=this.layerIndexes[Y]=new c),X}_getWorkerSource(Y,X,ie){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][X]||(this.workerSources[Y][X]={}),!this.workerSources[Y][X][ie]){const be={sendAsync:(ve,Le)=>(ve.targetMapId=Y,this.actor.sendAsync(ve,Le))};switch(X){case"vector":this.workerSources[Y][X][ie]=new H(be,this._getLayerIndex(Y),this._getAvailableImages(Y));break;case"geojson":this.workerSources[Y][X][ie]=new _o(be,this._getLayerIndex(Y),this._getAvailableImages(Y));break;default:this.workerSources[Y][X][ie]=new this.externalWorkerSourceTypes[X](be,this._getLayerIndex(Y),this._getAvailableImages(Y))}}return this.workerSources[Y][X][ie]}_getDEMWorkerSource(Y,X){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][X]||(this.demWorkerSources[Y][X]=new Ze),this.demWorkerSources[Y][X]}}return T.i(self)&&(self.worker=new _n(self)),_n})),I("index",["exports","./shared"],(function(T,c){var V="5.15.0";function W(){var m=new c.A(4);return c.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let se,ee,ne;const ke={frame(m,t,n){const l=requestAnimationFrame((g=>{h(),t(g)})),{unsubscribe:h}=c.s(m.signal,"abort",(()=>{h(),cancelAnimationFrame(l),n(new c.a(m.signal.reason))}),!1)},frameAsync(m){return new Promise(((t,n)=>{this.frame(m,t,n)}))},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,n.drawImage(m,0,0,m.width,m.height),n},resolveURL:m=>(se||(se=document.createElement("a")),se.href=m,se.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ne!==void 0?ne:!!matchMedia&&(ee==null&&(ee=matchMedia("(prefers-reduced-motion: reduce)")),ee.matches)},set prefersReducedMotion(m){ne=m}},je=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function re(){return je.getCurrentTime()}class H{static testProp(t){if(!H.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in H.docStyle)return t[n];return t[0]}static create(t,n,l){const h=window.document.createElement(t);return n!==void 0&&(h.className=n),l&&l.appendChild(h),h}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){H.docStyle&&H.selectProp&&(H.userSelect=H.docStyle[H.selectProp],H.docStyle[H.selectProp]="none")}static enableDrag(){H.docStyle&&H.selectProp&&(H.docStyle[H.selectProp]=H.userSelect)}static setTransform(t,n){t.style[H.transformProp]=n}static addEventListener(t,n,l,h={}){t.addEventListener(n,l,"passive"in h?h:h.capture)}static removeEventListener(t,n,l,h={}){t.removeEventListener(n,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",H.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",H.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",H.suppressClickInternal,!0)}),0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,l){const h=n.boundingClientRect;return new c.P((l.clientX-h.left)/n.x-t.clientLeft,(l.clientY-h.top)/n.y-t.clientTop)}static mousePos(t,n){const l=H.getScale(t);return H.getPoint(t,l,n)}static touchPos(t,n){const l=[],h=H.getScale(t);for(let g=0;g<n.length;g++)l.push(H.getPoint(t,h,n[g]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const n=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=n.querySelectorAll("script");for(const h of l)h.remove();return H.clean(n),n.innerHTML}static isPossiblyDangerous(t,n){const l=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const n=t.children;for(const l of n)H.removeAttributes(l),H.clean(l)}static removeAttributes(t){for(const{name:n,value:l}of t.attributes)H.isPossiblyDangerous(n,l)&&t.removeAttribute(n)}}H.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,H.selectProp=H.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),H.transformProp=H.testProp(["transform","WebkitTransform"]);const Ze={supported:!1,testSupport:function(m){!lt&&ze&&(Nt?zt(m):Pe=m)}};let Pe,ze,lt=!1,Nt=!1;function zt(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,ze),m.isContextLost())return;Ze.supported=!0}catch{}m.deleteTexture(t),lt=!0}var Ft;typeof document<"u"&&(ze=document.createElement("img"),ze.onload=()=>{Pe&&zt(Pe),Pe=null,Nt=!0},ze.onerror=()=>{lt=!0,Pe=null},ze.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let t,n,l,h;m.resetRequestQueue=()=>{t=[],n=0,l=0,h={}},m.addThrottleControl=E=>{const M=l++;return h[M]=E,M},m.removeThrottleControl=E=>{delete h[E],_()},m.getImage=(E,M,D=!0)=>new Promise((($,B)=>{Ze.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),c.e(E,{type:"image"}),t.push({abortController:M,requestParameters:E,supportImageRefresh:D,state:"queued",onError:G=>{B(G)},onSuccess:G=>{$(G)}}),_()}));const g=E=>c._(this,void 0,void 0,(function*(){E.state="running";const{requestParameters:M,supportImageRefresh:D,onError:$,onSuccess:B,abortController:G}=E,J=D===!1&&!c.i(self)&&!c.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce(((ce,de)=>ce&&de==="accept"),!0));n++;const le=J?j(M,G):c.m(M,G);try{const ce=yield le;delete E.abortController,E.state="completed",ce.data instanceof HTMLImageElement||c.b(ce.data)?B(ce):ce.data&&B({data:yield(ue=ce.data,typeof createImageBitmap=="function"?c.f(ue):c.h(ue)),cacheControl:ce.cacheControl,expires:ce.expires})}catch(ce){delete E.abortController,$(ce)}finally{n--,_()}var ue})),_=()=>{const E=(()=>{for(const M of Object.keys(h))if(h[M]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=n;M<E&&t.length>0;M++){const D=t.shift();D.abortController.signal.aborted?M--:g(D)}},j=(E,M)=>new Promise(((D,$)=>{const B=new Image,G=E.url,J=E.credentials;J&&J==="include"?B.crossOrigin="use-credentials":(J&&J==="same-origin"||!c.d(G))&&(B.crossOrigin="anonymous"),M.signal.addEventListener("abort",(()=>{B.src="",$(new c.a(M.signal.reason))})),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,D({data:B})},B.onerror=()=>{B.onerror=B.onload=null,M.signal.aborted||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=G}))})(Ft||(Ft={})),Ft.resetRequestQueue();class Vt{constructor(t){this._transformRequestFn=t??null}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Zt(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const n=[];for(const{id:l,url:h}of m){const g=`${l}${h}`;n.indexOf(g)===-1&&(n.push(g),t.push({id:l,url:h}))}}return t}function mt(m,t,n){try{const l=new URL(m);return l.pathname+=`${t}${n}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function fr(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class Kt extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:l}of this.requestors)l(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new c.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let l=!0;const h=n.data||n.spriteData;return this._validateStretch(n.stretchX,h&&h.width)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,h&&h.height)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,n){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||n<h[1])return!1;l=h[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const l=n.spriteData,h=l&&l.width||n.data.width,g=l&&l.height||n.data.height;return!(t[0]<0||h<t[0]||t[1]<0||g<t[1]||t[2]<0||h<t[2]||t[3]<0||g<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==n.data.width||h.data.height!==n.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=h.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((n,l)=>{let h=!0;if(!this.isLoaded())for(const g of t)this.images[g]||(h=!1);this.isLoaded()||h?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})}))}_getImagesForIds(t){const n={};for(const l of t){let h=this.getImage(l);h||(this.fire(new c.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?n[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:c.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],l=this.getImage(t);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new c.I(h,l);this.patterns[t]={bin:h,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:n,h:l}=c.p(t),h=this.atlasImage;h.resize({width:n||1,height:l||1});for(const g in this.patterns){const{bin:_}=this.patterns[g],j=_.x+1,E=_.y+1,M=this.getImage(g).data,D=M.width,$=M.height;c.R.copy(M,h,{x:0,y:0},{x:j,y:E},{width:D,height:$}),c.R.copy(M,h,{x:0,y:$-1},{x:j,y:E-1},{width:D,height:1}),c.R.copy(M,h,{x:0,y:0},{x:j,y:E+$},{width:D,height:1}),c.R.copy(M,h,{x:D-1,y:0},{x:j-1,y:E},{width:1,height:$}),c.R.copy(M,h,{x:0,y:0},{x:j+D,y:E},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||c.w(`Image with ID: "${n}" was not found`),fr(l)&&this.updateImage(n,l)}}cloneImages(){const t={};for(const n in this.images){const l=this.images[n];t[n]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const Wt=1e20;function Me(m,t,n,l,h,g,_,j,E){for(let M=t;M<t+l;M++)Ct(m,n*g+M,g,h,_,j,E);for(let M=n;M<n+h;M++)Ct(m,M*g+t,1,l,_,j,E)}function Ct(m,t,n,l,h,g,_){g[0]=0,_[0]=-Wt,_[1]=Wt,h[0]=m[t];for(let j=1,E=0,M=0;j<l;j++){h[j]=m[t+j*n];const D=j*j;do{const $=g[E];M=(h[j]-h[$]+D-$*$)/(j-$)/2}while(M<=_[E]&&--E>-1);E++,g[E]=j,_[E]=M,_[E+1]=Wt}for(let j=0,E=0;j<l;j++){for(;_[E+1]<j;)E++;const M=g[E],D=j-M;m[t+j*n]=h[M]+D*D}}const it=c.v.layout_symbol["text-font"].default.join(",");class Tt{constructor(t,n,l){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return c._(this,void 0,void 0,(function*(){const n=[];for(const g in t)for(const _ of t[g])n.push(this._getAndCacheGlyphsPromise(g,_));const l=yield Promise.all(n),h={};for(const{stack:g,id:_,glyph:j}of l)h[g]||(h[g]={}),h[g][_]=j&&{id:j.id,bitmap:j.bitmap.clone(),metrics:j.metrics};return h}))}_getAndCacheGlyphsPromise(t,n){return c._(this,void 0,void 0,(function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[n];return h!==void 0?{stack:t,id:n,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(n)?(h=l.glyphs[n]=this._drawGlyph(l,t,n),{stack:t,id:n,glyph:h}):yield this._downloadAndCacheRangePromise(t,n)}))}_downloadAndCacheRangePromise(t,n){return c._(this,void 0,void 0,(function*(){const l=this.entries[t],h=Math.floor(n/256);if(l.ranges[h])return{stack:t,id:n,glyph:null};if(!l.requests[h]){const g=Tt.loadGlyphRange(t,h,this.url,this.requestManager);l.requests[h]=g}try{const g=yield l.requests[h];for(const _ in g)l.glyphs[+_]=g[+_];return l.ranges[h]=!0,{stack:t,id:n,glyph:g[n]||null}}catch(g){const _=l.glyphs[n]=this._drawGlyph(l,t,n);return this._warnOnMissingGlyphRange(_,h,n,g),{stack:t,id:n,glyph:_}}}))}_warnOnMissingGlyphRange(t,n,l,h){const g=256*n,_=g+255,j=l.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${n}, ${g}-${_}. Rendering codepoint U+${j} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&c.q(t)}_drawGlyph(t,n,l){const h=n===it&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),g=h?"ideographTinySDF":"tinySDF";t[g]||(t[g]=this._createTinySDF(h?this.localIdeographFontFamily:n));const _=t[g].draw(String.fromCodePoint(l));return{id:l,bitmap:new c.r({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const n=t?t.split(","):[];n.push("sans-serif");const l=n.map((h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`)).join(",");return new Tt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(n[0]),fontStyle:this._fontStyle(n[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const n={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,g]of Object.entries(n))new RegExp(`\\b${h}\\b`,"i").test(t)&&(l=`${g}`);return l}destroy(){for(const t in this.entries){const n=this.entries[t];n.tinySDF&&(n.tinySDF=null),n.ideographTinySDF&&(n.ideographTinySDF=null),n.glyphs={},n.requests={},n.ranges={}}this.entries={}}}Tt.loadGlyphRange=function(m,t,n,l){return c._(this,void 0,void 0,(function*(){const h=256*t,g=h+255,_=l.transformRequest(n.replace("{fontstack}",m).replace("{range}",`${h}-${g}`),"Glyphs"),j=yield c.n(_,new AbortController);if(!j||!j.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${g}`);const E={};for(const M of c.o(j.data))E[M.id]=M;return E}))},Tt.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:n=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:_="normal",lang:j=null}={}){this.buffer=t,this.cutoff=l,this.radius=n,this.lang=j;const E=this.size=m+4*t,M=this._createCanvas(E),D=this.ctx=M.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${g} ${m}px ${h}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(m),_=Math.ceil(n),j=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),E=Math.min(this.size-this.buffer,_+Math.ceil(l)),M=j+2*this.buffer,D=E+2*this.buffer,$=Math.max(M*D,0),B=new Uint8ClampedArray($),G={data:B,width:M,height:D,glyphWidth:j,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:t};if(j===0||E===0)return G;const{ctx:J,buffer:le,gridInner:ue,gridOuter:ce}=this;this.lang&&(J.lang=this.lang),J.clearRect(le,le,j,E),J.fillText(m,le,le+_);const de=J.getImageData(le,le,j,E);ce.fill(Wt,0,$),ue.fill(0,0,$);for(let xe=0;xe<E;xe++)for(let he=0;he<j;he++){const ge=de.data[4*(xe*j+he)+3]/255;if(ge===0)continue;const we=(xe+le)*M+he+le;if(ge===1)ce[we]=0,ue[we]=Wt;else{const me=.5-ge;ce[we]=me>0?me*me:0,ue[we]=me<0?me*me:0}}Me(ce,0,0,M,D,M,this.f,this.v,this.z),Me(ue,le,le,j,E,M,this.f,this.v,this.z);for(let xe=0;xe<$;xe++){const he=Math.sqrt(ce[xe])-Math.sqrt(ue[xe]);B[xe]=Math.round(255-255*(he/this.radius+this.cutoff))}return G}};class nt{constructor(){this.specification=c.u.light.position}possiblyEvaluate(t,n){return c.F(t.expression.evaluate(n))}interpolate(t,n,l){return{x:c.G.number(t.x,n.x,l),y:c.G.number(t.y,n.y,l),z:c.G.number(t.z,n.z,l)}}}let ht;class pt extends c.E{constructor(t){super(),ht=ht||new c.t({anchor:new c.D(c.u.light.anchor),position:new nt,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(ht,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(c.y,t,n))for(const l in t){const h=t[l];l.endsWith(c.z)?this._transitionable.setTransition(l.slice(0,-c.z.length),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,l){return(!l||l.validate!==!1)&&c.B(this,t.call(c.C,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const Ce=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class Ye extends c.E{constructor(t){super(),this._transitionable=new c.x(Ce,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(t,n={}){if(!this._validate(c.J,t,n)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const h=t[l];l.endsWith(c.z)?this._transitionable.setTransition(l.slice(0,-c.z.length),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,l={}){return l?.validate!==!1&&c.B(this,t.call(c.C,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class qt{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const l=t.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,n)),this.dashEntry[l]}getDashRanges(t,n,l){const h=[];let g=t.length%2==1?-t[t.length-1]*l:0,_=t[0]*l,j=!0;h.push({left:g,right:_,isDash:j,zeroLength:t[0]===0});let E=t[0];for(let M=1;M<t.length;M++){j=!j;const D=t[M];g=E*l,E+=D,_=E*l,h.push({left:g,right:_,isDash:j,zeroLength:D===0})}return h}addRoundDash(t,n,l){const h=n/2;for(let g=-l;g<=l;g++){const _=this.width*(this.nextRow+l+g);let j=0,E=t[j];for(let M=0;M<this.width;M++){M/E.right>1&&(E=t[++j]);const D=Math.abs(M-E.left),$=Math.abs(M-E.right),B=Math.min(D,$);let G;const J=g/l*(h+1);if(E.isDash){const le=h-Math.abs(J);G=Math.sqrt(B*B+le*le)}else G=h-Math.sqrt(B*B+J*J);this.data[_+M]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(t){for(let j=t.length-1;j>=0;--j){const E=t[j],M=t[j+1];E.zeroLength?t.splice(j,1):M&&M.isDash===E.isDash&&(M.left=E.left,t.splice(j,1))}const n=t[0],l=t[t.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const h=this.width*this.nextRow;let g=0,_=t[g];for(let j=0;j<this.width;j++){j/_.right>1&&(_=t[++g]);const E=Math.abs(j-_.left),M=Math.abs(j-_.right),D=Math.min(E,M);this.data[h+j]=Math.max(0,Math.min(255,(_.isDash?D:-D)+128))}}addDash(t,n){const l=n?7:0,h=2*l+1;if(this.nextRow+h>this.height)return c.w("LineAtlas out of space"),null;let g=0;for(let j=0;j<t.length;j++)g+=t[j];if(g!==0){const j=this.width/g,E=this.getDashRanges(t,this.width,j);n?this.addRoundDash(E,j,l):this.addRegularDash(E)}const _={y:this.nextRow+l,height:2*l,width:g};return this.nextRow+=h,this.dirty=!0,_}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Yt="maplibre_preloaded_worker_pool";class wt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((n=>{n.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Yt]}numActive(){return Object.keys(this.active).length}}const Ht=Math.floor(ke.hardwareConcurrency/2);let At,er;function Sr(){return At||(At=new wt),At}wt.workerCount=c.K(globalThis)?Math.max(Math.min(Ht,3),1):1;class Jr{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const l=this.workerPool.acquire(n);for(let h=0;h<l.length;h++){const g=new c.L(l[h],n);g.name=`Worker ${h}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:n}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((n=>{n.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const l of this.actors)l.registerMessageHandler(t,n)}unregisterMessageHandler(t){for(const n of this.actors)n.unregisterMessageHandler(t)}}function _a(){return er||(er=new Jr(Sr(),c.M),er.registerMessageHandler("GR",((m,t,n)=>c.m(t,n)))),er}function Qn(m,t){const n=c.N();return c.O(n,n,[1,1,0]),c.Q(n,n,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?c.S(n,n,m.calculatePosMatrix(t.toUnwrapped())):n}function Oi(m,t,n,l,h,g,_){var j;const E=(function(B,G,J){if(B)for(const le of B){const ue=G[le];if(ue&&ue.source===J&&ue.type==="fill-extrusion")return!0}else for(const le in G){const ue=G[le];if(ue.source===J&&ue.type==="fill-extrusion")return!0}return!1})((j=h?.layers)!==null&&j!==void 0?j:null,t,m.id),M=g.maxPitchScaleFactor(),D=m.tilesIn(l,M,E);D.sort(Cs);const $=[];for(const B of D)$.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(t,n,m.getState(),B.queryGeometry,B.cameraQueryGeometry,B.scale,h,g,M,Qn(g,B.tileID),_?(G,J)=>_(B.tileID,G,J):void 0)});return(function(B,G){for(const J in B)for(const le of B[J])Gn(le,G);return B})((function(B){const G={},J={};for(const le of B){const ue=le.queryResults,ce=le.wrappedTileID,de=J[ce]=J[ce]||{};for(const xe in ue){const he=ue[xe],ge=de[xe]=de[xe]||{},we=G[xe]=G[xe]||[];for(const me of he)ge[me.featureIndex]||(ge[me.featureIndex]=!0,we.push(me))}}return G})($),m)}function Cs(m,t){const n=m.tileID,l=t.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}function Gn(m,t){const n=m.feature,l=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=l}function ba(m,t,n){return c._(this,void 0,void 0,(function*(){let l=m;if(m.url?l=(yield c.j(t.transformRequest(m.url,"Source"),n)).data:yield ke.frameAsync(n),!l)return null;const h=c.U(c.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map((g=>g.id))),h}))}class as{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}extend(t){const n=this._sw,l=this._ne;let h,g;if(t instanceof c.V)h=t,g=t;else{if(!(t instanceof as))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(as.convert(t)):this.extend(c.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.V.convert(t)):this;if(h=t._sw,g=t._ne,!h||!g)return this}return n||l?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new c.V(h.lng,h.lat),this._ne=new c.V(g.lng,g.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:l}=c.V.convert(t);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(t){if(!((t=as.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const n=Math.abs(this.getEast()-this.getWest()),l=Math.abs(t.getEast()-t.getWest());if(n>=360||l>=360)return!0;const h=c.W(this.getWest(),-180,180),g=c.W(this.getEast(),-180,180),_=c.W(t.getWest(),-180,180),j=c.W(t.getEast(),-180,180),E=h>=g,M=_>=j;return!(!E||!M)||(E?j>=h||_<=g:M?g>=_||h<=j:_<=g&&j>=h)}static convert(t){return t instanceof as?t:t&&new as(t)}static fromLngLat(t,n=0){const l=360*n/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new as(new c.V(t.lng-h,t.lat-l),new c.V(t.lng+h,t.lat+l))}adjustAntiMeridian(){const t=new c.V(this._sw.lng,this._sw.lat),n=new c.V(this._ne.lng,this._ne.lat);return new as(t,t.lng>n.lng?new c.V(n.lng+360,n.lat):n)}}class fi{constructor(t,n,l){this.bounds=as.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),l=Math.floor(c.Y(this.bounds.getWest())*n),h=Math.floor(c.X(this.bounds.getNorth())*n),g=Math.ceil(c.Y(this.bounds.getEast())*n),_=Math.ceil(c.X(this.bounds.getSouth())*n);return t.x>=l&&t.x<g&&t.y>=h&&t.y<_}}class mi extends c.E{constructor(t,n,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(n,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ba(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(c.e(this,t),t.bounds&&(this.tileBounds=new fi(t.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,c.Z(t)||this.fire(new c.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(t){return c._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(n,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((g,_)=>{t.reloadPromise={resolve:g,reject:_}}))}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const g=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,g)}catch(g){if(delete t.abortController,t.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const n=t.tileID.scaledTo(this.maxzoom).canonical,l=n.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:n,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Oa extends c.E{constructor(t,n,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.U(n,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield ba(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(c.e(this,n),n.bounds&&(this.tileBounds=new fi(n.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(n){this._tileJSONRequest=null,this._loaded=!0,c.Z(n)||this.fire(new c.k(n))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return c._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield Ft.getImage(this.map._requestManager.transformRequest(n,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,g=h.gl,_=l.data;t.texture=this.map.painter.getTileTexture(_.width),t.texture?t.texture.update(_,{useMipmap:!0}):(t.texture=new c.T(h,_,g.RGBA,{useMipmap:!0}),t.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Zn extends Oa{constructor(t,n,l,h){super(t,n,l,h),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return c._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(n,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield Ft.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const g=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const _=c.b(g)&&c.$()?g:yield this.readImageNow(g),j={type:this.type,uid:t.uid,source:this.id,rawImageData:_,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const E=yield t.actor.sendAsync({type:"LDT",data:j});t.dem=E,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}}))}readImageNow(t){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.a0()){const n=t.width+2,l=t.height+2;try{return new c.R({width:n,height:l},yield c.a1(t,-1,-1,n,l))}catch{}}return ke.getImageData(t,1)}))}_getNeighboringTiles(t){const n=t.canonical,l=Math.pow(2,n.z),h=(n.x-1+l)%l,g=n.x===0?t.wrap-1:t.wrap,_=(n.x+1+l)%l,j=n.x+1===l?t.wrap+1:t.wrap,E={};return E[new c.a2(t.overscaledZ,g,n.z,h,n.y).key]={backfilled:!1},E[new c.a2(t.overscaledZ,j,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(E[new c.a2(t.overscaledZ,g,n.z,h,n.y-1).key]={backfilled:!1},E[new c.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new c.a2(t.overscaledZ,j,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<l&&(E[new c.a2(t.overscaledZ,g,n.z,h,n.y+1).key]={backfilled:!1},E[new c.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new c.a2(t.overscaledZ,j,n.z,_,n.y+1).key]={backfilled:!1}),E}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Hn(m){return m.type==="GeometryCollection"?m.geometries.map((t=>t.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function _o(m){const t=new as;let n;switch(m.type){case"FeatureCollection":n=m.features.map((l=>Hn(l.geometry))).flat(1/0);break;case"Feature":n=Hn(m.geometry);break;default:n=Hn(m)}if(n.length==0)return t;for(let l=0;l<n.length-1;l+=2)t.extend([n[l],n[l+1]]);return t}class bo extends c.E{constructor(t,n,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=typeof n.data=="string"?{url:n.data}:{geojson:n.data},this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(c.a5/this.tileSize)}_getClusterMaxZoom(t){const n=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${n}"`),n}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,n){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return n?l:this}updateData(t,n){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return n?l:this}getData(){return c._(this,void 0,void 0,(function*(){const t=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return c._(this,void 0,void 0,(function*(){return _o(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:l}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:n}=this._pendingWorkerUpdate,l=c.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(ke.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):n&&(l.dataDiff=n,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));h.data&&(this._data={geojson:h.data});const g=this._applyDiffToSource(n),_=this._getShouldReloadTileOptions(g);let j=null;h.resourceTiming&&h.resourceTiming[this.id]&&(j=h.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&j&&j.length>0&&c.e(E,{resourceTiming:j}),this.fire(new c.l("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},E),{sourceDataType:"content",shouldReloadTileOptions:_})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const n=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const h=c.a7(this._data.geojson,n);if(!h)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:h}}if(!this._data.updateable)return;const l=c.a8(this._data.updateable,t,n);return t.removeAll||this._options.cluster?void 0:l}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((n=>_o(n)))}}shouldReloadTile(t,{affectedBounds:n}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:l,extent:h}=this.workerOptions.geojsonVtOptions,g=(function({x:_,y:j,z:E},M=0){const D=c.a3((_-M)/Math.pow(2,E)),$=c.a4((j+1+M)/Math.pow(2,E)),B=c.a3((_+1+M)/Math.pow(2,E)),G=c.a4((j-M)/Math.pow(2,E));return new as([D,$],[B,G])})(t.tileID.canonical,l/h);for(const _ of n)if(g.intersects(_))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return c._(this,void 0,void 0,(function*(){const n=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:n,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,n==="RT")}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class _n extends c.E{constructor(t,n,l,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=n}load(t){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Ft.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,c.Z(n)||this.fire(new c.k(n))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(c.a9.fromLngLat);var l;return this.tileID=(function(h){const g=c.aa.fromPoints(h),_=g.width(),j=g.height(),E=Math.max(_,j),M=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),D=Math.pow(2,M);return new c.ac(M,Math.floor((g.minX+g.maxX)/2*D),Math.floor((g.minY+g.maxY)/2*D))})(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.texture||(this.texture=new c.T(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:n,minY:l,maxX:h,maxY:g}=c.aa.fromPoints(t),_={};for(let j=0;j<=c.ab;j++){const E=Math.pow(2,j),M=Math.floor(n*E),D=Math.floor(l*E),$=Math.floor(h*E),B=Math.floor(g*E);_[j]={minTileX:M,minTileY:D,maxTileX:$,maxTileY:B}}return _}}class Ae extends _n{constructor(t,n,l,h){super(t,n,l,h),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.ad(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.k(n))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new c.k(new c.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const g=this.tiles[h];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Y extends _n{constructor(t,n,l,h){super(t,n,l,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((_=>typeof _!="number"))))||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.k(new c.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,l=n.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(n,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let h=!1;for(const g in this.tiles){const _=this.tiles[g];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const X={},ie=m=>{switch(m){case"geojson":return bo;case"image":return _n;case"raster":return Oa;case"raster-dem":return Zn;case"vector":return mi;case"video":return Ae;case"canvas":return Y}return X[m]},be="RTLPluginLoaded";class ve extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=_a()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((n=>{throw this.status="error",n}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return c._(this,arguments,void 0,(function*(n,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ke.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(be))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Le=null;function Ie(){return Le||(Le=new ve),Le}var Se,$e;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(Se||(Se={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})($e||($e={}));class rt{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=c.af(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:n,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=n,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=re(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(h,g){const _={};if(!g)return _;for(const j of h){const E=j.layerIds.map((M=>g.getLayer(M))).filter(Boolean);if(E.length!==0){j.layers=E,j.stateDependentLayerIds&&(j.stateDependentLayers=j.stateDependentLayerIds.map((M=>E.filter((D=>D.id===M))[0])));for(const M of E)_[M.id]=j}}return _})(t.buckets,n?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof c.ah){if(this.hasSymbolBuckets=!0,!l)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof c.ah&&g.hasRTLText){this.hasRTLText=!0,Ie().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new c.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,l,h,g,_,j,E,M,D,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:_,tileSize:this.tileSize,pixelPosMatrix:D,transform:E,params:j,queryPadding:this.queryPadding*M,getElevation:$},t,n,l):{}}querySourceFeatures(t,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),g=n&&n.sourceLayer?n.sourceLayer:"",_=h[c.ai]||h[g];if(!_)return;const j=c.aj(n?.filter,n?.globalState),{z:E,x:M,y:D}=this.tileID.canonical,$={z:E,x:M,y:D};for(let B=0;B<_.length;B++){const G=_.feature(B);if(j.needGeometry){const ue=c.ak(G,!0);if(!j.filter(new c.H(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!j.filter(new c.H(this.tileID.overscaledZ),G))continue;const J=l.getId(G,g),le=new c.al(G,E,M,D,J);le.tile=$,t.push(le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const l=c.am(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const g=this.expirationTime-n;g?this.expirationTime=l+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const g=this.buckets[h],_=g.layers[0].sourceLayer||c.ai,j=l[_],E=t[_];if(!j||!E||Object.keys(E).length===0)continue;g.update(E,j,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const M=n&&n.style&&n.style.getLayer(h);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(g)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<re()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=re()+t}setDependencies(t,n){const l={};for(const h of n)l[h]=!0;this.dependencies[t]=l}hasDependency(t,n){for(const l of t){const h=this.dependencies[l];if(h){for(const g of n)if(h[g])return!0}}return!1}}class Qe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,l){const h=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},c.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==h&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const g in this.state[t][h])l[g]||(this.deletedStates[t][h][g]=null)}else for(const g in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][g]===null&&delete this.deletedStates[t][h][g]}removeFeatureState(t,n,l){if(this.deletedStates[t]===null)return;const h=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&n!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,n){const l=String(n),h=c.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][n];if(g===null)return{};for(const _ in g)delete h[_]}return h}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),c.e(this.state[h][_],this.stateChanges[h][_]),g[_]=this.state[h][_];l[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(this.deletedStates[h]===null)for(const _ in this.state[h])g[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(this.deletedStates[h][_]===null)this.state[h][_]={};else for(const j of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][j];g[_]=this.state[h][_]}l[h]=l[h]||{},c.e(l[h],g)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,n)}}const kt=89.25;function It(m,t){const n=c.an(t.lat,-c.ao,c.ao);return new c.P(c.Y(t.lng)*m,c.X(n)*m)}function Jt(m,t){return new c.a9(t.x/m,t.y/m).toLngLat()}function wr(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(c.ap(90-m.pitch)),Math.tan(c.ap(kt-m.pitch)))}function xr(m,t){const n=m.canonical,l=t/c.aq(n.z),h=n.x+Math.pow(2,n.z)*m.wrap,g=c.ar(new Float64Array(16));return c.O(g,g,[h*l,n.y*l,0]),c.Q(g,g,[l/c.a5,l/c.a5,1]),g}function Fe(m,t,n,l,h){const g=c.a9.fromLngLat(m,t),_=h*c.as(1,m.lat),{x:j,y:E,z:M}=Or(n,l);return new c.a9(g.x+_*-j,g.y+_*-E,g.z+_*-M)}function Or(m,t){const n=c.ap(m),l=c.ap(t),h=Math.cos(-n),g=Math.sin(n);return{x:g*Math.sin(l),y:-g*Math.cos(l),z:h}}function $s(m,t,n){const l=t.intersectsFrustum(m);if(!n||l===0)return l;const h=t.intersectsPlane(n);return h===0?0:l===2&&h===2?2:1}function tr(m,t,n){let l=0;const h=(n-t)/10;for(let g=0;g<10;g++)l+=h*Math.pow(Math.cos(t+(g+.5)/10*(n-t)),m);return l}function Mr(m,t){return function(n,l,h,g,_){const j=2*((m-1)/c.at(Math.cos(c.ap(kt-_))/Math.cos(c.ap(kt)))-1),E=Math.acos(h/g),M=2*tr(j-1,0,c.ap(_/2)),D=Math.min(c.ap(kt),E+c.ap(_/2)),$=tr(j-1,Math.min(D,E-c.ap(_/2)),D),B=Math.atan(l/h),G=Math.hypot(l,h);let J=n;return J+=c.at(g/G/Math.max(.5,Math.cos(c.ap(_/2)))),J+=j*c.at(Math.cos(B))/2,J-=c.at(Math.max(1,$/M/t))/2,J}}const Rs=Mr(9.314,3);function Gr(m,t){const n=(t.roundZoom?Math.round:Math.floor)(m.zoom+c.at(m.tileSize/t.tileSize));return Math.max(0,n)}function Zr(m,t){const n=m.getCameraFrustum(),l=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=c.a9.fromLngLat(m.center,m.elevation);h.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const _=m.getCoveringTilesDetailsProvider(),j=_.allowVariableZoom(m,t),E=Gr(m,t),M=t.minzoom||0,D=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,$=Math.min(Math.max(0,E),D),B=Math.pow(2,$),G=[B*h.x,B*h.y,0],J=[B*g.x,B*g.y,0],le=Math.hypot(g.x-h.x,g.y-h.y),ue=Math.abs(g.z-h.z),ce=Math.hypot(le,ue),de=ge=>({zoom:0,x:0,y:0,wrap:ge,fullyVisible:!1}),xe=[],he=[];if(m.renderWorldCopies&&_.allowWorldCopies())for(let ge=1;ge<=3;ge++)xe.push(de(-ge)),xe.push(de(ge));for(xe.push(de(0));xe.length>0;){const ge=xe.pop(),we=ge.x,me=ge.y;let Ne=ge.fullyVisible;const Ue={x:we,y:me,z:ge.zoom},Re=_.getTileBoundingVolume(Ue,ge.wrap,m.elevation,t);if(!Ne){const ct=$s(n,Re,l);if(ct===0)continue;Ne=ct===2}const Oe=_.distanceToTile2d(h.x,h.y,Ue,Re);let Be=E;j&&(Be=(t.calculateTileZoom||Rs)(m.zoom+c.at(m.tileSize/t.tileSize),Oe,ue,ce,m.fov)),Be=(t.roundZoom?Math.round:Math.floor)(Be),Be=Math.max(0,Be);const ot=Math.min(Be,D);if(ge.wrap=_.getWrap(g,Ue,ge.wrap),ge.zoom>=ot){if(ge.zoom<M)continue;const ct=$-ge.zoom,et=G[0]-.5-(we<<ct),xt=G[1]-.5-(me<<ct),rr=t.reparseOverscaled?Math.max(ge.zoom,Be):ge.zoom;he.push({tileID:new c.a2(ge.zoom===D?rr:ge.zoom,ge.wrap,ge.zoom,we,me),distanceSq:c.au([J[0]-.5-we,J[1]-.5-me]),tileDistanceToCamera:Math.sqrt(et*et+xt*xt)})}else for(let ct=0;ct<4;ct++)xe.push({zoom:ge.zoom+1,x:(we<<1)+ct%2,y:(me<<1)+(ct>>1),wrap:ge.wrap,fullyVisible:Ne})}return he.sort(((ge,we)=>ge.distanceSq-we.distanceSq)).map((ge=>ge.tileID))}const Dr=c.aa.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function ps(m){return m==="raster"||m==="image"||m==="video"}function sc(m,t,n,l,h,g,_){if(!t.hasData())return!1;const{tileID:j,fadingRole:E,fadingDirection:M,fadingParentID:D}=t;if(E===Se.Base&&M===$e.Incoming&&D)return n[D.key]=D,!0;const $=Math.max(j.overscaledZ-h,g);for(let B=j.overscaledZ-1;B>=$;B--){const G=j.scaledTo(B),J=m.getLoadedTile(G);if(J)return t.setCrossFadeLogic({fadingRole:Se.Base,fadingDirection:$e.Incoming,fadingParentID:J.tileID,fadeEndTime:l+_}),J.setCrossFadeLogic({fadingRole:Se.Parent,fadingDirection:$e.Departing,fadeEndTime:l+_}),n[G.key]=G,!0}return!1}function gi(m,t,n,l,h,g){if(!t.hasData())return!1;const _=t.tileID.children(h);let j=at(m,t,_,n,l,h,g);if(j)return!0;for(const E of _)at(m,t,E.children(h),n,l,h,g)&&(j=!0);return j}function at(m,t,n,l,h,g,_){if(n[0].overscaledZ>=g)return!1;let j=!1;for(const E of n){const M=m.getLoadedTile(E);if(!M)continue;const{fadingRole:D,fadingDirection:$,fadingParentID:B}=M;D===Se.Base&&$===$e.Departing&&B||(M.setCrossFadeLogic({fadingRole:Se.Base,fadingDirection:$e.Departing,fadingParentID:t.tileID,fadeEndTime:h+_}),t.setCrossFadeLogic({fadingRole:Se.Parent,fadingDirection:$e.Incoming,fadeEndTime:h+_})),l[E.key]=E,j=!0}return j}function Us(m,t,n,l){const h=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(h)&&(m.setSelfFadeLogic(n+l),!0)}function en(m,t){var n;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-m.tileID.canonical.x;const h=t.tileID.canonical.y-m.tileID.canonical.y,g=Math.pow(2,m.tileID.canonical.z),_=t.tileID.key;l===0&&h===0||Math.abs(h)>1||(Math.abs(l)>1&&(Math.abs(l+g)===1?l+=g:Math.abs(l-g)===1&&(l-=g)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,l,h),!((n=m.neighboringTiles)===null||n===void 0)&&n[_]&&(m.neighboringTiles[_].backfilled=!0)))}class Kc{constructor(){this._tiles={}}handleWrapJump(t){const n={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),n[h.tileID.key]=h}this._tiles=n}setFeatureState(t,n){for(const l in this._tiles)this._tiles[l].setFeatureState(t,n)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((n=>n.tileID)).sort(c.aw).map((n=>n.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,n){this._tiles[t]=n}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const n=this.getTileById(t.key);return n?.hasData()?n:null}isIdRenderable(t,n=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(n)}getRenderableIds(t=0,n){const l=[];for(const h of this.getAllIds())this.isIdRenderable(h,n)&&l.push(this.getTileById(h));return n?l.sort(((h,g)=>{const _=h.tileID,j=g.tileID,E=new c.P(_.canonical.x,_.canonical.y)._rotate(-t),M=new c.P(j.canonical.x,j.canonical.y)._rotate(-t);return _.overscaledZ-j.overscaledZ||M.y-E.y||M.x-E.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(c.aw).map((h=>h.key))}}class ea extends c.E{constructor(t,n,l){super(),this.id=t,this.dispatcher=l,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,g,_,j)=>{const E=new(ie(g.type))(h,g,_,j);if(E.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${E.id}`);return E})(t,n,l,this),this._inViewTiles=new Kc,this._outOfViewCache=new c.ax(0,(h=>this._unloadTile(h))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Qe,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const n of this._inViewTiles.getAllTiles())n.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Kc}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,l){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new c.k(h,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new c.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const n of this._inViewTiles.getAllTiles())n.upload(t),n.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var n;return this._inViewTiles.getRenderableIds((n=this.transform)===null||n===void 0?void 0:n.bearingInRadians,t)}hasRenderableParent(t){const n=t.overscaledZ-1;if(n>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(n));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,n=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(l);n&&!this._source.shouldReloadTile(h,n)||(t?this._reloadTile(l,"expired"):h.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,n){return c._(this,void 0,void 0,(function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=n),yield this._loadTile(l,t,n))}))}_tileLoaded(t,n,l){t.timeAdded=re(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&(function(h,g){var _,j;const E=g.getRenderableIds();for(const M of E){if(!h.neighboringTiles||!h.neighboringTiles[M])continue;const D=g.getTileById(M);h.neighboringTiles[M].backfilled||en(h,D),!((j=(_=D.neighboringTiles)===null||_===void 0?void 0:_[h.tileID.key])===null||j===void 0)&&j.backfilled||en(D,h)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,n){const l=this._getLoadedDescendents(n),h=new Set;for(const g of n){const _=l[g.key];if(!_?.length){h.add(g);continue}const j=g.overscaledZ+ea.maxOverzooming,E=_.filter(($=>$.tileID.overscaledZ<=j));if(!E.length){h.add(g);continue}const M=Math.min(...E.map(($=>$.tileID.overscaledZ))),D=E.filter(($=>$.tileID.overscaledZ===M)).map(($=>$.tileID));for(const $ of D)t[$.key]=$;this._areDescendentsComplete(D,M,g.overscaledZ)||h.add(g)}return h}_getLoadedDescendents(t){var n;const l={};for(const h of this._inViewTiles.getAllTiles().filter((g=>g.hasData())))for(const g of t)h.tileID.isChildOf(g)&&(l[n=g.key]||(l[n]=[])).push(h);return l}_areDescendentsComplete(t,n,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===n:Math.pow(4,n-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(g)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,n&&(this._inViewTiles.handleWrapJump(n),this._resetTileReloadTimers())}update(t,n){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=n,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((E=>new c.a2(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y))):(l=Zr(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((E=>this._source.hasTile(E))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=Gr(t,this._source),_=this._updateRetainedTiles(l,g),j=ps(this._source.type);j&&this._rasterFadeDuration>0&&!n&&(function(E,M,D,$,B,G,J){const le=re(),ue=c.av(M);for(const ce of M){const de=E.getTileById(ce.key);de.fadingDirection!==$e.Departing&&de.fadeOpacity!==0||de.resetFadeLogic(),sc(E,de,D,le,$,B,J)||gi(E,de,D,le,G,J)||Us(de,ue,le,J)||de.resetFadeLogic()}})(this._inViewTiles,l,_,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),j?this._cleanUpRasterTiles(_):this._cleanUpVectorTiles(_)}_cleanUpRasterTiles(t){for(const n of this._inViewTiles.getAllIds())t[n]||this._removeTile(n)}_cleanUpVectorTiles(t){for(const n of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(n);t[n]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(n):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(n)}}_addTerrainIdealTiles(t){const n=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);n.push(h);const g=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));n.push(g)}return t.concat(n)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){var l;const h=new Set;for(const M of t)this._addTile(M).hasData()||h.add(M);const g=t.reduce(((M,D)=>(M[D.key]=D,M)),{}),_=this._retainLoadedChildren(g,h),j={},E=Math.max(n-ea.maxUnderzooming,this._source.minzoom);for(const M of _){let D=this._inViewTiles.getTileById(M.key),$=D?.wasRequested();for(let B=M.overscaledZ-1;B>=E;--B){const G=M.scaledTo(B);if(j[G.key])break;if(j[G.key]=!0,D=this.getTile(G),!D&&$&&(D=this._addTile(G)),D){const J=D.hasData();if((J||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||$)&&(g[G.key]=G),$=D.wasRequested(),J)break}}}return g}_addTile(t){let n=this._inViewTiles.getTileById(t.key);if(n)return n;n=this._outOfViewCache.getAndRemove(t),n&&(n.resetFadeLogic(),this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null));const l=n;return n||(n=new rt(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._inViewTiles.setTile(t.key,n),l||this._source.fire(new c.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){this._clearTileReloadTimer(t);const l=n.getExpiryTimeout();l&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),l))}_clearTileReloadTimer(t){const n=this._timers[t];n&&(clearTimeout(n),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const n=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,n)}}refreshTiles(t){for(const n of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(n);(this._inViewTiles.isIdRenderable(n)||l.state=="errored")&&t.some((h=>h.equals(l.tileID.canonical)))&&this._reloadTile(n,"expired")}}_removeTile(t){const n=this._inViewTiles.getTileById(t);n&&(n.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._outOfViewCache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,n,l){const h=[],g=this.transform;if(!g)return h;const _=g.getCoveringTilesDetailsProvider().allowWorldCopies(),j=l?g.getCameraQueryGeometry(t):t,E=G=>g.screenPointToMercatorCoordinate(G,this.terrain),M=this.transformBbox(t,E,!_),D=this.transformBbox(j,E,!_),$=this.getIds(),B=c.aa.fromPoints(D);for(let G=0;G<$.length;G++){const J=this._inViewTiles.getTileById($[G]);if(J.holdingForSymbolFade())continue;const le=_?[J.tileID]:[J.tileID.unwrapTo(-1),J.tileID.unwrapTo(0)],ue=Math.pow(2,g.zoom-J.tileID.overscaledZ),ce=n*J.queryPadding*c.a5/J.tileSize/ue;for(const de of le){const xe=B.map((he=>de.getTilePoint(new c.a9(he.x,he.y))));if(xe.expandBy(ce),xe.intersects(Dr)){const he=M.map((we=>de.getTilePoint(we))),ge=D.map((we=>de.getTilePoint(we)));h.push({tile:J,tileID:_?de:de.unwrapTo(0),queryGeometry:he,cameraQueryGeometry:ge,scale:ue})}}}return h}transformBbox(t,n,l){let h=t.map(n);if(l){const g=c.aa.fromPoints(t);g.shrinkBy(.001*Math.min(g.width(),g.height()));const _=g.map(n);c.aa.fromPoints(h).covers(_)||(h=h.map((j=>j.x>.5?new c.a9(j.x-1,j.y,j.z):j)))}return h}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map((l=>this._inViewTiles.getTileById(l).tileID));return this.transform&&this.transform.populateCache(n),n}hasTransition(){return!!this._source.hasTransition()||!(!ps(this._source.type)||!(function(t,n){if(n<=0)return!1;const l=re();for(const h of t.getAllTiles())if(h.fadeEndTime>=l)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,n,l){this._state.updateState(t=t||c.ai,n,l)}removeFeatureState(t,n,l){this._state.removeFeatureState(t=t||c.ai,n,l)}getFeatureState(t,n){return this._state.getState(t=t||c.ai,n)}setDependencies(t,n,l){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(n,l)}reloadTilesForDependencies(t,n){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,n)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter((l=>!l.hasDependency(t,n)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}ea.maxUnderzooming=10,ea.maxOverzooming=3;class _t{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.an(t,0,1);let n=1,l=this._distances[n];const h=t*this.paddedLength+this.padding;for(;l<h&&n<this._distances.length;)l=this._distances[++n];const g=n-1,_=this._distances[g],j=l-_,E=j>0?(h-_)/j:0;return this.points[g].mult(1-E).add(this.points[n].mult(E))}}function nr(m,t){let n=!0;return m==="always"||m!=="never"&&t!=="never"||(n=!1),n}class ur{constructor(t,n,l){const h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(n/l);for(let _=0;_<this.xCellCount*this.yCellCount;_++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,l,h,g){this._forEachCell(n,l,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(g)}insertCircle(t,n,l,h){this._forEachCell(n-h,l-h,n+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,n,l,h,g,_){this.boxCells[g].push(_)}_insertCircleCell(t,n,l,h,g,_){this.circleCells[g].push(_)}_query(t,n,l,h,g,_,j){if(l<0||t>this.width||h<0||n>this.height)return[];const E=[];if(t<=0&&n<=0&&this.width<=l&&this.height<=h){if(g)return[{key:null,x1:t,y1:n,x2:l,y2:h}];for(let M=0;M<this.boxKeys.length;M++)E.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const D=this.circles[3*M],$=this.circles[3*M+1],B=this.circles[3*M+2];E.push({key:this.circleKeys[M],x1:D-B,y1:$-B,x2:D+B,y2:$+B})}}else this._forEachCell(t,n,l,h,this._queryCell,E,{hitTest:g,overlapMode:_,seenUids:{box:{},circle:{}}},j);return E}query(t,n,l,h){return this._query(t,n,l,h,!1,null)}hitTest(t,n,l,h,g,_){return this._query(t,n,l,h,!0,g,_).length>0}hitTestCircle(t,n,l,h,g){const _=t-l,j=t+l,E=n-l,M=n+l;if(j<0||_>this.width||M<0||E>this.height)return!1;const D=[];return this._forEachCell(_,E,j,M,this._queryCellCircle,D,{hitTest:!0,overlapMode:h,circle:{x:t,y:n,radius:l},seenUids:{box:{},circle:{}}},g),D.length>0}_queryCell(t,n,l,h,g,_,j,E){const{seenUids:M,hitTest:D,overlapMode:$}=j,B=this.boxCells[g];if(B!==null){const J=this.bboxes;for(const le of B)if(!M.box[le]){M.box[le]=!0;const ue=4*le,ce=this.boxKeys[le];if(t<=J[ue+2]&&n<=J[ue+3]&&l>=J[ue+0]&&h>=J[ue+1]&&(!E||E(ce))&&(!D||!nr($,ce.overlapMode))&&(_.push({key:ce,x1:J[ue],y1:J[ue+1],x2:J[ue+2],y2:J[ue+3]}),D))return!0}}const G=this.circleCells[g];if(G!==null){const J=this.circles;for(const le of G)if(!M.circle[le]){M.circle[le]=!0;const ue=3*le,ce=this.circleKeys[le];if(this._circleAndRectCollide(J[ue],J[ue+1],J[ue+2],t,n,l,h)&&(!E||E(ce))&&(!D||!nr($,ce.overlapMode))){const de=J[ue],xe=J[ue+1],he=J[ue+2];if(_.push({key:ce,x1:de-he,y1:xe-he,x2:de+he,y2:xe+he}),D)return!0}}}return!1}_queryCellCircle(t,n,l,h,g,_,j,E){const{circle:M,seenUids:D,overlapMode:$}=j,B=this.boxCells[g];if(B!==null){const J=this.bboxes;for(const le of B)if(!D.box[le]){D.box[le]=!0;const ue=4*le,ce=this.boxKeys[le];if(this._circleAndRectCollide(M.x,M.y,M.radius,J[ue+0],J[ue+1],J[ue+2],J[ue+3])&&(!E||E(ce))&&!nr($,ce.overlapMode))return _.push(!0),!0}}const G=this.circleCells[g];if(G!==null){const J=this.circles;for(const le of G)if(!D.circle[le]){D.circle[le]=!0;const ue=3*le,ce=this.circleKeys[le];if(this._circlesCollide(J[ue],J[ue+1],J[ue+2],M.x,M.y,M.radius)&&(!E||E(ce))&&!nr($,ce.overlapMode))return _.push(!0),!0}}}_forEachCell(t,n,l,h,g,_,j,E){const M=this._convertToXCellCoord(t),D=this._convertToYCellCoord(n),$=this._convertToXCellCoord(l),B=this._convertToYCellCoord(h);for(let G=M;G<=$;G++)for(let J=D;J<=B;J++)if(g.call(this,t,n,l,h,this.xCellCount*J+G,_,j,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,l,h,g,_){const j=h-t,E=g-n,M=l+_;return M*M>j*j+E*E}_circleAndRectCollide(t,n,l,h,g,_,j){const E=(_-h)/2,M=Math.abs(t-(h+E));if(M>E+l)return!1;const D=(j-g)/2,$=Math.abs(n-(g+D));if($>D+l)return!1;if(M<=E||$<=D)return!0;const B=M-E,G=$-D;return B*B+G*G<=l*l}}function Cn(m,t,n){const l=c.N();if(!m){const{vecSouth:$,vecEast:B}=Ba(t),G=W();G[0]=B[0],G[1]=B[1],G[2]=$[0],G[3]=$[1],h=G,(D=(_=(g=G)[0])*(M=g[3])-(E=g[2])*(j=g[1]))&&(h[0]=M*(D=1/D),h[1]=-j*D,h[2]=-E*D,h[3]=_*D),l[0]=G[0],l[1]=G[1],l[4]=G[2],l[5]=G[3]}var h,g,_,j,E,M,D;return c.Q(l,l,[1/n,1/n,1]),l}function Jc(m,t,n,l){if(m){const h=c.N();if(!t){const{vecSouth:g,vecEast:_}=Ba(n);h[0]=_[0],h[1]=_[1],h[4]=g[0],h[5]=g[1]}return c.Q(h,h,[l,l,1]),h}return n.pixelsToClipSpaceMatrix}function Ba(m){const t=Math.cos(m.rollInRadians),n=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),_=c.aC();_[0]=-h*l*n-g*t,_[1]=-g*l*n+h*t;const j=c.aD(_);j<1e-9?c.aE(_):c.aF(_,_,1/j);const E=c.aC();E[0]=h*l*t-g*n,E[1]=g*l*t+h*n;const M=c.aD(E);return M<1e-9?c.aE(E):c.aF(E,E,1/M),{vecEast:E,vecSouth:_}}function ar(m,t,n,l){let h;l?(h=[m,t,l(m,t),1],c.aH(h,h,n)):(h=[m,t,0,1],tu(h,h,n));const g=h[3];return{point:new c.P(h[0]/g,h[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function ml(m,t){return .5+m/t*.5}function gl(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function Qc(m,t,n,l,h,g,_,j,E,M,D,$,B){const G=n?m.textSizeData:m.iconSizeData,J=c.ay(G,t.transform.zoom),le=[256/t.width*2+1,256/t.height*2+1],ue=n?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ue.clear();const ce=m.lineVertexArray,de=n?m.text.placedSymbolArray:m.icon.placedSymbolArray,xe=t.transform.width/t.transform.height;let he=!1;for(let ge=0;ge<de.length;ge++){const we=de.get(ge);if(we.hidden||we.writingMode===c.az.vertical&&!he){ko(we.numGlyphs,ue);continue}he=!1;const me=new c.P(we.anchorX,we.anchorY),Ne={getElevation:B,pitchedLabelPlaneMatrix:l,lineVertexArray:ce,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:me,unwrappedTileID:E,width:M,height:D,translation:$},Ue=wo(we.anchorX,we.anchorY,Ne);if(!gl(Ue.point,le)){ko(we.numGlyphs,ue);continue}const Re=ml(t.transform.cameraToCenterDistance,Ue.signedDistanceFromCamera),Oe=c.aA(G,J,we),Be=g?Oe*t.transform.getPitchedTextCorrection(we.anchorX,we.anchorY,E)/Re:Oe*Re,ot=yl({projectionContext:Ne,pitchedLabelPlaneMatrixInverse:h,symbol:we,fontSize:Be,flip:!1,keepUpright:_,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:ue,aspectRatio:xe,rotateToLine:j});he=ot.useVertical,(ot.notEnoughRoom||he||ot.needsFlipping&&yl({projectionContext:Ne,pitchedLabelPlaneMatrixInverse:h,symbol:we,fontSize:Be,flip:!0,keepUpright:_,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:ue,aspectRatio:xe,rotateToLine:j}).notEnoughRoom)&&ko(we.numGlyphs,ue)}n?m.text.dynamicLayoutVertexBuffer.updateData(ue):m.icon.dynamicLayoutVertexBuffer.updateData(ue)}function xl(m,t,n,l,h,g,_,j){const E=g.glyphStartIndex+g.numGlyphs,M=g.lineStartIndex,D=g.lineStartIndex+g.lineLength,$=t.getoffsetX(g.glyphStartIndex),B=t.getoffsetX(E-1),G=va(m*$,n,l,h,g.segment,M,D,j,_);if(!G)return null;const J=va(m*B,n,l,h,g.segment,M,D,j,_);return J?j.projectionCache.anyProjectionOccluded?null:{first:G,last:J}:null}function is(m,t,n,l){return m===c.az.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*l?{useVertical:!0}:(m===c.az.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function yl(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:n,symbol:l,fontSize:h,flip:g,keepUpright:_,glyphOffsetArray:j,dynamicLayoutVertexArray:E,aspectRatio:M,rotateToLine:D}=m,$=h/24,B=l.lineOffsetX*$,G=l.lineOffsetY*$;let J;if(l.numGlyphs>1){const le=l.glyphStartIndex+l.numGlyphs,ue=l.lineStartIndex,ce=l.lineStartIndex+l.lineLength,de=xl($,j,B,G,g,l,D,t);if(!de)return{notEnoughRoom:!0};const xe=eu(de.first.point.x,de.first.point.y,t,n),he=eu(de.last.point.x,de.last.point.y,t,n);if(_&&!g){const ge=is(l.writingMode,xe,he,M);if(ge)return ge}J=[de.first];for(let ge=l.glyphStartIndex+1;ge<le-1;ge++){const we=va($*j.getoffsetX(ge),B,G,g,l.segment,ue,ce,t,D);if(!we)return{notEnoughRoom:!0};J.push(we)}J.push(de.last)}else{if(_&&!g){const ue=Tr(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ce=l.lineStartIndex+l.segment+1,de=new c.P(t.lineVertexArray.getx(ce),t.lineVertexArray.gety(ce)),xe=Tr(de.x,de.y,t),he=xe.signedDistanceFromCamera>0?xe.point:vo(t.tileAnchorPoint,de,ue,1,t),ge=eu(ue.x,ue.y,t,n),we=eu(he.x,he.y,t,n),me=is(l.writingMode,ge,we,M);if(me)return me}const le=va($*j.getoffsetX(l.glyphStartIndex),B,G,g,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,D);if(!le||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};J=[le]}for(const le of J)c.aG(E,le.point,le.angle);return{}}function vo(m,t,n,l,h){const g=m.add(m.sub(t)._unit()),_=Tr(g.x,g.y,h).point,j=n.sub(_);return n.add(j._mult(l/j.mag()))}function on(m,t,n){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const h=new c.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),g=Tr(h.x,h.y,t);if(g.signedDistanceFromCamera>0)return l.projections[m]=g.point,l.anyProjectionOccluded=l.anyProjectionOccluded||g.isOccluded,g.point;const _=m-n.direction;return vo(n.distanceFromAnchor===0?t.tileAnchorPoint:new c.P(t.lineVertexArray.getx(_),t.lineVertexArray.gety(_)),h,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,t)}function Tr(m,t,n){const l=m+n.translation[0],h=t+n.translation[1];let g;return n.pitchWithMap?(g=ar(l,h,n.pitchedLabelPlaneMatrix,n.getElevation),g.isOccluded=!1):(g=n.transform.projectTileCoordinates(l,h,n.unwrappedTileID,n.getElevation),g.point.x=(.5*g.point.x+.5)*n.width,g.point.y=(.5*-g.point.y+.5)*n.height),g}function eu(m,t,n,l){if(n.pitchWithMap){const h=[m,t,0,1];return c.aH(h,h,l),n.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],n.unwrappedTileID,n.getElevation).point}return{x:m/n.width*2-1,y:1-t/n.height*2}}function wo(m,t,n){return n.transform.projectTileCoordinates(m,t,n.unwrappedTileID,n.getElevation)}function Bi(m,t,n){return m._unit()._perp()._mult(t*n)}function ln(m,t,n,l,h,g,_,j,E){if(j.projectionCache.offsets[m])return j.projectionCache.offsets[m];const M=n.add(t);if(m+E.direction<l||m+E.direction>=h)return j.projectionCache.offsets[m]=M,M;const D=on(m+E.direction,j,E),$=Bi(D.sub(n),_,E.direction),B=n.add($),G=D.add($);return j.projectionCache.offsets[m]=c.aI(g,M,B,G)||M,j.projectionCache.offsets[m]}function va(m,t,n,l,h,g,_,j,E){const M=l?m-t:m+t;let D=M>0?1:-1,$=0;l&&(D*=-1,$=Math.PI),D<0&&($+=Math.PI);let B,G=D>0?g+h:g+h+1;j.projectionCache.cachedAnchorPoint?B=j.projectionCache.cachedAnchorPoint:(B=Tr(j.tileAnchorPoint.x,j.tileAnchorPoint.y,j).point,j.projectionCache.cachedAnchorPoint=B);let J,le,ue=B,ce=B,de=0,xe=0;const he=Math.abs(M),ge=[];let we;for(;de+xe<=he;){if(G+=D,G<g||G>=_)return null;de+=xe,ce=ue,le=J;const Ue={absOffsetX:he,direction:D,distanceFromAnchor:de,previousVertex:ce};if(ue=on(G,j,Ue),n===0)ge.push(ce),we=ue.sub(ce);else{let Re;const Oe=ue.sub(ce);Re=Oe.mag()===0?Bi(on(G+D,j,Ue).sub(ue),n,D):Bi(Oe,n,D),le||(le=ce.add(Re)),J=ln(G,Re,ue,g,_,le,n,j,Ue),ge.push(le),we=J.sub(le)}xe=we.mag()}const me=we._mult((he-de)/xe)._add(le||ce),Ne=$+Math.atan2(ue.y-ce.y,ue.x-ce.x);return ge.push(me),{point:me,angle:E?Ne:0,path:ge}}const ta=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ko(m,t){for(let n=0;n<m;n++){const l=t.length;t.resize(l+4),t.float32.set(ta,3*l)}}function tu(m,t,n){const l=t[0],h=t[1];return m[0]=n[0]*l+n[4]*h+n[12],m[1]=n[1]*l+n[5]*h+n[13],m[3]=n[3]*l+n[7]*h+n[15],m}const gs=100;class nc{constructor(t,n=new ur(t.width+200,t.height+200,25),l=new ur(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+gs,this.screenBottomBoundary=t.height+gs,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,l,h,g,_,j,E,M,D,$,B){const G=this.projectAndGetPerspectiveRatio(t.anchorPointX+E[0],t.anchorPointY+E[1],g,D,B),J=l*G.perspectiveRatio;let le;if(_||j)le=this._projectCollisionBox(t,J,h,g,_,j,E,G,D,$,B);else{const we=G.x+($?$.x*J:0),me=G.y+($?$.y*J:0);le={allPointsOccluded:!1,box:[we+t.x1*J,me+t.y1*J,we+t.x2*J,me+t.y2*J]}}const[ue,ce,de,xe]=le.box,he=_?le.allPointsOccluded:G.isOccluded;let ge=he;return ge||(ge=G.perspectiveRatio<this.perspectiveRatioCutoff),ge||(ge=!this.isInsideGrid(ue,ce,de,xe)),ge||n!=="always"&&this.grid.hitTest(ue,ce,de,xe,n,M)?{box:[ue,ce,de,xe],placeable:!1,offscreen:!1,occluded:he}:{box:[ue,ce,de,xe],placeable:!0,offscreen:this.isOffscreen(ue,ce,de,xe),occluded:he}}placeCollisionCircles(t,n,l,h,g,_,j,E,M,D,$,B,G,J){const le=[],ue=new c.P(n.anchorX,n.anchorY),ce=this.getPerspectiveRatio(ue.x,ue.y,_,J),de=(M?g*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,_)/ce:g*ce)/c.aM,xe={getElevation:J,pitchedLabelPlaneMatrix:j,lineVertexArray:l,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ue,unwrappedTileID:_,width:this.transform.width,height:this.transform.height,translation:G},he=xl(de,h,n.lineOffsetX*de,n.lineOffsetY*de,!1,n,!1,xe);let ge=!1,we=!1,me=!0;if(he){const Ne=.5*$*ce+B,Ue=new c.P(-100,-100),Re=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Oe=new _t,Be=he.first,ot=he.last;let ct=[];for(let rr=Be.path.length-1;rr>=1;rr--)ct.push(Be.path[rr]);for(let rr=1;rr<ot.path.length;rr++)ct.push(ot.path[rr]);const et=2.5*Ne;if(M){const rr=this.projectPathToScreenSpace(ct,xe);ct=rr.some((zr=>zr.signedDistanceFromCamera<=0))?[]:rr.map((zr=>zr.point))}let xt=[];if(ct.length>0){const rr=ct[0].clone(),zr=ct[0].clone();for(let rs=1;rs<ct.length;rs++)rr.x=Math.min(rr.x,ct[rs].x),rr.y=Math.min(rr.y,ct[rs].y),zr.x=Math.max(zr.x,ct[rs].x),zr.y=Math.max(zr.y,ct[rs].y);xt=rr.x>=Ue.x&&zr.x<=Re.x&&rr.y>=Ue.y&&zr.y<=Re.y?[ct]:zr.x<Ue.x||rr.x>Re.x||zr.y<Ue.y||rr.y>Re.y?[]:c.aJ([ct],Ue.x,Ue.y,Re.x,Re.y)}for(const rr of xt){Oe.reset(rr,.25*Ne);let zr=0;zr=Oe.length<=.5*Ne?1:Math.ceil(Oe.paddedLength/et)+1;for(let rs=0;rs<zr;rs++){const Vr=rs/Math.max(zr-1,1),ss=Oe.lerp(Vr),$r=ss.x+gs,ns=ss.y+gs;le.push($r,ns,Ne,0);const us=$r-Ne,Xs=ns-Ne,js=$r+Ne,Pr=ns+Ne;if(me=me&&this.isOffscreen(us,Xs,js,Pr),we=we||this.isInsideGrid(us,Xs,js,Pr),t!=="always"&&this.grid.hitTestCircle($r,ns,Ne,t,D)&&(ge=!0,!E))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!E&&ge||!we||ce<this.perspectiveRatioCutoff?[]:le,offscreen:me,collisionDetected:ge}}projectPathToScreenSpace(t,n){const l=(function(h,g){const _=c.N();return c.aB(_,g.pitchedLabelPlaneMatrix),h.map((j=>{const E=ar(j.x,j.y,_,g.getElevation),M=g.transform.projectTileCoordinates(E.point.x,E.point.y,g.unwrappedTileID,g.getElevation);return M.point.x=(.5*M.point.x+.5)*g.width,M.point.y=(.5*-M.point.y+.5)*g.height,M}))})(t,n);return(function(h){let g=0,_=0,j=0,E=0;for(let M=0;M<h.length;M++)h[M].isOccluded?(j=M+1,E=0):(E++,E>_&&(_=E,g=j));return h.slice(g,g+_)})(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[],l=new c.aa;for(const $ of t){const B=new c.P($.x+gs,$.y+gs);l.extend(B),n.push(B)}const{minX:h,minY:g,maxX:_,maxY:j}=l,E=this.grid.query(h,g,_,j).concat(this.ignoredGrid.query(h,g,_,j)),M={},D={};for(const $ of E){const B=$.key;if(M[B.bucketInstanceId]===void 0&&(M[B.bucketInstanceId]={}),M[B.bucketInstanceId][B.featureIndex])continue;const G=[new c.P($.x1,$.y1),new c.P($.x2,$.y1),new c.P($.x2,$.y2),new c.P($.x1,$.y2)];c.aK(n,G)&&(M[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(t,n,l,h,g,_){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:_,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,l,h,g,_){const j=l?this.ignoredGrid:this.grid,E={bucketInstanceId:h,featureIndex:g,collisionGroupID:_,overlapMode:n};for(let M=0;M<t.length;M+=4)j.insertCircle(E,t[M],t[M+1],t[M+2])}projectAndGetPerspectiveRatio(t,n,l,h,g){if(g){let _;h?(_=[t,n,h(t,n),1],c.aH(_,_,g)):(_=[t,n,0,1],tu(_,_,g));const j=_[3];return{x:(_[0]/j+1)/2*this.transform.width+gs,y:(-_[1]/j+1)/2*this.transform.height+gs,perspectiveRatio:.5+this.transform.cameraToCenterDistance/j*.5,isOccluded:!1,signedDistanceFromCamera:j}}{const _=this.transform.projectTileCoordinates(t,n,l,h);return{x:(_.point.x+1)/2*this.transform.width+gs,y:(1-_.point.y)/2*this.transform.height+gs,perspectiveRatio:.5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5,isOccluded:_.isOccluded,signedDistanceFromCamera:_.signedDistanceFromCamera}}}getPerspectiveRatio(t,n,l,h){const g=this.transform.projectTileCoordinates(t,n,l,h);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(t,n,l,h){return l<gs||t>=this.screenRightBoundary||h<gs||n>this.screenBottomBoundary}isInsideGrid(t,n,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=c.ar([]);return c.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,n,l,h,g,_,j,E,M,D,$){let B=1,G=0,J=0,le=1;const ue=t.anchorPointX+j[0],ce=t.anchorPointY+j[1];if(_&&!g){const ct=this.projectAndGetPerspectiveRatio(ue+1,ce,h,M,$),et=ct.x-E.x,xt=Math.atan((ct.y-E.y)/et)+(et<0?Math.PI:0),rr=Math.sin(xt),zr=Math.cos(xt);B=zr,G=rr,J=-rr,le=zr}else if(!_&&g){const ct=Ba(this.transform);B=ct.vecEast[0],G=ct.vecEast[1],J=ct.vecSouth[0],le=ct.vecSouth[1]}let de=E.x,xe=E.y,he=n;g&&(de=ue,xe=ce,he=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),he*=this.transform.getPitchedTextCorrection(ue,ce,h),D||(he*=c.an(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),D&&(de+=B*D.x*he+J*D.y*he,xe+=G*D.x*he+le*D.y*he);const ge=t.x1*he,we=t.x2*he,me=(ge+we)/2,Ne=t.y1*he,Ue=t.y2*he,Re=(Ne+Ue)/2,Oe=[{offsetX:ge,offsetY:Ne},{offsetX:me,offsetY:Ne},{offsetX:we,offsetY:Ne},{offsetX:we,offsetY:Re},{offsetX:we,offsetY:Ue},{offsetX:me,offsetY:Ue},{offsetX:ge,offsetY:Ue},{offsetX:ge,offsetY:Re}];let Be=[];for(const{offsetX:ct,offsetY:et}of Oe)Be.push(new c.P(de+B*ct+J*et,xe+G*ct+le*et));let ot=!1;if(g){const ct=Be.map((et=>this.projectAndGetPerspectiveRatio(et.x,et.y,h,M,$)));ot=ct.some((et=>!et.isOccluded)),Be=ct.map((et=>new c.P(et.x,et.y)))}else ot=!0;return{box:c.aL(Be),allPointsOccluded:!ot}}}class ac{constructor(t,n,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class xi{constructor(t,n,l,h,g){this.text=new ac(t?t.text:null,n,l,g),this.icon=new ac(t?t.icon:null,n,h,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ic{constructor(t,n,l){this.text=t,this.icon=n,this.skipFade=l}}class uh{constructor(t,n,l,h,g){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=g}}class dh{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[t]}}function _l(m,t,n,l,h){const{horizontalAlign:g,verticalAlign:_}=c.aS(m);return new c.P(-(g-.5)*t+l[0]*h,-(_-.5)*n+l[1]*h)}class ru{constructor(t,n,l,h,g){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new nc(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new dh(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const n=this.terrain;return n?(l,h)=>n.getElevation(t,l,h):null}getBucketParts(t,n,l,h){const g=l.getBucket(n),_=l.latestFeatureIndex;if(!g||!_||n.id!==g.layerIds[0])return;const j=l.collisionBoxArray,E=g.layers[0].layout,M=g.layers[0].paint,D=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),$=l.tileSize/c.a5,B=l.tileID.toUnwrapped(),G=E.get("text-rotation-alignment")==="map",J=c.aN(l,1,this.transform.zoom),le=c.aO(this.collisionIndex.transform,l,M.get("text-translate"),M.get("text-translate-anchor")),ue=c.aO(this.collisionIndex.transform,l,M.get("icon-translate"),M.get("icon-translate-anchor")),ce=Cn(G,this.transform,J);this.retainedQueryData[g.bucketInstanceId]=new uh(g.bucketInstanceId,_,g.sourceLayerIndex,g.index,l.tileID);const de={bucket:g,layout:E,translationText:le,translationIcon:ue,unwrappedTileID:B,pitchedLabelPlaneMatrix:ce,scale:D,textPixelRatio:$,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:c.ay(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(const xe of g.sortKeyRanges){const{sortKey:he,symbolInstanceStart:ge,symbolInstanceEnd:we}=xe;t.push({sortKey:he,symbolInstanceStart:ge,symbolInstanceEnd:we,parameters:de})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:de})}attemptAnchorPlacement(t,n,l,h,g,_,j,E,M,D,$,B,G,J,le,ue,ce,de,xe,he){const ge=c.aP[t.textAnchor],we=[t.textOffset0,t.textOffset1],me=_l(ge,l,h,we,g),Ne=this.collisionIndex.placeCollisionBox(n,B,E,M,D,j,_,ue,$.predicate,xe,me,he);if((!de||this.collisionIndex.placeCollisionBox(de,B,E,M,D,j,_,ce,$.predicate,xe,me,he).placeable)&&Ne.placeable){let Ue;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Ue=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:we,width:l,height:h,anchor:ge,textBoxScale:g,prevAnchor:Ue},this.markUsedJustification(J,ge,G,le),J.allowVerticalPlacement&&(this.markUsedOrientation(J,le,G),this.placedOrientations[G.crossTileID]=le),{shift:me,placedGlyphBoxes:Ne}}}placeLayerBucketPart(t,n,l){const{bucket:h,layout:g,translationText:_,translationIcon:j,unwrappedTileID:E,pitchedLabelPlaneMatrix:M,textPixelRatio:D,holdingForFade:$,collisionBoxArray:B,partiallyEvaluatedTextSize:G,collisionGroup:J}=t.parameters,le=g.get("text-optional"),ue=g.get("icon-optional"),ce=c.aQ(g,"text-overlap","text-allow-overlap"),de=ce==="always",xe=c.aQ(g,"icon-overlap","icon-allow-overlap"),he=xe==="always",ge=g.get("text-rotation-alignment")==="map",we=g.get("text-pitch-alignment")==="map",me=g.get("icon-text-fit")!=="none",Ne=g.get("symbol-z-order")==="viewport-y",Ue=de&&(he||!h.hasIconData()||ue),Re=he&&(de||!h.hasTextData()||le);!h.collisionArrays&&B&&h.deserializeCollisionBoxes(B);const Oe=this.retainedQueryData[h.bucketInstanceId].tileID,Be=this._getTerrainElevationFunc(Oe),ot=this.transform.getFastPathSimpleProjectionMatrix(Oe),ct=(et,xt,rr)=>{var zr,rs;if(n[et.crossTileID])return;if($)return void(this.placements[et.crossTileID]=new ic(!1,!1,!1));let Vr=!1,ss=!1,$r=!0,ns=null,us={box:null,placeable:!1,offscreen:null,occluded:!1},Xs={placeable:!1},js=null,Pr=null,Fs=null,za=0,Ja=0,Aa=0;xt.textFeatureIndex?za=xt.textFeatureIndex:et.useRuntimeCollisionCircles&&(za=et.featureIndex),xt.verticalTextFeatureIndex&&(Ja=xt.verticalTextFeatureIndex);const jn=xt.textBox;if(jn){const Rn=qr=>{let Ur=c.az.horizontal;if(h.allowVerticalPlacement&&!qr&&this.prevPlacement){const As=this.prevPlacement.placedOrientations[et.crossTileID];As&&(this.placedOrientations[et.crossTileID]=As,Ur=As,this.markUsedOrientation(h,Ur,et))}return Ur},ei=(qr,Ur)=>{if(h.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&xt.verticalTextBox){for(const As of h.writingModes)if(As===c.az.vertical?(us=Ur(),Xs=us):us=qr(),us&&us.placeable)break}else us=qr()},ha=et.textAnchorOffsetStartIndex,pa=et.textAnchorOffsetEndIndex;if(pa===ha){const qr=(Ur,As)=>{const Os=this.collisionIndex.placeCollisionBox(Ur,ce,D,Oe,E,we,ge,_,J.predicate,Be,void 0,ot);return Os&&Os.placeable&&(this.markUsedOrientation(h,As,et),this.placedOrientations[et.crossTileID]=As),Os};ei((()=>qr(jn,c.az.horizontal)),(()=>{const Ur=xt.verticalTextBox;return h.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&Ur?qr(Ur,c.az.vertical):{box:null,offscreen:null}})),Rn(us&&us.placeable)}else{let qr=c.aP[(rs=(zr=this.prevPlacement)===null||zr===void 0?void 0:zr.variableOffsets[et.crossTileID])===null||rs===void 0?void 0:rs.anchor];const Ur=(Os,Sn,dn)=>{const uo=Os.x2-Os.x1,jh=Os.y2-Os.y1,zd=et.textBoxScale,Fu=me&&xe==="never"?Sn:null;let Ci=null,ti=ce==="never"?1:2,Pi="never";qr&&ti++;for(let Lc=0;Lc<ti;Lc++){for(let Ou=ha;Ou<pa;Ou++){const Fc=h.textAnchorOffsets.get(Ou);if(qr&&Fc.textAnchor!==qr)continue;const Bl=this.attemptAnchorPlacement(Fc,Os,uo,jh,zd,ge,we,D,Oe,E,J,Pi,et,h,dn,_,j,Fu,Be);if(Bl&&(Ci=Bl.placedGlyphBoxes,Ci&&Ci.placeable))return Vr=!0,ns=Bl.shift,Ci}qr?qr=null:Pi=ce}return l&&!Ci&&(Ci={box:this.collisionIndex.placeCollisionBox(jn,"always",D,Oe,E,we,ge,_,J.predicate,Be,void 0,ot).box,offscreen:!1,placeable:!1,occluded:!1}),Ci};ei((()=>Ur(jn,xt.iconBox,c.az.horizontal)),(()=>{const Os=xt.verticalTextBox;return h.allowVerticalPlacement&&(!us||!us.placeable)&&et.numVerticalGlyphVertices>0&&Os?Ur(Os,xt.verticalIconBox,c.az.vertical):{box:null,occluded:!0,offscreen:null}})),us&&(Vr=us.placeable,$r=us.offscreen);const As=Rn(us&&us.placeable);if(!Vr&&this.prevPlacement){const Os=this.prevPlacement.variableOffsets[et.crossTileID];Os&&(this.variableOffsets[et.crossTileID]=Os,this.markUsedJustification(h,Os.anchor,et,As))}}}if(js=us,Vr=js&&js.placeable,$r=js&&js.offscreen,et.useRuntimeCollisionCircles&&et.centerJustifiedTextSymbolIndex>=0){const Rn=h.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex),ei=c.aA(h.textSizeData,G,Rn),ha=g.get("text-padding");Pr=this.collisionIndex.placeCollisionCircles(ce,Rn,h.lineVertexArray,h.glyphOffsetArray,ei,E,M,l,we,J.predicate,et.collisionCircleDiameter,ha,_,Be),Pr.circles.length&&Pr.collisionDetected&&!l&&c.w("Collisions detected, but collision boxes are not shown"),Vr=de||Pr.circles.length>0&&!Pr.collisionDetected,$r=$r&&Pr.offscreen}if(xt.iconFeatureIndex&&(Aa=xt.iconFeatureIndex),xt.iconBox){const Rn=ei=>this.collisionIndex.placeCollisionBox(ei,xe,D,Oe,E,we,ge,j,J.predicate,Be,me&&ns?ns:void 0,ot);Xs&&Xs.placeable&&xt.verticalIconBox?(Fs=Rn(xt.verticalIconBox),ss=Fs.placeable):(Fs=Rn(xt.iconBox),ss=Fs.placeable),$r=$r&&Fs.offscreen}const Ni=le||et.numHorizontalGlyphVertices===0&&et.numVerticalGlyphVertices===0,Qa=ue||et.numIconVertices===0;Ni||Qa?Qa?Ni||(ss=ss&&Vr):Vr=ss&&Vr:ss=Vr=ss&&Vr;const Ei=ss&&Fs.placeable;if(Vr&&js.placeable&&this.collisionIndex.insertCollisionBox(js.box,ce,g.get("text-ignore-placement"),h.bucketInstanceId,Xs&&Xs.placeable&&Ja?Ja:za,J.ID),Ei&&this.collisionIndex.insertCollisionBox(Fs.box,xe,g.get("icon-ignore-placement"),h.bucketInstanceId,Aa,J.ID),Pr&&Vr&&this.collisionIndex.insertCollisionCircles(Pr.circles,ce,g.get("text-ignore-placement"),h.bucketInstanceId,za,J.ID),l&&this.storeCollisionData(h.bucketInstanceId,rr,xt,js,Fs,Pr),et.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[et.crossTileID]=new ic((Vr||Ue)&&!js?.occluded,(ss||Re)&&!Fs?.occluded,$r||h.justReloaded),n[et.crossTileID]=!0};if(Ne){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const et=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let xt=et.length-1;xt>=0;--xt){const rr=et[xt];ct(h.symbolInstances.get(rr),h.collisionArrays[rr],rr)}}else for(let et=t.symbolInstanceStart;et<t.symbolInstanceEnd;et++)ct(h.symbolInstances.get(et),h.collisionArrays[et],et);h.justReloaded=!1}storeCollisionData(t,n,l,h,g,_){if(l.textBox||l.iconBox){let j,E;this.collisionBoxArrays.has(t)?j=this.collisionBoxArrays.get(t):(j=new Map,this.collisionBoxArrays.set(t,j)),j.has(n)?E=j.get(n):(E={text:null,icon:null},j.set(n,E)),l.textBox&&(E.text=h.box),l.iconBox&&(E.icon=g.box)}if(_){let j=this.collisionCircleArrays[t];j===void 0&&(j=this.collisionCircleArrays[t]=[]);for(let E=0;E<_.circles.length;E+=4)j.push(_.circles[E+0]-gs),j.push(_.circles[E+1]-gs),j.push(_.circles[E+2]),j.push(_.collisionDetected?1:0)}}markUsedJustification(t,n,l,h){let g;g=h===c.az.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[c.aR(n)];const _=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const j of _)j>=0&&(t.text.placedSymbolArray.get(j).crossTileID=g>=0&&j!==g?0:l.crossTileID)}markUsedOrientation(t,n,l){const h=n===c.az.horizontal||n===c.az.horizontalOnly?n:0,g=n===c.az.vertical?n:0,_=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const j of _)t.text.placedSymbolArray.get(j).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const h=n?n.symbolFadeChange(t):1,g=n?n.opacities:{},_=n?n.variableOffsets:{},j=n?n.placedOrientations:{};for(const E in this.placements){const M=this.placements[E],D=g[E];D?(this.opacities[E]=new xi(D,h,M.text,M.icon),l=l||M.text!==D.text.placed||M.icon!==D.icon.placed):(this.opacities[E]=new xi(null,h,M.text,M.icon,M.skipFade),l=l||M.text||M.icon)}for(const E in g){const M=g[E];if(!this.opacities[E]){const D=new xi(M,h,!1,!1);D.isHidden()||(this.opacities[E]=D,l=l||M.text.placed||M.icon.placed)}}for(const E in _)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=_[E]);for(const E in j)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=j[E]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const l={};for(const h of n){const g=h.getBucket(t);g&&h.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,n,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const g=t.layers[0],_=g.layout,j=new xi(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),D=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=_.get("text-rotation-alignment")==="map",B=_.get("text-pitch-alignment")==="map",G=_.get("icon-text-fit")!=="none",J=new xi(null,0,E&&(M||!t.hasIconData()||_.get("icon-optional")),M&&(E||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const le=(ce,de,xe)=>{for(let he=0;he<de/4;he++)ce.opacityVertexArray.emplaceBack(xe);ce.hasVisibleVertices=ce.hasVisibleVertices||xe!==bl},ue=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ce=0;ce<t.symbolInstances.length;ce++){const de=t.symbolInstances.get(ce),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:he,crossTileID:ge}=de;let we=this.opacities[ge];l[ge]?we=j:we||(we=J,this.opacities[ge]=we),l[ge]=!0;const me=de.numIconVertices>0,Ne=this.placedOrientations[de.crossTileID],Ue=Ne===c.az.vertical,Re=Ne===c.az.horizontal||Ne===c.az.horizontalOnly;if(xe>0||he>0){const Be=su(we.text);le(t.text,xe,Ue?bl:Be),le(t.text,he,Re?bl:Be);const ot=we.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach((xt=>{xt>=0&&(t.text.placedSymbolArray.get(xt).hidden=ot||Ue?1:0)})),de.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=ot||Re?1:0);const ct=this.variableOffsets[de.crossTileID];ct&&this.markUsedJustification(t,ct.anchor,de,Ne);const et=this.placedOrientations[de.crossTileID];et&&(this.markUsedJustification(t,"left",de,et),this.markUsedOrientation(t,et,de))}if(me){const Be=su(we.icon),ot=!(G&&de.verticalPlacedIconSymbolIndex&&Ue);de.placedIconSymbolIndex>=0&&(le(t.icon,de.numIconVertices,ot?Be:bl),t.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=we.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(le(t.icon,de.numVerticalIconVertices,ot?bl:Be),t.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}const Oe=ue&&ue.has(ce)?ue.get(ce):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Be=t.collisionArrays[ce];if(Be){let ot=new c.P(0,0);if(Be.textBox||Be.verticalTextBox){let ct=!0;if(D){const et=this.variableOffsets[ge];et?(ot=_l(et.anchor,et.width,et.height,et.textOffset,et.textBoxScale),$&&ot._rotate(B?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ct=!1}if(Be.textBox||Be.verticalTextBox){let et;Be.textBox&&(et=Ue),Be.verticalTextBox&&(et=Re),oc(t.textCollisionBox.collisionVertexArray,we.text.placed,!ct||et,Oe.text,ot.x,ot.y)}}if(Be.iconBox||Be.verticalIconBox){const ct=!!(!Re&&Be.verticalIconBox);let et;Be.iconBox&&(et=ct),Be.verticalIconBox&&(et=!ct),oc(t.iconCollisionBox.collisionVertexArray,we.icon.placed,et,Oe.icon,G?ot.x:0,G?ot.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function oc(m,t,n,l,h,g){l&&l.length!==0||(l=[0,0,0,0]);const _=l[0]-gs,j=l[1]-gs,E=l[2]-gs,M=l[3]-gs;m.emplaceBack(t?1:0,n?1:0,h||0,g||0,_,j),m.emplaceBack(t?1:0,n?1:0,h||0,g||0,E,j),m.emplaceBack(t?1:0,n?1:0,h||0,g||0,E,M),m.emplaceBack(t?1:0,n?1:0,h||0,g||0,_,M)}const jo=Math.pow(2,25),od=Math.pow(2,24),ld=Math.pow(2,17),Nr=Math.pow(2,16),lc=Math.pow(2,9),cd=Math.pow(2,8),Vi=Math.pow(2,1);function su(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,n=Math.floor(127*m.opacity);return n*jo+t*od+n*ld+t*Nr+n*lc+t*cd+n*Vi+t}const bl=0;class yi{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,l,h,g){const _=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(_,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort(((j,E)=>j.sortKey-E.sortKey)));this._currentPartIndex<_.length;)if(n.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,g())return!0;return!1}}class $i{constructor(t,n,l,h,g,_,j,E){this.placement=new ru(t,n,_,j,E),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,n,l){const h=re(),g=()=>!this._forceFullPlacement&&re()-h>2;for(;this._currentPlacementIndex>=0;){const _=n[t[this._currentPlacementIndex]],j=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=j)&&(!_.maxzoom||_.maxzoom>j)){if(this._inProgressLayer||(this._inProgressLayer=new yi(_)),this._inProgressLayer.continuePlacement(l[_.source],this.placement,this._showCollisionBoxes,_,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ir=512/c.a5/2;class Va{constructor(t,n,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let g=0;g<n.length;g++){const _=n.get(g),j=_.key,E=h.get(j);E?E.push(_):h.set(j,[_])}for(const[g,_]of h){const j={positions:_.map((E=>({x:Math.floor(E.anchorX*ir),y:Math.floor(E.anchorY*ir)}))),crossTileIDs:_.map((E=>E.crossTileID))};if(j.positions.length>128){const E=new c.aT(j.positions.length,16,Uint16Array);for(const{x:M,y:D}of j.positions)E.add(M,D);E.finish(),delete j.positions,j.index=E}this._symbolsByKey[g]=j}}getScaledCoordinates(t,n){const{x:l,y:h,z:g}=this.tileID.canonical,{x:_,y:j,z:E}=n.canonical,M=ir/Math.pow(2,E-g),D=(j*c.a5+t.anchorY)*M,$=h*c.a5*ir;return{x:Math.floor((_*c.a5+t.anchorX)*M-l*c.a5*ir),y:Math.floor(D-$)}}findMatches(t,n,l){const h=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let g=0;g<t.length;g++){const _=t.get(g);if(_.crossTileID)continue;const j=this._symbolsByKey[_.key];if(!j)continue;const E=this.getScaledCoordinates(_,n);if(j.index){const M=j.index.range(E.x-h,E.y-h,E.x+h,E.y+h).sort();for(const D of M){const $=j.crossTileIDs[D];if(!l[$]){l[$]=!0,_.crossTileID=$;break}}}else if(j.positions)for(let M=0;M<j.positions.length;M++){const D=j.positions[M],$=j.crossTileIDs[M];if(Math.abs(D.x-E.x)<=h&&Math.abs(D.y-E.y)<=h&&!l[$]){l[$]=!0,_.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Ui{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class $a{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const l in this.indexes){const h=this.indexes[l],g={};for(const _ in h){const j=h[_];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+n),g[j.tileID.key]=j}this.indexes[l]=g}this.lng=t}addBucket(t,n,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<n.symbolInstances.length;g++)n.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const _=this.indexes[g];if(Number(g)>t.overscaledZ)for(const j in _){const E=_[j];E.tileID.isChildOf(t)&&E.findMatches(n.symbolInstances,t,h)}else{const j=_[t.scaledTo(Number(g)).key];j&&j.findMatches(n.symbolInstances,t,h)}}for(let g=0;g<n.symbolInstances.length;g++){const _=n.symbolInstances.get(g);_.crossTileID||(_.crossTileID=l.generate(),h[_.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Va(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const l of n.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let n=!1;for(const l in this.indexes){const h=this.indexes[l];for(const g in h)t[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[g]),delete h[g],n=!0)}return n}}class qs{constructor(){this.layerIndexes={},this.crossTileIDs=new Ui,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new $a);let g=!1;const _={};h.handleWrapJump(l);for(const j of n){const E=j.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(j.tileID,E,this.crossTileIDs)&&(g=!0),_[E.bucketInstanceId]=!0)}return h.removeStaleBuckets(_)&&(g=!0),g}pruneUnusedLayers(t){const n={};t.forEach((l=>{n[l]=!0}));for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}var Ps="void main() {fragColor=vec4(1.0);}";const Ir={prelude:Xt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Xt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Xt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Xt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Xt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Xt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Xt(Ps,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Xt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Xt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Xt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Xt(Ps,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Xt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Xt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Xt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Xt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Xt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Xt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Xt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Xt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Xt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Xt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Xt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Xt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Xt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Xt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Xt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Xt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Xt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Xt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Xt(m,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=g?g.concat(h):h,j={};return{fragmentSource:m=m.replace(n,((E,M,D,$,B)=>(j[B]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${D} ${$} ${B};
#else
uniform ${D} ${$} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${D} ${$} ${B} = u_${B};
#endif
`))),vertexSource:t=t.replace(n,((E,M,D,$,B)=>{const G=$==="float"?"vec2":"vec4",J=B.match(/color/)?"color":G;return j[B]?M==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${D} ${G} a_${B};
out ${D} ${$} ${B};
#else
uniform ${D} ${$} u_${B};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${D} ${$} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${J}(a_${B}, u_${B}_t);
#else
    ${D} ${$} ${B} = u_${B};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${D} ${G} a_${B};
#else
uniform ${D} ${$} u_${B};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${D} ${$} ${B} = a_${B};
#else
    ${D} ${$} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${D} ${$} ${B} = unpack_mix_${J}(a_${B}, u_${B}_t);
#else
    ${D} ${$} ${B} = u_${B};
#endif
`})),staticAttributes:l,staticUniforms:_}}class Br{constructor(t,n,l){this.vertexBuffer=t,this.indexBuffer=n,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ra=c.aU([{name:"a_pos",type:"Int16",components:2}]);const bn="#define PROJECTION_MERCATOR",Pn="mercator";class Gs{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Pn}get shaderDefine(){return bn}get shaderPreludeCode(){return Ir.projectionMercator}get vertexShaderPreludeCode(){return Ir.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,n,l,h,g){if(this._cachedMesh)return this._cachedMesh;const _=new c.aW;_.emplaceBack(0,0),_.emplaceBack(c.a5,0),_.emplaceBack(0,c.a5),_.emplaceBack(c.a5,c.a5);const j=t.createVertexBuffer(_,ra.members),E=c.aX.simpleSegment(0,0,4,2),M=new c.aY;M.emplaceBack(1,0,2),M.emplaceBack(1,2,3);const D=t.createIndexBuffer(M);return this._cachedMesh=new Br(j,D,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class So{constructor(t=0,n=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=l,this.right=h}interpolate(t,n,l){return n.top!=null&&t.top!=null&&(this.top=c.G.number(t.top,n.top,l)),n.bottom!=null&&t.bottom!=null&&(this.bottom=c.G.number(t.bottom,n.bottom,l)),n.left!=null&&t.left!=null&&(this.left=c.G.number(t.left,n.left,l)),n.right!=null&&t.right!=null&&(this.right=c.G.number(t.right,n.right,l)),this}getCenter(t,n){const l=c.an((this.left+t-this.right)/2,0,t),h=c.an((this.top+n-this.bottom)/2,0,n);return new c.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new So(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function qi(m,t){if(!m.renderWorldCopies||m.lngRange)return;const n=t.lng-m.center.lng;t.lng+=n>180?-360:n<-180?360:0}function Qr(m){return Math.max(0,Math.floor(m))}class wa{constructor(t,n){var l;this.applyConstrain=(h,g)=>this._constrainOverride!==null?this._constrainOverride(h,g):this._callbacks.defaultConstrain(h,g),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=n?.renderWorldCopies===void 0||!!n?.renderWorldCopies,this._minZoom=n?.minZoom||0,this._maxZoom=n?.maxZoom||22,this._minPitch=n?.minPitch==null?0:n?.minPitch,this._maxPitch=n?.maxPitch==null?60:n?.maxPitch,this._constrainOverride=(l=n?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Qr(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new So,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,n,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Qr(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new So(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,n&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const n=c.W(t,-180,180)*Math.PI/180;var l,h,g,_,j,E,M,D,$;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=W(),l=this._rotationMatrix,g=-this._bearingInRadians,_=(h=this._rotationMatrix)[0],j=h[1],E=h[2],M=h[3],D=Math.sin(g),$=Math.cos(g),l[0]=_*$+E*D,l[1]=j*$+M*D,l[2]=_*-D+E*$,l[3]=j*-D+M*$)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const n=c.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const n=t/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aZ(this._fovInRadians)}setFov(t){t=c.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=c.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const n=this.applyConstrain(this._center,t).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=c.aq(n),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,n){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,l){this._unmodified=!1,this._edgeInsets.interpolate(t,n,l),this.constrainInternal(),this._calcMatrices()}resize(t,n,l=!0){this._width=t,this._height=n,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new as([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ao,c.ao])}getCameraQueryGeometry(t,n){if(n.length===1)return[n[0],t];{const{minX:l,minY:h,maxX:g,maxY:_}=c.aa.fromPoints(n).extend(t);return[new c.P(l,h),new c.P(g,h),new c.P(g,_),new c.P(l,_),new c.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:n,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(n),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=c.ar(new Float64Array(16));c.Q(t,t,[this._width/2,-this._height/2,1]),c.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=c.ar(new Float64Array(16)),c.Q(t,t,[1,-1,1]),c.O(t,t,[-1,-1,0]),c.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,n,l,h){const g=l!==void 0?l:this.bearing,_=h=h!==void 0?h:this.pitch,{distanceToCenter:j,clampedElevation:E}=this._distanceToCenterFromAltElevationPitch(n,this.elevation,_),{x:M,y:D}=Or(_,g),$=c.a9.fromLngLat(t,n);let B,G,J=c.a_(1,$.y),le=0;do{if(le+=1,le>10)break;G=j/J,B=new c.a9($.x+M*G,$.y+D*G),J=1/B.meterInMercatorCoordinateUnits()}while(Math.abs(j-G*J)>1e-12);return{center:B.toLngLat(),elevation:E,zoom:c.at(this.height/2/Math.tan(this.fovInRadians/2)/G/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const n=1/this.worldSize,l=c.as(1,this.center.lat)*this.worldSize,h=c.a9.fromLngLat(this.center,this.elevation),g=h.x/n,_=h.y/n,j=h.z/n,E=this.pitch,M=this.bearing,{x:D,y:$,z:B}=Or(E,M),G=this.cameraToCenterDistance,J=g+G*-D,le=_+G*-$,ue=j+G*B,{distanceToCenter:ce,clampedElevation:de}=this._distanceToCenterFromAltElevationPitch(ue/l,t,E),xe=ce*l,he=new c.a9((J+D*xe)*n,(le+$*xe)*n,0).toLngLat(),ge=c.as(1,he.lat),we=c.at(this.height/2/Math.tan(this.fovInRadians/2)/ce/ge/this.tileSize);this._elevation=de,this._center=he,this.setZoom(we)}_distanceToCenterFromAltElevationPitch(t,n,l){const h=-Math.cos(c.ap(l)),g=t-n;let _,j=n;return h*g>=0||Math.abs(h)<.1?(_=1e4,j=t+_*h):_=-g/h,{distanceToCenter:_,clampedElevation:j}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Fe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const n=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/n,t.canonical.y/n,1/n/c.a5,1/n/c.a5]}}class vn{constructor(t,n){this.min=t,this.max=n,this.center=c.a$([],c.b0([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],l=c.b1(this.min),h=c.b1(this.max);for(let g=0;g<n.length;g++)l[g]=n[g]?this.min[g]:this.center[g],h[g]=n[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new vn(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let n=!0;for(let l=0;l<t.planes.length;l++){const h=this.intersectsPlane(t.planes[l]);if(h===0)return 0;h===1&&(n=!1)}return n?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let n=t[3],l=t[3];for(let h=0;h<3;h++)t[h]>0?(n+=t[h]*this.min[h],l+=t[h]*this.max[h]):(l+=t[h]*this.min[h],n+=t[h]*this.max[h]);return n>=0?2:l<0?0:1}}class To{distanceToTile2d(t,n,l,h){const g=h.distanceX([t,n]),_=h.distanceY([t,n]);return Math.hypot(g,_)}getWrap(t,n,l){return l}getTileBoundingVolume(t,n,l,h){var g,_;let j=0,E=0;if(h?.terrain){const D=new c.a2(t.z,n,t.z,t.x,t.y),$=h.terrain.getMinMaxElevation(D);j=(g=$.minElevation)!==null&&g!==void 0?g:Math.min(0,l),E=(_=$.maxElevation)!==null&&_!==void 0?_:Math.max(0,l)}const M=1<<t.z;return new vn([n+t.x/M,t.y/M,j],[n+(t.x+1)/M,(t.y+1)/M,E])}allowVariableZoom(t,n){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=c.an(78.5-l/2,0,60);return!!n.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class Mn{constructor(t,n,l){this.points=t,this.planes=n,this.aabb=l}static fromInvProjectionMatrix(t,n=1,l=0,h,g){const _=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],j=Math.pow(2,l),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((B=>(function(G,J,le,ue){const ce=c.aH([],G,J),de=1/ce[3]/le*ue;return c.b6(ce,ce,[de,de,1/ce[3],de])})(B,t,n,j)));h&&(function(B,G,J,le){const ue=le?4:0,ce=le?0:4;let de=0;const xe=[],he=[];for(let me=0;me<4;me++){const Ne=c.b2([],B[me+ce],B[me+ue]),Ue=c.b7(Ne);c.a$(Ne,Ne,1/Ue),xe.push(Ue),he.push(Ne)}for(let me=0;me<4;me++){const Ne=c.b8(B[me+ue],he[me],J);de=Ne!==null&&Ne>=0?Math.max(de,Ne):Math.max(de,xe[me])}const ge=(function(me,Ne){const Ue=c.b2([],me[Ne[0]],me[Ne[1]]),Re=c.b2([],me[Ne[2]],me[Ne[1]]),Oe=[0,0,0,0];return c.b3(Oe,c.b4([],Ue,Re)),Oe[3]=-c.b5(Oe,me[Ne[0]]),Oe})(B,G),we=(function(me,Ne){const Ue=c.b9(me),Re=c.ba([],me,1/Ue),Oe=c.b2([],Ne,c.a$([],Re,c.b5(Ne,Re))),Be=c.b9(Oe);if(Be>0){const ot=Math.sqrt(1-Re[3]*Re[3]),ct=c.a$([],Re,-Re[3]),et=c.b0([],ct,c.a$([],Oe,ot/Be));return c.bb(Ne,et)}return null})(J,ge);if(we!==null){const me=we/c.b5(he[0],ge);de=Math.min(de,me)}for(let me=0;me<4;me++){const Ne=Math.min(de,xe[me]);B[me+ce]=[B[me+ue][0]+he[me][0]*Ne,B[me+ue][1]+he[me][1]*Ne,B[me+ue][2]+he[me][2]*Ne,1]}})(E,_[0],h,g);const M=_.map((B=>{const G=c.b2([],E[B[0]],E[B[1]]),J=c.b2([],E[B[2]],E[B[1]]),le=c.b3([],c.b4([],G,J)),ue=-c.b5(le,E[B[1]]);return le.concat(ue)})),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],$=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const B of E)for(let G=0;G<3;G++)D[G]=Math.min(D[G],B[G]),$[G]=Math.max($[G],B[G]);return new Mn(E,M,new vn(D,$))}}class No{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,l){return this._helper.interpolatePadding(t,n,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,l=!0){this._helper.resize(t,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,n){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(n,l)=>{l=c.an(+l,this.minZoom,this.maxZoom);const h={center:new c.V(n.lng,n.lat),zoom:l};let g=this._helper._lngRange;if(!this._helper._renderWorldCopies&&g===null){const he=179.9999999999;g=[-he,he]}const _=this.tileSize*c.aq(h.zoom);let j=0,E=_,M=0,D=_,$=0,B=0;const{x:G,y:J}=this.size;if(this._helper._latRange){const he=this._helper._latRange;j=c.X(he[1])*_,E=c.X(he[0])*_,E-j<J&&($=J/(E-j))}g&&(M=c.W(c.Y(g[0])*_,0,_),D=c.W(c.Y(g[1])*_,0,_),D<M&&(D+=_),D-M<G&&(B=G/(D-M)));const{x:le,y:ue}=It(_,n);let ce,de;const xe=Math.max(B||0,$||0);if(xe){const he=new c.P(B?(D+M)/2:le,$?(E+j)/2:ue);return h.center=Jt(_,he).wrap(),h.zoom+=c.at(xe),h}if(this._helper._latRange){const he=J/2;ue-he<j&&(de=j+he),ue+he>E&&(de=E-he)}if(g){const he=(M+D)/2;let ge=le;this._helper._renderWorldCopies&&(ge=c.W(le,he-_/2,he+_/2));const we=G/2;ge-we<M&&(ce=M+we),ge+we>D&&(ce=D-we)}if(ce!==void 0||de!==void 0){const he=new c.P(ce??le,de??ue);h.center=Jt(_,he).wrap()}return h},this.applyConstrain=(n,l)=>this._helper.applyConstrain(n,l),this._helper=new wa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,l)=>this.defaultConstrain(n,l)},t),this._coveringTilesDetailsProvider=new To}clone(){const t=new No;return t.apply(this),t}apply(t,n,l){this._helper.apply(t,n,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const n=[new c.bc(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new c.P(0,0)),h=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),_=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),j=Math.floor(Math.min(l.x,h.x,g.x,_.x)),E=Math.floor(Math.max(l.x,h.x,g.x,_.x)),M=1;for(let D=j-M;D<=E+M;D++)D!==0&&n.push(new c.bc(D,t))}return n}getCameraFrustum(){return Mn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const n=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,n){const l=c.as(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(n,l),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),_=c.a9.fromLngLat(t),j=new c.a9(_.x-(h.x-g.x),_.y-(h.y-g.y));this.setCenter(j?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,n){return n?this.coordinatePoint(c.a9.fromLngLat(t),n.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(c.a9.fromLngLat(t))}screenPointToLocation(t,n){var l;return(l=this.screenPointToMercatorCoordinate(t,n))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,n){if(n){const l=n.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,n){const l=n||0,h=[t.x,t.y,0,1],g=[t.x,t.y,1,1];c.aH(h,h,this._pixelMatrixInverse),c.aH(g,g,this._pixelMatrixInverse);const _=h[3],j=g[3],E=h[1]/_,M=g[1]/j,D=h[2]/_,$=g[2]/j,B=D===$?0:(l-D)/($-D);return new c.a9(c.G.number(h[0]/_,g[0]/j,B)/this.worldSize,c.G.number(E,M,B)/this.worldSize,l)}coordinatePoint(t,n=0,l=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,n,1];return c.aH(h,h,l),new c.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-wr(this));return new as().extend(this.screenPointToLocation(new c.P(0,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(t,n){return n?n.pointCoordinate(t)!=null:t.y>this.height/2-wr(this)}calculatePosMatrix(t,n=!1,l){var h;const g=(h=t.key)!==null&&h!==void 0?h:c.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),_=n?this._alignedPosMatrixCache:this._posMatrixCache;if(_.has(g)){const M=_.get(g);return l?M.f32:M.f64}const j=xr(t,this.worldSize);c.S(j,n?this._alignedProjMatrix:this._viewProjMatrix,j);const E={f64:j,f32:new Float32Array(j)};return _.set(g,E),l?E.f32:E.f64}calculateFogMatrix(t){const n=t.key,l=this._fogMatrixCacheF32;if(l.has(n))return l.get(n);const h=xr(t,this.worldSize);return c.S(h,this._fogMatrix,h),l.set(n,new Float32Array(h)),l.get(n)}calculateCenterFromCameraLngLatAlt(t,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,l,h)}_calculateNearFarZIfNeeded(t,n,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=t-h*this._helper._pixelPerMeter/Math.cos(n),_=h<0?g:t,j=Math.PI/2+this.pitchInRadians,E=c.ap(this.fov)*(Math.abs(Math.cos(c.ap(this.roll)))*this.height+Math.abs(Math.sin(c.ap(this.roll)))*this.width)/this.height*(.5+l.y/this.height),M=Math.sin(E)*_/Math.sin(c.an(Math.PI-j-E,.01,Math.PI-.01)),D=wr(this),$=Math.atan(D/this._helper.cameraToCenterDistance),B=c.ap(.75),G=$>B?2*$*(.5+l.y/(2*D)):B,J=Math.sin(G)*_/Math.sin(c.an(Math.PI-j-G,.01,Math.PI-.01)),le=Math.min(M,J);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*le+_),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,n=It(this.worldSize,this.center),l=n.x,h=n.y;this._helper._pixelPerMeter=c.as(1,this.center.lat)*this.worldSize;const g=c.ap(Math.min(this.pitch,kt)),_=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let j;this._calculateNearFarZIfNeeded(_,g,t),j=new Float64Array(16),c.be(j,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aB(this._invProjMatrix,j),j[8]=2*-t.x/this._helper._width,j[9]=2*t.y/this._helper._height,this._projectionMatrix=c.bf(j),c.Q(j,j,[1,-1,1]),c.O(j,j,[0,0,-this._helper.cameraToCenterDistance]),c.bg(j,j,-this.rollInRadians),c.bh(j,j,this.pitchInRadians),c.bg(j,j,-this.bearingInRadians),c.O(j,j,[-l,-h,0]),this._mercatorMatrix=c.Q([],j,[this.worldSize,this.worldSize,this.worldSize]),c.Q(j,j,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,j),c.O(j,j,[0,0,-this.elevation]),this._viewProjMatrix=j,this._invViewProjMatrix=c.aB([],j);const E=[0,0,-1,1];c.aH(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),c.be(this._fogMatrix,this.fovInRadians,this.width/this.height,_,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-l,-h,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,j);const M=this._helper._width%2/2,D=this._helper._height%2/2,$=Math.cos(this.bearingInRadians),B=Math.sin(-this.bearingInRadians),G=l-Math.round(l)+$*M+B*D,J=h-Math.round(h)+$*D+B*M,le=new Float64Array(j);if(c.O(le,le,[G>.5?G-1:G,J>.5?J-1:J,0]),this._alignedProjMatrix=le,j=c.aB(new Float64Array(16),this._pixelMatrix),!j)throw new Error("failed to invert matrix");this._pixelMatrixInverse=j,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new c.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.aH(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Fe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,n){const l=c.a9.fromLngLat(t),h=[l.x*this.worldSize,l.y*this.worldSize,n,1];return c.aH(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:n,aligned:l,applyTerrainMatrix:h}=t,g=this._helper.getMercatorTileCoordinates(n),_=n?this.calculatePosMatrix(n,l,!0):null;let j;return j=n&&n.terrainRttPosMatrix32f&&h?n.terrainRttPosMatrix32f:_||c.bi(),{mainMatrix:j,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:j}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,n,l){return 1}transformLightDirection(t){return c.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,n,l,h){const g=this.calculatePosMatrix(l);let _;h?(_=[t,n,h(t,n),1],c.aH(_,_,g)):(_=[t,n,0,1],tu(_,_,g));const j=_[3];return{point:new c.P(_[0]/j,_[1]/j),signedDistanceFromCamera:j,isOccluded:!1}}populateCache(t){for(const n of t)this.calculatePosMatrix(n)}getMatrixForModel(t,n){const l=c.a9.fromLngLat(t,n),h=l.meterInMercatorCoordinateUnits(),g=c.bj();return c.O(g,g,[l.x,l.y,l.z]),c.bg(g,g,Math.PI),c.bh(g,g,Math.PI/2),c.Q(g,g,[-h,h,h]),g}getProjectionDataForCustomLayer(t=!0){const n=new c.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:t}),h=xr(n,this.worldSize);c.S(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const g=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],_=c.bk();return c.Q(_,h,g),l.fallbackMatrix=_,l.mainMatrix=_,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function ka(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function cc(m){if(m.useSlerp)if(m.k<1){const t=c.bl(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),n=c.bl(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);c.bm(l,t,n,m.k);const h=c.bn(l);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(c.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(c.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(c.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function uc(m,t,n,l,h){const g=h.padding,_=It(h.worldSize,n.getNorthWest()),j=It(h.worldSize,n.getNorthEast()),E=It(h.worldSize,n.getSouthEast()),M=It(h.worldSize,n.getSouthWest()),D=c.ap(-l),$=_.rotate(D),B=j.rotate(D),G=E.rotate(D),J=M.rotate(D),le=new c.P(Math.max($.x,B.x,J.x,G.x),Math.max($.y,B.y,J.y,G.y)),ue=new c.P(Math.min($.x,B.x,J.x,G.x),Math.min($.y,B.y,J.y,G.y)),ce=le.sub(ue),de=(h.width-(g.left+g.right+t.left+t.right))/ce.x,xe=(h.height-(g.top+g.bottom+t.top+t.bottom))/ce.y;if(xe<0||de<0)return void ka();const he=Math.min(c.at(h.scale*Math.min(de,xe)),m.maxZoom),ge=c.P.convert(m.offset),we=new c.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(c.ap(l)),me=ge.add(we).mult(h.scale/c.aq(he));return{center:Jt(h.worldSize,_.add(E).div(2).sub(me)),zoom:he,bearing:l}}class Gi{get useGlobeControls(){return!1}handlePanInertia(t,n){const l=t.mag(),h=Math.abs(wr(n));return{easingOffset:t.mult(Math.min(.75*h/l,1)),easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(t,n){t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta),t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta)}handleMapControlsPan(t,n,l){t.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,n,l,h,g){return uc(t,n,l,h,g)}handleJumpToCenterZoom(t,n){t.zoom!==(n.zoom!==void 0?+n.zoom:t.zoom)&&t.setZoom(+n.zoom),n.center!==void 0&&t.setCenter(c.V.convert(n.center))}handleEaseTo(t,n){const l=t.zoom,h=t.padding,g={roll:t.roll,pitch:t.pitch,bearing:t.bearing},_={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},j=n.zoom!==void 0,E=!t.isPaddingEqual(n.padding);let M=!1;const D=j?+n.zoom:t.zoom;let $=t.centerPoint.add(n.offsetAsPoint);const B=t.screenPointToLocation($),{center:G,zoom:J}=t.applyConstrain(c.V.convert(n.center||B),D??l);qi(t,G);const le=It(t.worldSize,B),ue=It(t.worldSize,G).sub(le),ce=c.aq(J-l);return M=J!==l,{easeFunc:de=>{if(M&&t.setZoom(c.G.number(l,J,de)),c.bo(g,_)||cc({startEulerAngles:g,endEulerAngles:_,tr:t,k:de,useSlerp:g.roll!=_.roll}),E&&(t.interpolatePadding(h,n.padding,de),$=t.centerPoint.add(n.offsetAsPoint)),n.around)t.setLocationAtPoint(n.around,n.aroundPoint);else{const xe=c.aq(t.zoom-l),he=J>l?Math.min(2,ce):Math.max(.5,ce),ge=Math.pow(he,1-de),we=Jt(t.worldSize,le.add(ue.mult(de*ge)).mult(xe));t.setLocationAtPoint(t.renderWorldCopies?we.wrap():we,$)}},isZooming:M,elevationCenter:G}}handleFlyTo(t,n){const l=n.zoom!==void 0,h=t.zoom,g=t.applyConstrain(c.V.convert(n.center||n.locationAtOffset),l?+n.zoom:h),_=g.center,j=g.zoom;qi(t,_);const E=It(t.worldSize,n.locationAtOffset),M=It(t.worldSize,_).sub(E),D=M.mag(),$=c.aq(j-h);let B;if(n.minZoom!==void 0){const G=Math.min(+n.minZoom,h,j),J=t.applyConstrain(_,G).zoom;B=c.aq(J-h)}return{easeFunc:(G,J,le,ue)=>{t.setZoom(G===1?j:h+c.at(J));const ce=G===1?_:Jt(t.worldSize,E.add(M.mult(le)).mult(J));t.setLocationAtPoint(t.renderWorldCopies?ce.wrap():ce,ue)},scaleOfZoom:$,targetCenter:_,scaleOfMinZoom:B,pixelPathLength:D}}}class br{constructor(t,n,l){this.blendFunction=t,this.blendColor=n,this.mask=l}}br.Replace=[1,0],br.disabled=new br(br.Replace,c.bp.transparent,[!1,!1,!1,!1]),br.unblended=new br(br.Replace,c.bp.transparent,[!0,!0,!0,!0]),br.alphaBlended=new br([1,771],c.bp.transparent,[!0,!0,!0,!0]);const Zi=2305;class pr{constructor(t,n,l){this.enable=t,this.mode=n,this.frontFace=l}}pr.disabled=new pr(!1,1029,Zi),pr.backCCW=new pr(!0,1029,Zi),pr.frontCCW=new pr(!0,1028,Zi);class or{constructor(t,n,l){this.func=t,this.mask=n,this.range=l}}or.ReadOnly=!1,or.ReadWrite=!0,or.disabled=new or(519,or.ReadOnly,[0,1]);const _i=7680;class mr{constructor(t,n,l,h,g,_){this.test=t,this.ref=n,this.mask=l,this.fail=h,this.depthFail=g,this.pass=_}}mr.disabled=new mr({func:519,mask:0},0,0,_i,_i,_i);const vl=new WeakMap;function fs(m){var t;if(vl.has(m))return vl.get(m);{const n=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return vl.set(m,n),n}}class ja{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const n=t.context,l=n.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new c.aW;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const g=new c.aY;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Br(n.createVertexBuffer(h,ra.members),n.createIndexBuffer(g),c.aX.simpleSegment(0,0,h.length,g.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(l.TEXTURE1);const _=l.createTexture();l.bindTexture(l.TEXTURE_2D,_),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(_),fs(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,n){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,n=t.gl;t.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,n){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:c.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,or.disabled,mr.disabled,br.unblended,pr.disabled,((g,_)=>({u_input:g,u_output_expected:_}))(t,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&fs(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const g=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&fs(t)){const n=t.clientWaitSync(this._readbackQueue.sync,0,0);if(n===t.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ja._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let n=0;return n+=t[0]/256,n+=t[1]/65536,n+=t[2]/16777216,t[3]<127&&(n=-n),n/128}}const Ua=c.a5/128;function wl(m,t){const n=m.granularity!==void 0?Math.max(m.granularity,1):1,l=n+(m.generateBorders?2:0),h=n+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=l+1,_=h+1,j=m.generateBorders?-1:0,E=m.generateBorders||m.extendToNorthPole?-1:0,M=n+(m.generateBorders?1:0),D=n+(m.generateBorders||m.extendToSouthPole?1:0),$=g*_,B=l*h*6,G=g*_>65536;if(G&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const J=G||t==="32bit",le=new Int16Array(2*$);let ue=0;for(let xe=E;xe<=D;xe++)for(let he=j;he<=M;he++){let ge=he/n*c.a5;he===-1&&(ge=-Ua),he===n+1&&(ge=c.a5+Ua);let we=xe/n*c.a5;xe===-1&&(we=m.extendToNorthPole?c.br:-Ua),xe===n+1&&(we=m.extendToSouthPole?c.bs:c.a5+Ua),le[ue++]=ge,le[ue++]=we}const ce=J?new Uint32Array(B):new Uint16Array(B);let de=0;for(let xe=0;xe<h;xe++)for(let he=0;he<l;he++){const ge=he+1+xe*g,we=he+(xe+1)*g,me=he+1+(xe+1)*g;ce[de++]=he+xe*g,ce[de++]=we,ce[de++]=ge,ce[de++]=ge,ce[de++]=we,ce[de++]=me}return{vertices:le.buffer.slice(0),indices:ce.buffer.slice(0),uses32bitIndices:J}}const dc=new c.aV({fill:new c.bt(128,2),line:new c.bt(512,0),tile:new c.bt(128,32),stencil:new c.bt(128,1),circle:3});class hc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ir.projectionGlobe}get vertexShaderPreludeCode(){return Ir.projectionMercator.vertexSource}get subdivisionGranularity(){return dc}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new ja(t));const n=c.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(n,l),g=re();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=g);const _=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bv(_))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,n,l,h,g){const _=(g==="stencil"?dc.stencil:dc.tile).getGranularityForZoomLevel(n.z);return this._getMesh(t,{granularity:_,generateBorders:l,extendToNorthPole:n.y===0&&h,extendToSouthPole:n.y===(1<<n.z)-1&&h})}_getMesh(t,n){const l=this._getMeshKey(n);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=(function(g,_){const j=wl(_,"16bit"),E=c.aW.deserialize({arrayBuffer:j.vertices,length:j.vertices.byteLength/2/2}),M=c.aY.deserialize({arrayBuffer:j.indices,length:j.indices.byteLength/2/3});return new Br(g.createVertexBuffer(E,ra.members),g.createIndexBuffer(M),c.aX.simpleSegment(0,0,E.length,M.length))})(t,n);return this._tileMeshCache[l]=h,h}recalculate(t){}hasTransition(){const t=re();let n=!1;return n=n||(t-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const ud=new c.t({type:new c.D(c.u.projection.type)});class kl extends c.E{constructor(t){super(),this._transitionable=new c.x(ud,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new Gs,this._verticalPerspectiveProjection=new hc}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof c.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,n,l,h,g){return this.currentProjection.getMeshFromTileID(t,n,l,h,g)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Zs(m){const t=Eo(m.worldSize,m.center.lat);return 2*Math.PI*t}function Sa(m,t,n,l,h){const g=1/(1<<h),_=t/c.a5*g+l*g,j=c.by((m/c.a5*g+n*g)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-_*Math.PI*2))-.5*Math.PI,M=Math.cos(E),D=new Float64Array(3);return D[0]=Math.sin(j)*M,D[1]=Math.sin(E),D[2]=Math.cos(j)*M,D}function os(m){return(function(t,n){const l=Math.cos(n),h=new Float64Array(3);return h[0]=Math.sin(t)*l,h[1]=Math.sin(n),h[2]=Math.cos(t)*l,h})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Eo(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function dd(m){const t=Math.asin(m[1])/Math.PI*180,n=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(n>1e-6){const l=m[0]/n,h=Math.acos(m[2]/n),g=(l>0?h:-h)/Math.PI*180;return new c.V(c.W(g,-180,180),t)}return new c.V(0,t)}function Co(m){return Math.cos(m*Math.PI/180)}function xs(m,t){const n=Co(m),l=Co(t);return c.at(l/n)}function hh(m,t){const n=m.rotate(t.bearingInRadians),l=t.zoom+xs(t.center.lat,0),h=c.bu(1/Co(t.center.lat),1/Co(Math.min(Math.abs(t.center.lat),60)),c.bx(l,7,3,0,1)),g=360/Zs({worldSize:t.worldSize,center:{lat:t.center.lat}});return new c.V(t.center.lng-n.x*g*h,c.an(t.center.lat+n.y*g,-c.ao,c.ao))}function hd(m){const t=.5*m,n=Math.sin(t),l=Math.cos(t);return Math.log(n+l)-Math.log(l-n)}function ph(m,t,n,l){const h=m.lat+n*l;if(Math.abs(n)>1){const g=(Math.sign(m.lat+n)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,_=Math.abs(m.lat+n)*Math.PI/180,j=hd(g+l*(_-g)),E=hd(g),M=hd(_);return new c.V(m.lng+t*((j-E)/(M-E)),h)}return new c.V(m.lng+t*l,h)}class np{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,n,l,h){const g=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,_=this._cache.get(g);if(_)return _;const j=this._cachePrevious.get(g);if(j)return this._cache.set(g,j),j;const E=this._boundingVolumeFactory(t,n,l,h);return this._cache.set(g,E),this._hadAnyChanges=!0,E}}class Po{constructor(t,n,l,h){this.min=l,this.max=h,this.points=t,this.planes=n}static fromAabb(t,n){const l=[];for(let h=0;h<8;h++)l.push([1&~h?t[0]:n[0],(h>>1&1)==1?n[1]:t[1],(h>>2&1)==1?n[2]:t[2]]);return new Po(l,[[-1,0,0,n[0]],[1,0,0,-t[0]],[0,-1,0,n[1]],[0,1,0,-t[1]],[0,0,-1,n[2]],[0,0,1,-t[2]]],t,n)}static fromCenterSizeAngles(t,n,l){const h=c.bB([],l[0],l[1],l[2]),g=c.bC([],[n[0],0,0],h),_=c.bC([],[0,n[1],0],h),j=c.bC([],[0,0,n[2]],h),E=[...t],M=[...t];for(let $=0;$<8;$++)for(let B=0;B<3;B++){const G=t[B]+g[B]*(1&~$?-1:1)+_[B]*(($>>1&1)==1?1:-1)+j[B]*(($>>2&1)==1?1:-1);E[B]=Math.min(E[B],G),M[B]=Math.max(M[B],G)}const D=[];for(let $=0;$<8;$++){const B=[...t];c.b0(B,B,c.a$([],g,1&~$?-1:1)),c.b0(B,B,c.a$([],_,($>>1&1)==1?1:-1)),c.b0(B,B,c.a$([],j,($>>2&1)==1?1:-1)),D.push(B)}return new Po(D,[[...g,-c.b5(g,D[0])],[..._,-c.b5(_,D[0])],[...j,-c.b5(j,D[0])],[-g[0],-g[1],-g[2],-c.b5(g,D[7])],[-_[0],-_[1],-_[2],-c.b5(_,D[7])],[-j[0],-j[1],-j[2],-c.b5(j,D[7])]],E,M)}intersectsFrustum(t){let n=!0;const l=this.points.length,h=this.planes.length,g=t.planes.length,_=t.points.length;for(let j=0;j<g;j++){const E=t.planes[j];let M=0;for(let D=0;D<l;D++){const $=this.points[D];E[0]*$[0]+E[1]*$[1]+E[2]*$[2]+E[3]>=0&&M++}if(M===0)return 0;M<l&&(n=!1)}if(n)return 2;for(let j=0;j<h;j++){const E=this.planes[j];let M=0;for(let D=0;D<_;D++){const $=t.points[D];E[0]*$[0]+E[1]*$[1]+E[2]*$[2]+E[3]>=0&&M++}if(M===0)return 0}return 1}intersectsPlane(t){const n=this.points.length;let l=0;for(let h=0;h<n;h++){const g=this.points[h];t[0]*g[0]+t[1]*g[1]+t[2]*g[2]+t[3]>=0&&l++}return l===n?2:l===0?0:1}}function nu(m,t,n){const l=m-t;return l<0?-l:Math.max(0,l-n)}function jl(m,t,n,l,h){const g=m-n;let _;return _=g<0?Math.min(-g,1+g-h):g>1?Math.min(Math.max(g-h,0),1-g):0,Math.max(_,nu(t,l,h))}class pd{constructor(){this._boundingVolumeCache=new np(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,n,l,h){const g=1<<l.z,_=1/g,j=l.x/g,E=l.y/g;let M=2;return M=Math.min(M,jl(t,n,j,E,_)),M=Math.min(M,jl(t,n,j+.5,-E-_,_)),M=Math.min(M,jl(t,n,j+.5,2-E-_,_)),M}getWrap(t,n,l){const h=1<<n.z,g=1/h,_=n.x/h,j=nu(t.x,_,g),E=nu(t.x,_-1,g),M=nu(t.x,_+1,g),D=Math.min(j,E,M);return D===M?1:D===E?-1:0}allowVariableZoom(t,n){return Gr(t,n)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,n,l,h){return this._boundingVolumeCache.getTileBoundingVolume(t,n,l,h)}_computeTileBoundingVolume(t,n,l,h){var g,_;let j=0,E=0;if(h?.terrain){const M=new c.a2(t.z,n,t.z,t.x,t.y),D=h.terrain.getMinMaxElevation(M);j=(g=D.minElevation)!==null&&g!==void 0?g:Math.min(0,l),E=(_=D.maxElevation)!==null&&_!==void 0?_:Math.max(0,l)}if(j/=c.bE,E/=c.bE,j+=1,E+=1,t.z<=0)return Po.fromAabb([-E,-E,-E],[E,E,E]);if(t.z===1)return Po.fromAabb([t.x===0?-E:0,t.y===0?0:-E,-E],[t.x===0?0:E,t.y===0?E:0,E]);{const M=[Sa(0,0,t.x,t.y,t.z),Sa(c.a5,0,t.x,t.y,t.z),Sa(c.a5,c.a5,t.x,t.y,t.z),Sa(0,c.a5,t.x,t.y,t.z)],D=[];for(const Oe of M)D.push(c.a$([],Oe,E));if(E!==j)for(const Oe of M)D.push(c.a$([],Oe,j));t.y===0&&D.push([0,1,0]),t.y===(1<<t.z)-1&&D.push([0,-1,0]);const $=[1,1,1],B=[-1,-1,-1];for(const Oe of D)for(let Be=0;Be<3;Be++)$[Be]=Math.min($[Be],Oe[Be]),B[Be]=Math.max(B[Be],Oe[Be]);const G=Sa(c.a5/2,c.a5/2,t.x,t.y,t.z),J=c.b4([],[0,1,0],G);c.b3(J,J);const le=c.b4([],G,J);c.b3(le,le);const ue=c.b4([],M[2],M[1]);c.b3(ue,ue);const ce=c.b4([],M[0],M[3]);c.b3(ce,ce),D.push(c.a$([],G,E)),t.y>=(1<<t.z)/2&&D.push(c.a$([],Sa(c.a5/2,0,t.x,t.y,t.z),E)),t.y<(1<<t.z)/2&&D.push(c.a$([],Sa(c.a5/2,c.a5,t.x,t.y,t.z),E));const de=pc(G,D),xe=pc(le,D),he=[-G[0],-G[1],-G[2],de.max],ge=[G[0],G[1],G[2],-de.min],we=[-le[0],-le[1],-le[2],xe.max],me=[le[0],le[1],le[2],-xe.min],Ne=[...ue,0],Ue=[...ce,0],Re=[];return t.y===0?Re.push(c.bD(Ue,Ne,he),c.bD(Ue,Ne,ge)):Re.push(c.bD(we,Ne,he),c.bD(we,Ne,ge),c.bD(we,Ue,he),c.bD(we,Ue,ge)),t.y===(1<<t.z)-1?Re.push(c.bD(Ue,Ne,he),c.bD(Ue,Ne,ge)):Re.push(c.bD(me,Ne,he),c.bD(me,Ne,ge),c.bD(me,Ue,he),c.bD(me,Ue,ge)),new Po(Re,[he,ge,we,me,Ne,Ue],$,B)}}}function pc(m,t){let n=1/0,l=-1/0;for(const h of t){const g=c.b5(m,h);n=Math.min(n,g),l=Math.max(l,g)}return{min:n,max:l}}class Hi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,l){return this._helper.interpolatePadding(t,n,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n){this._helper.resize(t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=c.bF(),this._projectionMatrix=c.bj(),this._globeViewProjMatrix32f=c.bi(),this._globeViewProjMatrixNoCorrection=c.bj(),this._globeViewProjMatrixNoCorrectionInverted=c.bj(),this._globeProjMatrixInverted=c.bj(),this._cameraPosition=c.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(n,l)=>{const h=c.an(n.lat,-c.ao,c.ao),g=c.an(+l,this.minZoom+xs(0,h),this.maxZoom);return{center:new c.V(n.lng,h),zoom:g}},this.applyConstrain=(n,l)=>this._helper.applyConstrain(n,l),this._helper=new wa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,l)=>this.defaultConstrain(n,l)},t),this._coveringTilesDetailsProvider=new pd}clone(){const t=new Hi;return t.apply(this),t}apply(t,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=c.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:n,applyGlobeMatrix:l}=t,h=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const n=this.pitchInRadians,l=this.cameraToCenterDistance/t,h=Math.sin(n)*l,g=Math.cos(n)*l+1,_=1/Math.sqrt(h*h+g*g)*1;let j=-h,E=g;const M=Math.sqrt(j*j+E*E);j/=M,E/=M;const D=[0,j,E];c.bG(D,D,[0,0,0],-this.bearingInRadians),c.bH(D,D,[0,0,0],-1*this.center.lat*Math.PI/180),c.bI(D,D,[0,0,0],this.center.lng*Math.PI/180);const $=1/c.b7(D);return c.a$(D,D,$),[...D,-_*$]}isLocationOccluded(t){return!this.isSurfacePointVisible(os(t))}transformLightDirection(t){const n=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),g=[Math.sin(n)*h,Math.sin(l),Math.cos(n)*h],_=[g[2],0,-g[0]],j=[0,0,0];c.b4(j,_,g),c.b3(_,_),c.b3(j,j);const E=[0,0,0];return c.b3(E,[_[0]*t[0]+j[0]*t[1]+g[0]*t[2],_[1]*t[0]+j[1]*t[1]+g[1]*t[2],_[2]*t[0]+j[2]*t[1]+g[2]*t[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,n,l){const h=(function(j,E,M){const D=1/(1<<M.z);return new c.a9(j/c.a5*D+M.x*D,E/c.a5*D+M.y*D)})(t,n,l.canonical),g=(_=h.y,[c.by(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-_*Math.PI*2))-.5*Math.PI]);var _;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(t,n,l,h){const g=l.canonical,_=Sa(t,n,g.x,g.y,g.z),j=1+(h?h(t,n):0)/c.bE,E=[_[0]*j,_[1]*j,_[2]*j,1];c.aH(E,E,this._globeViewProjMatrixNoCorrection);const M=this._cachedClippingPlane,D=M[0]*_[0]+M[1]*_[1]+M[2]*_[2]+M[3]<0;return{point:new c.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:D}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Eo(this.worldSize,this.center.lat),n=c.bk(),l=c.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),c.be(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;n[8]=2*-h.x/this._helper._width,n[9]=2*h.y/this._helper._height,this._projectionMatrix=c.bf(n),this._globeProjMatrixInverted=c.bk(),c.aB(this._globeProjMatrixInverted,n),c.O(n,n,[0,0,-this.cameraToCenterDistance]),c.bg(n,n,this.rollInRadians),c.bh(n,n,-this.pitchInRadians),c.bg(n,n,this.bearingInRadians),c.O(n,n,[0,0,-t]);const g=c.bz();g[0]=t,g[1]=t,g[2]=t,c.bh(l,n,this.center.lat*Math.PI/180),c.bJ(l,l,-this.center.lng*Math.PI/180),c.Q(l,l,g),this._globeViewProjMatrixNoCorrection=l,c.bh(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bJ(n,n,-this.center.lng*Math.PI/180),c.Q(n,n,g),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),c.aB(this._globeViewProjMatrixNoCorrectionInverted,l);const _=c.bz();this._cameraPosition=c.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,c.bG(this._cameraPosition,this._cameraPosition,_,-this.rollInRadians),c.bH(this._cameraPosition,this._cameraPosition,_,this.pitchInRadians),c.bG(this._cameraPosition,this._cameraPosition,_,-this.bearingInRadians),c.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bH(this._cameraPosition,this._cameraPosition,_,-this.center.lat*Math.PI/180),c.bI(this._cameraPosition,this._cameraPosition,_,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const j=c.bf(this._globeViewProjMatrixNoCorrectionInverted);c.Q(j,j,[1,1,-1]),this._cachedFrustum=Mn.fromInvProjectionMatrix(j,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){c.w("calculateFogMatrix is not supported on globe projection.");const n=c.bk();return c.ar(n),n}getVisibleUnwrappedCoordinates(t){return[new c.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=os(t);c.a$(l,l,1+n/c.bE);const h=c.bF();return c.aH(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,n=.5*this.height,l=[new c.P(0,0),new c.P(t,0),new c.P(this.width,0),new c.P(this.width,n),new c.P(this.width,this.height),new c.P(t,this.height),new c.P(0,this.height),new c.P(0,n)],h=[];for(const $ of l)h.push(this.unprojectScreenPoint($));let g=0,_=0,j=0,E=0;const M=this.center;for(const $ of h){const B=c.bK(M.lng,$.lng),G=c.bK(M.lat,$.lat);B<_&&(_=B),B>g&&(g=B),G<E&&(E=G),G>j&&(j=G)}const D=[M.lng+_,M.lat+E,M.lng+g,M.lat+j];return this.isSurfacePointOnScreen([0,1,0])&&(D[3]=90,D[0]=-180,D[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(D[1]=-90,D[0]=-180,D[2]=180),new as(D)}calculateCenterFromCameraLngLatAlt(t,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,l,h)}setLocationAtPoint(t,n){const l=os(this.unprojectScreenPoint(n)),h=os(t),g=c.bz();c.bL(g);const _=c.bz();c.bI(_,l,g,-this.center.lng*Math.PI/180),c.bH(_,_,g,this.center.lat*Math.PI/180);const j=h[0]*h[0]+h[2]*h[2],E=_[0]*_[0];if(j<E)return;const M=Math.sqrt(j-E),D=-M,$=c.bM(h[0],h[2],_[0],M),B=c.bM(h[0],h[2],_[0],D),G=c.bz();c.bI(G,h,g,-$);const J=c.bM(G[1],G[2],_[1],_[2]),le=c.bz();c.bI(le,h,g,-B);const ue=c.bM(le[1],le[2],_[1],_[2]),ce=.5*Math.PI,de=J>=-ce&&J<=ce,xe=ue>=-ce&&ue<=ce;let he,ge;if(de&&xe){const Ue=this.center.lng*Math.PI/180,Re=this.center.lat*Math.PI/180;c.bN($,Ue)+c.bN(J,Re)<c.bN(B,Ue)+c.bN(ue,Re)?(he=$,ge=J):(he=B,ge=ue)}else if(de)he=$,ge=J;else{if(!xe)return;he=B,ge=ue}const we=he/Math.PI*180,me=ge/Math.PI*180,Ne=this.center.lat;this.setCenter(new c.V(we,c.an(me,-90,90))),this.setZoom(this.zoom+xs(Ne,this.center.lat))}locationToScreenPoint(t,n){const l=os(t);if(n){const h=n.getElevationForLngLatZoom(t,this._helper._tileZoom);c.a$(l,l,1+h/c.bE)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const n=c.bF();return c.aH(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new c.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,n){if(n){const l=n.pointCoordinate(t);if(l)return l}return c.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,n){var l;return(l=this.screenPointToMercatorCoordinate(t,n))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,n){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(t){const n=c.bF();n[0]=t.x/this.width*2-1,n[1]=-1*(t.y/this.height*2-1),n[2]=1,n[3]=1,c.aH(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const l=c.bz();l[0]=n[0]-this._cameraPosition[0],l[1]=n[1]-this._cameraPosition[1],l[2]=n[2]-this._cameraPosition[2];const h=c.bz();return c.b3(h,l),h}isSurfacePointVisible(t){const n=this._cachedClippingPlane;return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const n=c.bF();return c.aH(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(t,n){const l=c.b5(t,n),h=c.bz(),g=c.bz();c.a$(g,n,l),c.b2(h,t,g);const _=1-c.b5(h,h);if(_<0)return null;const j=c.b5(t,t)-1,E=-l+(l<0?1:-1)*Math.sqrt(_),M=j/E,D=E;return{tMin:Math.min(M,D),tMax:Math.max(M,D)}}unprojectScreenPoint(t){const n=this._cameraPosition,l=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(n,l);if(h){const D=c.bz();c.b0(D,n,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const $=c.bz();return c.b3($,D),dd($)}const g=this._cachedClippingPlane,_=g[0]*l[0]+g[1]*l[1]+g[2]*l[2],j=-c.bb(g,n)/_,E=c.bz();if(j>0)c.b0(E,n,[l[0]*j,l[1]*j,l[2]*j]);else{const D=c.bz();c.b0(D,n,[2*l[0],2*l[1],2*l[2]]);const $=c.bb(this._cachedClippingPlane,D);c.b2(E,D,[this._cachedClippingPlane[0]*$,this._cachedClippingPlane[1]*$,this._cachedClippingPlane[2]*$])}const M=(function(D){const $=c.bz();return $[0]=D[0]*-D[3],$[1]=D[1]*-D[3],$[2]=D[2]*-D[3],{center:$,radius:Math.sqrt(1-D[3]*D[3])}})(g);return dd((function(D,$,B){const G=c.bz();c.b2(G,B,D);const J=c.bz();return c.bA(J,D,G,$/c.b9(G)),J})(M.center,M.radius,E))}getMatrixForModel(t,n){const l=c.V.convert(t),h=1/c.bE,g=c.bj();return c.bJ(g,g,l.lng/180*Math.PI),c.bh(g,g,-l.lat/180*Math.PI),c.O(g,g,[0,0,1+n/c.bE]),c.bh(g,g,.5*Math.PI),c.Q(g,g,[h,h,h]),g}getProjectionDataForCustomLayer(t=!0){const n=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:t});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(t){}}class Sl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,l){return this._helper.interpolatePadding(t,n,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,l=!0){this._helper.resize(t,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,n){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(n,l)=>this.currentTransform.defaultConstrain(n,l),this.applyConstrain=(n,l)=>this._helper.applyConstrain(n,l),this._helper=new wa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,l)=>this.defaultConstrain(n,l)},t),this._globeness=1,this._mercatorTransform=new No,this._verticalPerspectiveTransform=new Hi}clone(){const t=new Sl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const n=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:n.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return c.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,n,l){const h=this._mercatorTransform.getPitchedTextCorrection(t,n,l),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,n,l);return c.bu(h,g,this._globeness)}projectTileCoordinates(t,n,l,h){return this.currentTransform.projectTileCoordinates(t,n,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){return this.currentTransform.lngLatToCameraDepth(t,n)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,l,h)}setLocationAtPoint(t,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,n){return this.currentTransform.locationToScreenPoint(t,n)}screenPointToMercatorCoordinate(t,n){return this.currentTransform.screenPointToMercatorCoordinate(t,n)}screenPointToLocation(t,n){return this.currentTransform.screenPointToLocation(t,n)}isPointOnMapSurface(t,n){return this.currentTransform.isPointOnMapSurface(t,n)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,n){return this.currentTransform.getMatrixForModel(t,n)}getProjectionDataForCustomLayer(t=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return n;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=n.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Ms{get useGlobeControls(){return!0}handlePanInertia(t,n){const l=hh(t,n);return Math.abs(l.lng-n.center.lng)>180&&(l.lng=n.center.lng+179.5*Math.sign(l.lng-n.center.lng)),{easingCenter:l,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,n){const l=t.around,h=n.screenPointToLocation(l);t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta);const g=n.zoom;t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta);const _=n.zoom-g;if(_===0)return;const j=c.bK(n.center.lng,h.lng),E=j/(Math.abs(j/180)+1),M=c.bK(n.center.lat,h.lat),D=n.getRayDirectionFromPixel(l),$=n.cameraPosition,B=-1*c.b5($,D),G=c.bz();c.b0(G,$,[D[0]*B,D[1]*B,D[2]*B]);const J=c.b7(G)-1,le=Math.exp(.5*-Math.max(J-.3,0)),ue=Eo(n.worldSize,n.center.lat)/Math.min(n.width,n.height),ce=c.bx(ue,.9,.5,1,.25),de=(1-c.aq(-_))*Math.min(le,ce),xe=n.center.lat,he=n.zoom,ge=new c.V(n.center.lng+E*de,c.an(n.center.lat+M*de,-c.ao,c.ao));n.setLocationAtPoint(h,l);const we=n.center,me=c.bx(Math.abs(j),45,85,0,1),Ne=c.bx(ue,.75,.35,0,1),Ue=Math.pow(Math.max(me,Ne),.25),Re=c.bK(we.lng,ge.lng),Oe=c.bK(we.lat,ge.lat);n.setCenter(new c.V(we.lng+Re*Ue,we.lat+Oe*Ue).wrap()),n.setZoom(he+xs(xe,n.center.lat))}handleMapControlsPan(t,n,l){if(!t.panDelta)return;const h=n.center.lat,g=n.zoom;n.setCenter(hh(t.panDelta,n).wrap()),n.setZoom(g+xs(h,n.center.lat))}cameraForBoxAndBearing(t,n,l,h,g){const _=uc(t,n,l,h,g),j=n.left/g.width*2-1,E=(g.width-n.right)/g.width*2-1,M=n.top/g.height*-2+1,D=(g.height-n.bottom)/g.height*-2+1,$=c.bK(l.getWest(),l.getEast())<0,B=$?l.getEast():l.getWest(),G=$?l.getWest():l.getEast(),J=Math.max(l.getNorth(),l.getSouth()),le=Math.min(l.getNorth(),l.getSouth()),ue=B+.5*c.bK(B,G),ce=J+.5*c.bK(J,le),de=g.clone();de.setCenter(_.center),de.setBearing(_.bearing),de.setPitch(0),de.setRoll(0),de.setZoom(_.zoom);const xe=de.modelViewProjectionMatrix,he=[os(l.getNorthWest()),os(l.getNorthEast()),os(l.getSouthWest()),os(l.getSouthEast()),os(new c.V(G,ce)),os(new c.V(B,ce)),os(new c.V(ue,J)),os(new c.V(ue,le))],ge=os(_.center);let we=Number.POSITIVE_INFINITY;for(const me of he)j<0&&(we=Ms.getLesserNonNegativeNonNull(we,Ms.solveVectorScale(me,ge,xe,"x",j))),E>0&&(we=Ms.getLesserNonNegativeNonNull(we,Ms.solveVectorScale(me,ge,xe,"x",E))),M>0&&(we=Ms.getLesserNonNegativeNonNull(we,Ms.solveVectorScale(me,ge,xe,"y",M))),D<0&&(we=Ms.getLesserNonNegativeNonNull(we,Ms.solveVectorScale(me,ge,xe,"y",D)));if(Number.isFinite(we)&&we!==0)return _.zoom=de.zoom+c.at(we),_;ka()}handleJumpToCenterZoom(t,n){const l=t.center.lat,h=t.applyConstrain(n.center?c.V.convert(n.center):t.center,t.zoom).center;t.setCenter(h.wrap());const g=n.zoom!==void 0?+n.zoom:t.zoom+xs(l,h.lat);t.zoom!==g&&t.setZoom(g)}handleEaseTo(t,n){const l=t.zoom,h=t.center,g=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},j={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},E=n.zoom!==void 0,M=!t.isPaddingEqual(n.padding);let D=!1;const $=n.center?c.V.convert(n.center):h,B=t.applyConstrain($,l).center;qi(t,B);const G=t.clone();G.setCenter(B),G.setZoom(E?+n.zoom:l+xs(h.lat,$.lat)),G.setBearing(n.bearing);const J=new c.P(c.an(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));G.setLocationAtPoint(B,J);const le=(n.offset&&n.offsetAsPoint.mag())>0?G.center:B,ue=E?+n.zoom:l+xs(h.lat,le.lat),ce=l+xs(h.lat,0),de=ue+xs(le.lat,0),xe=c.bK(h.lng,le.lng),he=c.bK(h.lat,le.lat),ge=c.aq(de-ce);return D=ue!==l,{easeFunc:we=>{if(c.bo(_,j)||cc({startEulerAngles:_,endEulerAngles:j,tr:t,k:we,useSlerp:_.roll!=j.roll}),M&&t.interpolatePadding(g,n.padding,we),n.around)c.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(n.around,n.aroundPoint);else{const me=de>ce?Math.min(2,ge):Math.max(.5,ge),Ne=Math.pow(me,1-we),Ue=ph(h,xe,he,we*Ne);t.setCenter(Ue.wrap())}if(D){const me=c.G.number(ce,de,we)+xs(0,t.center.lat);t.setZoom(me)}},isZooming:D,elevationCenter:le}}handleFlyTo(t,n){const l=n.zoom!==void 0,h=t.center,g=t.zoom,_=t.padding,j=!t.isPaddingEqual(n.padding),E=t.applyConstrain(c.V.convert(n.center||n.locationAtOffset),g).center,M=l?+n.zoom:t.zoom+xs(t.center.lat,E.lat),D=t.clone();D.setCenter(E),D.setZoom(M),D.setBearing(n.bearing);const $=new c.P(c.an(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));D.setLocationAtPoint(E,$);const B=D.center;qi(t,B);const G=(function(he,ge,we){const me=os(ge),Ne=os(we),Ue=c.b5(me,Ne),Re=Math.acos(Ue),Oe=Zs(he);return Re/(2*Math.PI)*Oe})(t,h,B),J=g+xs(h.lat,0),le=M+xs(B.lat,0),ue=c.aq(le-J);let ce;if(typeof n.minZoom=="number"){const he=+n.minZoom+xs(B.lat,0),ge=Math.min(he,J,le)+xs(0,B.lat),we=t.applyConstrain(B,ge).zoom+xs(B.lat,0);ce=c.aq(we-J)}const de=c.bK(h.lng,B.lng),xe=c.bK(h.lat,B.lat);return{easeFunc:(he,ge,we,me)=>{const Ne=ph(h,de,xe,we);j&&t.interpolatePadding(_,n.padding,he);const Ue=he===1?B:Ne;t.setCenter(Ue.wrap());const Re=J+c.at(ge);t.setZoom(he===1?M:Re+xs(0,Ue.lat))},scaleOfZoom:ue,targetCenter:B,scaleOfMinZoom:ce,pixelPathLength:G}}static solveVectorScale(t,n,l,h,g){const _=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],j=[l[3],l[7],l[11],l[15]],E=t[0]*_[0]+t[1]*_[1]+t[2]*_[2],M=t[0]*j[0]+t[1]*j[1]+t[2]*j[2],D=n[0]*_[0]+n[1]*_[1]+n[2]*_[2],$=n[0]*j[0]+n[1]*j[1]+n[2]*j[2];return D+g*M===E+g*$||j[3]*(E-D)+_[3]*($-M)+E*$==D*M?null:(D+_[3]-g*$-g*j[3])/(D-E-g*$+g*M)}static getLesserNonNegativeNonNull(t,n){return n!==null&&n>=0&&n<t?n:t}}class fh{constructor(t){this._globe=t,this._mercatorCameraHelper=new Gi,this._verticalPerspectiveCameraHelper=new Ms}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,n){return this.currentHelper.handlePanInertia(t,n)}handleMapControlsRollPitchBearingZoom(t,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,n)}handleMapControlsPan(t,n,l){this.currentHelper.handleMapControlsPan(t,n,l)}cameraForBoxAndBearing(t,n,l,h,g){return this.currentHelper.cameraForBoxAndBearing(t,n,l,h,g)}handleJumpToCenterZoom(t,n){this.currentHelper.handleJumpToCenterZoom(t,n)}handleEaseTo(t,n){return this.currentHelper.handleEaseTo(t,n)}handleFlyTo(t,n){return this.currentHelper.handleFlyTo(t,n)}}const Mo=(m,t)=>c.B(m,t&&t.filter((n=>n.identifier!=="source.canvas"))),fc=c.bO();class Io extends c.E{constructor(t,n={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const _ in this.tileManagers){const j=this.tileManagers[_].getSource().type;j!=="vector"&&j!=="geojson"||this.tileManagers[_].reload()}},this.map=t,this.dispatcher=new Jr(Sr(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((_,j)=>this.getGlyphs(_,j))),this.dispatcher.registerMessageHandler("GI",((_,j)=>this.getImages(_,j))),this.dispatcher.registerMessageHandler("GDA",((_,j)=>this.getDashes(_,j))),this.imageManager=new Kt,this.imageManager.setEventedParent(this);const g=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new Tt(t._requestManager,n.localIdeographFontFamily,g),this.lineAtlas=new qt(256,512),this.crossTileSymbolIndex=new qs,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bP()),Ie().on(be,this._rtlPluginLoaded),this.on("data",(_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const j=this.tileManagers[_.sourceId];if(!j)return;const E=j.getSource();if(E&&E.vectorLayerIds)for(const M in this._layers){const D=this._layers[M];D.source===E.id&&this._validateLayer(D)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,n){var l,h,g;this._checkLoaded();const _=n===null?(g=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||h===void 0?void 0:h.default)!==null&&g!==void 0?g:null:n;if(c.bR(_,this._globalState[t]))return this;this._globalState[t]=_,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const n=[];for(const l in t)!c.bR(this._globalState[l],t[l].default)&&(n.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(n)}_applyGlobalStateChanges(t){if(t.length===0)return;const n=new Set,l={};for(const h of t){l[h]=this._globalState[h];for(const g in this._layers){const _=this._layers[g],j=_.getLayoutAffectingGlobalStateRefs(),E=_.getPaintAffectingGlobalStateRefs(),M=_.getVisibilityAffectingGlobalStateRefs();if(j.has(h)&&n.add(_.source),E.has(h))for(const{name:D,value:$}of E.get(h))this._updatePaintProperty(_,D,$);M?.has(h)&&(_.recalculateVisibility(),this._updateLayer(_))}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)n.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,n={},l){this.fire(new c.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;c.j(h,this._loadStyleRequest).then((_=>{this._loadStyleRequest=null,this._load(_.data,n,l)})).catch((_=>{this._loadStyleRequest=null,_&&!g.signal.aborted&&this.fire(new c.k(_))}))}loadJSON(t,n={},l){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ke.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,l)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(fc,{validate:!1})}_load(t,n,l){var h,g;let _=n.transformStyle?n.transformStyle(l,t):t;if(!n.validate||!Mo(this,c.C(_))){_=Object.assign({},_),this._loaded=!0,this.stylesheet=_;for(const j in _.sources)this.addSource(j,_.sources[j],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new pt(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new Ye(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var t,n,l;const h=c.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map((g=>g.id)),this._layers={},this._serializedLayers=null;for(const g of h){const _=c.bT(g,this._globalState);if(_.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=_,c.bU(_)&&this.tileManagers[_.source]){const j=(l=(n=g.paint)===null||n===void 0?void 0:n["raster-fade-duration"])!==null&&l!==void 0?l:_.paint.get("raster-fade-duration");this.tileManagers[_.source].setRasterFadeDuration(j)}}}_loadSprite(t,n=!1,l=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let g;this._spriteRequest=h,(function(_,j,E,M){return c._(this,void 0,void 0,(function*(){const D=Zt(_),$=E>1?"@2x":"",B={},G={};for(const{id:J,url:le}of D){const ue=j.transformRequest(mt(le,$,".json"),"SpriteJSON");B[J]=c.j(ue,M);const ce=j.transformRequest(mt(le,$,".png"),"SpriteImage");G[J]=Ft.getImage(ce,M)}return yield Promise.all([...Object.values(B),...Object.values(G)]),(function(J,le){return c._(this,void 0,void 0,(function*(){const ue={};for(const ce in J){ue[ce]={};const de=ke.getImageCanvasContext((yield le[ce]).data),xe=(yield J[ce]).data;for(const he in xe){const{width:ge,height:we,x:me,y:Ne,sdf:Ue,pixelRatio:Re,stretchX:Oe,stretchY:Be,content:ot,textFitWidth:ct,textFitHeight:et}=xe[he];ue[ce][he]={data:null,pixelRatio:Re,sdf:Ue,stretchX:Oe,stretchY:Be,content:ot,textFitWidth:ct,textFitHeight:et,spriteData:{width:ge,height:we,x:me,y:Ne,context:de}}}}return ue}))})(B,G)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((_=>{if(this._spriteRequest=null,_)for(const j in _){this._spritesImagesIds[j]=[];const E=this._spritesImagesIds[j]?this._spritesImagesIds[j].filter((M=>!(M in _))):[];for(const M of E)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in _[j]){const D=j==="default"?M:`${j}:${M}`;this._spritesImagesIds[j].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,_[j][M],!1):this.imageManager.addImage(D,_[j][M]),n&&(this._changedImages[D]=!0)}}})).catch((_=>{this._spriteRequest=null,g=_,h.signal.aborted||this.fire(new c.k(g))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),l&&l(g)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(t){const n=this.tileManagers[t.source];if(!n)return;const l=t.sourceLayer;if(!l)return;const h=n.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new c.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,n=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n?c.bV(l):l);const h=[];for(const g of t)if(l[g]){const _=n?c.bV(l[g]):l[g];h.push(_)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){var t,n,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(n){const h=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(h.length||g.length)&&this._updateWorkerLayers(h,g);for(const _ in this._updatedSources){const j=this._updatedSources[_];if(j==="reload")this._reloadSource(_);else{if(j!=="clear")throw new Error(`Invalid action ${j}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.tileManagers){const g=this.tileManagers[h];l[h]=g.used,g.used=!1}for(const h of this._order){const g=this._layers[h];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.tileManagers[g.source].used=!0)}for(const h in l){const g=this.tileManagers[h];!!l[h]!=!!g.used&&g.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,n&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.tileManagers)this.tileManagers[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){var l;this._checkLoaded();const h=this.serialize();if(t=n.transformStyle?n.transformStyle(h,t):t,((l=n.validate)===null||l===void 0||l)&&Mo(this,c.C(t)))return!1;(t=c.bV(t)).layers=c.bS(t.layers);const g=c.bW(h,t),_=this._getOperationsToPerform(g);if(_.unimplemented.length>0)throw new Error(`Unimplemented: ${_.unimplemented.join(", ")}.`);if(_.operations.length===0)return!1;for(const j of _.operations)j();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const n=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":n.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":n.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":n.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":n.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":n.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":n.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":n.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":n.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":n.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":n.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":n.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":n.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":n.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":n.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":n.push((()=>{}));break;default:l.push(h.command)}return{operations:n,unimplemented:l}}addImage(t,n){if(this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.C.source,`sources.${t}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const h=this.tileManagers[t]=new ea(t,n,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t}))),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new c.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const n=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],n.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,n,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new c.k(new Error(`Layer "${h}" already exists on this map.`)));let g;if(t.type==="custom"){if(Mo(this,c.bX(t)))return;g=c.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=c.bV(t),t=c.e(t,{source:h})),this._validate(c.C.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;g=c.bT(t,this._globalState),this._validateLayer(g),g.setEventedParent(this,{layer:{id:h}})}const _=n?this._order.indexOf(n):this._order.length;if(n&&_===-1)this.fire(new c.k(new Error(`Cannot add layer "${h}" before non-existing layer "${n}".`)));else{if(this._order.splice(_,0,h),this._layerOrderChanged=!0,this._layers[h]=g,this._removedLayers[h]&&g.source&&g.type!=="custom"){const j=this._removedLayers[h];delete this._removedLayers[h],j.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.tileManagers[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=n?this._order.indexOf(n):this._order.length;n&&h===-1?this.fire(new c.k(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===n&&h.maxzoom===l||(n!=null&&(h.minzoom=n),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!c.bR(h.filter,n))return n==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(c.C.filter,`layers.${h.id}.filter`,n,null,l)||(h.setFilter(c.bV(n)),this._updateLayer(h)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.bV(this.getLayer(t).filter)}setLayoutProperty(t,n,l,h={}){this._checkLoaded();const g=this.getLayer(t);g?c.bR(g.getLayoutProperty(n),l)||(g.setLayoutProperty(n,l,h),this._updateLayer(g)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const l=this.getLayer(t);if(l)return l.getLayoutProperty(n);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,l,h={}){this._checkLoaded();const g=this.getLayer(t);g?c.bR(g.getPaintProperty(n),l)||this._updatePaintProperty(g,n,l,h):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,n,l,h={}){t.setPaintProperty(n,l,h)&&this._updateLayer(t),c.bU(t)&&n==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const l=t.source,h=t.sourceLayer,g=this.tileManagers[l];if(g===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=g.getSource().type;_==="geojson"&&h?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||h?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(h,t.id,n)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const l=t.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=h.getSource().type,_=g==="vector"?t.sourceLayer:void 0;g!=="vector"||_?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(_,t.id,n):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,l=t.sourceLayer,h=this.tileManagers[n];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.bY(this.tileManagers,(g=>g.serialize())),n=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return c.bZ({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:n,terrain:l},(g=>g!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=_=>this._layers[_].type==="fill-extrusion",l={},h=[];for(let _=this._order.length-1;_>=0;_--){const j=this._order[_];if(n(j)){l[j]=_;for(const E of t){const M=E[j];if(M)for(const D of M)h.push(D)}}}h.sort(((_,j)=>j.intersectionZ-_.intersectionZ));const g=[];for(let _=this._order.length-1;_>=0;_--){const j=this._order[_];if(n(j))for(let E=h.length-1;E>=0;E--){const M=h[E].feature;if(l[M.layer.id]<_)break;g.push(M),h.pop()}else for(const E of t){const M=E[j];if(M)for(const D of M)g.push(D.feature)}}return g}queryRenderedFeatures(t,n,l){n&&n.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",n.filter,null,n);const h={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const M of n.layers){const D=this._layers[M];if(!D)return this.fire(new c.k(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];h[D.source]=!0}}const g=[];n.availableImages=this._availableImages;const _=this._serializedAllLayers(),j=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,E=Object.assign(Object.assign({},n),{layers:j,globalState:this._globalState});for(const M in this.tileManagers)n.layers&&!h[M]||g.push(Oi(this.tileManagers[M],this._layers,_,t,E,l,this.map.terrain?(D,$,B)=>this.map.terrain.getElevation(D,$,B):void 0));return this.placement&&g.push((function(M,D,$,B,G,J,le){const ue={},ce=J.queryRenderedSymbols(B),de=[];for(const xe of Object.keys(ce).map(Number))de.push(le[xe]);de.sort(Cs);for(const xe of de){const he=xe.featureIndex.lookupSymbolFeatures(ce[xe.bucketInstanceId],D,xe.bucketIndex,xe.sourceLayerIndex,{filterSpec:G.filter,globalState:G.globalState},G.layers,G.availableImages,M);for(const ge in he){const we=ue[ge]=ue[ge]||[],me=he[ge];me.sort(((Ne,Ue)=>{const Re=xe.featureSortOrder;if(Re){const Oe=Re.indexOf(Ne.featureIndex);return Re.indexOf(Ue.featureIndex)-Oe}return Ue.featureIndex-Ne.featureIndex}));for(const Ne of me)we.push(Ne)}}return(function(xe,he,ge){for(const we in xe)for(const me of xe[we])Gn(me,ge[he[we].source]);return xe})(ue,M,$)})(this._layers,_,this.tileManagers,t,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,n){n?.filter&&this._validate(c.C.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.tileManagers[t];return l?(function(h,g){const _=h.getRenderableIds().map((M=>h.getTileByID(M))),j=[],E={};for(let M=0;M<_.length;M++){const D=_[M],$=D.tileID.canonical.key;E[$]||(E[$]=!0,D.querySourceFeatures(j,g))}return j})(l,n?Object.assign(Object.assign({},n),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const _ in t)if(!c.bR(t[_],l[_])){h=!0;break}if(!h)return;const g={now:re(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(g)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,n={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!t&&!l)return;if(t&&!l)h=!0;else if(!t&&l)h=!0;else for(const _ in t)if(!c.bR(t[_],l[_])){h=!0;break}if(!h)return;const g={now:re(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,n),this.sky.updateTransitions(g)}_setProjectionInternal(t){const n=(function(l,h){const g={constrainOverride:h};if(Array.isArray(l)){const _=new kl({type:l});return{projection:_,transform:new Sl(g),cameraHelper:new fh(_)}}switch(l){case"mercator":return{projection:new Gs,transform:new No(g),cameraHelper:new Gi};case"globe":{const _=new kl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:_,transform:new Sl(g),cameraHelper:new fh(_)}}case"vertical-perspective":return{projection:new hc,transform:new Hi(g),cameraHelper:new Ms};default:return c.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Gs,transform:new No(g),cameraHelper:new Gi}}})(t,this.map.transformConstrain);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,n,l,h,g={}){return(!g||g.validate!==!1)&&Mo(this,t.call(c.C,c.e({key:n,style:this.serialize(),value:l,styleSpec:c.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ie().off(be,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.tileManagers){const l=this.tileManagers[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const n in this.tileManagers)this.tileManagers[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,n,l,h,g=!1){let _=!1,j=!1;const E={};for(const M of this._order){const D=this._layers[M];if(D.type!=="symbol")continue;if(!E[D.source]){const B=this.tileManagers[D.source];E[D.source]=B.getRenderableIds(!0).map((G=>B.getTileByID(G))).sort(((G,J)=>J.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(J.tileID)?-1:1)))}const $=this.crossTileSymbolIndex.addLayer(D,E[D.source],t.center.lng);_=_||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(re(),t.zoom))&&(this.pauseablePlacement=new $i(t,this.map.terrain,this._order,g,n,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(re()),j=!0),_&&this.pauseablePlacement.placement.setStale()),j||_)for(const M of this._order){const D=this._layers[M];D.type==="symbol"&&this.placement.updateLayerOpacities(D,E[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(re())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,n){return c._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const h=this.tileManagers[n.source];return h&&h.setDependencies(n.tileID.key,n.type,n.icons),l}))}getGlyphs(t,n){return c._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(n.stacks),h=this.tileManagers[n.source];return h&&h.setDependencies(n.tileID.key,n.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(c.C.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,n){return c._(this,void 0,void 0,(function*(){const l={};for(const[h,g]of Object.entries(n.dashes))l[h]=this.lineAtlas.getDash(g.dasharray,g.round);return l}))}addSprite(t,n,l={},h){this._checkLoaded();const g=[{id:t,url:n}],_=[...Zt(this.stylesheet.sprite),...g];this._validate(c.C.sprite,"sprite",_,null,l)||(this.stylesheet.sprite=_,this._loadSprite(g,!0,h))}removeSprite(t){this._checkLoaded();const n=Zt(this.stylesheet.sprite);if(n.find((l=>l.id===t))){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex((l=>l.id===t)),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Zt(this.stylesheet.sprite)}setSprite(t,n={},l){this._checkLoaded(),t&&this._validate(c.C.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const n=this.tileManagers[t];n.setEventedParent(null),n.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const n=this._layers[t];n.setEventedParent(null),n.onRemove&&n.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var ap=c.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class au{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,l,h,g,_,j,E,M){this.context=t;let D=this.boundPaintVertexBuffers.length!==h.length;for(let $=0;!D&&$<h.length;$++)this.boundPaintVertexBuffers[$]!==h[$]&&(D=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||D||this.boundIndexBuffer!==g||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==j||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==M?this.freshBind(n,l,h,g,_,j,E,M):(t.bindVertexArray.set(this.vao),j&&j.bind(),g&&g.dynamicDraw&&g.bind(),E&&E.bind(),M&&M.bind())}freshBind(t,n,l,h,g,_,j,E){const M=t.numAttributes,D=this.context,$=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=j,this.boundDynamicVertexBuffer3=E,n.enableAttributes($,t);for(const B of l)B.enableAttributes($,t);_&&_.enableAttributes($,t),j&&j.enableAttributes($,t),E&&E.enableAttributes($,t),n.bind(),n.setVertexAttribPointers($,t,g);for(const B of l)B.bind(),B.setVertexAttribPointers($,t,g);_&&(_.bind(),_.setVertexAttribPointers($,t,g)),h&&h.bind(),j&&(j.bind(),j.setVertexAttribPointers($,t,g)),E&&(E.bind(),E.setVertexAttribPointers($,t,g)),D.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ip=(m,t,n,l,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:n?n.properties.get("fog-color"):c.bp.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:n?n.calculateFogBlendOpacity(l):0,u_horizon_color:n?n.properties.get("horizon-color"):c.bp.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Tl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function iu(m){const t=[];for(let n=0;n<m.length;n++){if(m[n]===null)continue;const l=m[n].split(" ");t.push(l.pop())}return t}class ou{constructor(t,n,l,h,g,_,j,E,M=[]){const D=t.gl;this.program=D.createProgram();const $=iu(n.staticAttributes),B=l?l.getBinderAttributes():[],G=$.concat(B),J=Ir.prelude.staticUniforms?iu(Ir.prelude.staticUniforms):[],le=j.staticUniforms?iu(j.staticUniforms):[],ue=n.staticUniforms?iu(n.staticUniforms):[],ce=l?l.getBinderUniforms():[],de=J.concat(le).concat(ue).concat(ce),xe=[];for(const Re of de)xe.indexOf(Re)<0&&xe.push(Re);const he=l?l.defines():[];fs(D)&&he.unshift("#version 300 es"),g&&he.push("#define OVERDRAW_INSPECTOR;"),_&&he.push("#define TERRAIN3D;"),E&&he.push(E),M&&he.push(...M);let ge=he.concat(Ir.prelude.fragmentSource,j.fragmentSource,n.fragmentSource).join(`
`),we=he.concat(Ir.prelude.vertexSource,j.vertexSource,n.vertexSource).join(`
`);fs(D)||(ge=(function(Re){return Re.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ge),we=(function(Re){return Re.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(we));const me=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(me,ge),D.compileShader(me),!D.getShaderParameter(me,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(me)}`);D.attachShader(this.program,me);const Ne=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ne,we),D.compileShader(Ne),!D.getShaderParameter(Ne,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ne)}`);D.attachShader(this.program,Ne),this.attributes={};const Ue={};this.numAttributes=G.length;for(let Re=0;Re<this.numAttributes;Re++)G[Re]&&(D.bindAttribLocation(this.program,Re,G[Re]),this.attributes[G[Re]]=Re);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ne),D.deleteShader(me);for(let Re=0;Re<xe.length;Re++){const Oe=xe[Re];if(Oe&&!Ue[Oe]){const Be=D.getUniformLocation(this.program,Oe);Be&&(Ue[Oe]=Be)}}this.fixedUniforms=h(t,Ue),this.terrainUniforms=((Re,Oe)=>({u_depth:new c.b_(Re,Oe.u_depth),u_terrain:new c.b_(Re,Oe.u_terrain),u_terrain_dim:new c.bq(Re,Oe.u_terrain_dim),u_terrain_matrix:new c.c0(Re,Oe.u_terrain_matrix),u_terrain_unpack:new c.c1(Re,Oe.u_terrain_unpack),u_terrain_exaggeration:new c.bq(Re,Oe.u_terrain_exaggeration)}))(t,Ue),this.projectionUniforms=((Re,Oe)=>({u_projection_matrix:new c.c0(Re,Oe.u_projection_matrix),u_projection_tile_mercator_coords:new c.c1(Re,Oe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c1(Re,Oe.u_projection_clipping_plane),u_projection_transition:new c.bq(Re,Oe.u_projection_transition),u_projection_fallback_matrix:new c.c0(Re,Oe.u_projection_fallback_matrix)}))(t,Ue),this.binderUniforms=l?l.getUniforms(t,Ue):[]}draw(t,n,l,h,g,_,j,E,M,D,$,B,G,J,le,ue,ce,de,xe){const he=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(g),t.setCullFace(_),E){t.activeTexture.set(he.TEXTURE2),he.bindTexture(he.TEXTURE_2D,E.depthTexture),t.activeTexture.set(he.TEXTURE3),he.bindTexture(he.TEXTURE_2D,E.texture);for(const we in this.terrainUniforms)this.terrainUniforms[we].set(E[we])}if(M)for(const we in M)this.projectionUniforms[Tl[we]].set(M[we]);if(j)for(const we in this.fixedUniforms)this.fixedUniforms[we].set(j[we]);ue&&ue.setUniforms(t,this.binderUniforms,J,{zoom:le});let ge=0;switch(n){case he.LINES:ge=2;break;case he.TRIANGLES:ge=3;break;case he.LINE_STRIP:ge=1}for(const we of G.get()){const me=we.vaos||(we.vaos={});(me[D]||(me[D]=new au)).bind(t,this,$,ue?ue.getPaintVertexBuffers():[],B,we.vertexOffset,ce,de,xe),he.drawElements(n,we.primitiveLength*ge,he.UNSIGNED_SHORT,we.primitiveOffset*ge*2)}}}function Nl(m,t,n){const l=1/c.aN(n,1,t.transform.tileZoom),h=Math.pow(2,n.tileID.overscaledZ),g=n.tileSize*Math.pow(2,t.transform.tileZoom)/h,_=g*(n.tileID.canonical.x+n.tileID.wrap*h),j=g*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[_>>16,j>>16],u_pixel_coord_lower:[65535&_,65535&j]}}const fd=(m,t,n,l)=>{const h=m.style.light,g=h.properties.get("position"),_=[g.x,g.y,g.z],j=c.c4();h.properties.get("anchor")==="viewport"&&c.c5(j,m.transform.bearingInRadians),c.c6(_,_,j);const E=m.transform.transformLightDirection(_),M=h.properties.get("color");return{u_lightpos:_,u_lightpos_globe:E,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+t,u_opacity:n,u_fill_translate:l}},lu=(m,t,n,l,h,g,_)=>c.e(fd(m,t,n,l),Nl(g,m,_),{u_height_factor:-Math.pow(2,h.overscaledZ)/_.tileSize/8}),cu=(m,t,n,l)=>c.e(Nl(t,m,n),{u_fill_translate:l}),md=(m,t)=>({u_world:m,u_fill_translate:t}),gd=(m,t,n,l,h)=>c.e(cu(m,t,n,h),{u_world:l}),xd=(m,t,n,l,h)=>{const g=m.transform;let _,j,E=0;if(n.paint.get("circle-pitch-alignment")==="map"){const M=c.aN(t,1,g.zoom);_=!0,j=[M,M],E=M/(c.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else _=!1,j=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+_,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:j,u_globe_extrude_scale:E,u_translate:l}},sa=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),mh=m=>({u_viewport_size:[m.width,m.height]}),yd=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),El=(m,t,n,l)=>{const h=c.aN(m,1,t)/(c.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:c.aN(m,1,t),u_intensity:n,u_globe_extrude_scale:h}},_d=(m,t,n,l)=>{const h=c.N();c.c7(h,0,m.width,m.height,0,0,1);const g=m.context.gl;return{u_matrix:h,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:n,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},mc=(m,t,n)=>{const l=n.paint.get("hillshade-accent-color");let h;switch(n.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const g=n.getIlluminationProperties();for(let _=0;_<g.directionRadians.length;_++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[_]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:xc(0,t.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:l,u_method:h,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},gc=(m,t)=>{const n=t.stride,l=c.N();return c.c7(l,0,c.a5,-c.a5,0,0,1),c.O(l,l,[0,-c.a5,0]),{u_matrix:l,u_image:1,u_dimension:[n,n],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function xc(m,t){const n=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new c.a9(0,l/n).toLngLat().lat,new c.a9(0,(l+1)/n).toLngLat().lat]}const gh=(m,t,n=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:m.paint.get("color-relief-opacity")}),Wi=(m,t,n,l)=>{const h=m.transform;return{u_translation:yc(m,t,n),u_ratio:l/c.aN(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},xh=(m,t,n,l,h)=>c.e(Wi(m,t,n,l),{u_image:0,u_image_height:h}),uu=(m,t,n,l,h)=>{const g=m.transform,_=na(t,g);return{u_translation:yc(m,t,n),u_texsize:t.imageAtlasTexture.size,u_ratio:l/c.aN(t,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[_,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},du=(m,t,n,l,h)=>{const g=na(t,m.transform);return c.e(Wi(m,t,n,l),{u_tileratio:g,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},Cl=(m,t,n,l,h,g)=>{const _=na(t,m.transform);return c.e(Wi(m,t,n,l),{u_image:0,u_image_height:g,u_tileratio:_,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function na(m,t){return 1/c.aN(m,1,t.tileZoom)}function yc(m,t,n){return c.aO(m.transform,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const hu=(m,t,n,l,h)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(_=l.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(g=l.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:bd(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var g,_};function bd(m){m*=Math.PI/180;const t=Math.sin(m),n=Math.cos(m);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const vd=(m,t,n,l,h,g,_,j,E,M,D,$,B)=>{const G=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:G.width/G.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_label_plane_matrix:j,u_coord_matrix:E,u_is_text:+D,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:g,u_texsize:$,u_texture:0,u_translation:M,u_pitched_scale:B}},pu=(m,t,n,l,h,g,_,j,E,M,D,$,B,G)=>{const J=_.transform;return c.e(vd(m,t,n,l,h,g,_,j,E,M,D,$,G),{u_gamma_scale:l?Math.cos(J.pitch*Math.PI/180)*J.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:1})},zo=(m,t,n,l,h,g,_,j,E,M,D,$,B)=>c.e(pu(m,t,n,l,h,g,_,j,E,M,!0,D,0,B),{u_texsize_icon:$,u_texture_icon:1}),wd=(m,t)=>({u_opacity:m,u_color:t}),Ta=(m,t,n,l,h)=>c.e((function(g,_,j,E){const M=j.imageManager.getPattern(g.from.toString()),D=j.imageManager.getPattern(g.to.toString()),{width:$,height:B}=j.imageManager.getPixelSize(),G=Math.pow(2,E.tileID.overscaledZ),J=E.tileSize*Math.pow(2,j.transform.tileZoom)/G,le=J*(E.tileID.canonical.x+E.tileID.wrap*G),ue=J*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[$,B],u_mix:_.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/c.aN(E,1,j.transform.tileZoom),u_pixel_coord_upper:[le>>16,ue>>16],u_pixel_coord_lower:[65535&le,65535&ue]}})(n,h,t,l),{u_opacity:m}),Pl=(m,t)=>{},yh={fillExtrusion:(m,t)=>({u_lightpos:new c.c2(m,t.u_lightpos),u_lightpos_globe:new c.c2(m,t.u_lightpos_globe),u_lightintensity:new c.bq(m,t.u_lightintensity),u_lightcolor:new c.c2(m,t.u_lightcolor),u_vertical_gradient:new c.bq(m,t.u_vertical_gradient),u_opacity:new c.bq(m,t.u_opacity),u_fill_translate:new c.c3(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new c.c2(m,t.u_lightpos),u_lightpos_globe:new c.c2(m,t.u_lightpos_globe),u_lightintensity:new c.bq(m,t.u_lightintensity),u_lightcolor:new c.c2(m,t.u_lightcolor),u_vertical_gradient:new c.bq(m,t.u_vertical_gradient),u_height_factor:new c.bq(m,t.u_height_factor),u_opacity:new c.bq(m,t.u_opacity),u_fill_translate:new c.c3(m,t.u_fill_translate),u_image:new c.b_(m,t.u_image),u_texsize:new c.c3(m,t.u_texsize),u_pixel_coord_upper:new c.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(m,t.u_pixel_coord_lower),u_scale:new c.c2(m,t.u_scale),u_fade:new c.bq(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new c.c3(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new c.b_(m,t.u_image),u_texsize:new c.c3(m,t.u_texsize),u_pixel_coord_upper:new c.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(m,t.u_pixel_coord_lower),u_scale:new c.c2(m,t.u_scale),u_fade:new c.bq(m,t.u_fade),u_fill_translate:new c.c3(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new c.c3(m,t.u_world),u_fill_translate:new c.c3(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new c.c3(m,t.u_world),u_image:new c.b_(m,t.u_image),u_texsize:new c.c3(m,t.u_texsize),u_pixel_coord_upper:new c.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(m,t.u_pixel_coord_lower),u_scale:new c.c2(m,t.u_scale),u_fade:new c.bq(m,t.u_fade),u_fill_translate:new c.c3(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new c.bq(m,t.u_camera_to_center_distance),u_scale_with_map:new c.b_(m,t.u_scale_with_map),u_pitch_with_map:new c.b_(m,t.u_pitch_with_map),u_extrude_scale:new c.c3(m,t.u_extrude_scale),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new c.bq(m,t.u_globe_extrude_scale),u_translate:new c.c3(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new c.c3(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new c.c3(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new c.b$(m,t.u_color),u_overlay:new c.b_(m,t.u_overlay),u_overlay_scale:new c.bq(m,t.u_overlay_scale)}),depth:Pl,clippingMask:Pl,heatmap:(m,t)=>({u_extrude_scale:new c.bq(m,t.u_extrude_scale),u_intensity:new c.bq(m,t.u_intensity),u_globe_extrude_scale:new c.bq(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new c.c0(m,t.u_matrix),u_world:new c.c3(m,t.u_world),u_image:new c.b_(m,t.u_image),u_color_ramp:new c.b_(m,t.u_color_ramp),u_opacity:new c.bq(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new c.b_(m,t.u_image),u_latrange:new c.c3(m,t.u_latrange),u_exaggeration:new c.bq(m,t.u_exaggeration),u_altitudes:new c.c9(m,t.u_altitudes),u_azimuths:new c.c9(m,t.u_azimuths),u_accent:new c.b$(m,t.u_accent),u_method:new c.b_(m,t.u_method),u_shadows:new c.c8(m,t.u_shadows),u_highlights:new c.c8(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new c.c0(m,t.u_matrix),u_image:new c.b_(m,t.u_image),u_dimension:new c.c3(m,t.u_dimension),u_zoom:new c.bq(m,t.u_zoom),u_unpack:new c.c1(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new c.b_(m,t.u_image),u_unpack:new c.c1(m,t.u_unpack),u_dimension:new c.c3(m,t.u_dimension),u_elevation_stops:new c.b_(m,t.u_elevation_stops),u_color_stops:new c.b_(m,t.u_color_stops),u_color_ramp_size:new c.b_(m,t.u_color_ramp_size),u_opacity:new c.bq(m,t.u_opacity)}),line:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels),u_image:new c.b_(m,t.u_image),u_image_height:new c.bq(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_texsize:new c.c3(m,t.u_texsize),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_image:new c.b_(m,t.u_image),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels),u_scale:new c.c2(m,t.u_scale),u_fade:new c.bq(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels),u_image:new c.b_(m,t.u_image),u_mix:new c.bq(m,t.u_mix),u_tileratio:new c.bq(m,t.u_tileratio),u_crossfade_from:new c.bq(m,t.u_crossfade_from),u_crossfade_to:new c.bq(m,t.u_crossfade_to),u_lineatlas_width:new c.bq(m,t.u_lineatlas_width),u_lineatlas_height:new c.bq(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new c.c3(m,t.u_translation),u_ratio:new c.bq(m,t.u_ratio),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(m,t.u_units_to_pixels),u_image:new c.b_(m,t.u_image),u_image_height:new c.bq(m,t.u_image_height),u_tileratio:new c.bq(m,t.u_tileratio),u_crossfade_from:new c.bq(m,t.u_crossfade_from),u_crossfade_to:new c.bq(m,t.u_crossfade_to),u_image_dash:new c.b_(m,t.u_image_dash),u_mix:new c.bq(m,t.u_mix),u_lineatlas_width:new c.bq(m,t.u_lineatlas_width),u_lineatlas_height:new c.bq(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new c.c3(m,t.u_tl_parent),u_scale_parent:new c.bq(m,t.u_scale_parent),u_buffer_scale:new c.bq(m,t.u_buffer_scale),u_fade_t:new c.bq(m,t.u_fade_t),u_opacity:new c.bq(m,t.u_opacity),u_image0:new c.b_(m,t.u_image0),u_image1:new c.b_(m,t.u_image1),u_brightness_low:new c.bq(m,t.u_brightness_low),u_brightness_high:new c.bq(m,t.u_brightness_high),u_saturation_factor:new c.bq(m,t.u_saturation_factor),u_contrast_factor:new c.bq(m,t.u_contrast_factor),u_spin_weights:new c.c2(m,t.u_spin_weights),u_coords_top:new c.c1(m,t.u_coords_top),u_coords_bottom:new c.c1(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new c.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(m,t.u_is_size_feature_constant),u_size_t:new c.bq(m,t.u_size_t),u_size:new c.bq(m,t.u_size),u_camera_to_center_distance:new c.bq(m,t.u_camera_to_center_distance),u_pitch:new c.bq(m,t.u_pitch),u_rotate_symbol:new c.b_(m,t.u_rotate_symbol),u_aspect_ratio:new c.bq(m,t.u_aspect_ratio),u_fade_change:new c.bq(m,t.u_fade_change),u_label_plane_matrix:new c.c0(m,t.u_label_plane_matrix),u_coord_matrix:new c.c0(m,t.u_coord_matrix),u_is_text:new c.b_(m,t.u_is_text),u_pitch_with_map:new c.b_(m,t.u_pitch_with_map),u_is_along_line:new c.b_(m,t.u_is_along_line),u_is_variable_anchor:new c.b_(m,t.u_is_variable_anchor),u_texsize:new c.c3(m,t.u_texsize),u_texture:new c.b_(m,t.u_texture),u_translation:new c.c3(m,t.u_translation),u_pitched_scale:new c.bq(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new c.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(m,t.u_is_size_feature_constant),u_size_t:new c.bq(m,t.u_size_t),u_size:new c.bq(m,t.u_size),u_camera_to_center_distance:new c.bq(m,t.u_camera_to_center_distance),u_pitch:new c.bq(m,t.u_pitch),u_rotate_symbol:new c.b_(m,t.u_rotate_symbol),u_aspect_ratio:new c.bq(m,t.u_aspect_ratio),u_fade_change:new c.bq(m,t.u_fade_change),u_label_plane_matrix:new c.c0(m,t.u_label_plane_matrix),u_coord_matrix:new c.c0(m,t.u_coord_matrix),u_is_text:new c.b_(m,t.u_is_text),u_pitch_with_map:new c.b_(m,t.u_pitch_with_map),u_is_along_line:new c.b_(m,t.u_is_along_line),u_is_variable_anchor:new c.b_(m,t.u_is_variable_anchor),u_texsize:new c.c3(m,t.u_texsize),u_texture:new c.b_(m,t.u_texture),u_gamma_scale:new c.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_is_halo:new c.b_(m,t.u_is_halo),u_translation:new c.c3(m,t.u_translation),u_pitched_scale:new c.bq(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new c.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(m,t.u_is_size_feature_constant),u_size_t:new c.bq(m,t.u_size_t),u_size:new c.bq(m,t.u_size),u_camera_to_center_distance:new c.bq(m,t.u_camera_to_center_distance),u_pitch:new c.bq(m,t.u_pitch),u_rotate_symbol:new c.b_(m,t.u_rotate_symbol),u_aspect_ratio:new c.bq(m,t.u_aspect_ratio),u_fade_change:new c.bq(m,t.u_fade_change),u_label_plane_matrix:new c.c0(m,t.u_label_plane_matrix),u_coord_matrix:new c.c0(m,t.u_coord_matrix),u_is_text:new c.b_(m,t.u_is_text),u_pitch_with_map:new c.b_(m,t.u_pitch_with_map),u_is_along_line:new c.b_(m,t.u_is_along_line),u_is_variable_anchor:new c.b_(m,t.u_is_variable_anchor),u_texsize:new c.c3(m,t.u_texsize),u_texsize_icon:new c.c3(m,t.u_texsize_icon),u_texture:new c.b_(m,t.u_texture),u_texture_icon:new c.b_(m,t.u_texture_icon),u_gamma_scale:new c.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(m,t.u_device_pixel_ratio),u_is_halo:new c.b_(m,t.u_is_halo),u_translation:new c.c3(m,t.u_translation),u_pitched_scale:new c.bq(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new c.bq(m,t.u_opacity),u_color:new c.b$(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new c.bq(m,t.u_opacity),u_image:new c.b_(m,t.u_image),u_pattern_tl_a:new c.c3(m,t.u_pattern_tl_a),u_pattern_br_a:new c.c3(m,t.u_pattern_br_a),u_pattern_tl_b:new c.c3(m,t.u_pattern_tl_b),u_pattern_br_b:new c.c3(m,t.u_pattern_br_b),u_texsize:new c.c3(m,t.u_texsize),u_mix:new c.bq(m,t.u_mix),u_pattern_size_a:new c.c3(m,t.u_pattern_size_a),u_pattern_size_b:new c.c3(m,t.u_pattern_size_b),u_scale_a:new c.bq(m,t.u_scale_a),u_scale_b:new c.bq(m,t.u_scale_b),u_pixel_coord_upper:new c.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bq(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new c.b_(m,t.u_texture),u_ele_delta:new c.bq(m,t.u_ele_delta),u_fog_matrix:new c.c0(m,t.u_fog_matrix),u_fog_color:new c.b$(m,t.u_fog_color),u_fog_ground_blend:new c.bq(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bq(m,t.u_fog_ground_blend_opacity),u_horizon_color:new c.b$(m,t.u_horizon_color),u_horizon_fog_blend:new c.bq(m,t.u_horizon_fog_blend),u_is_globe_mode:new c.bq(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new c.bq(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new c.b_(m,t.u_texture),u_terrain_coords_id:new c.bq(m,t.u_terrain_coords_id),u_ele_delta:new c.bq(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new c.bq(m,t.u_input),u_output_expected:new c.bq(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new c.c2(m,t.u_sun_pos),u_atmosphere_blend:new c.bq(m,t.u_atmosphere_blend),u_globe_position:new c.c2(m,t.u_globe_position),u_globe_radius:new c.bq(m,t.u_globe_radius),u_inv_proj_matrix:new c.c0(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new c.b$(m,t.u_sky_color),u_horizon_color:new c.b$(m,t.u_horizon_color),u_horizon:new c.c3(m,t.u_horizon),u_horizon_normal:new c.c3(m,t.u_horizon_normal),u_sky_horizon_blend:new c.bq(m,t.u_sky_horizon_blend),u_sky_blend:new c.bq(m,t.u_sky_blend)})};class _h{constructor(t,n,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const kd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bh{constructor(t,n,l,h){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=h,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let l=0;l<this.attributes.length;l++){const h=n.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,n,l){for(let h=0;h<this.attributes.length;h++){const g=this.attributes[h],_=n.attributes[g.name];_!==void 0&&t.vertexAttribPointer(_,g.components,t[kd[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fu extends vr{getDefault(){return c.bp.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class mu extends vr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class bi extends vr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class _c extends vr{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Na extends vr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ao extends vr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Do extends vr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class wn extends vr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ro extends vr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class gu extends vr{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class xu extends vr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class qa extends vr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class bc extends vr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class vc extends vr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ml extends vr{getDefault(){return c.bp.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class wc extends vr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class jd extends vr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Lo extends vr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Wn extends vr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class yu extends vr{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class kc extends vr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class hr extends vr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _u extends vr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class jc extends vr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class vh extends vr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Il extends vr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wh extends vr{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ls extends vr{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const l=this.gl;fs(l)?l.bindVertexArray(t):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class bu extends vr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class vu extends vr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Fo extends vr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Oo extends vr{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Bo extends Oo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Xi extends Oo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class zl extends Oo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Yi="Framebuffer is not complete";class Sc{constructor(t,n,l,h,g){this.context=t,this.width=n,this.height=l;const _=t.gl,j=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new Bo(t,j),h)this.depthAttachment=g?new zl(t,j):new Xi(t,j);else if(g)throw new Error("Stencil cannot be set without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error(Yi)}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class wu{constructor(t){var n,l;if(this.gl=t,this.clearColor=new fu(this),this.clearDepth=new mu(this),this.clearStencil=new bi(this),this.colorMask=new _c(this),this.depthMask=new Na(this),this.stencilMask=new Ao(this),this.stencilFunc=new Do(this),this.stencilOp=new wn(this),this.stencilTest=new Ro(this),this.depthRange=new gu(this),this.depthTest=new xu(this),this.depthFunc=new qa(this),this.blend=new bc(this),this.blendFunc=new vc(this),this.blendColor=new Ml(this),this.blendEquation=new wc(this),this.cullFace=new jd(this),this.cullFaceSide=new Lo(this),this.frontFace=new Wn(this),this.program=new yu(this),this.activeTexture=new kc(this),this.viewport=new hr(this),this.bindFramebuffer=new _u(this),this.bindRenderbuffer=new jc(this),this.bindTexture=new vh(this),this.bindVertexBuffer=new Il(this),this.bindElementBuffer=new wh(this),this.bindVertexArray=new ls(this),this.pixelStoreUnpack=new bu(this),this.pixelStoreUnpackPremultiplyAlpha=new vu(this),this.pixelStoreUnpackFlipY=new Fo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),fs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:h?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new _h(this,t,n)}createVertexBuffer(t,n,l){return new bh(this,t,n,l)}createRenderbuffer(t,n,l){const h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,t,n,l),this.bindRenderbuffer.set(null),g}createFramebuffer(t,n,l,h){return new Sc(this,t,n,l,h)}clear({color:t,depth:n,stencil:l}){const h=this.gl;let g=0;t&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(g|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.bR(t.blendFunction,br.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return fs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return fs(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ki;function Ji(m,t,n,l,h){const g=m.context,_=m.transform,j=g.gl,E=m.useProgram("collisionBox"),M=[];let D=0,$=0;for(let ce=0;ce<l.length;ce++){const de=l[ce],xe=t.getTile(de).getBucket(n);if(!xe)continue;const he=h?xe.textCollisionBox:xe.iconCollisionBox,ge=xe.collisionCircleArray;ge.length>0&&(M.push({circleArray:ge,circleOffset:$,coord:de}),D+=ge.length/4,$=D),he&&E.draw(g,j.LINES,or.disabled,mr.disabled,m.colorModeForRenderPass(),pr.disabled,sa(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(de),_.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,m.transform.zoom,null,null,he.collisionVertexBuffer)}if(!h||!M.length)return;const B=m.useProgram("collisionCircle"),G=new c.ca;G.resize(4*D),G._trim();let J=0;for(const ce of M)for(let de=0;de<ce.circleArray.length/4;de++){const xe=4*de,he=ce.circleArray[xe+0],ge=ce.circleArray[xe+1],we=ce.circleArray[xe+2],me=ce.circleArray[xe+3];G.emplace(J++,he,ge,we,me,0),G.emplace(J++,he,ge,we,me,1),G.emplace(J++,he,ge,we,me,2),G.emplace(J++,he,ge,we,me,3)}(!Ki||Ki.length<2*D)&&(Ki=(function(ce){const de=2*ce,xe=new c.cc;xe.resize(de),xe._trim();for(let he=0;he<de;he++){const ge=6*he;xe.uint16[ge+0]=4*he+0,xe.uint16[ge+1]=4*he+1,xe.uint16[ge+2]=4*he+2,xe.uint16[ge+3]=4*he+2,xe.uint16[ge+4]=4*he+3,xe.uint16[ge+5]=4*he+0}return xe})(D));const le=g.createIndexBuffer(Ki,!0),ue=g.createVertexBuffer(G,c.cb.members,!0);for(const ce of M){const de=mh(m.transform);B.draw(g,j.TRIANGLES,or.disabled,mr.disabled,m.colorModeForRenderPass(),pr.disabled,de,m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce.coord),null,n.id,ue,le,c.aX.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,m.transform.zoom,null,null,null)}ue.destroy(),le.destroy()}const Al=c.ar(new Float32Array(16));function ku(m,t,n,l,h,g){const{horizontalAlign:_,verticalAlign:j}=c.aS(m);return new c.P((-(_-.5)*t/h+l[0])*g,(-(j-.5)*n/h+l[1])*g)}function Vo(m,t,n,l,h,g){const _=t.tileAnchorPoint.add(new c.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let j=l.mult(g);n||(j=j.rotate(-h));const E=_.add(j);return ar(E.x,E.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(n){const j=Tr(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),E=Math.atan(j.y/j.x)+(j.x<0?Math.PI:0);return m.add(l.rotate(E))}return m.add(l)}function Sd(m,t,n,l,h,g,_,j,E,M,D,$){const B=m.text.placedSymbolArray,G=m.text.dynamicLayoutVertexArray,J=m.icon.dynamicLayoutVertexArray,le={};G.clear();for(let ue=0;ue<B.length;ue++){const ce=B.get(ue),de=ce.hidden||!ce.crossTileID||m.allowVerticalPlacement&&!ce.placedOrientation?null:l[ce.crossTileID];if(de){const xe=new c.P(ce.anchorX,ce.anchorY),he={getElevation:$,width:h.width,height:h.height,pitchedLabelPlaneMatrix:g,pitchWithMap:n,transform:h,tileAnchorPoint:xe,translation:M,unwrappedTileID:D},ge=n?wo(xe.x,xe.y,he):Tr(xe.x,xe.y,he),we=ml(h.cameraToCenterDistance,ge.signedDistanceFromCamera);let me=c.aA(m.textSizeData,j,ce)*we/c.aM;n&&(me*=m.tilePixelRatio/_);const{width:Ne,height:Ue,anchor:Re,textOffset:Oe,textBoxScale:Be}=de,ot=ku(Re,Ne,Ue,Oe,Be,me),ct=h.getPitchedTextCorrection(xe.x+M[0],xe.y+M[1],D),et=Vo(ge.point,he,t,ot,-h.bearingInRadians,ct),xt=m.allowVerticalPlacement&&ce.placedOrientation===c.az.vertical?Math.PI/2:0;for(let rr=0;rr<ce.numGlyphs;rr++)c.aG(G,et,xt);E&&ce.associatedIconIndex>=0&&(le[ce.associatedIconIndex]={shiftedAnchor:et,angle:xt})}else ko(ce.numGlyphs,G)}if(E){J.clear();const ue=m.icon.placedSymbolArray;for(let ce=0;ce<ue.length;ce++){const de=ue.get(ce);if(de.hidden)ko(de.numGlyphs,J);else{const xe=le[ce];if(xe)for(let he=0;he<de.numGlyphs;he++)c.aG(J,xe.shiftedAnchor,xe.angle);else ko(de.numGlyphs,J)}}m.icon.dynamicLayoutVertexBuffer.updateData(J)}m.text.dynamicLayoutVertexBuffer.updateData(G)}function ju(m,t,n){return n.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function $o(m,t,n,l,h,g,_,j,E,M,D,$,B){const G=m.context,J=G.gl,le=m.transform,ue=j==="map",ce=E==="map",de=j!=="viewport"&&n.layout.get("symbol-placement")!=="point",xe=ue&&!ce&&!de,he=!n.layout.get("symbol-sort-key").isConstant();let ge=!1;const we=m.getDepthModeForSublayer(0,or.ReadOnly),me=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ne=[],Ue=le.getCircleRadiusCorrection();for(const Re of l){const Oe=t.getTile(Re),Be=Oe.getBucket(n);if(!Be)continue;const ot=h?Be.text:Be.icon;if(!ot||!ot.segments.get().length||!ot.hasVisibleVertices)continue;const ct=ot.programConfigurations.get(n.id),et=h||Be.sdfIcons,xt=h?Be.textSizeData:Be.iconSizeData,rr=ce||le.pitch!==0,zr=m.useProgram(ju(et,h,Be),ct),rs=c.ay(xt,le.zoom),Vr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Re);let ss,$r,ns,us,Xs=[0,0],js=null;if(h)$r=Oe.glyphAtlasTexture,ns=J.LINEAR,ss=Oe.glyphAtlasTexture.size,Be.iconsInText&&(Xs=Oe.imageAtlasTexture.size,js=Oe.imageAtlasTexture,us=rr||m.options.rotating||m.options.zooming||xt.kind==="composite"||xt.kind==="camera"?J.LINEAR:J.NEAREST);else{const qr=n.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;$r=Oe.imageAtlasTexture,ns=et||m.options.rotating||m.options.zooming||qr||rr?J.LINEAR:J.NEAREST,ss=Oe.imageAtlasTexture.size}const Pr=c.aN(Oe,1,m.transform.zoom),Fs=Cn(ue,m.transform,Pr),za=c.N();c.aB(za,Fs);const Ja=Jc(ce,ue,m.transform,Pr),Aa=c.aO(le,Oe,g,_),jn=le.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Ni=me&&Be.hasTextData(),Qa=n.layout.get("icon-text-fit")!=="none"&&Ni&&Be.hasIconData();if(de){const qr=m.style.map.terrain?(As,Os)=>m.style.map.terrain.getElevation(Re,As,Os):null,Ur=n.layout.get("text-rotation-alignment")==="map";Qc(Be,m,h,Fs,za,ce,M,Ur,Re.toUnwrapped(),le.width,le.height,Aa,qr)}const Ei=h&&me||Qa,Rn=de||Ei?Al:ce?Fs:m.transform.clipSpaceToPixelsMatrix,ei=et&&n.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ha;ha=et?Be.iconsInText?zo(xt.kind,rs,xe,ce,de,Ei,m,Rn,Ja,Aa,ss,Xs,Ue):pu(xt.kind,rs,xe,ce,de,Ei,m,Rn,Ja,Aa,h,ss,0,Ue):vd(xt.kind,rs,xe,ce,de,Ei,m,Rn,Ja,Aa,h,ss,Ue);const pa={program:zr,buffers:ot,uniformValues:ha,projectionData:jn,atlasTexture:$r,atlasTextureIcon:js,atlasInterpolation:ns,atlasInterpolationIcon:us,isSDF:et,hasHalo:ei};if(he&&Be.canOverlap){ge=!0;const qr=ot.segments.get();for(const Ur of qr)Ne.push({segments:new c.aX([Ur]),sortKey:Ur.sortKey,state:pa,terrainData:Vr})}else Ne.push({segments:ot.segments,sortKey:0,state:pa,terrainData:Vr})}ge&&Ne.sort(((Re,Oe)=>Re.sortKey-Oe.sortKey));for(const Re of Ne){const Oe=Re.state;if(G.activeTexture.set(J.TEXTURE0),Oe.atlasTexture.bind(Oe.atlasInterpolation,J.CLAMP_TO_EDGE),Oe.atlasTextureIcon&&(G.activeTexture.set(J.TEXTURE1),Oe.atlasTextureIcon&&Oe.atlasTextureIcon.bind(Oe.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),Oe.isSDF){const Be=Oe.uniformValues;Oe.hasHalo&&(Be.u_is_halo=1,Su(Oe.buffers,Re.segments,n,m,Oe.program,we,D,$,Be,Oe.projectionData,Re.terrainData)),Be.u_is_halo=0}Su(Oe.buffers,Re.segments,n,m,Oe.program,we,D,$,Oe.uniformValues,Oe.projectionData,Re.terrainData)}}function Su(m,t,n,l,h,g,_,j,E,M,D){const $=l.context;h.draw($,$.gl.TRIANGLES,g,_,j,pr.backCCW,E,D,M,n.id,m.layoutVertexBuffer,m.indexBuffer,t,n.paint,l.transform.zoom,m.programConfigurations.get(n.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Td(m,t,n,l,h){const g=m.context,_=g.gl,j=mr.disabled,E=new br([_.ONE,_.ONE],c.bp.transparent,[!0,!0,!0,!0]),M=t.getBucket(n);if(!M)return;const D=l.key;let $=n.heatmapFbos.get(D);$||($=Tc(g,t.tileSize,t.tileSize),n.heatmapFbos.set(D,$)),g.bindFramebuffer.set($.framebuffer),g.viewport.set([0,0,t.tileSize,t.tileSize]),g.clear({color:c.bp.transparent});const B=M.programConfigurations.get(n.id),G=m.useProgram("heatmap",B,!h),J=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=m.style.map.terrain.getTerrainData(l);G.draw(g,_.TRIANGLES,or.disabled,j,E,pr.disabled,El(t,m.transform.zoom,n.paint.get("heatmap-intensity"),1),le,J,n.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,n.paint,m.transform.zoom,B)}function kh(m,t,n,l,h){const g=m.context,_=g.gl,j=m.transform;g.setColorMode(m.colorModeForRenderPass());const E=Dl(g,t),M=n.key,D=t.heatmapFbos.get(M);if(!D)return;g.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,D.colorAttachment.get()),g.activeTexture.set(_.TEXTURE1),E.bind(_.LINEAR,_.CLAMP_TO_EDGE);const $=j.getProjectionData({overscaledTileID:n,applyTerrainMatrix:h,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(g,_.TRIANGLES,or.disabled,mr.disabled,m.colorModeForRenderPass(),pr.disabled,_d(m,t,0,1),null,$,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,j.zoom),D.destroy(),t.heatmapFbos.delete(M)}function Tc(m,t,n){var l,h;const g=m.gl,_=g.createTexture();g.bindTexture(g.TEXTURE_2D,_),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const j=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:g.UNSIGNED_BYTE,E=(h=m.RGBA16F)!==null&&h!==void 0?h:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,E,t,n,0,g.RGBA,j,null);const M=m.createFramebuffer(t,n,!1,!1);return M.colorAttachment.set(_),M}function Dl(m,t){return t.colorRampTexture||(t.colorRampTexture=new c.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function vi(m,t,n,l,h,g,_,j){let E=256;if(h.stepInterpolant){const M=t.getSource().maxzoom,D=_.canonical.z===M?Math.ceil(1<<m.transform.maxZoom-_.canonical.z):1;E=c.an(c.ce(g.maxLineLength/c.a5*1024*D),256,n.maxTextureSize)}return j.gradient=c.cf({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:E,image:j.gradient||void 0,clips:g.lineClipsArray}),j.texture?j.texture.update(j.gradient):j.texture=new c.T(n,j.gradient,l.RGBA),j.version=h.gradientVersion,j.texture}function Nd(m,t,n,l,h){m.activeTexture.set(t.TEXTURE0),n.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function Hr(m,t,n,l,h,g){(h||m.lineAtlas.dirty)&&(t.activeTexture.set(n.TEXTURE0),m.lineAtlas.bind(t)),l.updatePaintBuffers(g)}function cn(m,t,n,l,h,g,_){const j=g.gradients[h.id];let E=j.texture;h.gradientVersion!==j.version&&(E=vi(m,t,n,l,h,g,_,j)),n.activeTexture.set(l.TEXTURE0),E.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function tn(m,t,n,l,h,g,_,j,E){const M=g.gradients[h.id];let D=M.texture;h.gradientVersion!==M.version&&(D=vi(m,t,n,l,h,g,_,M)),n.activeTexture.set(l.TEXTURE0),D.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),n.activeTexture.set(l.TEXTURE1),m.lineAtlas.bind(n),j.updatePaintBuffers(E)}function aa(m,t,n,l,h){if(!n||!l||!l.imageAtlas)return;const g=l.imageAtlas.patternPositions;let _=g[n.to.toString()],j=g[n.from.toString()];if(!_&&j&&(_=j),!j&&_&&(j=_),!_||!j){const E=h.getPaintProperty(t);_=g[E],j=g[E]}_&&j&&m.setConstantPatternPositions(_,j)}function Uo(m,t,n,l,h,g,_,j){const E=m.context.gl,M="fill-pattern",D=n.paint.get(M),$=D&&D.constantOr(1),B=n.getCrossfadeParameters();let G,J,le,ue,ce;const de=m.transform,xe=n.paint.get("fill-translate"),he=n.paint.get("fill-translate-anchor");_?(J=$&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=E.LINES):(J=$?"fillPattern":"fill",G=E.TRIANGLES);const ge=D.constantOr(null);for(const we of l){const me=t.getTile(we);if($&&!me.patternsLoaded())continue;const Ne=me.getBucket(n);if(!Ne)continue;const Ue=Ne.programConfigurations.get(n.id),Re=m.useProgram(J,Ue),Oe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(we);$&&(m.context.activeTexture.set(E.TEXTURE0),me.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Ue.updatePaintBuffers(B)),aa(Ue,M,ge,me,n);const Be=de.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),ot=c.aO(de,me,xe,he);if(_){ue=Ne.indexBuffer2,ce=Ne.segments2;const et=[E.drawingBufferWidth,E.drawingBufferHeight];le=J==="fillOutlinePattern"&&$?gd(m,B,me,et,ot):md(et,ot)}else ue=Ne.indexBuffer,ce=Ne.segments,le=$?cu(m,B,me,ot):{u_fill_translate:ot};const ct=m.stencilModeForClipping(we);Re.draw(m.context,G,h,ct,g,pr.backCCW,le,Oe,Be,n.id,Ne.layoutVertexBuffer,ue,ce,n.paint,m.transform.zoom,Ue)}}function Tu(m,t,n,l,h,g,_,j){const E=m.context,M=E.gl,D="fill-extrusion-pattern",$=n.paint.get(D),B=$.constantOr(1),G=n.getCrossfadeParameters(),J=n.paint.get("fill-extrusion-opacity"),le=$.constantOr(null),ue=m.transform;for(const ce of l){const de=t.getTile(ce),xe=de.getBucket(n);if(!xe)continue;const he=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce),ge=xe.programConfigurations.get(n.id),we=m.useProgram(B?"fillExtrusionPattern":"fillExtrusion",ge);B&&(m.context.activeTexture.set(M.TEXTURE0),de.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ge.updatePaintBuffers(G));const me=ue.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!j,applyTerrainMatrix:!0});aa(ge,D,le,de,n);const Ne=c.aO(ue,de,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Ue=n.paint.get("fill-extrusion-vertical-gradient"),Re=B?lu(m,Ue,J,Ne,ce,G,de):fd(m,Ue,J,Ne);we.draw(E,E.gl.TRIANGLES,h,g,_,pr.backCCW,Re,he,me,n.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,n.paint,m.transform.zoom,ge,m.style.map.terrain&&xe.centroidVertexBuffer)}}function Qi(m,t,n,l,h,g,_,j,E){var M;const D=m.style.projection,$=m.context,B=m.transform,G=$.gl,J=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],le=m.useProgram("hillshade",null,!1,J),ue=!m.options.moving;for(const ce of l){const de=t.getTile(ce),xe=de.fbo;if(!xe)continue;const he=D.getMeshFromTileID($,ce.canonical,j,!0,"raster"),ge=(M=m.style.map.terrain)===null||M===void 0?void 0:M.getTerrainData(ce);$.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,xe.colorAttachment.get());const we=B.getProjectionData({overscaledTileID:ce,aligned:ue,applyGlobeMatrix:!E,applyTerrainMatrix:!0});le.draw($,G.TRIANGLES,g,h[ce.overscaledZ],_,pr.backCCW,mc(m,de,n),ge,we,n.id,he.vertexBuffer,he.indexBuffer,he.segments)}}function Ea(m,t,n,l,h,g,_,j,E){var M;const D=m.style.projection,$=m.context,B=m.transform,G=$.gl,J=m.useProgram("colorRelief"),le=!m.options.moving;let ue=!0,ce=0;for(const de of l){const xe=t.getTile(de),he=xe.dem;if(ue){const Re=G.getParameter(G.MAX_TEXTURE_SIZE),{elevationTexture:Oe,colorTexture:Be}=n.getColorRampTextures($,Re,he.getUnpackVector());$.activeTexture.set(G.TEXTURE1),Oe.bind(G.NEAREST,G.CLAMP_TO_EDGE),$.activeTexture.set(G.TEXTURE4),Be.bind(G.LINEAR,G.CLAMP_TO_EDGE),ue=!1,ce=Oe.size[0]}if(!he||!he.data)continue;const ge=he.stride,we=he.getPixels();if($.activeTexture.set(G.TEXTURE0),$.pixelStoreUnpackPremultiplyAlpha.set(!1),xe.demTexture=xe.demTexture||m.getTileTexture(ge),xe.demTexture){const Re=xe.demTexture;Re.update(we,{premultiply:!1}),Re.bind(G.LINEAR,G.CLAMP_TO_EDGE)}else xe.demTexture=new c.T($,we,G.RGBA,{premultiply:!1}),xe.demTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const me=D.getMeshFromTileID($,de.canonical,j,!0,"raster"),Ne=(M=m.style.map.terrain)===null||M===void 0?void 0:M.getTerrainData(de),Ue=B.getProjectionData({overscaledTileID:de,aligned:le,applyGlobeMatrix:!E,applyTerrainMatrix:!0});J.draw($,G.TRIANGLES,g,h[de.overscaledZ],_,pr.backCCW,gh(n,xe.dem,ce),Ne,Ue,n.id,me.vertexBuffer,me.indexBuffer,me.segments)}}const Ca=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function Pa(m,t,n,l,h,g,_,j,E=!1,M=!1){const D=l[l.length-1].overscaledZ,$=m.context,B=$.gl,G=m.useProgram("raster"),J=m.transform,le=m.style.projection,ue=m.colorModeForRenderPass(),ce=!m.options.moving,de=n.paint.get("raster-opacity"),xe=n.paint.get("raster-resampling"),he=n.paint.get("raster-fade-duration"),ge=!!m.style.map.terrain;for(const we of l){const me=m.getDepthModeForSublayer(we.overscaledZ-D,de===1?or.ReadWrite:or.ReadOnly,B.LESS),Ne=t.getTile(we),Ue=xe==="nearest"?B.NEAREST:B.LINEAR;$.activeTexture.set(B.TEXTURE0),Ne.texture.bind(Ue,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),$.activeTexture.set(B.TEXTURE1);const{parentTile:Re,parentScaleBy:Oe,parentTopLeft:Be,fadeValues:ot}=Nc(Ne,t,he,ge);Ne.fadeOpacity=ot.tileOpacity,Re?(Re.fadeOpacity=ot.parentTileOpacity,Re.texture.bind(Ue,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST)):Ne.texture.bind(Ue,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST),Ne.texture.useMipmap&&$.extTextureFilterAnisotropic&&m.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const ct=m.style.map.terrain&&m.style.map.terrain.getTerrainData(we),et=J.getProjectionData({overscaledTileID:we,aligned:ce,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),xt=hu(Be,Oe,ot.fadeMix,n,j),rr=le.getMeshFromTileID($,we.canonical,g,_,"raster");G.draw($,B.TRIANGLES,me,h?h[we.overscaledZ]:mr.disabled,ue,E?pr.frontCCW:pr.backCCW,xt,ct,et,n.id,rr.vertexBuffer,rr.indexBuffer,rr.segments)}}function Nc(m,t,n,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(n===0||l)return h;if(m.fadingParentID){const g=t.getLoadedTile(m.fadingParentID);if(!g)return h;const _=Math.pow(2,g.tileID.overscaledZ-m.tileID.overscaledZ),j=[m.tileID.canonical.x*_%1,m.tileID.canonical.y*_%1],E=(function(M,D,$){const B=re(),G=(B-D.timeAdded)/$,J=M.fadingDirection===$e.Incoming,le=c.an((B-M.timeAdded)/$,0,1),ue=c.an(1-G,0,1),ce=J?le:ue;return{tileOpacity:ce,parentTileOpacity:J?ue:le,fadeMix:{opacity:1,mix:1-ce}}})(m,g,n);return{parentTile:g,parentScaleBy:_,parentTopLeft:j,fadeValues:E}}if(m.selfFading){const g=(function(_,j){const E=(re()-_.timeAdded)/j,M=c.an(E,0,1);return{tileOpacity:M,fadeMix:{opacity:M,mix:0}}})(m,n);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:g}}return h}const Nu=new c.bp(1,0,0,1),qo=new c.bp(0,1,0,1),wi=new c.bp(0,0,1,1),es=new c.bp(1,0,1,1),Er=new c.bp(0,1,1,1);function Ga(m,t,n,l){Ws(m,0,t+n/2,m.transform.width,n,l)}function Hs(m,t,n,l){Ws(m,t-n/2,0,n,m.transform.height,l)}function Ws(m,t,n,l,h,g){const _=m.context,j=_.gl;j.enable(j.SCISSOR_TEST),j.scissor(t*m.pixelRatio,n*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),_.clear({color:g}),j.disable(j.SCISSOR_TEST)}function eo(m,t,n){const l=m.context,h=l.gl,g=m.useProgram("debug"),_=or.disabled,j=mr.disabled,E=m.colorModeForRenderPass(),M="$debug",D=m.style.map.terrain&&m.style.map.terrain.getTerrainData(n);l.activeTexture.set(h.TEXTURE0);const $=t.getTileByID(n.key).latestRawTileData,B=Math.floor(($&&$.byteLength||0)/1024),G=t.getTile(n).tileSize,J=512/Math.min(G,512)*(n.overscaledZ/m.transform.zoom)*.5;let le=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(le+=` => ${n.overscaledZ}`),(function(ce,de){ce.initDebugOverlayCanvas();const xe=ce.debugOverlayCanvas,he=ce.context.gl,ge=ce.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,xe.width,xe.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(de,5,5),ge.strokeText(de,5,5),ce.debugOverlayTexture.update(xe),ce.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)})(m,`${le} ${B}kB`);const ue=m.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(l,h.TRIANGLES,_,j,br.alphaBlended,pr.disabled,yd(c.bp.transparent,J),null,ue,M,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(l,h.LINE_STRIP,_,j,E,pr.disabled,yd(c.bp.red),D,ue,M,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function to(m,t,n,l){const{isRenderingGlobe:h}=l,g=m.context,_=g.gl,j=m.transform,E=m.colorModeForRenderPass(),M=m.getDepthModeFor3D(),D=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(const $ of n){const B=t.getTerrainMesh($.tileID),G=m.renderToTexture.getTexture($),J=t.getTerrainData($.tileID);g.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,G.texture);const le=t.getMeshFrameDelta(j.zoom),ue=j.calculateFogMatrix($.tileID.toUnwrapped()),ce=ip(le,ue,m.style.sky,j.pitch,h),de=j.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(g,_.TRIANGLES,M,mr.disabled,E,pr.backCCW,ce,J,de,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}function un(m,t){if(!t.mesh){const n=new c.aW;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const l=new c.aY;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Br(m.createVertexBuffer(n,ra.members),m.createIndexBuffer(l),c.aX.simpleSegment(0,0,n.length,l.length))}return t.mesh}class Ec{constructor(t,n){this.context=new wu(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ea.maxOverzooming+ea.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qs}resize(t,n,l){if(this.width=Math.floor(t*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,n=new c.aW;n.emplaceBack(0,0),n.emplaceBack(c.a5,0),n.emplaceBack(0,c.a5),n.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=t.createVertexBuffer(n,ra.members),this.tileExtentSegments=c.aX.simpleSegment(0,0,4,2);const l=new c.aW;l.emplaceBack(0,0),l.emplaceBack(c.a5,0),l.emplaceBack(0,c.a5),l.emplaceBack(c.a5,c.a5),this.debugBuffer=t.createVertexBuffer(l,ra.members),this.debugSegments=c.aX.simpleSegment(0,0,4,5);const h=new c.ch;h.emplaceBack(0,0,0,0),h.emplaceBack(c.a5,0,c.a5,0),h.emplaceBack(0,c.a5,0,c.a5),h.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,ap.members),this.rasterBoundsSegments=c.aX.simpleSegment(0,0,4,2);const g=new c.aW;g.emplaceBack(0,0),g.emplaceBack(c.a5,0),g.emplaceBack(0,c.a5),g.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(g,ra.members),this.rasterBoundsSegmentsPosOnly=c.aX.simpleSegment(0,0,4,5);const _=new c.aW;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,ra.members),this.viewportSegments=c.aX.simpleSegment(0,0,4,2);const j=new c.ci;j.emplaceBack(0),j.emplaceBack(1),j.emplaceBack(3),j.emplaceBack(2),j.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(j);const E=new c.aY;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const M=this.context.gl;this.stencilClearMode=new mr({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.tileExtentMesh=new Br(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=c.N();c.c7(l,0,this.width,this.height,0,0,1),c.Q(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,n.TRIANGLES,or.disabled,this.stencilClearMode,br.disabled,pr.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source,this.nextStencilID+n.length>256&&this.clearStencil();const h=this.context;h.setColorMode(br.disabled),h.setDepthMode(or.disabled);const g={};for(const _ of n)g[_.key]=this.nextStencilID++;this._renderTileMasks(g,n,l,!0),this._renderTileMasks(g,n,l,!1),this._tileClippingMaskIDs=g}_renderTileMasks(t,n,l,h){const g=this.context,_=g.gl,j=this.style.projection,E=this.transform,M=this.useProgram("clippingMask");for(const D of n){const $=t[D.key],B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),G=j.getMeshFromTileID(this.context,D.canonical,h,!0,"stencil"),J=E.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!l,applyTerrainMatrix:!0});M.draw(g,_.TRIANGLES,or.disabled,new mr({func:_.ALWAYS,mask:0},$,255,_.KEEP,_.KEEP,_.REPLACE),br.disabled,l?pr.disabled:pr.backCCW,null,B,J,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}_renderTilesDepthBuffer(){const t=this.context,n=t.gl,l=this.style.projection,h=this.transform,g=this.useProgram("depth"),_=this.getDepthModeFor3D(),j=Zr(h,{tileSize:h.tileSize});for(const E of j){const M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),D=l.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),$=h.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(t,n.TRIANGLES,_,mr.disabled,br.disabled,pr.backCCW,null,M,$,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new mr({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new mr({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const n=this.context.gl,l=t.sort(((_,j)=>j.overscaledZ-_.overscaledZ)),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const _={};for(let j=0;j<g;j++)_[j+h]=new mr({func:n.GEQUAL,mask:255},j+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=g,[_,l]}return[{[h]:mr.disabled},l]}stencilConfigForOverlapTwoPass(t){const n=this.context.gl,l=t.sort(((_,j)=>j.overscaledZ-_.overscaledZ)),h=l[l.length-1].overscaledZ,g=l[0].overscaledZ-h+1;if(this.clearStencil(),g>1){const _={},j={};for(let E=0;E<g;E++)_[E+h]=new mr({func:n.GREATER,mask:255},g+1+E,255,n.KEEP,n.KEEP,n.REPLACE),j[E+h]=new mr({func:n.GREATER,mask:255},1+E,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*g+1,[_,j,l]}return this.nextStencilID=3,[{[h]:new mr({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[h]:new mr({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new br([t.CONSTANT_COLOR,t.ONE],new c.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?br.unblended:br.alphaBlended}getDepthModeForSublayer(t,n,l){if(!this.opaquePassEnabledForLayer())return or.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new or(l||this.context.gl.LEQUAL,n,[h,h])}getDepthModeFor3D(){return new or(this.context.gl.LEQUAL,or.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){var l,h;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(re()),this.imageManager.beginFrame();const g=this.style._order,_=this.style.tileManagers,j={},E={},M={},D={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const B in _){const G=_[B];G.used&&G.prepare(this.context),j[B]=G.getVisibleCoordinates(!1),E[B]=j[B].slice().reverse(),M[B]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<g.length;B++)if(this.style._layers[g[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of g){const G=this.style._layers[B];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const J=E[G.source];(G.type==="custom"||J.length)&&this.renderLayer(this,_[G.source],G,J,D)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:B=>this.useProgram(B)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.bp.black:c.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(B,G){const J=B.context,le=J.gl,ue=((we,me,Ne)=>{const Ue=Math.cos(me.rollInRadians),Re=Math.sin(me.rollInRadians),Oe=wr(me),Be=me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:we.properties.get("sky-color"),u_horizon_color:we.properties.get("horizon-color"),u_horizon:[(me.width/2-Oe*Re)*Ne,(me.height/2+Oe*Ue)*Ne],u_horizon_normal:[-Re,Ue],u_sky_horizon_blend:we.properties.get("sky-horizon-blend")*me.height/2*Ne,u_sky_blend:Be}})(G,B.style.map.transform,B.pixelRatio),ce=new or(le.LEQUAL,or.ReadWrite,[0,1]),de=mr.disabled,xe=B.colorModeForRenderPass(),he=B.useProgram("sky"),ge=un(J,G);he.draw(J,le.TRIANGLES,ce,de,xe,pr.disabled,ue,null,void 0,"sky",ge.vertexBuffer,ge.indexBuffer,ge.segments)})(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[g[this.currentLayer]],G=_[B.source],J=j[B.source];this._renderTileClippingMasks(B,J,!1),this.renderLayer(this,G,B,J,D)}this.renderPass="translucent";let $=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const B=this.style._layers[g[this.currentLayer]],G=_[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B,D))continue;this.opaquePassEnabledForLayer()||$||($=!0,D.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const J=(B.type==="symbol"?M:E)[B.source];this._renderTileClippingMasks(B,j[B.source],!!this.renderToTexture),this.renderLayer(this,G,B,J,D)}if(D.isRenderingGlobe&&(function(B,G,J){const le=B.context,ue=le.gl,ce=B.useProgram("atmosphere"),de=new or(ue.LEQUAL,or.ReadOnly,[0,1]),xe=B.transform,he=(function(Be,ot){const ct=Be.properties.get("position"),et=[-ct.x,-ct.y,-ct.z],xt=c.ar(new Float64Array(16));return Be.properties.get("anchor")==="map"&&(c.bg(xt,xt,ot.rollInRadians),c.bh(xt,xt,-ot.pitchInRadians),c.bg(xt,xt,ot.bearingInRadians),c.bh(xt,xt,ot.center.lat*Math.PI/180),c.bJ(xt,xt,-ot.center.lng*Math.PI/180)),c.cg(et,et,xt),et})(J,B.transform),ge=xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),we=G.properties.get("atmosphere-blend")*ge.projectionTransition;if(we===0)return;const me=Eo(xe.worldSize,xe.center.lat),Ne=xe.inverseProjectionMatrix,Ue=new Float64Array(4);Ue[3]=1,c.aH(Ue,Ue,xe.modelViewProjectionMatrix),Ue[0]/=Ue[3],Ue[1]/=Ue[3],Ue[2]/=Ue[3],Ue[3]=1,c.aH(Ue,Ue,Ne),Ue[0]/=Ue[3],Ue[1]/=Ue[3],Ue[2]/=Ue[3],Ue[3]=1;const Re=((Be,ot,ct,et,xt)=>({u_sun_pos:Be,u_atmosphere_blend:ot,u_globe_position:ct,u_globe_radius:et,u_inv_proj_matrix:xt}))(he,we,[Ue[0],Ue[1],Ue[2]],me,Ne),Oe=un(le,G);ce.draw(le,ue.TRIANGLES,de,mr.disabled,br.alphaBlended,pr.disabled,Re,null,null,"atmosphere",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const B=(function(G,J){let le=null;const ue=Object.values(G._layers).flatMap((he=>he.source&&!he.isHidden(J)?[G.tileManagers[he.source]]:[])),ce=ue.filter((he=>he.getSource().type==="vector")),de=ue.filter((he=>he.getSource().type!=="vector")),xe=he=>{(!le||le.getSource().maxzoom<he.getSource().maxzoom)&&(le=he)};return ce.forEach((he=>xe(he))),le||de.forEach((he=>xe(he))),le})(this.style,this.transform.zoom);B&&(function(G,J,le){for(let ue=0;ue<le.length;ue++)eo(G,J,le[ue])})(this,B,B.getVisibleCoordinates())}this.options.showPadding&&(function(B){const G=B.transform.padding;Ga(B,B.transform.height-(G.top||0),3,Nu),Ga(B,G.bottom||0,3,qo),Hs(B,G.left||0,3,wi),Hs(B,B.transform.width-(G.right||0),3,es);const J=B.transform.centerPoint;(function(le,ue,ce,de){Ws(le,ue-1,ce-10,2,20,de),Ws(le,ue-10,ce-1,20,2,de)})(B,J.x,B.transform.height-J.y,Er)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!c.cj(n,l):!c.ck(n,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(c.cl(n,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,_){const j=g.context,E=j.gl,M=g.transform,D=br.unblended,$=new or(E.LEQUAL,or.ReadWrite,[0,1]),B=_.tileManager.getRenderableTiles(),G=g.useProgram("terrainDepth");j.bindFramebuffer.set(_.getFramebuffer("depth").framebuffer),j.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),j.clear({color:c.bp.transparent,depth:1});for(const J of B){const le=_.getTerrainMesh(J.tileID),ue=_.getTerrainData(J.tileID),ce=M.getProjectionData({overscaledTileID:J.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),de={u_ele_delta:_.getMeshFrameDelta(M.zoom)};G.draw(j,E.TRIANGLES,$,mr.disabled,D,pr.backCCW,de,ue,ce,"terrain",le.vertexBuffer,le.indexBuffer,le.segments)}j.bindFramebuffer.set(null),j.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,_){const j=g.context,E=j.gl,M=g.transform,D=br.unblended,$=new or(E.LEQUAL,or.ReadWrite,[0,1]),B=_.getCoordsTexture(),G=_.tileManager.getRenderableTiles(),J=g.useProgram("terrainCoords");j.bindFramebuffer.set(_.getFramebuffer("coords").framebuffer),j.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),j.clear({color:c.bp.transparent,depth:1}),_.coordsIndex=[];for(const le of G){const ue=_.getTerrainMesh(le.tileID),ce=_.getTerrainData(le.tileID);j.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,B.texture);const de={u_terrain_coords_id:(255-_.coordsIndex.length)/255,u_texture:0,u_ele_delta:_.getMeshFrameDelta(M.zoom)},xe=M.getProjectionData({overscaledTileID:le.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});J.draw(j,E.TRIANGLES,$,mr.disabled,D,pr.backCCW,de,ce,xe,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments),_.coordsIndex.push(le.tileID.key)}j.bindFramebuffer.set(null),j.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(t,n,l,h,g){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,c.cm(l)?(function(_,j,E,M,D,$){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:B}=$,G=mr.disabled,J=_.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(le,ue,ce,de,xe,he,ge,we,me){const Ne=ue.transform,Ue=ue.style.map.terrain,Re=xe==="map",Oe=he==="map";for(const Be of le){const ot=de.getTile(Be),ct=ot.getBucket(ce);if(!ct||!ct.text||!ct.text.segments.get().length)continue;const et=c.ay(ct.textSizeData,Ne.zoom),xt=c.aN(ot,1,ue.transform.zoom),rr=Cn(Re,ue.transform,xt),zr=ce.layout.get("icon-text-fit")!=="none"&&ct.hasIconData();if(et){const rs=Math.pow(2,Ne.zoom-ot.tileID.overscaledZ),Vr=Ue?(ss,$r)=>Ue.getElevation(Be,ss,$r):null;Sd(ct,Re,Oe,me,Ne,rr,rs,et,zr,c.aO(Ne,ot,ge,we),Be.toUnwrapped(),Vr)}}})(M,_,E,j,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),D),E.paint.get("icon-opacity").constantOr(1)!==0&&$o(_,j,E,M,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),G,J,B),E.paint.get("text-opacity").constantOr(1)!==0&&$o(_,j,E,M,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),G,J,B),j.map.showCollisionBoxes&&(Ji(_,j,E,M,!0),Ji(_,j,E,M,!1))})(t,n,l,h,this.style.placement.variableOffsets,g):c.cn(l)?(function(_,j,E,M,D){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:$}=D,B=E.paint.get("circle-opacity"),G=E.paint.get("circle-stroke-width"),J=E.paint.get("circle-stroke-opacity"),le=!E.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(G.constantOr(1)===0||J.constantOr(1)===0))return;const ue=_.context,ce=ue.gl,de=_.transform,xe=_.getDepthModeForSublayer(0,or.ReadOnly),he=mr.disabled,ge=_.colorModeForRenderPass(),we=[],me=de.getCircleRadiusCorrection();for(let Ne=0;Ne<M.length;Ne++){const Ue=M[Ne],Re=j.getTile(Ue),Oe=Re.getBucket(E);if(!Oe)continue;const Be=E.paint.get("circle-translate"),ot=E.paint.get("circle-translate-anchor"),ct=c.aO(de,Re,Be,ot),et=Oe.programConfigurations.get(E.id),xt=_.useProgram("circle",et),rr=Oe.layoutVertexBuffer,zr=Oe.indexBuffer,rs=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ue),Vr={programConfiguration:et,program:xt,layoutVertexBuffer:rr,indexBuffer:zr,uniformValues:xd(_,Re,E,ct,me),terrainData:rs,projectionData:de.getProjectionData({overscaledTileID:Ue,applyGlobeMatrix:!$,applyTerrainMatrix:!0})};if(le){const ss=Oe.segments.get();for(const $r of ss)we.push({segments:new c.aX([$r]),sortKey:$r.sortKey,state:Vr})}else we.push({segments:Oe.segments,sortKey:0,state:Vr})}le&&we.sort(((Ne,Ue)=>Ne.sortKey-Ue.sortKey));for(const Ne of we){const{programConfiguration:Ue,program:Re,layoutVertexBuffer:Oe,indexBuffer:Be,uniformValues:ot,terrainData:ct,projectionData:et}=Ne.state;Re.draw(ue,ce.TRIANGLES,xe,he,ge,pr.backCCW,ot,ct,et,E.id,Oe,Be,Ne.segments,E.paint,_.transform.zoom,Ue)}})(t,n,l,h,g):c.co(l)?(function(_,j,E,M,D){if(E.paint.get("heatmap-opacity")===0)return;const $=_.context,{isRenderingToTexture:B,isRenderingGlobe:G}=D;if(_.style.map.terrain){for(const J of M){const le=j.getTile(J);j.hasRenderableParent(J)||(_.renderPass==="offscreen"?Td(_,le,E,J,G):_.renderPass==="translucent"&&kh(_,E,J,B,G))}$.viewport.set([0,0,_.width,_.height])}else _.renderPass==="offscreen"?(function(J,le,ue,ce){const de=J.context,xe=de.gl,he=J.transform,ge=mr.disabled,we=new br([xe.ONE,xe.ONE],c.bp.transparent,[!0,!0,!0,!0]);(function(me,Ne,Ue){const Re=me.gl;me.activeTexture.set(Re.TEXTURE1),me.viewport.set([0,0,Ne.width/4,Ne.height/4]);let Oe=Ue.heatmapFbos.get(c.cd);Oe?(Re.bindTexture(Re.TEXTURE_2D,Oe.colorAttachment.get()),me.bindFramebuffer.set(Oe.framebuffer)):(Oe=Tc(me,Ne.width/4,Ne.height/4),Ue.heatmapFbos.set(c.cd,Oe))})(de,J,ue),de.clear({color:c.bp.transparent});for(let me=0;me<ce.length;me++){const Ne=ce[me];if(le.hasRenderableParent(Ne))continue;const Ue=le.getTile(Ne),Re=Ue.getBucket(ue);if(!Re)continue;const Oe=Re.programConfigurations.get(ue.id),Be=J.useProgram("heatmap",Oe),ot=he.getProjectionData({overscaledTileID:Ne,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ct=he.getCircleRadiusCorrection();Be.draw(de,xe.TRIANGLES,or.disabled,ge,we,pr.backCCW,El(Ue,he.zoom,ue.paint.get("heatmap-intensity"),ct),null,ot,ue.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,ue.paint,he.zoom,Oe)}de.viewport.set([0,0,J.width,J.height])})(_,j,E,M):_.renderPass==="translucent"&&(function(J,le){const ue=J.context,ce=ue.gl;ue.setColorMode(J.colorModeForRenderPass());const de=le.heatmapFbos.get(c.cd);de&&(ue.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_2D,de.colorAttachment.get()),ue.activeTexture.set(ce.TEXTURE1),Dl(ue,le).bind(ce.LINEAR,ce.CLAMP_TO_EDGE),J.useProgram("heatmapTexture").draw(ue,ce.TRIANGLES,or.disabled,mr.disabled,J.colorModeForRenderPass(),pr.disabled,_d(J,le,0,1),null,null,le.id,J.viewportBuffer,J.quadTriangleIndexBuffer,J.viewportSegments,le.paint,J.transform.zoom))})(_,E)})(t,n,l,h,g):c.cp(l)?(function(_,j,E,M,D){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:$}=D,B=E.paint.get("line-opacity"),G=E.paint.get("line-width");if(B.constantOr(1)===0||G.constantOr(1)===0)return;const J=_.getDepthModeForSublayer(0,or.ReadOnly),le=_.colorModeForRenderPass(),ue=E.paint.get("line-dasharray"),ce=ue.constantOr(1),de=E.paint.get("line-pattern"),xe=de.constantOr(1),he=E.paint.get("line-gradient"),ge=E.getCrossfadeParameters();let we;we=xe?"linePattern":ce&&he?"lineGradientSDF":ce?"lineSDF":he?"lineGradient":"line";const me=_.context,Ne=me.gl,Ue=_.transform;let Re=!0;for(const Oe of M){const Be=j.getTile(Oe);if(xe&&!Be.patternsLoaded())continue;const ot=Be.getBucket(E);if(!ot)continue;const ct=ot.programConfigurations.get(E.id),et=_.context.program.get(),xt=_.useProgram(we,ct),rr=Re||xt.program!==et,zr=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Oe),rs=de.constantOr(null),Vr=ue&&ue.constantOr(null);if(rs&&Be.imageAtlas){const Xs=Be.imageAtlas,js=Xs.patternPositions[rs.to.toString()],Pr=Xs.patternPositions[rs.from.toString()];js&&Pr&&ct.setConstantPatternPositions(js,Pr)}else if(Vr){const Xs=E.layout.get("line-cap")==="round",js=_.lineAtlas.getDash(Vr.to,Xs),Pr=_.lineAtlas.getDash(Vr.from,Xs);ct.setConstantDashPositions(js,Pr)}const ss=Ue.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),$r=Ue.getPixelScale();let ns;xe?(ns=uu(_,Be,E,$r,ge),Nd(me,Ne,Be,ct,ge)):ce&&he?(ns=Cl(_,Be,E,$r,ge,ot.lineClipsArray.length),tn(_,j,me,Ne,E,ot,Oe,ct,ge)):ce?(ns=du(_,Be,E,$r,ge),Hr(_,me,Ne,ct,rr,ge)):he?(ns=xh(_,Be,E,$r,ot.lineClipsArray.length),cn(_,j,me,Ne,E,ot,Oe)):ns=Wi(_,Be,E,$r);const us=_.stencilModeForClipping(Oe);xt.draw(me,Ne.TRIANGLES,J,us,le,pr.disabled,ns,zr,ss,E.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,E.paint,_.transform.zoom,ct,ot.layoutVertexBuffer2),Re=!1}})(t,n,l,h,g):c.cq(l)?(function(_,j,E,M,D){const $=E.paint.get("fill-color"),B=E.paint.get("fill-opacity");if(B.constantOr(1)===0)return;const{isRenderingToTexture:G}=D,J=_.colorModeForRenderPass(),le=E.paint.get("fill-pattern"),ue=_.opaquePassEnabledForLayer()&&!le.constantOr(1)&&$.constantOr(c.bp.transparent).a===1&&B.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===ue){const ce=_.getDepthModeForSublayer(1,_.renderPass==="opaque"?or.ReadWrite:or.ReadOnly);Uo(_,j,E,M,ce,J,!1,G)}if(_.renderPass==="translucent"&&E.paint.get("fill-antialias")){const ce=_.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,or.ReadOnly);Uo(_,j,E,M,ce,J,!0,G)}})(t,n,l,h,g):c.cr(l)?(function(_,j,E,M,D){const $=E.paint.get("fill-extrusion-opacity");if($===0)return;const{isRenderingToTexture:B}=D;if(_.renderPass==="translucent"){const G=new or(_.context.gl.LEQUAL,or.ReadWrite,_.depthRangeFor3D);if($!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))Tu(_,j,E,M,G,mr.disabled,br.disabled,B),Tu(_,j,E,M,G,_.stencilModeFor3D(),_.colorModeForRenderPass(),B);else{const J=_.colorModeForRenderPass();Tu(_,j,E,M,G,mr.disabled,J,B)}}})(t,n,l,h,g):c.cs(l)?(function(_,j,E,M,D){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const{isRenderingToTexture:$}=D,B=_.context,G=_.style.projection.useSubdivision,J=_.getDepthModeForSublayer(0,or.ReadOnly),le=_.colorModeForRenderPass();if(_.renderPass==="offscreen")(function(ue,ce,de,xe,he,ge,we){const me=ue.context,Ne=me.gl;for(const Ue of de){const Re=ce.getTile(Ue),Oe=Re.dem;if(!Oe||!Oe.data||!Re.needsHillshadePrepare)continue;const Be=Oe.dim,ot=Oe.stride,ct=Oe.getPixels();if(me.activeTexture.set(Ne.TEXTURE1),me.pixelStoreUnpackPremultiplyAlpha.set(!1),Re.demTexture=Re.demTexture||ue.getTileTexture(ot),Re.demTexture){const xt=Re.demTexture;xt.update(ct,{premultiply:!1}),xt.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE)}else Re.demTexture=new c.T(me,ct,Ne.RGBA,{premultiply:!1}),Re.demTexture.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);me.activeTexture.set(Ne.TEXTURE0);let et=Re.fbo;if(!et){const xt=new c.T(me,{width:Be,height:Be,data:null},Ne.RGBA);xt.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),et=Re.fbo=me.createFramebuffer(Be,Be,!0,!1),et.colorAttachment.set(xt.texture)}me.bindFramebuffer.set(et.framebuffer),me.viewport.set([0,0,Be,Be]),ue.useProgram("hillshadePrepare").draw(me,Ne.TRIANGLES,he,ge,we,pr.disabled,gc(Re.tileID,Oe),null,null,xe.id,ue.rasterBoundsBuffer,ue.quadTriangleIndexBuffer,ue.rasterBoundsSegments),Re.needsHillshadePrepare=!1}})(_,j,M,E,J,mr.disabled,le),B.viewport.set([0,0,_.width,_.height]);else if(_.renderPass==="translucent")if(G){const[ue,ce,de]=_.stencilConfigForOverlapTwoPass(M);Qi(_,j,E,de,ue,J,le,!1,$),Qi(_,j,E,de,ce,J,le,!0,$)}else{const[ue,ce]=_.getStencilConfigForOverlapAndUpdateStencilID(M);Qi(_,j,E,ce,ue,J,le,!1,$)}})(t,n,l,h,g):c.ct(l)?(function(_,j,E,M,D){if(_.renderPass!=="translucent"||!M.length)return;const{isRenderingToTexture:$}=D,B=_.style.projection.useSubdivision,G=_.getDepthModeForSublayer(0,or.ReadOnly),J=_.colorModeForRenderPass();if(B){const[le,ue,ce]=_.stencilConfigForOverlapTwoPass(M);Ea(_,j,E,ce,le,G,J,!1,$),Ea(_,j,E,ce,ue,G,J,!0,$)}else{const[le,ue]=_.getStencilConfigForOverlapAndUpdateStencilID(M);Ea(_,j,E,ue,le,G,J,!1,$)}})(t,n,l,h,g):c.bU(l)?(function(_,j,E,M,D){if(_.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!M.length)return;const{isRenderingToTexture:$}=D,B=j.getSource(),G=_.style.projection.useSubdivision;if(B instanceof _n)Pa(_,j,E,M,null,!1,!1,B.tileCoords,B.flippedWindingOrder,$);else if(G){const[J,le,ue]=_.stencilConfigForOverlapTwoPass(M);Pa(_,j,E,ue,J,!1,!0,Ca,!1,$),Pa(_,j,E,ue,le,!0,!0,Ca,!1,$)}else{const[J,le]=_.getStencilConfigForOverlapAndUpdateStencilID(M);Pa(_,j,E,le,J,!1,!0,Ca,!1,$)}})(t,n,l,h,g):c.cu(l)?(function(_,j,E,M,D){const $=E.paint.get("background-color"),B=E.paint.get("background-opacity");if(B===0)return;const{isRenderingToTexture:G}=D,J=_.context,le=J.gl,ue=_.style.projection,ce=_.transform,de=ce.tileSize,xe=E.paint.get("background-pattern");if(_.isPatternMissing(xe))return;const he=!xe&&$.a===1&&B===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==he)return;const ge=mr.disabled,we=_.getDepthModeForSublayer(0,he==="opaque"?or.ReadWrite:or.ReadOnly),me=_.colorModeForRenderPass(),Ne=_.useProgram(xe?"backgroundPattern":"background"),Ue=M||Zr(ce,{tileSize:de,terrain:_.style.map.terrain});xe&&(J.activeTexture.set(le.TEXTURE0),_.imageManager.bind(_.context));const Re=E.getCrossfadeParameters();for(const Oe of Ue){const Be=ce.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),ot=xe?Ta(B,_,xe,{tileID:Oe,tileSize:de},Re):wd(B,$),ct=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Oe),et=ue.getMeshFromTileID(J,Oe.canonical,!1,!0,"raster");Ne.draw(J,le.TRIANGLES,we,ge,me,pr.backCCW,ot,ct,Be,E.id,et.vertexBuffer,et.indexBuffer,et.segments)}})(t,0,l,h,g):c.cv(l)&&(function(_,j,E,M){const{isRenderingGlobe:D}=M,$=_.context,B=E.implementation,G=_.style.projection,J=_.transform,le=J.getProjectionDataForCustomLayer(D),ue={farZ:J.farZ,nearZ:J.nearZ,fov:J.fov*Math.PI/180,modelViewProjectionMatrix:J.modelViewProjectionMatrix,projectionMatrix:J.projectionMatrix,shaderData:{variantName:G.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${G.shaderPreludeCode.vertexSource}`,define:G.shaderDefine},defaultProjectionData:le},ce=B.renderingMode?B.renderingMode:"2d";if(_.renderPass==="offscreen"){const de=B.prerender;de&&(_.setCustomLayerDefaults(),$.setColorMode(_.colorModeForRenderPass()),de.call(B,$.gl,ue),$.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),$.setColorMode(_.colorModeForRenderPass()),$.setStencilMode(mr.disabled);const de=ce==="3d"?_.getDepthModeFor3D():_.getDepthModeForSublayer(0,or.ReadOnly);$.setDepthMode(de),B.render($.gl,ue),$.setDirty(),_.setBaseState(),$.bindFramebuffer.set(null)}})(t,0,l,g))}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!n||!l}useProgram(t,n,l=!1,h=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,_=this.style.projection,j=l?Ir.projectionMercator:_.shaderPreludeCode,E=l?bn:_.shaderDefine,M=t+(n?n.cacheKey:"")+`/${l?Pn:_.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[M]||(this.cache[M]=new ou(this.context,Ir[t],n,yh[t],this._showOverdrawInspector,g,j,E,h)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,n;if(this._tileTextures){for(const l in this._tileTextures){const h=this._tileTextures[l];if(h)for(const g of h)g.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((n=this.tileExtentMesh.indexBuffer)===null||n===void 0||n.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const h=this.cache[l];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}function Eu(m,t){let n,l=!1,h=null,g=null;const _=()=>{h=null,l&&(m.apply(g,n),h=setTimeout(_,t),l=!1)};return(...j)=>(l=!0,g=this,n=j,h||_(),h)}class Cu{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(l=h)})),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const l=n.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let g=window.location.hash.replace(h,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let _=window.location.href.replace(/(#.+)?$/,g);_=_.replace("&&","&"),window.history.replaceState(window.history.state,null,_)},this._updateHash=Eu(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),_=Math.round(n.lng*g)/g,j=Math.round(n.lat*g)/g,E=this._map.getBearing(),M=this._map.getPitch();let D="";if(D+=t?`/${_}/${j}/${l}`:`${l}/${j}/${_}`,(E||M)&&(D+="/"+Math.round(10*E)/10),M&&(D+=`/${Math.round(M)}`),this._hashName){const $=this._hashName;let B=!1;const G=window.location.hash.slice(1).split("&").map((J=>{const le=J.split("=")[0];return le===$?(B=!0,`${le}=${D}`):J})).filter((J=>J));return B||G.push(`${$}=${D}`),`#${G.join("&")}`}return`#${D}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new c.V(+t[2],+t[1])}catch{return!1}const n=+t[0],l=+(t[3]||0),h=+(t[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const Ma={linearity:.3,easing:c.cw(0,0,.3,1)},Ed=c.e({deceleration:2500,maxSpeed:1400},Ma),Is=c.e({deceleration:20,maxSpeed:1400},Ma),In=c.e({deceleration:1e3,maxSpeed:360},Ma),Pu=c.e({deceleration:1e3,maxSpeed:90},Ma),ia=c.e({deceleration:1e3,maxSpeed:360},Ma);class op{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:re(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=re();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)n.zoom+=g.zoomDelta||0,n.bearing+=g.bearingDelta||0,n.pitch+=g.pitchDelta||0,n.roll+=g.rollDelta||0,g.panDelta&&n.pan._add(g.panDelta),g.around&&(n.around=g.around),g.pinchAround&&(n.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(n.pan.mag()){const g=Za(n.pan.mag(),l,c.e({},Ed,t||{})),_=n.pan.mult(g.amount/n.pan.mag()),j=this._map.cameraHelper.handlePanInertia(_,this._map.transform);h.center=j.easingCenter,h.offset=j.easingOffset,oa(h,g)}if(n.zoom){const g=Za(n.zoom,l,Is);h.zoom=this._map.transform.zoom+g.amount,oa(h,g)}if(n.bearing){const g=Za(n.bearing,l,In);h.bearing=this._map.transform.bearing+c.an(g.amount,-179,179),oa(h,g)}if(n.pitch){const g=Za(n.pitch,l,Pu);h.pitch=this._map.transform.pitch+g.amount,oa(h,g)}if(n.roll){const g=Za(n.roll,l,ia);h.roll=this._map.transform.roll+c.an(g.amount,-179,179),oa(h,g)}if(h.zoom||h.bearing){const g=n.pinchAround===void 0?n.around:n.pinchAround;h.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),c.e(h,{noMoveStart:!0})}}function oa(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Za(m,t,n){const{maxSpeed:l,linearity:h,deceleration:g}=n,_=c.an(m*h/(t/1e3),-l,l),j=Math.abs(_)/(g*h);return{easing:n.easing,duration:1e3*j,amount:_*(j/2)}}class ys extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const g=H.mousePos(n.getCanvas(),l),_=n.unproject(g);super(t,c.e({point:g,lngLat:_,originalEvent:l},h)),this._defaultPrevented=!1,this.target=n}}class ro extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){const h=t==="touchend"?l.changedTouches:l.touches,g=H.touchPos(n.getCanvasContainer(),h),_=g.map((E=>n.unproject(E))),j=g.reduce(((E,M,D,$)=>E.add(M.div($.length))),new c.P(0,0));super(t,{points:g,point:j,lngLats:_,lngLat:n.unproject(j),originalEvent:l}),this._defaultPrevented=!1}}class Cc extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class la{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Cc(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new ys(t.type,this._map,t))}mouseup(t){this._map.fire(new ys(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ys(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ys(t.type,this._map,t))}mouseover(t){this._map.fire(new ys(t.type,this._map,t))}mouseout(t){this._map.fire(new ys(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ro(t.type,this._map,t))}touchmove(t){this._map.fire(new ro(t.type,this._map,t))}touchend(t){this._map.fire(new ro(t.type,this._map,t))}touchcancel(t){this._map.fire(new ro(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ca{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ys(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ys("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ys(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ua{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(c.P.convert(t),this._map.terrain)}}class zn{constructor(t,n){this._map=t,this._tr=new ua(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(H.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=H.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(h.x,l.x),_=Math.max(h.x,l.x),j=Math.min(h.y,l.y),E=Math.max(h.y,l.y);H.setTransform(this._box,`translate(${g}px,${j}px)`),this._box.style.width=_-g+"px",this._box.style.height=E-j+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const l=this._startPos,h=n;if(this.reset(),H.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new c.l(t,{originalEvent:n}))}}function Ls(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const n={};for(let l=0;l<m.length;l++)n[m[l].identifier]=t[l];return n}class bt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=(function(h){const g=new c.P(0,0);for(const _ of h)g._add(_);return g.div(h.length)})(n),this.touches=Ls(l,n)))}touchmove(t,n,l){if(this.aborted||!this.centroid)return;const h=Ls(l,n);for(const g in this.touches){const _=h[g];(!_||_.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,n,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Pc{constructor(t){this.singleTap=new bt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,l){this.singleTap.touchstart(t,n,l)}touchmove(t,n,l){this.singleTap.touchmove(t,n,l)}touchend(t,n,l){const h=this.singleTap.touchend(t,n,l);if(h){const g=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(h)<30;if(g&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Mc{constructor(t){this._tr=new ua(t),this._zoomIn=new Pc({numTouches:1,numTaps:2}),this._zoomOut=new Pc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,l){this._zoomIn.touchstart(t,n,l),this._zoomOut.touchstart(t,n,l)}touchmove(t,n,l){this._zoomIn.touchmove(t,n,l),this._zoomOut.touchmove(t,n,l)}touchend(t,n,l){const h=this._zoomIn.touchend(t,n,l),g=this._zoomOut.touchend(t,n,l),_=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(h)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:j=>j.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class so{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(n)?n[0]:n;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&H.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const rn=0,sn=2,ts={[rn]:1,[sn]:2};class kn{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=H.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(n,l){const h=ts[l];return n.buttons===void 0||(n.buttons&h)!==h})(t,this._eventButton)}isValidEndEvent(t){return H.mouseButton(t)===this._eventButton}}class Mu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Cd{constructor(t=new kn({checkCorrectEvent:()=>!0}),n=new Mu){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(t,n,l){return t instanceof MouseEvent?n(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.startMove(n)),(n=>this.oneFingerTouchMoveStateManager.startMove(n)))}endMove(t){this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.endMove(n)),(n=>this.oneFingerTouchMoveStateManager.endMove(n)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidStartEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidMoveEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidEndEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n)))}}const no=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Pd{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,n,l){return this._calculateTransform(t,n,l)}touchmove(t,n,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,n,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,n,l){this._calculateTransform(t,n,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,l){l.length>0&&(this._active=!0);const h=Ls(l,n),g=new c.P(0,0),_=new c.P(0,0);let j=0;for(const M in h){const D=h[M],$=this._touches[M];$&&(g._add(D),_._add(D.sub($)),j++,h[M]=D)}if(this._touches=h,this._shouldBePrevented(j)||!_.mag())return;const E=_.div(j);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(j),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ic{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,g]=this._firstTwoTouches,_=Go(l,n,h),j=Go(l,n,g);if(!_||!j)return;const E=this._aroundCenter?null:_.add(j).div(2);return this._move([_,j],E,t)}touchend(t,n,l){if(!this._firstTwoTouches)return;const[h,g]=this._firstTwoTouches,_=Go(l,n,h),j=Go(l,n,g);_&&j||(this._active&&H.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Go(m,t,n){for(let l=0;l<m.length;l++)if(m[l].identifier===n)return t[l]}function Md(m,t){return Math.log(m/t)/Math.LN2}class ao extends Ic{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Md(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Md(this._distance,l),pinchAround:n}}}function Iu(m,t){return 180*m.angleWith(t)/Math.PI}class Id extends Ic{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Iu(this._vector,h),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,l=Iu(t,this._startVector);return Math.abs(l)<n}}function Zo(m){return Math.abs(m.y)>Math.abs(m.x)}class zc extends Ic{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,l){super.touchstart(t,n,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,Zo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,g,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,g=n.mag()>=2;if(!h&&!g)return;if(!h||!g)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const _=t.y>0==n.y>0;return Zo(t)&&Zo(n)&&_}}const ki={panStep:100,bearingStep:15,pitchStep:10};class Rr{constructor(t){this._tr=new ua(t);const n=ki;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,l=0,h=0,g=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:j=>{const E=this._tr;j.easeTo({duration:300,easeId:"keyboardHandler",easing:Rl,zoom:n?Math.round(E.zoom)+n*(t.shiftKey?2:1):E.zoom,bearing:E.bearing+l*this._bearingStep,pitch:E.pitch+h*this._pitchStep,offset:[-g*this._panStep,-_*this._panStep],center:E.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rl(m){return m*(2-m)}const Ll=4.000244140625,Ho=1/450;class Wo{constructor(t,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new ua(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ho}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=re(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%Ll==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=H.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(c.V.convert(l.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const j=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=j),typeof this._targetZoom=="number"&&(this._targetZoom+=j)}if(this._delta!==0){const j=this._type==="wheel"&&Math.abs(this._delta)>Ll?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&E!==0&&(E=1/E);const M=typeof this._targetZoom!="number"?t.scale:c.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),c.at(M*E)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let g,_=!1;if(this._type==="wheel"&&l&&h){const j=re()-this._lastWheelEventTime,E=Math.min((j+5)/200,1),M=h(E);g=c.G.number(l,n,M),E<1?this._frameId||(this._frameId=!0):_=!0}else g=n,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!_,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=c.cy;if(this._prevEase){const l=this._prevEase,h=(re()-l.start)/l.duration,g=l.easing(h+.01)-l.easing(h),_=.27/Math.sqrt(g*g+1e-4)*.01,j=Math.sqrt(.0729-_*_);n=c.cw(_,j,.25,1)}return this._prevEase={start:re(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class io{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zu{constructor(t){this._tr=new ua(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Au{constructor(){this._tap=new Pc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,l){if(!this._swipePoint)if(this._tapTime){const h=n[0],g=t.timeStamp-this._tapTime<500,_=this._tapPoint.dist(h)<30;g&&_?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,n,l)}touchmove(t,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=n[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,n,l)}touchend(t,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,n,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Du{constructor(t,n,l){this._el=t,this._mousePan=n,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xn{constructor(t,n,l,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=n,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ha{constructor(t,n,l,h){this._el=t,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Et{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=H.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=n,this._container.appendChild(h);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=l,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(H.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,n){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:t,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Rt=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Xo extends c.l{}function Ac(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class da{constructor(t,n){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,g)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=h.type==="renderFrame"?void 0:h,j={needsRenderFrame:!1},E={},M={};for(const{handlerName:B,handler:G,allowed:J}of this._handlers){if(!G.isEnabled())continue;let le;if(this._blockedByActive(M,J,B))G.reset();else if(G[g||h.type]){if(c.cz(h,g||h.type)){const ue=H.mousePos(this._map.getCanvas(),h);le=G[g||h.type](h,ue)}else if(c.cA(h,g||h.type)){const ue=this._getMapTouches(h.touches),ce=H.touchPos(this._map.getCanvas(),ue);le=G[g||h.type](h,ce,ue)}else c.cB(g||h.type)||(le=G[g||h.type](h));this.mergeHandlerResult(j,E,le,B,_),le&&le.needsRenderFrame&&this._triggerRenderFrame()}(le||G.isActive())&&(M[B]=G)}const D={};for(const B in this._previousActiveHandlers)M[B]||(D[B]=_);this._previousActiveHandlers=M,(Object.keys(D).length||Ac(j))&&(this._changes.push([j,E,D]),this._triggerRenderFrame()),(Object.keys(M).length||Ac(j))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=j;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new op(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,g,_]of this._listeners)H.addEventListener(h,g,h===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[t,n,l]of this._listeners)H.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new la(n,t));const h=n.boxZoom=new zn(n,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const g=n.cooperativeGestures=new Et(n,t.cooperativeGestures);this._add("cooperativeGestures",g),t.cooperativeGestures&&g.enable();const _=new Mc(n),j=new zu(n);n.doubleClickZoom=new io(j,_),this._add("tapZoom",_),this._add("clickZoom",j),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const E=new Au;this._add("tapDragZoom",E);const M=n.touchPitch=new zc(n);this._add("touchPitch",M),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const D=()=>n.project(n.getCenter()),$=(function({enable:he,clickTolerance:ge,aroundCenter:we=!0,minPixelCenterThreshold:me=100,rotateDegreesPerPixelMoved:Ne=.8},Ue){const Re=new kn({checkCorrectEvent:Oe=>H.mouseButton(Oe)===0&&Oe.ctrlKey||H.mouseButton(Oe)===2&&!Oe.ctrlKey});return new so({clickTolerance:ge,move:(Oe,Be)=>{const ot=Ue();if(we&&Math.abs(ot.y-Oe.y)>me)return{bearingDelta:c.cx(new c.P(Oe.x,Be.y),Be,ot)};let ct=(Be.x-Oe.x)*Ne;return we&&Be.y<ot.y&&(ct=-ct),{bearingDelta:ct}},moveStateManager:Re,enable:he,assignEvents:no})})(t,D),B=(function({enable:he,clickTolerance:ge,pitchDegreesPerPixelMoved:we=-.5}){const me=new kn({checkCorrectEvent:Ne=>H.mouseButton(Ne)===0&&Ne.ctrlKey||H.mouseButton(Ne)===2});return new so({clickTolerance:ge,move:(Ne,Ue)=>({pitchDelta:(Ue.y-Ne.y)*we}),moveStateManager:me,enable:he,assignEvents:no})})(t),G=(function({enable:he,clickTolerance:ge,rollDegreesPerPixelMoved:we=.3},me){const Ne=new kn({checkCorrectEvent:Ue=>H.mouseButton(Ue)===2&&Ue.ctrlKey});return new so({clickTolerance:ge,move:(Ue,Re)=>{const Oe=me();let Be=(Re.x-Ue.x)*we;return Re.y<Oe.y&&(Be=-Be),{rollDelta:Be}},moveStateManager:Ne,enable:he,assignEvents:no})})(t,D);n.dragRotate=new Xn(t,$,B,G),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",B,["mouseRotate","mouseRoll"]),this._add("mouseRoll",G,["mousePitch"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const J=(function({enable:he,clickTolerance:ge}){const we=new kn({checkCorrectEvent:me=>H.mouseButton(me)===0&&!me.ctrlKey});return new so({clickTolerance:ge,move:(me,Ne)=>({around:Ne,panDelta:Ne.sub(me)}),activateOnStart:!0,moveStateManager:we,enable:he,assignEvents:no})})(t),le=new Pd(t,n);n.dragPan=new Du(l,J,le),this._add("mousePan",J),this._add("touchPan",le,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const ue=new Id,ce=new ao;n.touchZoomRotate=new Ha(l,ce,ue,E),this._add("touchRotate",ue,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new ca(n));const de=n.scrollZoom=new Wo(n,(()=>this._triggerRenderFrame()));this._add("scrollZoom",de,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const xe=n.keyboard=new Rr(n);this._add("keyboard",xe),t.interactive&&t.keyboard&&n.keyboard.enable()}_add(t,n,l){this._handlers.push({handlerName:t,handler:n,allowed:l}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Rt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,l){for(const h in t)if(h!==l&&(!n||n.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const l of t)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(t,n,l,h,g){if(!l)return;c.e(t,l);const _={handlerName:h,originalEvent:l.originalEvent||g};l.zoomDelta!==void 0&&(n.zoom=_),l.panDelta!==void 0&&(n.drag=_),l.rollDelta!==void 0&&(n.roll=_),l.pitchDelta!==void 0&&(n.pitch=_),l.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const t={},n={},l={};for(const[h,g,_]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),c.e(n,g),c.e(l,_);this._updateMapTransform(t,n,l),this._changes=[]}_updateMapTransform(t,n,l){const h=this._map,g=h._getTransformForUpdate(),_=h.terrain;if(!(Ac(t)||_&&this._terrainMovement))return this._fireEvents(n,l,!0);h._stop(!0);let{panDelta:j,zoomDelta:E,bearingDelta:M,pitchDelta:D,rollDelta:$,around:B,pinchAround:G}=t;G!==void 0&&(B=G),B=B||h.transform.centerPoint,_&&!g.isPointOnMapSurface(B)&&(B=g.centerPoint);const J={panDelta:j,zoomDelta:E,rollDelta:$,pitchDelta:D,bearingDelta:M,around:B};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(B)&&(B=g.centerPoint);const le=B.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(j?B.sub(j):B);this._handleMapControls({terrain:_,tr:g,deltasForHelper:J,preZoomAroundLoc:le,combinedEventsInProgress:n,panDelta:j}),h._applyUpdatedTransform(g),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,l,!0)}_handleMapControls({terrain:t,tr:n,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:g,panDelta:_}){const j=this._map.cameraHelper;if(j.handleMapControlsRollPitchBearingZoom(l,n),t)return j.useGlobeControls?(this._terrainMovement||!g.drag&&!g.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void j.handleMapControlsPan(l,n,h)):this._terrainMovement||!g.drag&&!g.zoom?void(g.drag&&this._terrainMovement&&_?n.setCenter(n.screenPointToLocation(n.centerPoint.sub(_))):j.handleMapControlsPan(l,n,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void j.handleMapControlsPan(l,n,h));j.handleMapControlsPan(l,n,h)}_fireEvents(t,n,l){const h=Rt(this._eventsInProgress),g=Rt(t),_={};for(const $ in t){const{originalEvent:B}=t[$];this._eventsInProgress[$]||(_[`${$}start`]=B),this._eventsInProgress[$]=t[$]}!h&&g&&this._fireEvent("movestart",g.originalEvent);for(const $ in _)this._fireEvent($,_[$]);g&&this._fireEvent("move",g.originalEvent);for(const $ in t){const{originalEvent:B}=t[$];this._fireEvent($,B)}const j={};let E;for(const $ in this._eventsInProgress){const{handlerName:B,originalEvent:G}=this._eventsInProgress[$];this._handlersById[B].isActive()||(delete this._eventsInProgress[$],E=n[B]||G,j[`${$}end`]=E)}for(const $ in j)this._fireEvent($,j[$]);const M=Rt(this._eventsInProgress),D=(h||g)&&!M;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const $=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&$.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform($)}if(l&&D){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!$||!$.essential&&ke.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:E})),B(this._map.getBearing())&&this._map.resetNorth()):(B($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new c.l(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Xo("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ws extends c.E{constructor(t,n,l){super(),this._renderFrameCallback=()=>{const h=Math.min((re()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=n,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,n){t.apply(this.transform),this.transform=t,this.cameraHelper=n}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,n){return this.jumpTo({elevation:t},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,n,l){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},n),l)}panTo(t,n,l){return this.easeTo(c.e({center:t},n),l)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,l){return this.easeTo(c.e({zoom:t},n),l)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,n){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new c.l("movestart",n)).fire(new c.l("move",n)).fire(new c.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,l){return this.easeTo(c.e({bearing:t},n),l)}resetNorth(t,n){return this.rotateTo(0,c.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}getRoll(){return this.transform.roll}setRoll(t,n){return this.jumpTo({roll:t},n),this}cameraForBounds(t,n){t=as.convert(t).adjustAntiMeridian();const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,n)}_cameraForBoxAndBearing(t,n,l,h){const g={top:0,bottom:0,right:0,left:0};if(typeof(h=c.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const M=h.padding;h.padding={top:M,bottom:M,right:M,left:M}}const _=c.e(g,h.padding);h.padding=_;const j=this.transform,E=new as(t,n);return this.cameraHelper.cameraForBoxAndBearing(h,_,E,l,j)}fitBounds(t,n,l){return this._fitInternal(this.cameraForBounds(t,n),n,l)}fitScreenCoordinates(t,n,l,h,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(t)),this.transform.screenPointToLocation(c.P.convert(n)),l,h),h,g)}_fitInternal(t,n,l){return t?(delete(n=c.e(t,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(t,n){this.stop();const l=this._getTransformForUpdate();let h=!1,g=!1,_=!1;const j=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const E=l.zoom!==j;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(h=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(g=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(_=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new c.l("movestart",n)).fire(new c.l("move",n)),E&&this.fire(new c.l("zoomstart",n)).fire(new c.l("zoom",n)).fire(new c.l("zoomend",n)),h&&this.fire(new c.l("rotatestart",n)).fire(new c.l("rotate",n)).fire(new c.l("rotateend",n)),g&&this.fire(new c.l("pitchstart",n)).fire(new c.l("pitch",n)).fire(new c.l("pitchend",n)),_&&this.fire(new c.l("rollstart",n)).fire(new c.l("roll",n)).fire(new c.l("rollend",n)),this.fire(new c.l("moveend",n))}calculateCameraOptionsFromTo(t,n,l,h=0){const g=c.a9.fromLngLat(t,n),_=c.a9.fromLngLat(l,h),j=_.x-g.x,E=_.y-g.y,M=_.z-g.z,D=Math.hypot(j,E,M);if(D===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(j,E),B=c.at(this.transform.cameraToCenterDistance/D/this.transform.tileSize),G=180*Math.atan2(j,-E)/Math.PI;let J=180*Math.acos($/D)/Math.PI;return J=M<0?90-J:90+J,{center:_.toLngLat(),elevation:h,zoom:B,pitch:J,bearing:G}}calculateCameraOptionsFromCameraLngLatAltRotation(t,n,l,h,g){const _=this.transform.calculateCenterFromCameraLngLatAlt(t,n,l,h);return{center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:l,pitch:h,roll:g}}easeTo(t,n){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.cy},t)).animate===!1||!t.essential&&ke.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),g=l.pitch,_=l.roll,j="bearing"in t?this._normalizeBearing(t.bearing,h):h,E="pitch"in t?+t.pitch:g,M="roll"in t?this._normalizeBearing(t.roll,_):_,D="padding"in t?t.padding:l.padding,$=c.P.convert(t.offset);let B,G;t.around&&(B=c.V.convert(t.around),G=l.locationToScreenPoint(B));const J={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},le=this.cameraHelper.handleEaseTo(l,{bearing:j,pitch:E,roll:M,padding:D,around:B,aroundPoint:G,offsetAsPoint:$,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==j,this._pitching=this._pitching||E!==g,this._rolling=this._rolling||M!==_,this._padding=!l.isPaddingEqual(D),this._zooming=this._zooming||le.isZooming,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,J),this.terrain&&this._prepareElevation(le.elevationCenter),this._ease((ue=>{le.easeFunc(ue),this.terrain&&!t.freezeElevation&&this._updateElevation(ue),this._applyUpdatedTransform(l),this._fireMoveEvents(n)}),(ue=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n,ue)}),t),this}_prepareEase(t,n,l={}){this._moving=!0,n||l.moving||this.fire(new c.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new c.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new c.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new c.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new c.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(n-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const n=t.getCameraLngLat(),l=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(n,t.zoom):0;if(l<h){const g=this.calculateCameraOptionsFromTo(n,h,t.center,t.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(t){const n=[];if(n.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&n.push((h=>this.transformCameraUpdate(h))),!n.length)return;const l=t.clone();for(const h of n){const g=l.clone(),{center:_,zoom:j,roll:E,pitch:M,bearing:D,elevation:$}=h(g);_&&g.setCenter(_),$!==void 0&&g.setElevation($),j!==void 0&&g.setZoom(j),E!==void 0&&g.setRoll(E),M!==void 0&&g.setPitch(M),D!==void 0&&g.setBearing(D),l.apply(g)}this.transform.apply(l)}_fireMoveEvents(t){this.fire(new c.l("move",t)),this._zooming&&this.fire(new c.l("zoom",t)),this._rotating&&this.fire(new c.l("rotate",t)),this._pitching&&this.fire(new c.l("pitch",t)),this._rolling&&this.fire(new c.l("roll",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,h=this._rotating,g=this._pitching,_=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new c.l("zoomend",t)),h&&this.fire(new c.l("rotateend",t)),g&&this.fire(new c.l("pitchend",t)),_&&this.fire(new c.l("rollend",t)),this.fire(new c.l("moveend",t))}flyTo(t,n){if(!t.essential&&ke.prefersReducedMotion){const Be=c.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Be,n)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cy},t);const l=this._getTransformForUpdate(),h=l.bearing,g=l.pitch,_=l.roll,j=l.padding,E="bearing"in t?this._normalizeBearing(t.bearing,h):h,M="pitch"in t?+t.pitch:g,D="roll"in t?this._normalizeBearing(t.roll,_):_,$="padding"in t?t.padding:l.padding,B=c.P.convert(t.offset);let G=l.centerPoint.add(B);const J=l.screenPointToLocation(G),le=this.cameraHelper.handleFlyTo(l,{bearing:E,pitch:M,roll:D,padding:$,locationAtOffset:J,offsetAsPoint:B,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ue=t.curve;const ce=Math.max(l.width,l.height),de=ce/le.scaleOfZoom,xe=le.pixelPathLength;typeof le.scaleOfMinZoom=="number"&&(ue=Math.sqrt(ce/le.scaleOfMinZoom/xe*2));const he=ue*ue;function ge(Be){const ot=(de*de-ce*ce+(Be?-1:1)*he*he*xe*xe)/(2*(Be?de:ce)*he*xe);return Math.log(Math.sqrt(ot*ot+1)-ot)}function we(Be){return(Math.exp(Be)-Math.exp(-Be))/2}function me(Be){return(Math.exp(Be)+Math.exp(-Be))/2}const Ne=ge(!1);let Ue=function(Be){return me(Ne)/me(Ne+ue*Be)},Re=function(Be){return ce*((me(Ne)*(we(ot=Ne+ue*Be)/me(ot))-we(Ne))/he)/xe;var ot},Oe=(ge(!0)-Ne)/ue;if(Math.abs(xe)<2e-6||!isFinite(Oe)){if(Math.abs(ce-de)<1e-6)return this.easeTo(t,n);const Be=de<ce?-1:1;Oe=Math.abs(Math.log(de/ce))/ue,Re=()=>0,Ue=ot=>Math.exp(Be*ue*ot)}return t.duration="duration"in t?+t.duration:1e3*Oe/("screenSpeed"in t?+t.screenSpeed/ue:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==E,this._pitching=M!==g,this._rolling=D!==_,this._padding=!l.isPaddingEqual($),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(le.targetCenter),this._ease((Be=>{const ot=Be*Oe,ct=1/Ue(ot),et=Re(ot);this._rotating&&l.setBearing(c.G.number(h,E,Be)),this._pitching&&l.setPitch(c.G.number(g,M,Be)),this._rolling&&l.setRoll(c.G.number(_,D,Be)),this._padding&&(l.interpolatePadding(j,$,Be),G=l.centerPoint.add(B)),le.easeFunc(Be,ct,et,G),this.terrain&&!t.freezeElevation&&this._updateElevation(Be),this._applyUpdatedTransform(l),this._fireMoveEvents(n)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,n)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,n,l){l.animate===!1||l.duration===0?(t(1),n()):(this._easeStart=re(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=c.W(t,-180,180);const l=Math.abs(t-n);return Math.abs(t-360-n)<l&&(t-=360),Math.abs(t+360-n)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(t),this.transform):null}}const An={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ru{constructor(t=An){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=H.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=H.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const l=this._map._getUIString(`AttributionControl.${n}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const n=this._map.style.tileManagers;for(const h in n){const g=n[h];if(g.used||g.usedForTerrain){const _=g.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t=t.filter((h=>String(h).trim())),t.sort(((h,g)=>h.length-g.length)),t=t.filter(((h,g)=>{for(let _=g+1;_<t.length;_++)if(t[_].indexOf(h)>=0)return!1;return!0}));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=H.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Wa{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=H.create("div","maplibregl-ctrl");const n=H.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){H.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class oo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Lu=c.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Fl extends c.E{constructor(t){super(),this._lastTilesetChange=re(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,n){this.tileManager.update(t,n),this._renderableTilesKeys=[];const l={};for(const h of Zr(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),c.c7(h.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[h.key]=new rt(h,this.tileSize),this._lastTilesetChange=re());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const n in this._tiles){const l=this._tiles[n];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,n){return n?this._getTerrainCoordsForTileRanges(t,n):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const n={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,g=t.clone(),_=c.bk();if(h.canonical.equals(t.canonical))c.c7(_,0,c.a5,c.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const j=h.canonical.z-t.canonical.z,E=h.canonical.x-(h.canonical.x>>j<<j),M=h.canonical.y-(h.canonical.y>>j<<j),D=c.a5>>j;c.c7(_,0,D,D,0,0,1),c.O(_,_,[-E*D,-M*D,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const j=t.canonical.z-h.canonical.z,E=t.canonical.x-(t.canonical.x>>j<<j),M=t.canonical.y-(t.canonical.y>>j<<j),D=c.a5>>j;c.c7(_,0,c.a5,c.a5,0,0,1),c.O(_,_,[E*D,M*D,0]),c.Q(_,_,[1/2**j,1/2**j,0])}}g.terrainRttPosMatrix32f=new Float32Array(_),n[l]=g}return n}_getTerrainCoordsForTileRanges(t,n){const l={};for(const h of this._renderableTilesKeys){const g=this._tiles[h].tileID;if(!this._isWithinTileRanges(g,n))continue;const _=t.clone(),j=c.bk();if(g.canonical.z===t.canonical.z){const E=t.canonical.x-g.canonical.x,M=t.canonical.y-g.canonical.y;c.c7(j,0,c.a5,c.a5,0,0,1),c.O(j,j,[E*c.a5,M*c.a5,0])}else if(g.canonical.z>t.canonical.z){const E=g.canonical.z-t.canonical.z,M=g.canonical.x-(g.canonical.x>>E<<E),D=g.canonical.y-(g.canonical.y>>E<<E),$=t.canonical.x-(g.canonical.x>>E),B=t.canonical.y-(g.canonical.y>>E),G=c.a5>>E;c.c7(j,0,G,G,0,0,1),c.O(j,j,[-M*G+$*c.a5,-D*G+B*c.a5,0])}else{const E=t.canonical.z-g.canonical.z,M=t.canonical.x-(t.canonical.x>>E<<E),D=t.canonical.y-(t.canonical.y>>E<<E),$=(t.canonical.x>>E)-g.canonical.x,B=(t.canonical.y>>E)-g.canonical.y,G=c.a5<<E;c.c7(j,0,G,G,0,0,1),c.O(j,j,[M*c.a5+$*G,D*c.a5+B*G,0])}_.terrainRttPosMatrix32f=new Float32Array(j),l[h]=_}return l}getSourceTile(t,n){const l=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let g=this.findTileInCaches(this._sourceTileCache[t.key]);if(!g?.dem&&n)for(;h>=l.minzoom&&!g?.dem;)g=this.findTileInCaches(t.scaledTo(h--).key);return g}findTileInCaches(t){let n=this.tileManager.getTileByID(t);return n||(n=this.tileManager._outOfViewCache.getByKey(t),n)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,n){return n[t.canonical.z]&&t.canonical.x>=n[t.canonical.z].minTileX&&t.canonical.x<=n[t.canonical.z].maxTileX&&t.canonical.y>=n[t.canonical.z].minTileY&&t.canonical.y<=n[t.canonical.z].maxTileY}}class Wr{constructor(t,n,l){this._meshCache={},this.painter=t,this.tileManager=new Fl(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,l,h=c.a5){var g;if(!(n>=0&&n<h&&l>=0&&l<h))return 0;const _=this.getTerrainData(t),j=(g=_.tile)===null||g===void 0?void 0:g.dem;if(!j)return 0;const E=c.cC([],[n/h*c.a5,l/h*c.a5],_.u_terrain_matrix),M=[E[0]*j.dim,E[1]*j.dim],D=Math.floor(M[0]),$=Math.floor(M[1]),B=M[0]-D,G=M[1]-$;return j.get(D,$)*(1-B)*(1-G)+j.get(D+1,$)*B*(1-G)+j.get(D,$+1)*(1-B)*G+j.get(D+1,$+1)*B*G}getElevationForLngLatZoom(t,n){if(!c.cD(n,t.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(l,h%c.a5,g%c.a5,c.a5)}getElevationForLngLat(t,n){const l=Zr(n,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let h=0;for(const g of l)g.canonical.z>h&&(h=Math.min(g.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,h)}getElevation(t,n,l,h=c.a5){return this.getDEMElevation(t,n,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,g=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(h,g,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(h,new c.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ar([])}const n=this.tileManager.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const h=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new c.T(h,n.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),n.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n.toString()+n.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let g=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?g=t.canonical.z-h:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=t.canonical.x-(t.canonical.x>>g<<g),j=t.canonical.y-(t.canonical.y>>g<<g),E=c.cE(new Float64Array(16),[1/(c.a5<<g),1/(c.a5<<g),0]);c.O(E,E,[_*c.a5,j*c.a5,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,l=n.width/devicePixelRatio,h=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,_=0;g<this._coordsTextureSize;g++)for(let j=0;j<this._coordsTextureSize;j++,_+=4)n[_+0]=255&j,n[_+1]=255&g,n[_+2]=j>>8<<4|g>>8,n[_+3]=0;const l=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),h=new c.T(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),l=this.painter.context,h=l.gl,g=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),_=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),j=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(g,j-_-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const E=n[0]+(n[2]>>4<<8),M=n[1]+((15&n[2])<<8),D=this.coordsIndex[255-n[3]],$=D&&this.tileManager.getTileByID(D);if(!$)return null;const B=this._coordsTextureSize,G=(1<<$.tileID.canonical.z)*B;return new c.a9(($.tileID.canonical.x*B+E)/G+$.tileID.wrap,($.tileID.canonical.y*B+M)/G,this.getElevation($.tileID,E,M,B))}depthAtPoint(t){const n=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(t){var n;const l=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,h=l&&t.canonical.y===0,g=l&&t.canonical.y===(1<<t.canonical.z)-1,_=`m_${h?"n":""}_${g?"s":""}`;if(this._meshCache[_])return this._meshCache[_];const j=this.painter.context,E=new c.cF,M=new c.aY,D=this.meshSize,$=c.a5/D,B=D*D;for(let me=0;me<=D;me++)for(let Ne=0;Ne<=D;Ne++)E.emplaceBack(Ne*$,me*$,0);for(let me=0;me<B;me+=D+1)for(let Ne=0;Ne<D;Ne++)M.emplaceBack(Ne+me,D+Ne+me+1,D+Ne+me+2),M.emplaceBack(Ne+me,D+Ne+me+2,Ne+me+1);const G=E.length,J=G+(D+1),le=(D+1)*D,ue=h?c.br:0,ce=h?0:1,de=g?c.bs:c.a5,xe=g?0:1;for(let me=0;me<=D;me++)E.emplaceBack(me*$,ue,ce);for(let me=0;me<=D;me++)E.emplaceBack(me*$,de,xe);for(let me=0;me<D;me++)M.emplaceBack(le+me,J+me,J+me+1),M.emplaceBack(le+me,J+me+1,le+me+1),M.emplaceBack(0+me,G+me+1,G+me),M.emplaceBack(0+me,0+me+1,G+me+1);const he=E.length,ge=he+2*(D+1);for(const me of[0,1])for(let Ne=0;Ne<=D;Ne++)for(const Ue of[0,1])E.emplaceBack(me*c.a5,Ne*$,Ue);for(let me=0;me<2*D;me+=2)M.emplaceBack(he+me,he+me+1,he+me+3),M.emplaceBack(he+me,he+me+3,he+me+2),M.emplaceBack(ge+me,ge+me+3,ge+me+1),M.emplaceBack(ge+me,ge+me+2,ge+me+3);const we=new Br(j.createVertexBuffer(E,Lu.members),j.createIndexBuffer(M),c.aX.simpleSegment(0,0,E.length,M.length));return this._meshCache[_]=we,we}getMeshFrameDelta(t){return 2*Math.PI*c.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,n){var l;if(!c.cD(n,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,n){const l=c.a9.fromLngLat(t.wrap()),h=(1<<n)*c.a5,g=l.x*h,_=l.y*h,j=Math.floor(g/c.a5),E=Math.floor(_/c.a5);return{tileID:new c.a2(n,0,n,j,E),mercatorX:g,mercatorY:_}}}class _s{constructor(t,n,l){this._context=t,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:t,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((n=>t.id!==n)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Ia={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Dn{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new _s(t.context,30,n.tileManager.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((l=>!t._layers[l].isHidden(n))),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const h=t.tileManagers[l].getVisibleCoordinates(),g=t.tileManagers[l].getSource(),_=g instanceof _n?g.terrainTileRanges:null;for(const j of h){const E=this.terrain.tileManager.getTerrainCoords(j,_);for(const M in E)this._coordsAscending[l][M]||(this._coordsAscending[l][M]=[]),this._coordsAscending[l][M].push(E[M])}}this._coordsAscendingStr={};for(const l of t._order){const h=t._layers[l],g=h.source;if(Ia[h.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const _ in this._coordsAscending[g])this._coordsAscendingStr[g][_]=this._coordsAscending[g][_].map((j=>j.key)).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const g=this._coordsAscendingStr[h][l.tileID.key];g&&g!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t,n){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),h=t.type,g=this.painter,_=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Ia[h]&&(this._prevType&&Ia[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!_))return!0;if(Ia[this._prevType]||Ia[h]&&_){this._prevType=h;const j=this._stacks.length-1,E=this._stacks[j]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(to(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[j]){const $=this.pool.getObjectForId(M.rtt[j].id);if($.stamp===M.rtt[j].stamp){this.pool.useObject($);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),M.rtt[j]={id:D.id,stamp:D.stamp},g.context.bindFramebuffer.set(D.fbo.framebuffer),g.context.clear({color:c.bp.transparent,stencil:0}),g.currentStencilSource=void 0;for(let $=0;$<E.length;$++){const B=g.style._layers[E[$]],G=B.source?this._coordsAscending[B.source][M.tileID.key]:[M.tileID];g.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),g._renderTileClippingMasks(B,G,!0),g.renderLayer(g,g.style.tileManagers[B.source],B,G,l),B.source&&(M.rttCoords[B.source]=this._coordsAscendingStr[B.source][M.tileID.key])}}return to(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),Ia[h]}return!1}}const lo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Yo=V,Xa={hash:!1,interactive:!0,bearingSnap:7,attributionControl:An,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Dc={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ya{constructor(t,n,l=!1){this.mousedown=g=>{this.startMove(g,H.mousePos(this.element,g)),H.addEventListener(window,"mousemove",this.mousemove),H.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,H.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),H.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const h=new Cd;this._rotatePitchHandler=new so({clickTolerance:3,move:(g,_)=>{const j=n.getBoundingClientRect(),E=new c.P((j.bottom-j.top)/2,(j.right-j.left)/2);return{bearingDelta:c.cx(new c.P(g.x,_.y),_,E),pitchDelta:l?-.5*(_.y-g.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,H.addEventListener(n,"mousedown",this.mousedown),H.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(n,"touchcancel",this.reset)}startMove(t,n){this._rotatePitchHandler.dragStart(t,n),H.disableDrag()}move(t,n){const l=this.map,{bearingDelta:h,pitchDelta:g}=this._rotatePitchHandler.dragMove(t,n)||{};h&&l.setBearing(l.getBearing()+h),g&&l.setPitch(l.getPitch()+g)}off(){const t=this.element;H.removeEventListener(t,"mousedown",this.mousedown),H.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend),H.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){H.enableDrag(),H.removeEventListener(window,"mousemove",this.mousemove),H.removeEventListener(window,"mouseup",this.mouseup),H.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),H.removeEventListener(window,"touchend",this.touchend)}}let Ka;function Ol(m,t,n,l=!1){if(l||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new c.V(m.lng,m.lat);if(m=new c.V(m.lng,m.lat),t){const g=new c.V(m.lng-360,m.lat),_=new c.V(m.lng+360,m.lat),j=n.locationToScreenPoint(m).distSqr(t);n.locationToScreenPoint(g).distSqr(t)<j?m=g:n.locationToScreenPoint(_).distSqr(t)<j&&(m=_)}for(;Math.abs(m.lng-n.center.lng)>180;){const g=n.locationToScreenPoint(m);if(g.x>=0&&g.y>=0&&g.x<=n.width&&g.y<=n.height)break;m.lng>n.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(m))?m:h}const Xr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ko(m,t,n){const l=m.classList;for(const h in Xr)l.remove(`maplibregl-${n}-anchor-${h}`);l.add(`maplibregl-${n}-anchor-${t}`)}class Jo extends c.E{constructor(t){if(super(),this._onKeyPress=n=>{const l=n.code,h=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Ol(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,`${Xr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${h}`),ke.frameAsync(new AbortController).then((()=>{this._updateOpacity(n&&n.type==="moveend")})).catch((()=>{}))},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div");const n=H.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${h}px`),n.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const g=H.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const _=H.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const j=H.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(3.0, 29.0)"),j.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ce of E){const de=H.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",ce.rx),de.setAttributeNS(null,"ry",ce.ry),j.appendChild(de)}const M=H.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const D=H.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(D);const $=H.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const B=H.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(B);const G=H.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const J=H.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=H.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const ue=H.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#FFFFFF"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962"),J.appendChild(le),J.appendChild(ue),_.appendChild(j),_.appendChild(M),_.appendChild($),_.appendChild(G),_.appendChild(J),n.appendChild(_),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(n=>{n.preventDefault()})),this._element.addEventListener("mousedown",(n=>{n.preventDefault()})),Ko(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var n,l;const h=(n=this._map)===null||n===void 0?void 0:n.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!h||g){const G=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==G&&(this._element.style.opacity=G))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const _=this._map,j=_.terrain.depthAtPoint(this._pos),E=_.terrain.getElevationForLngLat(this._lngLat,_.transform);if(_.transform.lngLatToCameraDepth(this._lngLat,E)-j<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/_.transform.pixelsPerMeter,D=Math.sin(_.getPitch()*Math.PI/180)*M,$=_.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),B=_.transform.lngLatToCameraDepth(this._lngLat,E+D)-$>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&B&&this._popup.remove(),this._element.style.opacity=B?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return(this._opacity===void 0||t===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Rc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ji=0,Si=!1;const Ti={maxWidth:100,unit:"metric"};function Yr(m,t,n){const l=n&&n.maxWidth||100,h=m._container.clientHeight/2,g=m._container.clientWidth/2,_=m.unproject([g-l/2,h]),j=m.unproject([g+l/2,h]),E=Math.round(m.project(j).x-m.project(_).x),M=Math.min(l,E,m._container.clientWidth),D=_.distanceTo(j);if(n&&n.unit==="imperial"){const $=3.2808*D;$>5280?cs(t,M,$/5280,m._getUIString("ScaleControl.Miles")):cs(t,M,$,m._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?cs(t,M,D/1852,m._getUIString("ScaleControl.NauticalMiles")):D>=1e3?cs(t,M,D/1e3,m._getUIString("ScaleControl.Kilometers")):cs(t,M,D,m._getUIString("ScaleControl.Meters"))}function cs(m,t,n,l){const h=(function(g){const _=Math.pow(10,`${Math.floor(g)}`.length-1);let j=g/_;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:j>=1?1:(function(E){const M=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*M)/M})(j),_*j})(n);m.style.width=t*(h/n)+"px",m.innerHTML=`${h}&nbsp;${l}`}const zs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Qo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function co(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,m),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-m),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(m,0),right:new c.P(-m,0)}}if(m instanceof c.P||Array.isArray(m)){const t=c.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(m.center||[0,0]),top:c.P.convert(m.top||[0,0]),"top-left":c.P.convert(m["top-left"]||[0,0]),"top-right":c.P.convert(m["top-right"]||[0,0]),bottom:c.P.convert(m.bottom||[0,0]),"bottom-left":c.P.convert(m["bottom-left"]||[0,0]),"bottom-right":c.P.convert(m["bottom-right"]||[0,0]),left:c.P.convert(m.left||[0,0]),right:c.P.convert(m.right||[0,0])}}return co(new c.P(0,0))}const el=V;T.AJAXError=c.cI,T.Event=c.l,T.Evented=c.E,T.LngLat=c.V,T.MercatorCoordinate=c.a9,T.Point=c.P,T.addProtocol=c.cJ,T.config=c.c,T.removeProtocol=c.cK,T.AttributionControl=Ru,T.BoxZoomHandler=zn,T.CanvasSource=Y,T.CooperativeGesturesHandler=Et,T.DoubleClickZoomHandler=io,T.DragPanHandler=Du,T.DragRotateHandler=Xn,T.EdgeInsets=So,T.FullscreenControl=class extends c.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=n?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){H.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=H.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);H.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=bo,T.GeolocateControl=class extends c.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new c.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),g=c.e({bearing:h},this.options.fitBoundsOptions),_=as.fromLngLat(n,l);this._map.fitBounds(_,g,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new c.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Si)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=H.create("button","maplibregl-ctrl-geolocate",this._container),H.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Jo({element:this._dotElement}),this._circleElement=H.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{const l=n?.[0]instanceof ResizeObserverEntry;n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},Rc,m)}onAdd(m){return this._map=m,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(t=!1){if(Ka!==void 0&&!t)return Ka;if(window.navigator.permissions===void 0)return Ka=!!window.navigator.geolocation,Ka;try{Ka=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ka=!!window.navigator.geolocation}return Ka}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,ji=0,Si=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),n=m.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),n=this._map.unproject([t.x+100,t.y]),l=m.distanceTo(n)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ji--,Si=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ji++,ji>1?(m={maximumAge:6e5,timeout:0},Si=!0):(m=this.options.positionOptions,Si=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=H.create("button","maplibregl-ctrl-globe",this._container),H.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){H.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},T.Hash=Cu,T.ImageSource=_n,T.KeyboardHandler=Rr,T.LngLatBounds=as,T.LogoControl=Wa,T.Map=class extends ws{constructor(m){var t,n;c.cG.mark(c.cH.create);const l=Object.assign(Object.assign(Object.assign({},Xa),m),{canvasContextAttributes:Object.assign(Object.assign({},Xa.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new No,g=new Gi;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrainOverride(l.transformConstrain),super(h,g,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new oo,this._controls=[],this._mapId=c.af(),this._lostContextStyle={style:null,images:null},this._contextLost=j=>{j.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const E of Object.values(this.style._layers))if(E.type==="custom"&&console.warn(`Custom layer with id '${E.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),E._listeners)for(const[M]of Object.entries(E._listeners))console.warn(`Custom layer with id '${E.id}' had event listeners for event '${M}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:j}))},this._contextRestored=j=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:j}))},this._onMapScroll=j=>{if(j.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},lo),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(ke.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=Ft.addThrottleControl((()=>this.isMoving())),this._requestManager=new Vt(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let j=!1;const E=Eu((M=>{this._trackResize&&!this._removed&&(this.resize(M),this.redraw())}),50);this._resizeObserver=new ResizeObserver((M=>{j?E(M):j=!0})),this._resizeObserver.observe(this._container)}this.handlers=new da(this,l),this._hash=l.hash&&new Cu(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,c.e({},l.fitBoundsOptions,{duration:0}))));const _=typeof l.style=="string"||((n=(t=l.style)===null||t===void 0?void 0:t.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,_),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Ru(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Wa,l.logoPosition),this.on("style.load",(()=>{if(_||this._resizeTransform(),this.transform.unmodified){const j=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(j)}})),this.on("data",(j=>{this._update(j.dataType==="style"),this.fire(new c.l(`${j.dataType}data`,j))})),this.on("dataloading",(j=>{this.fire(new c.l(`${j.dataType}dataloading`,j))})),this.on("dataabort",(j=>{this.fire(new c.l("sourcedataabort",j))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return Zr(this.transform,m)}calculateCameraOptionsFromTo(m,t,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(n,this.transform)),super.calculateCameraOptionsFromTo(m,t,n,l)}resize(m,t=!0){const[n,l]=this._containerDimensions(),h=this._getClampedPixelRatio(n,l);if(this._resizeCanvas(n,l,h),this.painter.resize(n,l,h),this.painter.overLimit()){const _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];const j=this._getClampedPixelRatio(n,l);this._resizeCanvas(n,l,j),this.painter.resize(n,l,j)}this._resizeTransform(t);const g=!this._moving;return g&&(this.stop(),this.fire(new c.l("movestart",m)).fire(new c.l("move",m))),this.fire(new c.l("resize",m)),g&&this.fire(new c.l("moveend",m)),this}_resizeTransform(m=!0){var t;const[n,l]=this._containerDimensions();this.transform.resize(n,l,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(n,l,m)}_getClampedPixelRatio(m,t){const{0:n,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),g=m*h,_=t*h;return Math.min(g>n?n/g:1,_>l?l/_:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(as.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(m),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(m),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(c.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(c.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,n){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:t,listener:n,delegates:{mousemove:g=>{const _=t.filter((E=>this.getLayer(E))),j=_.length!==0?this.queryRenderedFeatures(g.point,{layers:_}):[];j.length?l||(l=!0,n.call(this,new ys(m,this,g.originalEvent,{features:j}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:t,listener:n,delegates:{mousemove:_=>{const j=t.filter((E=>this.getLayer(E)));(j.length!==0?this.queryRenderedFeatures(_.point,{layers:j}):[]).length?l=!0:l&&(l=!1,n.call(this,new ys(m,this,_.originalEvent)))},mouseout:_=>{l&&(l=!1,n.call(this,new ys(m,this,_.originalEvent)))}}}}{const l=h=>{const g=t.filter((j=>this.getLayer(j))),_=g.length!==0?this.queryRenderedFeatures(h.point,{layers:g}):[];_.length&&(h.features=_,n.call(this,h),delete h.features)};return{layers:t,listener:n,delegates:{[m]:l}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,n){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let h=0;h<l.length;h++){const g=l[h];if(g.listener===n&&g.layers.length===t.length&&g.layers.every((_=>t.includes(_)))){for(const _ in g.delegates)this.off(_,g.delegates[_]);return void l.splice(h,1)}}}on(m,t,n){if(n===void 0)return super.on(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,n);this._saveDelegatedListener(m,h);for(const g in h.delegates)this.on(g,h.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,n)}}}once(m,t,n){if(n===void 0)return super.once(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,n);for(const g in h.delegates){const _=h.delegates[g];h.delegates[g]=(...j)=>{this._removeDelegatedListener(m,l,n),_(...j)}}this._saveDelegatedListener(m,h);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(m,t,n){return n===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,n),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let n;const l=m instanceof c.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},h instanceof c.P||typeof h[0]=="number")n=[c.P.convert(h)];else{const g=c.P.convert(h[0]),_=c.P.convert(h[1]);n=[g,new c.P(_.x,g.y),_,new c.P(g.x,_.y),g]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var n,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,t)));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Io(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,h):this.style.loadJSON(m,t,h),this):((l=(n=this.style)===null||n===void 0?void 0:n.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Io(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const n=this._requestManager.transformRequest(m,"Style");c.j(n,new AbortController).then((l=>{this._updateDiff(l.data,t)})).catch((l=>{l&&this.fire(new c.k(l))}))}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===m.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Wr(this.painter,t,m),this.painter.renderToTexture=new Dn(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var l;n.dataType==="style"?this.terrain.tileManager.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=n.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,n){if(n){const l=this.getSource(n);if(!l)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);l.calculateTileZoom=Mr(Math.max(1,m),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=Mr(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const n=this.style.tileManagers[m];if(!n)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?n.reload(!0):n.refreshTiles(t.map((l=>new c.ac(l.z,l.x,l.y))))}addImage(m,t,n={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:g,stretchY:_,content:j,textFitWidth:E,textFitHeight:M}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:$,data:B}=t,G=t;return this.style.addImage(m,{data:new c.R({width:D,height:$},new Uint8Array(B)),pixelRatio:l,stretchX:g,stretchY:_,content:j,textFitWidth:E,textFitHeight:M,sdf:h,version:0,userImage:G}),G.onAdd&&G.onAdd(this,m),this}}{const{width:D,height:$,data:B}=ke.getImageData(t);this.style.addImage(m,{data:new c.R({width:D,height:$},B),pixelRatio:l,stretchX:g,stretchY:_,content:j,textFitWidth:E,textFitHeight:M,sdf:h,version:0})}}updateImage(m,t){const n=this.style.getImage(m);if(!n)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||c.b(t)?ke.getImageData(t):t,{width:h,height:g,data:_}=l;if(h===void 0||g===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==n.data.width||g!==n.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const j=!(t instanceof HTMLImageElement||c.b(t));return n.data.replace(_,j),this.style.updateImage(m,n),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Ft.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,n){return this.style.setLayerZoomRange(m,t,n),this._update(!0)}setFilter(m,t,n={}){return this.style.setFilter(m,t,n),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,n,l={}){return this.style.setPaintProperty(m,t,n,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,n,l={}){return this.style.setLayoutProperty(m,t,n,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,n,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,(n=>{n||this._update(!0)})),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=H.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=H.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const h=this._controlContainer=H.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((_=>{g[_]=H.create("div",`maplibregl-ctrl-${_} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,n){this._canvas.width=Math.floor(n*m),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)}),{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!n){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Ec(n,this.transform),Ze.testSupport(n)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,n,l,h,g;const _=this._idleTriggered?this._fadeDuration:0,j=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const $=this.transform.zoom,B=re();this.style.zoomHistory.update($,B);const G=new c.H($,{now:B,fadeDuration:_,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),J=G.crossFadingFactor();J===1&&J===this._crossFadingFactor||(E=!0,this._crossFadingFactor=J),this.style.update(G)}const M=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==j;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||M)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,M),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cG.mark(c.cH.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const D=this._sourcesDirty||this._styleDirty||this._placementDirty;return D||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,c.cG.mark(c.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ft.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),H.remove(this._canvasContainer),H.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cG.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ke.frame(this._frameRequest,(m=>{c.cG.frame(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!c.Z(t)&&!(function(n){return n.message===Yi})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Yo}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},T.MapMouseEvent=ys,T.MapTouchEvent=ro,T.MapWheelEvent=Cc,T.Marker=Jo,T.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);t.title=l,t.setAttribute("aria-label",l)},this.options=c.e({},Dc,m),this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),H.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),H.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=H.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ya(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const n=H.create("button",m,this._container);return n.type="button",n.addEventListener("click",t),n}},T.Popup=class extends c.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=H.create("div","maplibregl-popup",this._map.getContainer()),this._tip=H.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ol(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const n=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=co(this.options.offset);if(!l){const _=this._container.offsetWidth,j=this._container.offsetHeight;let E;E=n.y+h.bottom.y<j?["top"]:n.y>this._map.transform.height-j?["bottom"]:[],n.x<_/2?E.push("left"):n.x>this._map.transform.width-_/2&&E.push("right"),l=E.length===0?"bottom":E.join("-")}let g=n.add(h[l]);this.options.subpixelPositioning||(g=g.round()),H.setTransform(this._container,`${Xr[l]} translate(${g.x}px,${g.y}px)`),Ko(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(zs),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=c.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=m;l=n.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=H.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Qo);m&&m.focus()}},T.RasterDEMTileSource=Zn,T.RasterTileSource=Oa,T.ScaleControl=class{constructor(m){this._onMove=()=>{Yr(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Yr(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ti),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=Wo,T.Style=Io,T.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=H.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=H.create("button","maplibregl-ctrl-terrain",this._container),H.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){H.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=zc,T.TwoFingersTouchRotateHandler=Id,T.TwoFingersTouchZoomHandler=ao,T.TwoFingersTouchZoomRotateHandler=Ha,T.VectorTileSource=mi,T.VideoSource=Ae,T.addSourceType=(m,t)=>c._(void 0,void 0,void 0,(function*(){if(ie(m))throw new Error(`A source type called "${m}" already exists.`);((n,l)=>{X[n]=l})(m,t)})),T.clearPrewarmedResources=function(){const m=At;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Yt),At=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.createTileMesh=wl,T.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return Ie().getRTLTextPluginStatus()},T.getVersion=function(){return el},T.getWorkerCount=function(){return wt.workerCount},T.getWorkerUrl=function(){return c.c.WORKER_URL},T.importScriptInWorkers=function(m){return _a().broadcast("IS",m)},T.isTimeFrozen=function(){return je.isFrozen()},T.now=re,T.prewarm=function(){Sr().acquire(Yt)},T.restoreNow=function(){je.restoreNow()},T.setMaxParallelImageRequests=function(m){c.c.MAX_PARALLEL_IMAGE_REQUESTS=m},T.setNow=function(m){je.setNow(m)},T.setRTLTextPlugin=function(m,t){return Ie().setRTLTextPlugin(m,t)},T.setWorkerCount=function(m){wt.workerCount=m},T.setWorkerUrl=function(m){c.c.WORKER_URL=m}}));var R=w;return R}))})(nm)),nm.exports}var Zj=Gj();const Hc=Rb(Zj);function Hj(){const b=dr(),k=K.useRef(null),w=K.useRef(null),P=K.useRef(null),[I,R]=K.useState(!1),[T,c]=K.useState({latitude:"",longitude:"",is_resident:!1}),[V,W]=K.useState("");K.useEffect(()=>{w.current||k.current&&(w.current=new Hc.Map({container:k.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap"}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:[36.236,33.456],zoom:13}),w.current.on("click",re=>{const{lng:H,lat:Ze}=re.lngLat;se(Ze,H)}),setTimeout(()=>w.current?.resize(),500),setTimeout(()=>w.current?.resize(),2e3),w.current.on("load",()=>{w.current?.resize()}))},[]);const se=(re,H)=>{c(Ze=>({...Ze,latitude:re.toString(),longitude:H.toString()})),W(""),w.current&&(P.current?P.current.setLngLat([H,re]):P.current=new Hc.Marker({color:"#10b981"}).setLngLat([H,re]).addTo(w.current),w.current.flyTo({center:[H,re],zoom:15}))},ee=async()=>{try{const re=await nd.getCurrentPosition(),{latitude:H,longitude:Ze}=re.coords;se(H,Ze)}catch{alert("  .     GPS.")}},ne=async()=>{if(!T.latitude||!T.longitude){W("      .");return}R(!0);try{await Lt.post("/user/location",{latitude:T.latitude,longitude:T.longitude,is_resident:T.is_resident});const re=localStorage.getItem("user");if(re){const H=JSON.parse(re);H.latitude=T.latitude,H.longitude=T.longitude,H.is_resident=T.is_resident,H.location_verified_at=new Date().toISOString(),localStorage.setItem("user",JSON.stringify(H))}b("/")}catch(re){console.error(re);const H=re.response?.data?.message||re.message||"Unknown Error";W(` : ${H} (${re.response?.status||"No Status"})`)}finally{R(!1)}},ke=async()=>{R(!0);try{await Lt.post("/user/location",{latitude:null,longitude:null,is_resident:!1}),je()}catch(re){if(console.error(re),re.response?.status===401){localStorage.removeItem("token"),localStorage.removeItem("user"),b("/login");return}console.warn("Skip API failed, proceeding anyway locally"),je()}finally{R(!1)}},je=()=>{const re=localStorage.getItem("user");if(re){const H=JSON.parse(re);H.location_verified_at=new Date().toISOString(),localStorage.setItem("user",JSON.stringify(H))}b("/")};return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex flex-col p-6 transition-colors duration-300",dir:"rtl",children:i.jsxs("div",{className:"w-full max-w-md mx-auto flex-1 flex flex-col",children:[i.jsxs("div",{className:"text-center mb-6 mt-4",children:[i.jsx("div",{className:"w-16 h-16 bg-emerald-100 dark:bg-emerald-900/30 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-600 dark:text-emerald-400",children:i.jsx(qn,{size:32})}),i.jsx("h1",{className:"text-2xl font-black text-slate-800 dark:text-slate-100 mb-2",children:"   ()"}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm leading-relaxed",children:"           .            ."})]}),i.jsxs("div",{className:"w-full h-80 relative rounded-3xl overflow-hidden border-2 border-slate-200 dark:border-slate-700 shadow-inner group mb-6",children:[i.jsx("div",{ref:k,className:"w-full h-full bg-slate-100 dark:bg-slate-800 relative z-0",dir:"ltr"}),i.jsx("button",{type:"button",onClick:ee,className:"absolute bottom-4 right-4 bg-white dark:bg-slate-800 p-3 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 text-blue-600 dark:text-blue-400 active:scale-95 transition-transform",children:i.jsx(Wy,{size:24})}),!T.latitude&&i.jsx("div",{className:"absolute inset-0 bg-black/20 backdrop-blur-sm flex items-center justify-center pointer-events-none",children:i.jsxs("div",{className:"bg-white/95 dark:bg-slate-900/95 px-4 py-3 rounded-2xl text-sm font-bold shadow-lg flex items-center gap-2 animate-bounce",children:[i.jsx(qn,{size:18,className:"text-emerald-500"}),i.jsx("span",{className:"text-slate-800 dark:text-slate-200",children:"    "})]})})]}),V&&i.jsx("p",{className:"text-red-500 text-sm font-bold text-center mb-4 bg-red-50 p-3 rounded-xl border border-red-100",children:V}),i.jsxs("div",{className:"mb-6 flex items-start gap-3 bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm",children:[i.jsx("div",{className:"pt-0.5",children:i.jsx("input",{type:"checkbox",id:"is_resident",checked:T.is_resident,onChange:re=>c(H=>({...H,is_resident:re.target.checked})),className:"w-5 h-5 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500"})}),i.jsxs("label",{htmlFor:"is_resident",className:"flex-1 cursor-pointer",children:[i.jsx("span",{className:"block text-sm font-bold text-slate-800 dark:text-slate-100 mb-0.5",children:"     "}),i.jsx("span",{className:"block text-xs text-slate-500 dark:text-slate-400 leading-relaxed",children:"           ."})]})]}),i.jsxs("div",{className:"space-y-3 mt-auto",children:[i.jsx("button",{onClick:ne,disabled:I,className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-bold text-lg shadow-lg shadow-emerald-600/20 active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:I?i.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:" "}),i.jsx(Yh,{size:20})]})}),i.jsx("button",{onClick:ke,disabled:I,className:"w-full py-4 bg-slate-200 dark:bg-slate-800 hover:bg-slate-300 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-2xl font-bold text-lg active:scale-[0.98] transition-all",children:"  "})]})]})})}const I_={getCurrentPosition:async()=>{try{if((await nd.checkPermissions()).location!=="granted"&&(await nd.requestPermissions()).location!=="granted")return{error:"Location permission denied",permissionStatus:"denied"};const k=nd.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:3e3}),w=new Promise((I,R)=>setTimeout(()=>R(new Error("Location timeout")),1e4)),P=await Promise.race([k,w]);return{coords:{latitude:P.coords.latitude,longitude:P.coords.longitude},permissionStatus:"granted"}}catch(b){console.error("Geolocation Error:",b);let k="Failed to get location";return b.message==="Location timeout"?k="Taking too long to locate. Please try outdoors.":b.message.includes("denied")?k="Location permission denied.":b.message.includes("disabled")&&(k="Location services are disabled."),{error:k,permissionStatus:"denied"}}},openSettings:async()=>{}};var xy;(function(b){b[b.Sunday=1]="Sunday",b[b.Monday=2]="Monday",b[b.Tuesday=3]="Tuesday",b[b.Wednesday=4]="Wednesday",b[b.Thursday=5]="Thursday",b[b.Friday=6]="Friday",b[b.Saturday=7]="Saturday"})(xy||(xy={}));const E0=lh("LocalNotifications",{web:()=>Zp(()=>import("./web-Eo_at9lO.js"),[],import.meta.url).then(b=>new b.LocalNotificationsWeb)}),Wj={async requestPermissions(){const{display:b}=await E0.checkPermissions();b!=="granted"&&await E0.requestPermissions()},async schedule(b,k,w=Math.floor(Math.random()*1e4)){await E0.schedule({notifications:[{title:b,body:k,id:w,schedule:{at:new Date(Date.now()+1e3)},sound:void 0,attachments:void 0,actionTypeId:"",extra:null}]})}};function Xj(){const[b,k]=K.useState(""),[w,P]=K.useState(""),[I,R]=K.useState("infrastructure"),[T,c]=K.useState(3),[V,W]=K.useState(null),[se,ee]=K.useState(null),[ne,ke]=K.useState(null),[je,re]=K.useState(!1),[H,Ze]=K.useState(!0),[Pe,ze]=K.useState(null),[lt,Nt]=K.useState(!1),[zt,Ft]=K.useState(null),[Vt,Zt]=K.useState(null),[mt,fr]=K.useState(null),[Kt,Wt]=K.useState(!1),Me=K.useRef(null),Ct=K.useRef(null),it=K.useRef(null),Tt=dr(),nt=yo().state;K.useEffect(()=>{if(nt?.prefill){const{title:wt,type:Ht,latitude:At,longitude:er,infrastructure_node_id:Sr,infrastructure_line_id:Jr,serial_number:_a}=nt.prefill;wt&&k(wt),Ht&&R(Ht),At&&er&&(W({lat:At,lng:er}),Ze(!1)),Sr&&Ft(Sr),Jr&&Zt(Jr),_a&&fr(_a)}},[nt]),K.useEffect(()=>{Nt(!!(b||w||se))},[b,w,se]),K.useEffect(()=>{if(Kt&&Me.current&&!Ct.current){const wt=V?.lat||33.456,Ht=V?.lng||36.236;Ct.current=new Hc.Map({container:Me.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap"}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:[Ht,wt],zoom:15}),it.current=new Hc.Marker({draggable:!0,color:"#10b981"}).setLngLat([Ht,wt]).addTo(Ct.current),it.current.on("dragend",()=>{const At=it.current?.getLngLat();At&&(W({lat:At.lat,lng:At.lng}),ze(null))}),Ct.current.on("click",At=>{it.current?.setLngLat(At.lngLat),W({lat:At.lngLat.lat,lng:At.lngLat.lng}),ze(null)})}},[Kt]);const ht=()=>{lt?window.confirm("       .")&&Tt(-1):Tt(-1)},pt=wt=>{const Ht=wt.target.files?.[0];if(Ht){ee(Ht);const At=new FileReader;At.onloadend=()=>{ke(At.result)},At.readAsDataURL(Ht)}},Ce=()=>{ee(null),ke(null)},Ye=[{id:"infrastructure",label:" ",icon:i.jsx(gw,{size:24}),color:"bg-orange-50 text-orange-600 border-orange-100"},{id:"trash",label:"",icon:i.jsx(F0,{size:24}),color:"bg-red-50 text-red-600 border-red-100"},{id:"lighting",label:"",icon:i.jsx(mo,{size:24}),color:"bg-amber-50 text-amber-600 border-amber-100"},{id:"other",label:"",icon:i.jsx(Yy,{size:24}),color:"bg-blue-50 text-blue-600 border-blue-100"}],qt=async()=>{Ze(!0),ze(null);try{const wt=await I_.getCurrentPosition();wt.coords?W({lat:wt.coords.latitude,lng:wt.coords.longitude}):wt.error&&ze(wt.error)}catch{ze("   ")}finally{Ze(!1)}};K.useEffect(()=>{qt()},[]);const Yt=async wt=>{wt.preventDefault(),re(!0);let Ht=null;se&&(Ht=await new Promise(At=>{const er=new FileReader;er.onloadend=()=>At(er.result),er.readAsDataURL(se)}));try{if(!navigator.onLine)throw new Error("OFFLINE_MODE");const At=new FormData;At.append("title",b),At.append("description",w),At.append("type",I),At.append("category",I==="trash"?"sanitation":I==="lighting"?"electricity":"safety"),At.append("severity",T.toString()),V&&(At.append("latitude",V.lat.toString()),At.append("longitude",V.lng.toString())),se&&At.append("image",se),zt&&At.append("infrastructure_node_id",zt.toString()),Vt&&At.append("infrastructure_line_id",Vt.toString()),await Lt.post("/infrastructure/reports",At,{headers:{"Content-Type":"multipart/form-data"},timeout:5e3}),await Wj.schedule("  ! ","    .    ."),Tt("/",{replace:!0})}catch(At){At.message==="OFFLINE_MODE"||At.code==="ECONNABORTED"||At.message==="Network Error"||!navigator.onLine?(console.log("Saving report offline..."),await ag.saveReport({type:I,title:b,description:w,latitude:V?.lat,longitude:V?.lng,image:Ht||void 0,infrastructure_node_id:zt,infrastructure_line_id:Vt}),alert(`    .
          .`),Tt("/",{replace:!0})):(console.error("Report submission error:",At),alert("    .    ."))}finally{Nt(!1),re(!1)}};return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:"bg-slate-900 dark:bg-black pb-12 pt-6 px-4 rounded-b-[40px] relative overflow-hidden shadow-2xl transition-colors duration-300",children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-red-500/10 rounded-full blur-3xl -mr-16 -mt-16"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-orange-500/10 rounded-full -ml-12 -mb-12 blur-3xl"}),i.jsx("header",{className:"relative z-10 flex items-center justify-between mb-2",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:ht,className:"w-10 h-10 bg-white/10 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/20 hover:bg-white/20 transition-all",children:i.jsx(Cr,{size:20})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-black text-white",children:" "}),mt&&i.jsxs("div",{className:"text-[10px] font-bold text-orange-400 bg-orange-400/10 px-2 py-0.5 rounded-full inline-block mt-1",children:[" : ",mt]}),!mt&&i.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-xs font-medium",children:"   "})]})]})})]}),i.jsx("main",{className:"px-5 -mt-8 relative z-20 space-y-5",children:i.jsxs("form",{onSubmit:Yt,className:"space-y-6",children:[i.jsxs("div",{children:[i.jsxs("label",{className:"flex items-center gap-2 text-sm font-black text-slate-800 dark:text-slate-100 mb-3 px-1",children:[i.jsx("div",{className:"w-1.5 h-4 bg-slate-900 dark:bg-slate-400 rounded-full"})," "]}),i.jsx("div",{className:"grid grid-cols-2 gap-3",children:Ye.map(wt=>i.jsxs("button",{type:"button",onClick:()=>R(wt.id),className:`p-4 rounded-2xl border transition-all flex flex-col items-center justify-center gap-2 relative overflow-hidden group ${I===wt.id?"bg-slate-900 dark:bg-indigo-600 border-slate-900 dark:border-indigo-500 text-white shadow-lg":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:border-slate-300 dark:hover:border-slate-600"}`,children:[i.jsx("div",{className:`p-3 rounded-full mb-1 transition-colors ${I===wt.id?"bg-white/10 text-white":`${wt.color.replace("border","bg").replace("text","text")} bg-opacity-50`}`,children:wt.icon}),i.jsx("span",{className:"text-xs font-bold",children:wt.label}),I===wt.id&&i.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-emerald-500 rounded-full animate-pulse"})]},wt.id))})]}),i.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-[32px] p-2 border border-slate-100 dark:border-slate-700/50 shadow-sm",children:i.jsxs("div",{className:"space-y-4 p-4",children:[i.jsxs("div",{className:"group",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-slate-500 mb-2 px-1",children:" "}),i.jsx("input",{type:"text",value:b,onChange:wt=>k(wt.target.value),className:"w-full px-4 py-4 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl focus:outline-none focus:border-slate-900 dark:focus:border-indigo-500 focus:bg-white dark:focus:bg-slate-800 transition-all text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm font-bold",placeholder:":    ",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"flex items-center justify-between text-xs font-bold text-slate-500 dark:text-slate-500 mb-2 px-1",children:[i.jsxs("span",{children:["  ( ",T,"/5 )"]}),i.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${T===1?"bg-green-100 text-green-700":T===2?"bg-blue-100 text-blue-700":T===3?"bg-yellow-100 text-yellow-700":T===4?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:T===1?"":T===2?"":T===3?"":T===4?"":""})]}),i.jsx("input",{type:"range",min:"1",max:"5",value:T,onChange:wt=>c(parseInt(wt.target.value)),className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer dark:bg-slate-700 accent-slate-900 dark:accent-indigo-500"}),i.jsxs("div",{className:"flex justify-between px-1 mt-1 text-[10px] text-slate-400",children:[i.jsx("span",{children:""}),i.jsx("span",{children:""})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-slate-500 mb-2 px-1",children:""}),i.jsx("textarea",{value:w,onChange:wt=>P(wt.target.value),className:"w-full px-4 py-4 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl focus:outline-none focus:border-slate-900 dark:focus:border-indigo-500 focus:bg-white dark:focus:bg-slate-800 transition-all text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-600 text-sm min-h-[120px] resize-none leading-relaxed font-medium",placeholder:"  ...",required:!0})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-slate-500 px-1",children:" "}),i.jsx("input",{type:"file",id:"image-upload",accept:"image/*",className:"hidden",onChange:pt}),ne?i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:ne,alt:"Preview",className:"w-full h-48 object-cover rounded-2xl border border-slate-200 dark:border-slate-700 shadow-premium"}),i.jsx("button",{type:"button",onClick:Ce,className:"absolute top-3 right-3 w-10 h-10 bg-black/50 backdrop-blur-md text-white rounded-xl flex items-center justify-center hover:bg-black/70 transition-all border border-white/20",children:i.jsx(F0,{size:20})})]}):i.jsxs("label",{htmlFor:"image-upload",className:"w-full py-8 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-3xl text-slate-400 dark:text-slate-600 hover:text-emerald-600 dark:hover:text-emerald-400 transition-all flex flex-col items-center gap-3 bg-slate-50/50 dark:bg-slate-900/30 cursor-pointer",children:[i.jsx("div",{className:"p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-card border border-slate-100 dark:border-slate-700",children:i.jsx(om,{size:32})}),i.jsx("span",{className:"text-xs font-black",children:"  "})]})]})]})}),i.jsxs("div",{className:`bg-white dark:bg-slate-800 border ${Pe?"border-red-200":"border-slate-200 dark:border-slate-700/50"} p-4 rounded-3xl flex items-center gap-4 shadow-sm transition-colors`,children:[i.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 border transition-all ${Pe?"bg-red-50 text-red-500 border-red-100":"bg-indigo-50 text-indigo-600 border-indigo-100"}`,children:Pe?i.jsx(ec,{size:24}):i.jsx(qn,{size:24})}),i.jsxs("div",{className:"flex-1 text-right",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("div",{className:`font-black text-xs ${Pe?"text-red-600":"text-slate-800 dark:text-slate-100"}`,children:H?"  ...":Pe?"  ":" "}),i.jsxs("button",{type:"button",onClick:()=>Wt(!0),className:"text-[10px] font-bold text-indigo-600 dark:text-indigo-400 flex items-center gap-1 bg-indigo-50 dark:bg-indigo-900/30 px-2 py-1 rounded-lg hover:bg-indigo-100 transition-colors",children:[i.jsx(qn,{size:10}),"  "]})]}),V?i.jsxs("div",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-bold bg-slate-50 dark:bg-slate-900 px-2 py-1 rounded-lg border border-slate-100 dark:border-slate-700/50 inline-flex items-center gap-1",children:[i.jsx("span",{children:" :"}),i.jsxs("span",{className:"font-mono",dir:"ltr",children:[V.lat.toFixed(5),", ",V.lng.toFixed(5)]})]}):!H&&i.jsx("span",{className:"text-[10px] text-slate-400",children:"  "})]})]}),i.jsx("button",{type:"submit",disabled:je||H||!V,className:"w-full py-5 bg-slate-900 dark:bg-indigo-600 hover:bg-slate-800 text-white rounded-3xl font-black text-base shadow-xl active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3",children:je?i.jsx("span",{children:" ..."}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:" "}),i.jsx(Gp,{size:20,className:"rtl:rotate-180"})]})}),i.jsx("div",{className:"h-4"})]})}),Kt&&i.jsxs("div",{className:"fixed inset-0 z-50 bg-slate-900 flex flex-col animate-in fade-in duration-200",children:[i.jsxs("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-slate-900 z-10 shadow-md",children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:" "}),i.jsx("button",{onClick:()=>Wt(!1),className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full",children:i.jsx(ad,{size:20,className:"text-slate-600 dark:text-slate-300"})})]}),i.jsxs("div",{className:"flex-1 relative bg-slate-200",children:[i.jsx("div",{ref:Me,className:"absolute inset-0"}),i.jsx("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur px-4 py-2 rounded-full shadow-lg border border-emerald-500/30 text-xs font-bold text-emerald-700 z-10 pointer-events-none",children:"   "})]}),i.jsx("div",{className:"p-4 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800",children:i.jsx("button",{onClick:()=>Wt(!1),className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-bold shadow-lg shadow-emerald-500/20 active:scale-95 transition-all",children:" "})})]})]})}let Yj=0;const am=[],Kr=(b,k="info")=>{const w={id:Yj++,message:b,type:k};am.forEach(P=>P(w))};function Kj(){const[b,k]=K.useState([]);K.useEffect(()=>{const I=R=>{k(T=>[...T,R]),setTimeout(()=>{k(T=>T.filter(c=>c.id!==R.id))},3e3)};return am.push(I),()=>{const R=am.indexOf(I);R>-1&&am.splice(R,1)}},[]);const w=I=>{switch(I){case"success":return"bg-emerald-500 text-white";case"error":return"bg-red-500 text-white";default:return"bg-slate-800 text-white"}},P=I=>{switch(I){case"success":return"";case"error":return"";default:return""}};return i.jsx("div",{className:"fixed top-20 left-4 right-4 z-[9999] pointer-events-none",dir:"rtl",children:b.map(I=>i.jsxs("div",{className:`${w(I.type)} rounded-xl p-4 mb-3 shadow-lg flex items-center gap-3 animate-slide-down pointer-events-auto`,children:[i.jsx("span",{className:"text-2xl",children:P(I.type)}),i.jsx("span",{className:"font-bold text-sm flex-1",children:I.message})]},I.id))})}function tf({src:b,alt:k,className:w,fallback:P="https://via.placeholder.com/400x300?text=No+Image",...I}){const[R,T]=K.useState(!1),[c,V]=K.useState(!1);return i.jsxs("div",{className:`relative overflow-hidden ${w}`,children:[!R&&i.jsx("div",{className:"absolute inset-0 bg-slate-100 animate-pulse flex items-center justify-center",children:i.jsx("span",{className:"text-slate-300 text-2xl",children:""})}),i.jsx("img",{src:c?P:b,alt:k,className:`w-full h-full object-cover transition-opacity duration-300 ${R?"opacity-100":"opacity-0"}`,onLoad:()=>T(!0),onError:()=>{V(!0),T(!0)},...I})]})}function Jj(){const[b,k]=K.useState([]),[w,P]=K.useState(!0),I=dr();K.useEffect(()=>{R()},[]);const R=K.useCallback(async()=>{try{const ne=await Lt.get("/portal/projects");k(ne.data)}catch(ne){console.error(ne)}finally{P(!1)}},[]);K.useEffect(()=>{R()},[R]);const T=K.useCallback(async()=>{await R()},[R]),{isRefreshing:c,containerRef:V,indicatorRef:W,handlers:se}=hi(T),ee=async ne=>{if(!localStorage.getItem("token")){Kr("    ","error"),I("/login");return}try{await Lt.post(`/portal/projects/${ne}/vote`),k(b.map(je=>je.id===ne?{...je,votes_count:(je.votes_count||0)+1}:je)),Kr("   !   ","success")}catch(je){je.response?.status===401?(Kr(" .    ","error"),I("/login")):Kr(" .   ","error")}};return i.jsx("div",{className:"min-h-screen bg-page-gradient pb-20 transition-colors duration-300 overflow-x-hidden touch-pan-y",dir:"rtl",...se,children:i.jsxs(pi,{isRefreshing:c,containerRef:V,indicatorRef:W,children:[i.jsx("header",{className:"bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl border-b border-slate-200/60 dark:border-slate-800/60 sticky top-0 z-30 px-4 py-4 shadow-md transition-colors duration-300",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-emerald-50 dark:bg-emerald-900/30 rounded-xl flex items-center justify-center text-emerald-600 dark:text-emerald-400 border border-emerald-100 dark:border-emerald-800/50 shadow-inner-soft",children:i.jsx(d2,{size:20})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:" "}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-bold",children:"    "})]})]}),i.jsx("button",{onClick:()=>I("/initiatives/add"),className:"bg-emerald-600 dark:bg-emerald-500 text-white px-4 py-2 rounded-xl text-xs font-bold hover:bg-emerald-700 dark:hover:bg-emerald-600 transition shadow-premium active:scale-95",children:"+  "})]})}),i.jsxs("main",{className:"px-4 py-4",children:[i.jsxs("div",{className:"bg-gradient-to-br from-amber-500 via-orange-500 to-red-600 rounded-[32px] p-7 text-white relative overflow-hidden shadow-premium-xl mb-6",children:[i.jsx("div",{className:"absolute top-0 left-0 w-48 h-48 bg-white/20 rounded-full -ml-24 -mt-24 blur-3xl opacity-60"}),i.jsx("div",{className:"absolute bottom-0 right-0 w-40 h-40 bg-black/10 rounded-full -mr-20 -mb-20 blur-2xl"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("h2",{className:"text-2xl font-black mb-2 leading-tight",children:"  "}),i.jsx("p",{className:"text-orange-50/90 text-sm font-medium",children:"       "})]})]}),w?i.jsx("div",{className:"space-y-4",children:[1,2,3].map(ne=>i.jsx(ui,{type:"card"},ne))}):i.jsxs("div",{className:"space-y-4",children:[b.map(ne=>i.jsx("div",{onClick:()=>I(`/initiatives/${ne.id}`),className:"bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm rounded-2xl border border-slate-200/60 dark:border-slate-700/50 shadow-premium overflow-hidden hover:border-emerald-200 dark:hover:border-emerald-700 transition-all group cursor-pointer",children:i.jsxs("div",{className:"p-4",children:[i.jsxs("div",{className:"flex gap-4 items-start mb-3",children:[i.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-50 dark:bg-slate-900 flex-shrink-0 flex items-center justify-center overflow-hidden border border-slate-100 dark:border-slate-700 shadow-inner-soft",children:ne.image?i.jsx(tf,{src:ne.image,alt:ne.title,className:"w-full h-full object-cover"}):i.jsx("span",{className:"text-2xl",children:""})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex justify-between items-start mb-1 text-right",children:[i.jsx("h3",{className:"font-bold text-sm text-slate-900 dark:text-slate-100 truncate leading-tight group-hover:text-emerald-700 dark:group-hover:text-emerald-400 transition-colors",children:ne.title}),i.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-full border shadow-sm ${ne.status===""?"bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 border-emerald-100 dark:border-emerald-800/50":ne.status===" "?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border-blue-100 dark:border-blue-800/50":"bg-amber-50 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 border-amber-100 dark:border-amber-800/50"}`,children:ne.status||" "})]}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 line-clamp-2 leading-relaxed text-right font-medium",children:ne.description})]})]}),i.jsxs("div",{className:"bg-slate-50/50 dark:bg-slate-900/50 rounded-xl p-3 border border-slate-100 dark:border-slate-700/50 mb-4 shadow-inner-soft",children:[i.jsxs("div",{className:"flex justify-between items-center text-[10px] font-bold text-slate-500 dark:text-slate-400 mb-2",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Jn,{size:12,className:"text-slate-400 dark:text-slate-600"}),i.jsxs("span",{children:[ne.votes_count||0," "]})]}),i.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:"75% "})]}),i.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden shadow-inner",children:i.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-400 to-emerald-600 rounded-full shadow-sm"})})]}),i.jsxs("button",{onClick:ke=>{ke.stopPropagation(),ee(ne.id)},className:"w-full py-3 bg-white dark:bg-slate-900 border border-slate-200/60 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 hover:text-emerald-700 dark:hover:text-emerald-400 hover:border-emerald-200 dark:hover:border-emerald-700 rounded-xl text-xs font-black transition-all flex items-center justify-center gap-2 shadow-sm active:scale-95",children:[i.jsx(L0,{size:16}),i.jsx("span",{children:" "})]})]})},ne.id)),b.length===0&&i.jsxs("div",{className:"text-center py-12 bg-white/50 dark:bg-slate-800/50 rounded-[32px] border-2 border-dashed border-slate-200 dark:border-slate-800",children:[i.jsx("div",{className:"w-20 h-20 bg-slate-100 dark:bg-slate-900 rounded-full mx-auto flex items-center justify-center text-slate-400 dark:text-slate-600 mb-4 shadow-inner-soft",children:i.jsx(Jn,{size:40})}),i.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm font-bold",children:"   "})]})]})]})]})})}function Qj(){const b=dr(),[k,w]=K.useState(!1),[P,I]=K.useState(""),[R,T]=K.useState(""),[c,V]=K.useState(null),[W,se]=K.useState(null),[ee,ne]=K.useState(!1);K.useEffect(()=>{ne(!!(P||R||c))},[P,R,c]),K.useEffect(()=>{const Ze=Pe=>{ee&&(Pe.preventDefault(),Pe.returnValue="")};return window.addEventListener("beforeunload",Ze),()=>window.removeEventListener("beforeunload",Ze)},[ee]);const ke=()=>{ee?window.confirm("       .")&&b(-1):b(-1)},je=Ze=>{const Pe=Ze.target.files?.[0];if(Pe){V(Pe);const ze=new FileReader;ze.onloadend=()=>{se(ze.result)},ze.readAsDataURL(Pe)}},re=()=>{V(null),se(null)},H=async Ze=>{if(Ze.preventDefault(),!P||!R){Kr("    ","error");return}w(!0);try{const Pe=new FormData;Pe.append("title",P),Pe.append("description",R),c&&Pe.append("image",c),await Lt.post("/portal/projects",Pe),ne(!1),Kr("   !   ","success"),b("/initiatives")}catch(Pe){console.error(Pe);const ze=Pe.response?.data?.message||"   ";Pe.response?.status===401?(Kr("   ","error"),b("/login")):Kr(ze,"error")}finally{w(!1)}};return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30 px-4 py-4 shadow-sm flex items-center gap-3",children:[i.jsx("button",{onClick:ke,className:"w-10 h-10 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl flex items-center justify-center text-slate-600 dark:text-slate-400 transition-colors border border-slate-200 dark:border-slate-700",children:i.jsx(id,{size:24})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:"  "}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-medium",children:"   "})]})]}),i.jsxs("main",{className:"p-4 max-w-lg mx-auto",children:[i.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800/50 rounded-2xl p-4 mb-6 flex gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center text-blue-600 dark:text-blue-200 flex-shrink-0",children:i.jsx(mo,{size:20})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm mb-1",children:"  "}),i.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 leading-relaxed",children:"    .          ."})]})]}),i.jsxs("form",{onSubmit:H,className:"space-y-5",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 flex items-center gap-2",children:[i.jsx(a2,{size:16,className:"text-emerald-500"})," "]}),i.jsx("input",{type:"text",value:P,onChange:Ze=>I(Ze.target.value),placeholder:":    ",className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all font-bold text-slate-800 dark:text-slate-100 placeholder-slate-400"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:" "}),i.jsx("textarea",{value:R,onChange:Ze=>T(Ze.target.value),placeholder:"    ...",rows:6,className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all text-slate-800 dark:text-slate-100 placeholder-slate-400 resize-none leading-relaxed"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("label",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 flex items-center gap-2",children:[i.jsx(om,{size:16,className:"text-purple-500"}),"  ()"]}),W?i.jsxs("div",{className:"relative rounded-2xl overflow-hidden h-48 border border-slate-200 dark:border-slate-700 shadow-md",children:[i.jsx("img",{src:W,alt:"Preview",className:"w-full h-full object-cover"}),i.jsx("button",{onClick:re,type:"button",className:"absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-lg flex items-center justify-center shadow-lg active:scale-95 transition-transform",children:i.jsx(F0,{size:16})})]}):i.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-40 bg-white dark:bg-slate-800 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors group",children:[i.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[i.jsx("div",{className:"w-12 h-12 bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:i.jsx(om,{size:24})}),i.jsx("p",{className:"text-sm font-bold text-slate-600 dark:text-slate-400",children:"  "}),i.jsx("p",{className:"text-[10px] text-slate-400 mt-1 uppercase",children:"PNG, JPG up to 5MB"})]}),i.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:je})]})]}),i.jsx("button",{type:"submit",disabled:k,className:"w-full py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-emerald-500/20 active:scale-[0.98] transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:k?i.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx(Yh,{size:20}),i.jsx("span",{children:" "})]})})]})]})]})}function eS(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0);K.useEffect(()=>{T()},[b]);const T=async()=>{try{const V=await Lt.get(`/portal/projects/${b}`);P(V.data)}catch(V){console.error(V),Kr("   ","error"),k("/initiatives")}finally{R(!1)}},c=async()=>{if(!localStorage.getItem("token")){Kr("    ","error"),k("/login");return}try{P(W=>({...W,votes_count:(W.votes_count||0)+1})),await Lt.post(`/portal/projects/${b}/vote`),Kr("   !   ","success")}catch(W){P(se=>({...se,votes_count:(se.votes_count||0)-1})),W.response?.status===401?(Kr(" .    ","error"),k("/login")):W.response?.status===400?Kr("     ","info"):Kr(" .   ","error")}};return I?i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4",children:i.jsx(ui,{type:"card"})}):w?i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-24 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:"relative h-72 w-full",children:[i.jsxs("div",{className:"absolute top-0 left-0 w-full h-full",children:[w.image?i.jsx(tf,{src:w.image,alt:w.title,className:"w-full h-full object-cover"}):i.jsx("div",{className:"w-full h-full bg-gradient-to-br from-emerald-600 to-teal-800 flex items-center justify-center",children:i.jsx("span",{className:"text-6xl",children:""})}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/40 to-transparent"})]}),i.jsxs("div",{className:"absolute top-0 left-0 w-full p-4 flex justify-between items-center z-20",children:[i.jsx("button",{onClick:()=>k(-1),className:"w-10 h-10 bg-white/20 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/30 active:scale-95 transition",children:i.jsx(id,{size:24})}),i.jsx("button",{className:"w-10 h-10 bg-white/20 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/30 active:scale-95 transition",children:i.jsx(Yp,{size:20})})]}),i.jsxs("div",{className:"absolute bottom-0 left-0 w-full p-6 z-20",children:[i.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-[10px] font-bold mb-3 ${w.status===""?"bg-emerald-500 text-white":w.status===" "?"bg-blue-500 text-white":"bg-amber-500 text-white"}`,children:w.status||" "}),i.jsx("h1",{className:"text-2xl font-black text-white leading-tight mb-2",children:w.title}),i.jsxs("div",{className:"flex items-center gap-4 text-slate-300 text-xs font-medium",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Jn,{size:14}),i.jsxs("span",{children:[": ",w.user?.name||""]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(hl,{size:14}),i.jsx("span",{children:w.created_at})]})]})]})]}),i.jsxs("main",{className:"-mt-6 relative z-10 bg-slate-50 dark:bg-slate-900 rounded-t-3xl px-6 pt-8 space-y-8 min-h-[50vh]",children:[i.jsxs("div",{className:"flex gap-4",children:[i.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-emerald-50 dark:bg-emerald-900/30 rounded-full flex items-center justify-center text-emerald-600 dark:text-emerald-400",children:i.jsx(L0,{size:20})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-slate-400 font-bold",children:" "}),i.jsx("p",{className:"text-lg font-black text-slate-800 dark:text-slate-100",children:w.votes_count||0})]})]}),i.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-blue-50 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600 dark:text-blue-400",children:i.jsx(qn,{size:20})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-slate-400 font-bold",children:" "}),i.jsx("p",{className:"text-xs font-bold text-slate-800 dark:text-slate-100",children:""})]})]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 mb-3 text-lg",children:" "}),i.jsx("div",{className:"prose prose-sm dark:prose-invert text-slate-600 dark:text-slate-300 leading-relaxed text-justify",children:w.description})]}),i.jsxs("div",{className:"fixed bottom-0 left-0 w-full p-4 bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg border-t border-slate-200 dark:border-slate-800 z-50 safe-bottom",children:[i.jsxs("button",{onClick:c,className:"w-full py-3.5 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white rounded-xl font-bold text-lg shadow-lg shadow-emerald-500/30 active:scale-[0.98] transition-all flex items-center justify-center gap-2",children:[i.jsx(L0,{size:20}),i.jsx("span",{children:"  "})]}),i.jsx("p",{className:"text-center text-[10px] text-slate-400 mt-2 font-medium",children:"      "})]})]})]}):null}function tS(){const[b,k]=K.useState([]),[w,P]=K.useState(!0),[I,R]=K.useState(!1),[T,c]=K.useState(""),[V,W]=K.useState(""),[se,ee]=K.useState(null),[ne,ke]=K.useState("general"),[je,re]=K.useState(!1),[H,Ze]=K.useState(null),Pe=dr();K.useEffect(()=>{const mt=localStorage.getItem("user");mt&&Ze(JSON.parse(mt))},[]);const ze=()=>{if(!H){Pe("/login");return}Pe("/discussions/add")},lt=[{id:"general",name:"",icon:"",color:"slate"},{id:"services",name:"",icon:"",color:"blue"},{id:"suggestions",name:"",icon:"",color:"amber"},{id:"complaints",name:"",icon:"",color:"red"},{id:"help",name:"",icon:"",color:"emerald"}],Nt=K.useCallback(async()=>{try{const mt=await Lt.get("/portal/discussions");k(mt.data)}catch(mt){console.error(mt)}finally{P(!1)}},[]);K.useEffect(()=>{Nt()},[Nt]);const{isRefreshing:zt,pullMoveY:Ft,handlers:Vt}=hi(Nt),Zt=async(mt,fr)=>{if(fr.stopPropagation(),!H){Kr("   ","error");return}try{await Lt.post(`/portal/discussions/${mt}/vote`),k(b.map(Kt=>Kt.id===mt?{...Kt,votes_count:(Kt.votes_count||0)+(Kt.current_user_vote?-1:1),current_user_vote:!Kt.current_user_vote}:Kt))}catch(Kt){console.error(Kt)}};return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...Vt,children:i.jsxs(pi,{isRefreshing:zt,pullMoveY:Ft,children:[i.jsx("header",{className:"bg-white dark:bg-slate-900 pb-14 pt-8 z-40 relative transition-colors duration-300",children:i.jsxs("div",{className:"flex items-center justify-between px-5",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:()=>Pe(-1),className:"w-12 h-12 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-2xl flex items-center justify-center text-slate-600 dark:text-slate-400 transition-all border border-slate-200 dark:border-slate-800 active:scale-90 shadow-sm",children:i.jsx(Cr,{size:22,className:"rotate-180"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-black text-slate-800 dark:text-slate-100 tracking-tight",children:""}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium mt-0.5",children:"   "})]})]}),i.jsx("button",{onClick:ze,className:"bg-emerald-600 hover:bg-emerald-700 text-white w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg shadow-emerald-600/20 active:scale-90 transition-all",children:i.jsx(qp,{size:24})})]})}),i.jsxs("main",{className:"px-5 -mt-10 relative z-50 bg-slate-50 dark:bg-slate-900 rounded-t-[40px] pt-8 min-h-[calc(100vh-200px)] space-y-4 transition-colors duration-300",children:[i.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:lt.map(mt=>i.jsxs("button",{onClick:()=>ke(mt.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl border transition-all whitespace-nowrap ${ne===mt.id?`bg-${mt.color}-600 text-white border-${mt.color}-600 shadow-md`:"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[i.jsx("span",{className:"text-xs",children:mt.icon}),i.jsx("span",{className:"text-xs font-bold",children:mt.name})]},mt.id))}),w?[1,2,3].map(mt=>i.jsx(ui,{type:"card"},mt)):b.filter(mt=>ne==="general"||mt.category===ne).map(mt=>i.jsxs("div",{onClick:()=>Pe(`/discussions/${mt.id}`),className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700/50 shadow-premium active:scale-[0.99] transition-all overflow-hidden mb-4",children:[mt.image_url&&i.jsxs("div",{className:"h-40 w-full bg-slate-50 dark:bg-slate-900 relative",children:[i.jsx(tf,{src:mt.image_url,alt:mt.title,className:"w-full h-full object-cover"}),i.jsx("div",{className:"absolute top-3 right-3",children:i.jsx("span",{className:"px-2 py-1 rounded-lg text-[10px] font-bold shadow-sm backdrop-blur-md bg-white/90 dark:bg-slate-900/90 text-slate-800 dark:text-slate-100",children:lt.find(fr=>fr.id===mt.category)?.name||mt.category})})]}),i.jsxs("div",{className:"p-4",children:[!mt.image_url&&i.jsxs("div",{className:"flex justify-between items-start mb-3",children:[i.jsx("span",{className:"px-2 py-1 rounded-lg text-[10px] font-bold bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400",children:lt.find(fr=>fr.id===mt.category)?.name||mt.category}),i.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-medium",children:new Date(mt.created_at).toLocaleDateString("ar-SY")})]}),i.jsx("h3",{className:"font-bold text-slate-900 dark:text-slate-100 text-base mb-2 line-clamp-1",children:mt.title}),i.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 line-clamp-2 leading-relaxed mb-4",children:mt.body}),i.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-50",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-500 dark:text-slate-400 font-bold text-[10px]",children:mt.user?.name.charAt(0)}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-slate-300",children:mt.user?.name}),mt.image_url&&i.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:new Date(mt.created_at).toLocaleDateString("ar-SY")})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("button",{onClick:fr=>Zt(mt.id,fr),className:`flex items-center gap-1 text-xs font-bold transition-colors ${mt.current_user_vote?"text-emerald-600 dark:text-emerald-400":"text-slate-400 dark:text-slate-500"}`,children:[mt.current_user_vote?i.jsx("div",{className:"text-emerald-600 dark:text-emerald-400",children:""}):i.jsx("div",{className:"grayscale opacity-50",children:""}),i.jsx("span",{children:mt.votes_count||0})]}),i.jsxs("div",{className:"flex items-center gap-1 text-xs font-bold text-slate-400 dark:text-slate-500",children:[i.jsx(mm,{size:16}),i.jsx("span",{children:mt.replies_count||0})]})]})]})]})]},mt.id))]})]})})}function rS(){const[b,k]=K.useState(""),[w,P]=K.useState(""),[I,R]=K.useState(null),[T,c]=K.useState("general"),[V,W]=K.useState(!1),[se,ee]=K.useState(null),[ne,ke]=K.useState(!1),je=dr();K.useEffect(()=>{ke(!!(b||w||I))},[b,w,I]),K.useEffect(()=>{const ze=lt=>{ne&&(lt.preventDefault(),lt.returnValue="")};return window.addEventListener("beforeunload",ze),()=>window.removeEventListener("beforeunload",ze)},[ne]);const re=()=>{ne?window.confirm("       .")&&je(-1):je(-1)},H=[{id:"general",name:"",icon:"",color:"slate"},{id:"services",name:"",icon:"",color:"blue"},{id:"suggestions",name:"",icon:"",color:"amber"},{id:"complaints",name:"",icon:"",color:"red"},{id:"help",name:"",icon:"",color:"emerald"}];K.useEffect(()=>{const ze=localStorage.getItem("user");ze?ee(JSON.parse(ze)):je("/login")},[je]);const Ze=ze=>{ze.target.files&&ze.target.files[0]&&R(ze.target.files[0])},Pe=async ze=>{if(ze.preventDefault(),!b.trim()||!w.trim())return;W(!0);const lt=new FormData;lt.append("title",b),lt.append("body",w),lt.append("category",T),I&&lt.append("image",I);try{await Lt.post("/portal/discussions",lt,{headers:{"Content-Type":"multipart/form-data"}}),ke(!1),Kr("    ","success"),je("/discussions")}catch(Nt){console.error(Nt),Kr("   ","error")}finally{W(!1)}};return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsx("header",{className:"bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0 z-40 px-4 py-4 shadow-sm transition-colors duration-300",children:i.jsxs("div",{className:"flex items-center gap-4 px-1",children:[i.jsx("button",{onClick:re,className:"w-12 h-12 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-2xl flex items-center justify-center text-slate-600 dark:text-slate-400 transition-all border border-slate-200 dark:border-slate-800 active:scale-90 shadow-sm",children:i.jsx(Cr,{size:22,className:""})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-black text-slate-800 dark:text-slate-100 tracking-tight",children:"  "}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium mt-0.5",children:"    "})]})]})}),i.jsxs("main",{className:"px-5 py-6 space-y-6",children:[i.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-950/20 border border-emerald-100 dark:border-emerald-900/30 rounded-3xl p-5 flex gap-4",children:[i.jsx("div",{className:"w-12 h-12 bg-emerald-100 dark:bg-emerald-900/40 rounded-2xl flex items-center justify-center text-emerald-600 dark:text-emerald-400 shrink-0",children:i.jsx(R0,{size:24})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-black text-emerald-800 dark:text-emerald-100 mb-1",children:" "}),i.jsx("p",{className:"text-emerald-700/70 dark:text-emerald-400/70 text-xs leading-relaxed font-medium",children:"         ."})]})]}),i.jsxs("form",{onSubmit:Pe,className:"space-y-6",children:[i.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-[32px] p-2 border border-slate-200 dark:border-slate-700 shadow-premium transition-colors duration-300",children:i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-slate-400 mb-2 px-1",children:" "}),i.jsx("input",{type:"text",value:b,onChange:ze=>k(ze.target.value),placeholder:"   ...",className:"w-full px-4 py-4 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-500 focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder:text-slate-500 text-sm font-bold",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-bold text-slate-500 dark:text-slate-400 mb-2 px-1",children:""}),i.jsx("textarea",{value:w,onChange:ze=>P(ze.target.value),placeholder:"       ",rows:6,className:"w-full px-4 py-4 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl focus:outline-none focus:border-emerald-500 dark:focus:border-emerald-500 focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder:text-slate-500 text-sm min-h-[160px] resize-none leading-relaxed font-medium",required:!0})]}),i.jsx("div",{children:i.jsxs("label",{className:`flex items-center gap-3 p-4 rounded-2xl cursor-pointer transition-all border-2 border-dashed ${I?"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500":"bg-slate-50 dark:bg-slate-900 border-slate-200 dark:border-slate-700 hover:border-emerald-400"}`,children:[i.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shadow-sm ${I?"bg-emerald-100 dark:bg-emerald-900/40 text-emerald-600 dark:text-emerald-400":"bg-white dark:bg-slate-800 text-slate-400 dark:text-slate-500"}`,children:i.jsx(Ky,{size:24})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("span",{className:`text-sm font-bold block ${I?"text-emerald-700 dark:text-emerald-400":"text-slate-600 dark:text-slate-100"}`,children:I?"  ":"  "}),i.jsx("span",{className:`text-xs block ${I?"text-emerald-600 dark:text-emerald-500":"text-slate-400 dark:text-slate-500"}`,children:I?I.name:" -  "})]}),i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Ze}),I&&i.jsx("button",{type:"button",onClick:ze=>{ze.preventDefault(),R(null)},className:"w-8 h-8 bg-white dark:bg-slate-800 text-red-500 flex items-center justify-center rounded-full shadow-sm hover:bg-red-50 dark:hover:bg-red-900 transition-colors",children:i.jsx(ad,{size:18})})]})})]})}),i.jsxs("div",{children:[i.jsxs("label",{className:"flex items-center gap-2 text-sm font-black text-slate-800 dark:text-slate-100 mb-4 px-1",children:[i.jsx("div",{className:"w-1.5 h-4 bg-emerald-600 rounded-full"}),"  "]}),i.jsx("div",{className:"grid grid-cols-2 gap-3",children:H.map(ze=>i.jsxs("button",{type:"button",onClick:()=>c(ze.id),className:`p-4 rounded-2xl border transition-all flex flex-col items-center justify-center gap-2 relative overflow-hidden group ${T===ze.id?"bg-slate-900 dark:bg-emerald-600 border-slate-900 dark:border-emerald-600 text-white shadow-lg shadow-slate-900/20 dark:shadow-emerald-600/20":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:border-slate-300 dark:hover:border-slate-600"}`,children:[i.jsx("div",{className:`text-2xl mb-1 p-2 rounded-xl transition-colors ${T===ze.id?"bg-white/10":"bg-slate-50 dark:bg-slate-900"}`,children:ze.icon}),i.jsx("span",{className:"text-xs font-black",children:ze.name}),T===ze.id&&i.jsx("div",{className:"absolute top-2 right-2 w-2 h-2 bg-emerald-400 rounded-full animate-pulse"})]},ze.id))})]}),i.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/20 border border-amber-100 dark:border-amber-900/30 rounded-3xl p-4 flex gap-3",children:[i.jsx(K0,{size:20,className:"text-amber-600 dark:text-amber-500 shrink-0 mt-0.5"}),i.jsx("p",{className:"text-[11px] text-amber-800 dark:text-amber-200 font-medium leading-relaxed",children:"          .       ."})]}),i.jsx("button",{type:"submit",disabled:V||!b.trim()||!w.trim(),className:"w-full py-5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-[24px] font-black text-lg shadow-xl shadow-emerald-600/20 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3",children:V?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),i.jsx("span",{children:" ..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(Gp,{size:22,className:"rotate-180"}),i.jsx("span",{children:"  "})]})}),i.jsx("div",{className:"h-6"})]})]})]})}function sS(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0),[T,c]=K.useState(""),[V,W]=K.useState(null),[se,ee]=K.useState(null);K.useEffect(()=>{ne()},[b]);const ne=async()=>{try{const H=await Lt.get(`/portal/discussions/${b}`);P(H.data)}catch(H){console.error(H),Kr("   ","error")}finally{R(!1)}},ke=async()=>{try{const H=await Lt.post(`/portal/discussions/${b}/vote`);w&&P({...w,votes_count:H.data.votes_count,current_user_vote:H.data.status==="voted"})}catch{Kr("   ","error")}},je=async()=>{if(!T.trim()&&!V)return;const H=new FormData;H.append("body",T),V&&H.append("image",V),se&&H.append("parent_id",se.id);try{await Lt.post(`/portal/discussions/${b}/reply`,H,{headers:{"Content-Type":"multipart/form-data"}}),Kr("   ","success"),c(""),W(null),ee(null),ne()}catch{Kr("  ","error")}},re=H=>{H.target.files&&H.target.files[0]&&W(H.target.files[0])};return I?i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center transition-colors duration-300",children:i.jsx(ui,{type:"card"})}):w?i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-24 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"fixed top-0 left-0 right-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-4 py-3 flex items-center gap-3 transition-colors duration-300",children:[i.jsx("button",{onClick:()=>k(-1),className:"w-10 h-10 bg-slate-50 dark:bg-slate-800 rounded-full flex items-center justify-center text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 line-clamp-1 flex-1",children:w.title})]}),i.jsxs("main",{className:"pt-20 px-4 space-y-4",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-premium border border-slate-200 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-emerald-600 dark:text-emerald-400 font-bold border border-slate-100 dark:border-slate-700",children:w.user.name.charAt(0)}),i.jsxs("div",{children:[i.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:w.user.name}),i.jsx("div",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:" "})]}),i.jsx("span",{className:"mr-auto bg-slate-100 dark:bg-slate-900 px-2 py-1 rounded-lg text-[10px] text-slate-500 dark:text-slate-400 font-bold",children:w.category})]}),i.jsx("h2",{className:"text-xl font-black text-slate-900 dark:text-slate-100 mb-3 leading-snug",children:w.title}),i.jsx("p",{className:"text-slate-600 dark:text-slate-300 leading-relaxed text-sm mb-4 whitespace-pre-wrap",children:w.body}),w.image_url&&i.jsx("div",{className:"mb-4 rounded-xl overflow-hidden border border-slate-100 dark:border-slate-700",children:i.jsx(tf,{src:w.image_url,alt:"Discussion",className:"w-full h-auto"})}),i.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-slate-50 dark:border-slate-700/50",children:[i.jsxs("button",{onClick:ke,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg transition-colors ${w.current_user_vote?"text-red-500 dark:text-red-400 bg-red-50 dark:bg-red-900/20":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[i.jsx(Yc,{size:18,className:w.current_user_vote?"fill-current":""}),i.jsx("span",{className:"text-xs font-bold",children:w.votes_count})]}),i.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-slate-400",children:[i.jsx(mm,{size:18}),i.jsxs("span",{className:"text-xs font-bold",children:[w.replies_count," "]})]}),i.jsx("button",{className:"mr-auto text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300",children:i.jsx(Yp,{size:18})})]})]}),i.jsxs("div",{className:"space-y-4 pb-20",children:[i.jsxs("h3",{className:"text-sm font-bold text-slate-500 dark:text-slate-400 px-2",children:[" (",w.replies_count,")"]}),w.replies.map(H=>i.jsx(z_,{reply:H,onReply:Ze=>ee(Ze)},H.id))]})]}),i.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 p-3 z-50 transition-colors duration-300",children:[se&&i.jsxs("div",{className:"flex justify-between items-center bg-slate-100 dark:bg-slate-800 p-2 rounded-lg mb-2 text-xs text-slate-700 dark:text-slate-300",children:[i.jsxs("span",{children:["  ",i.jsx("b",{children:se.user.name})]}),i.jsx("button",{onClick:()=>ee(null),className:"text-slate-500 dark:text-slate-400 hover:text-red-500",children:i.jsx(Wx,{size:14})})]}),i.jsxs("div",{className:"flex items-end gap-2",children:[i.jsxs("label",{className:"p-3 bg-slate-50 dark:bg-slate-800 text-slate-400 dark:text-slate-500 rounded-xl cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors border border-slate-100 dark:border-slate-800",children:[i.jsx(Ky,{size:20}),i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:re})]}),i.jsxs("div",{className:"flex-1 bg-slate-50 dark:bg-slate-800 rounded-xl p-3 border border-slate-100 dark:border-slate-800 focus-within:border-emerald-500 dark:focus-within:border-emerald-400 focus-within:ring-1 focus-within:ring-emerald-500/20 transition-all",children:[i.jsx("textarea",{value:T,onChange:H=>c(H.target.value),placeholder:se?"  ...":" ...",className:"w-full bg-transparent border-none p-0 text-sm text-slate-800 dark:text-slate-200 focus:ring-0 resize-none max-h-24 placeholder:text-slate-400 dark:placeholder:text-slate-500",rows:1}),V&&i.jsxs("div",{className:"mt-2 relative inline-block",children:[i.jsx("img",{src:URL.createObjectURL(V),className:"h-12 w-12 rounded-lg object-cover border border-slate-200 dark:border-slate-700"}),i.jsx("button",{onClick:()=>W(null),className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5",children:i.jsx(Wx,{size:10})})]})]}),i.jsx("button",{onClick:je,disabled:!T.trim()&&!V,className:"p-3 bg-emerald-600 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-600/20 active:scale-95 transition-all",children:i.jsx(Cr,{size:20,className:"rotate-180"})})]})]})]}):i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-8 text-center text-slate-500 dark:text-slate-400",children:"  "})}function z_({reply:b,onReply:k,depth:w=0}){const P=w>0;return i.jsxs("div",{className:`flex gap-3 ${P?"mr-8 mt-2 relative":""}`,children:[P&&i.jsx("div",{className:"absolute -right-6 top-4 w-4 h-px bg-slate-200"}),i.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 font-bold text-xs shrink-0 border border-slate-100",children:b.user.name.charAt(0)}),i.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-800 p-3 rounded-2xl rounded-tr-none border border-slate-100 dark:border-slate-700/50 shadow-sm",children:[i.jsxs("div",{className:"flex justify-between items-start mb-1",children:[i.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-100 text-xs",children:b.user.name}),i.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500",children:" "})]}),i.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-[13px] leading-relaxed mb-2",children:b.body}),b.image_path&&i.jsx("div",{className:"mb-2 rounded-lg overflow-hidden max-w-[200px] border border-slate-100 dark:border-slate-700",children:i.jsx(tf,{src:`/storage/${b.image_path}`,alt:"Reply",className:"w-full h-auto"})}),i.jsx("div",{className:"flex items-center gap-4",children:i.jsxs("button",{onClick:()=>k(b),className:"text-[10px] font-bold text-slate-500 dark:text-slate-400 flex items-center gap-1 hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors",children:[i.jsx(x2,{size:12})," "]})}),b.replies&&b.replies.length>0&&i.jsx("div",{className:"mt-2 space-y-2 border-r-2 border-slate-100 dark:border-slate-700 pr-2",children:b.replies.map(I=>i.jsx(z_,{reply:I,onReply:k,depth:w+1},I.id))})]})]})}function nS(){const[b,k]=K.useState(""),[w,P]=K.useState([]),[I,R]=K.useState(!0),T=dr();K.useEffect(()=>{c()},[]);const c=async()=>{try{const ke=await Lt.get("/directory");P(ke.data)}catch(ke){console.error("Failed to fetch directory",ke)}finally{R(!1)}},V=ke=>({Landmark:Ow,ShieldCheck:t_,Gavel:Ew,Droplets:Vp,Zap:pl,Globe:rh,Building2:b0})[ke]||b0,W=w.filter(ke=>ke.category==="official"||ke.category==="emergency"),se=w.filter(ke=>ke.category==="company"),ee=W.filter(ke=>ke.name.includes(b)),ne=se.filter(ke=>ke.name.includes(b));return I?i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center",children:i.jsx(Jy,{className:"w-8 h-8 text-emerald-500 animate-spin"})}):i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:"bg-slate-900 dark:bg-slate-950 pb-12 pt-6 px-4 rounded-b-[40px] relative overflow-hidden shadow-2xl transition-colors duration-300",children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl -mr-16 -mt-16"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-blue-500/10 rounded-full -ml-12 -mb-12 blur-3xl"}),i.jsx("header",{className:"relative z-10 flex items-center justify-between mb-8",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>T(-1),className:"w-10 h-10 bg-white/10 dark:bg-slate-800/40 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/20 dark:border-white/5 hover:bg-white/20 transition-all",children:i.jsx("span",{className:"text-xl transform rotate-180 text-white",children:""})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-black text-white",children:" "}),i.jsx("p",{className:"text-slate-400 dark:text-slate-500 text-xs font-medium",children:"  "})]})]})}),i.jsx("div",{className:"relative z-10",children:i.jsxs("div",{className:"relative",children:[i.jsx(ch,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500",size:20}),i.jsx("input",{type:"text",value:b,onChange:ke=>k(ke.target.value),placeholder:"    ...",className:"w-full bg-white/10 dark:bg-slate-900/40 backdrop-blur-md border border-white/10 dark:border-white/5 rounded-2xl py-4 pr-12 pl-4 text-white placeholder-slate-400 focus:bg-white/20 transition-colors focus:outline-none"})]})})]}),i.jsxs("main",{className:"px-5 -mt-8 relative z-20 space-y-8",children:[i.jsxs("section",{className:"space-y-4",children:[i.jsxs("h3",{className:"text-lg font-black text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[i.jsx(b0,{size:20,className:"text-emerald-500"})," "]}),i.jsx("div",{className:"grid grid-cols-1 gap-3",children:ee.map((ke,je)=>{const re=V(ke.icon);return i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-100 dark:border-slate-700/50 shadow-sm hover:shadow-md transition-all flex items-center justify-between group",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 bg-slate-50 dark:bg-slate-900 text-slate-600 dark:text-slate-400 rounded-xl flex items-center justify-center border border-slate-100 dark:border-slate-700 group-hover:bg-emerald-500 group-hover:text-white transition-colors",children:i.jsx(re,{size:24})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-100",children:ke.name}),i.jsx("span",{className:"text-[10px] bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 px-2 py-0.5 rounded-full mt-1 inline-block",children:ke.type})]})]}),i.jsx("a",{href:`tel:${ke.phone}`,className:"w-10 h-10 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 rounded-xl flex items-center justify-center hover:bg-emerald-500 hover:text-white transition-colors",children:i.jsx(tc,{size:20})})]},je)})})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsxs("h3",{className:"text-lg font-black text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[i.jsx(rh,{size:20,className:"text-blue-500"})," "]}),i.jsx("div",{className:"grid grid-cols-1 gap-3",children:ne.map((ke,je)=>i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-100 dark:border-slate-700/50 shadow-sm hover:shadow-md transition-all",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-full flex items-center justify-center",children:i.jsx(rh,{size:20})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-100",children:ke.name}),i.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[[...Array(5)].map((re,H)=>i.jsx(ah,{size:10,className:H<Math.floor(ke.rating||0)?"fill-amber-400 text-amber-400":"text-slate-300 dark:text-slate-600"},H)),i.jsxs("span",{className:"text-[10px] text-slate-400 mr-1",children:["(",ke.rating,")"]})]})]})]}),i.jsx("a",{href:`tel:${ke.phone}`,className:"w-9 h-9 bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-lg flex items-center justify-center hover:bg-blue-600 hover:text-white transition-colors",children:i.jsx(tc,{size:16})})]}),i.jsxs("div",{className:"flex justify-between items-center bg-slate-50 dark:bg-slate-900/50 p-2 rounded-xl text-xs",children:[i.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:[" : ",i.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200",children:ke.metadata?.speed||" "})]}),i.jsx("button",{className:"text-blue-600 dark:text-blue-400 font-bold hover:underline",children:" "})]})]},je))})]}),i.jsx("div",{className:"h-4"})]})]})}const yy={water:{color:"#3b82f6",label:" "},electricity:{color:"#eab308",label:""},sewage:{color:"#78350f",label:" "},phone:{color:"#10b981",label:""}},C0={water_tank:"",pump:"",valve:"",transformer:"",pole:"",generator:"",manhole:"",exchange:"",cabinet:""};function aS(){const b=K.useRef(null),k=K.useRef(null),w=dr(),[P,I]=K.useState(""),[R,T]=K.useState(!1),[c,V]=K.useState({heatmap:!0,water:!1,electricity:!1,sewage:!1,phone:!1,crowdElectricity:!0,crowdWater:!0}),[W,se]=K.useState([]),[ee,ne]=K.useState([]),[ke,je]=K.useState(0),[re,H]=K.useState(null),[Ze,Pe]=K.useState({nodes:[],lines:[]}),[ze,lt]=K.useState({}),Nt=K.useMemo(()=>{const Me=new Date;return Me.setDate(Me.getDate()+ke),Me.toISOString().split("T")[0]},[ke]),zt=K.useMemo(()=>{if(ke===0)return"";if(ke===-1)return"";const Me=new Date;return Me.setDate(Me.getDate()+ke),Me.toLocaleDateString("ar-SA",{weekday:"long",day:"numeric",month:"short"})},[ke]);K.useEffect(()=>{k.current||b.current&&(console.log("Initializing Mobile Map..."),k.current=new Hc.Map({container:b.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap"}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:[36.236,33.456],zoom:14,pitch:0,attributionControl:!1}),k.current.on("load",()=>{k.current&&(console.log("Mobile Map Loaded"),k.current.addSource("population",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),k.current.addLayer({id:"population-heatmap",type:"heatmap",source:"population",maxzoom:16,paint:{"heatmap-weight":["interpolate",["linear"],["get","intensity"],0,0,1,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,15,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(220,20,60)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,15,25],"heatmap-opacity":.6},layout:{visibility:c.heatmap?"visible":"none"}}),Lt.get("/infrastructure").then(Me=>{const Ct=Me.data,it=k.current;it&&(["water","electricity","sewage","phone"].forEach(Tt=>{const nt=Ct.lines.filter(Ye=>Ye.type===Tt),ht=Ct.nodes.filter(Ye=>Tt==="sewage"&&Ye.type==="manhole"||Tt==="electricity"&&(Ye.type==="transformer"||Ye.type==="pole"||Ye.type==="generator")||Tt==="water"&&(Ye.type==="pump"||Ye.type==="water_tank"||Ye.type==="valve")||Tt==="phone"&&(Ye.type==="exchange"||Ye.type==="cabinet")),pt={type:"FeatureCollection",features:nt.map(Ye=>({type:"Feature",geometry:{type:"LineString",coordinates:Ye.coordinates},properties:{id:Ye.id,type:Ye.type,serial_number:Ye.serial_number}}))};it.addSource(`infra-${Tt}-source`,{type:"geojson",data:pt});const Ce=yy[Tt];if(it.addLayer({id:`infra-${Tt}`,type:"line",source:`infra-${Tt}-source`,layout:{"line-join":"round","line-cap":"round",visibility:"none"},paint:{"line-color":Ce.color,"line-width":3,"line-opacity":.8}}),ht.length>0){const Ye={type:"FeatureCollection",features:ht.map(qt=>({type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(qt.longitude),parseFloat(qt.latitude)]},properties:{id:qt.id,type:qt.type,serial_number:qt.serial_number}}))};it.addSource(`infra-${Tt}-nodes`,{type:"geojson",data:Ye}),it.addLayer({id:`infra-${Tt}-nodes-bg`,type:"circle",source:`infra-${Tt}-nodes`,paint:{"circle-radius":12,"circle-color":"#fff","circle-opacity":.8,"circle-stroke-width":1,"circle-stroke-color":Ce.color},layout:{visibility:"none"}}),it.addLayer({id:`infra-${Tt}-nodes-layer`,type:"symbol",source:`infra-${Tt}-nodes`,layout:{visibility:"none","text-field":["match",["get","type"],...Object.entries(C0).flat(),""],"text-size":14,"text-allow-overlap":!0,"icon-allow-overlap":!0}}),it.on("click",`infra-${Tt}-nodes-layer`,qt=>{if(qt.features&&qt.features[0]){const Yt=qt.features[0].properties,wt=qt.features[0].geometry.coordinates;H({...Yt,lng:wt[0],lat:wt[1],sector:Tt})}}),it.on("mouseenter",`infra-${Tt}-nodes-layer`,()=>{it.getCanvas().style.cursor="pointer"}),it.on("mouseleave",`infra-${Tt}-nodes-layer`,()=>{it.getCanvas().style.cursor=""})}}),Pe(Ct),mt(Ct,{}))}).catch(Me=>console.error("Failed to fetch infra",Me)),["electricity","water"].forEach(Me=>{k.current&&(k.current.addSource(`crowd-${Me}-source`,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),k.current.addLayer({id:`crowd-${Me}-fill`,type:"fill",source:`crowd-${Me}-source`,layout:{visibility:"visible"},paint:{"fill-color":["match",["get","status"],"available","#10b981","unstable","#f59e0b","cutoff","#ef4444","#94a3b8"],"fill-opacity":.4}}),k.current.addLayer({id:`crowd-${Me}-circle`,type:"circle",source:`crowd-${Me}-source`,layout:{visibility:"visible"},paint:{"circle-radius":14,"circle-color":["match",["get","status"],"available","#10b981","unstable","#f59e0b","cutoff","#ef4444","#94a3b8"],"circle-stroke-width":2,"circle-stroke-color":"#fff"}}),k.current.addLayer({id:`crowd-${Me}-symbol`,type:"symbol",source:`crowd-${Me}-source`,layout:{visibility:"visible","text-field":["concat",["get","score"],"%"],"text-size":10},paint:{"text-color":"#fff","text-halo-color":"#000","text-halo-width":1}}))}))}))},[]),K.useEffect(()=>{if(!k.current)return;const Me=k.current;Lt.get(`/analytics/heatmap?date=${Nt}`).then(Ct=>{const it=Me.getSource("population");it&&it.setData({type:"FeatureCollection",features:Ct.data.map(Tt=>({type:"Feature",geometry:{type:"Point",coordinates:[Tt[1],Tt[0]]},properties:{intensity:Tt[2]}}))})}),["electricity","water"].forEach(Ct=>{Lt.get(`/infrastructure/status-heatmap?type=${Ct}&date=${Nt}`).then(it=>{const Tt=Me.getSource(`crowd-${Ct}-source`);Tt&&(Tt.setData(it.data),lt(nt=>({...nt,[Ct]:it.data})))})})},[Nt]),K.useEffect(()=>{!k.current||!k.current.isStyleLoaded()||(k.current.getLayer("population-heatmap")&&k.current.setLayoutProperty("population-heatmap","visibility",c.heatmap?"visible":"none"),["water","electricity","sewage","phone"].forEach(Me=>{const it=c[Me]?"visible":"none";k.current?.getLayer(`infra-${Me}`)&&k.current.setLayoutProperty(`infra-${Me}`,"visibility",it),k.current?.getLayer(`infra-${Me}-nodes-layer`)&&k.current.setLayoutProperty(`infra-${Me}-nodes-layer`,"visibility",it)}),["electricity","water"].forEach(Me=>{const it=c[Me==="electricity"?"crowdElectricity":"crowdWater"]?"visible":"none";k.current?.getLayer(`crowd-${Me}-fill`)&&k.current.setLayoutProperty(`crowd-${Me}-fill`,"visibility",it),k.current?.getLayer(`crowd-${Me}-symbol`)&&k.current.setLayoutProperty(`crowd-${Me}-symbol`,"visibility",it),k.current?.getLayer(`crowd-${Me}-circle`)&&k.current.setLayoutProperty(`crowd-${Me}-circle`,"visibility",it)}),mt(Ze,ze))},[c,Ze,ze]),K.useEffect(()=>{k.current&&Kt()},[k.current]),K.useEffect(()=>{Lt.get("/directory").then(Me=>{const Ct=Me.data.filter(it=>{const Tt=parseFloat(it.latitude),nt=parseFloat(it.longitude);return!isNaN(Tt)&&!isNaN(nt)}).map(it=>({id:it.id,name:it.name,type:it.category,lat:parseFloat(it.latitude),lng:parseFloat(it.longitude),emoji:Ft(it.category)}));ne(Ct),se(Ct)}).catch(Me=>console.error("Failed to fetch directory",Me))},[]);const Ft=Me=>({pharmacy:"",health:"",government:"",park:"",service:"",food:"",education:"",transport:""})[Me]||"";K.useEffect(()=>{const Me=ee.filter(Ct=>Ct.name.includes(P)||Ct.type.includes(P));se(Me)},[P,ee]);const Vt=K.useRef([]),Zt=K.useRef([]),mt=(Me,Ct)=>{k.current&&(Zt.current.forEach(it=>it.remove()),Zt.current=[],Me.nodes.forEach(it=>{const Tt=fr(it.type);if(!Tt||!c[Tt])return;const nt=it.status==="damaged"||it.status==="unsafe",ht=it.status==="maintenance";if(nt||ht){const pt=document.createElement("div");pt.className=`status-bubble ${nt?"critical":"warning"}`,pt.innerHTML=nt?"":"",pt.onclick=Ye=>{Ye.stopPropagation(),k.current?.flyTo({center:[parseFloat(it.longitude),parseFloat(it.latitude)],zoom:18}),H({...it,lng:it.longitude,lat:it.latitude,sector:Tt})};const Ce=new Hc.Marker({element:pt,anchor:"bottom-left"}).setLngLat([parseFloat(it.longitude),parseFloat(it.latitude)]).setOffset([5,-20]).addTo(k.current);Zt.current.push(Ce)}}),["electricity","water"].forEach(it=>{if(!c[it==="electricity"?"crowdElectricity":"crowdWater"])return;(Ct[it]?.features||[]).forEach(ht=>{if(ht.properties.status==="cutoff"&&ht.geometry.type==="Point"){const pt=document.createElement("div");pt.className="status-bubble pb-1 pt-1",pt.innerHTML=it==="electricity"?"":"",pt.style.borderColor="#ef4444",pt.style.animationDelay=`${Math.random()*2}s`,pt.onclick=Ye=>{Ye.stopPropagation(),k.current?.flyTo({center:ht.geometry.coordinates,zoom:16})};const Ce=new Hc.Marker({element:pt,anchor:"bottom-left"}).setLngLat(ht.geometry.coordinates).addTo(k.current);Zt.current.push(Ce)}})}))},fr=Me=>["manhole"].includes(Me)?"sewage":["transformer","pole","generator"].includes(Me)?"electricity":["pump","water_tank","valve"].includes(Me)?"water":["exchange","cabinet"].includes(Me)?"phone":null;K.useEffect(()=>{k.current&&(Vt.current.forEach(Me=>Me.remove()),Vt.current=[],W.forEach(Me=>{const Ct=document.createElement("div");Ct.className="flex flex-col items-center justify-center animate-bounce-short cursor-pointer",Ct.innerHTML=`
                <div class="w-10 h-10 bg-white dark:bg-slate-800 rounded-full flex items-center justify-center text-xl shadow-lg border-2 border-emerald-500 transform transition hover:scale-110">
                    ${Me.emoji}
                </div>
                <div class="bg-white/90 dark:bg-slate-800/90 backdrop-blur px-2 py-0.5 rounded text-[10px] font-bold shadow-sm mt-1 whitespace-nowrap text-slate-800 dark:text-slate-100 border border-slate-100 dark:border-slate-700/50">
                    ${Me.name}
                </div>
            `,Ct.onclick=()=>{k.current?.flyTo({center:[Me.lng,Me.lat],zoom:17})};const it=new Hc.Marker({element:Ct}).setLngLat([Me.lng,Me.lat]).addTo(k.current);Vt.current.push(it)}))},[W,k.current]);const Kt=async()=>{try{console.log("Locating user...");const Me=await I_.getCurrentPosition();if(Me.coords){const{latitude:Ct,longitude:it}=Me.coords;if(console.log("User located:",Ct,it),k.current){const Tt=document.getElementById("user-location-marker");Tt&&Tt.remove();const nt=document.createElement("div");nt.id="user-location-marker",nt.className="w-4 h-4 bg-blue-500 rounded-full border-2 border-white dark:border-slate-100 shadow-lg pulse-ring",new Hc.Marker({element:nt}).setLngLat([it,Ct]).addTo(k.current),k.current.flyTo({center:[it,Ct],zoom:16})}}else Me.error&&(console.error("Location error:",Me.error),alert(Me.error))}catch(Me){console.error("Error getting location",Me),alert("   ")}},Wt=Me=>{const Ct=!c[Me];if(V(it=>({...it,[Me]:Ct})),k.current){const it=Ct?"visible":"none";k.current.getLayer(`infra-${Me}`)&&k.current.setLayoutProperty(`infra-${Me}`,"visibility",it),k.current.getLayer(`infra-${Me}-nodes-layer`)&&k.current.setLayoutProperty(`infra-${Me}-nodes-layer`,"visibility",it),k.current.getLayer(`infra-${Me}-nodes-bg`)&&k.current.setLayoutProperty(`infra-${Me}-nodes-bg`,"visibility",it)}};return i.jsxs("div",{className:"fixed inset-0 w-full h-full bg-slate-50 dark:bg-slate-900 flex flex-col z-0",children:[i.jsxs("div",{className:"relative w-full h-full",children:[i.jsx("div",{ref:b,className:"absolute inset-0 z-0 bg-slate-200 dark:bg-slate-800"}),i.jsx("div",{className:"absolute top-0 left-0 right-0 z-10 pt-12 px-4 pointer-events-none bg-gradient-to-b from-white/80 to-transparent dark:from-slate-900/80 pb-6",children:i.jsxs("div",{className:"flex flex-col gap-3 pointer-events-auto max-w-lg mx-auto w-full",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("button",{onClick:()=>w(-1),className:"w-10 h-10 bg-white/90 dark:bg-slate-800/90 backdrop-blur-md rounded-full flex items-center justify-center text-slate-600 dark:text-slate-300 shadow-lg border border-slate-200 dark:border-slate-700 active:scale-95 transition",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsx("div",{className:"bg-white/90 dark:bg-slate-800/90 backdrop-blur-md px-4 py-2 rounded-full shadow-lg border border-slate-200 dark:border-slate-700",children:i.jsx("h1",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm",children:" "})}),i.jsx("div",{className:"w-10"})," "]}),i.jsxs("div",{className:"bg-white/95 dark:bg-slate-800/95 backdrop-blur-md p-3 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 flex items-center gap-3 transition-all focus-within:ring-2 ring-emerald-500/20",children:[i.jsx("span",{className:"text-slate-400 dark:text-slate-500",children:""}),i.jsx("input",{type:"text",placeholder:"   ...",className:"bg-transparent border-none text-sm text-slate-800 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 w-full focus:ring-0 p-0 outline-none",value:P,onChange:Me=>I(Me.target.value)}),P&&i.jsx("button",{onClick:()=>I(""),className:"text-slate-400 hover:text-red-500 transition-colors",children:i.jsx(ad,{size:16})})]})]})}),i.jsxs("div",{className:"absolute bottom-48 left-4 z-10 flex flex-col gap-3 pointer-events-auto pb-safe",children:[i.jsx("button",{onClick:()=>T(!0),className:`w-12 h-12 rounded-2xl flex items-center justify-center shadow-premium active:scale-95 transition-transform border ${R?"bg-emerald-600 dark:bg-emerald-500 text-white border-emerald-700 dark:border-emerald-400":"bg-white dark:bg-slate-800 text-emerald-600 dark:text-emerald-400 border-slate-100 dark:border-slate-700"}`,children:i.jsx(cm,{size:22})}),i.jsx("button",{onClick:Kt,className:"w-12 h-12 bg-white dark:bg-slate-800 text-blue-600 dark:text-blue-400 rounded-2xl flex items-center justify-center shadow-premium active:scale-95 transition-transform border border-slate-100 dark:border-slate-700",children:i.jsx(Wy,{size:24})})]}),i.jsx("div",{className:"absolute bottom-24 left-6 right-6 z-40",children:i.jsxs("div",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md p-4 rounded-3xl border border-white/20 shadow-xl",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2 px-1",children:[i.jsxs("h4",{className:"flex items-center gap-1.5 text-[10px] font-black text-slate-500 uppercase tracking-widest",children:[i.jsx(oi,{size:12,className:"text-emerald-500"})," "]}),i.jsx("span",{className:"text-[10px] font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/30 px-2 py-0.5 rounded-full",children:zt})]}),i.jsx("input",{type:"range",min:"-7",max:"0",step:"1",value:ke,onChange:Me=>je(parseInt(Me.target.value)),className:"w-full h-1.5 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500 mb-1"}),i.jsxs("div",{className:"flex justify-between px-1",children:[i.jsx("span",{className:"text-[9px] text-slate-400 font-bold",children:" "}),i.jsx("span",{className:"text-[9px] text-slate-400 font-bold",children:""})]})]})})]}),R&&i.jsx("div",{className:"absolute inset-0 z-50 flex items-end justify-center bg-black/40 backdrop-blur-sm",onClick:()=>T(!1),children:i.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-md rounded-t-3xl shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.3)] p-6 animate-in slide-in-from-bottom duration-300 mb-safe",onClick:Me=>Me.stopPropagation(),children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[i.jsx("span",{className:"w-8 h-8 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg flex items-center justify-center text-emerald-600 dark:text-emerald-400",children:i.jsx(cm,{size:18})})," "]}),i.jsx("button",{onClick:()=>T(!1),className:"bg-slate-50 dark:bg-slate-800 p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:i.jsx(ad,{size:20})})]}),i.jsxs("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto pr-1 custom-scrollbar overscroll-contain pb-10 touch-pan-y",onTouchStart:Me=>Me.stopPropagation(),children:[i.jsx("div",{className:"p-3 rounded-2xl border border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/50",children:i.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"checkbox",checked:c.heatmap,onChange:()=>Wt("heatmap"),className:"peer sr-only"}),i.jsx("div",{className:"w-10 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-emerald-300 dark:peer-focus:ring-emerald-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-emerald-600"})]}),i.jsxs("div",{className:"flex-1 text-right",children:[i.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 text-sm block",children:" "}),i.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"   "})]}),i.jsx("div",{className:"h-6 w-6 rounded-lg bg-gradient-to-tr from-blue-300 to-red-500 shadow-sm"})]})}),i.jsx("div",{className:"text-xs font-bold text-slate-400 dark:text-slate-600 mt-4 mb-2 pr-2 text-right uppercase tracking-wider",children:" "}),[{id:"water",label:" ",color:"bg-blue-500",sub:"  "},{id:"electricity",label:"",color:"bg-yellow-500",sub:" "},{id:"sewage",label:" ",color:"bg-orange-800",sub:" "},{id:"phone",label:"",color:"bg-emerald-500",sub:" "}].map(Me=>i.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-2xl border border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-800/50 active:bg-slate-50 dark:active:bg-slate-800 transition cursor-pointer hover:border-emerald-200 dark:hover:border-emerald-800/50",children:[i.jsx("div",{className:"relative item-center flex",children:i.jsx("input",{type:"checkbox",checked:c[Me.id],onChange:()=>Wt(Me.id),className:"w-5 h-5 rounded border-slate-300 dark:border-slate-700 text-emerald-600 focus:ring-emerald-500 transition-all"})}),i.jsxs("div",{className:"flex-1 text-right",children:[i.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 text-sm block",children:Me.label}),i.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:Me.sub})]}),i.jsx("div",{className:`w-2 h-8 rounded-full ${Me.color} opacity-80 shadow-sm`})]},Me.id)),i.jsx("div",{className:"text-xs font-bold text-slate-400 dark:text-slate-600 mt-4 mb-2 pr-2 text-right uppercase tracking-wider",children:"  ()"}),[{id:"crowdElectricity",label:" ()",color:"bg-yellow-500",sub:"  "},{id:"crowdWater",label:" ()",color:"bg-blue-500",sub:"  "}].map(Me=>i.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-2xl border border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-800/50 active:bg-slate-50 dark:active:bg-slate-800 transition cursor-pointer hover:border-emerald-200 dark:hover:border-emerald-800/50",children:[i.jsx("div",{className:"relative item-center flex",children:i.jsx("input",{type:"checkbox",checked:c[Me.id],onChange:()=>Wt(Me.id),className:"w-5 h-5 rounded border-slate-300 dark:border-slate-700 text-emerald-600 focus:ring-emerald-500 transition-all"})}),i.jsxs("div",{className:"flex-1 text-right",children:[i.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200 text-sm block",children:Me.label}),i.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:Me.sub})]}),i.jsx("div",{className:`w-2 h-8 rounded-full ${Me.color} opacity-80 shadow-sm`})]},Me.id))]})]})}),re&&i.jsx("div",{className:"absolute inset-0 z-[60] flex items-end justify-center bg-black/40 backdrop-blur-sm px-4 pb-20",onClick:()=>H(null),children:i.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-3xl shadow-2xl p-6 animate-in slide-in-from-bottom duration-300",onClick:Me=>Me.stopPropagation(),children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-50 dark:bg-slate-800 flex items-center justify-center text-2xl shadow-sm border border-slate-100 dark:border-slate-700",children:C0[re.type]||""}),i.jsxs("div",{className:"text-right",children:[i.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:re.type==="water_tank"?" ":re.type==="transformer"?" ":re.type==="pole"?" ":re.type==="pump"?" ":re.type==="valve"?"":re.type==="generator"?"":re.type==="manhole"?"":re.type}),i.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:[yy[re.sector]?.label," | ",re.serial_number||`ID: ${re.id}`]})]})]}),i.jsx("button",{onClick:()=>H(null),className:"p-2 bg-slate-50 dark:bg-slate-800 rounded-full text-slate-400",children:i.jsx(ad,{size:18})})]}),i.jsxs("div",{className:"space-y-3 mb-6",children:[i.jsxs("div",{className:"flex justify-between items-center text-sm p-3 bg-slate-50 dark:bg-slate-800 rounded-xl",children:[i.jsx("span",{className:"text-slate-500",children:""}),i.jsx("span",{className:"font-bold text-emerald-600",children:"  "})]}),re.meta&&i.jsxs("div",{className:"text-sm p-3 bg-slate-50 dark:bg-slate-800 rounded-xl text-right",children:[i.jsx("span",{className:"text-slate-500 block mb-1",children:" "}),i.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:typeof re.meta=="string"?re.meta:JSON.stringify(re.meta)})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx("button",{onClick:()=>H(null),className:"py-3 px-4 rounded-2xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-bold text-sm transition-active active:scale-95",children:""}),i.jsx("button",{onClick:()=>{w("/add-report",{state:{prefill:{type:"infrastructure",title:`  ${C0[re.type]||""} ${re.type}`,latitude:re.lat,longitude:re.lng,infrastructure_node_id:re.sector!=="line"?re.id:null,infrastructure_line_id:re.sector==="line"?re.id:null,serial_number:re.serial_number}}})},className:"py-3 px-4 rounded-2xl bg-emerald-600 text-white font-bold text-sm shadow-lg shadow-emerald-500/30 transition-active active:scale-95",children:"  "})]})]})})]})}function iS(){const b=dr(),[k,w]=K.useState(!0),[P,I]=K.useState([]),R=async()=>{try{const se=await Lt.get("/api/volunteering");I(se.data)}catch(se){console.error("Failed to fetch opportunities:",se)}finally{w(!1)}},{isRefreshing:T,containerRef:c,indicatorRef:V,handlers:W}=hi(R);return K.useEffect(()=>{R()},[]),i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...W,children:i.jsxs(pi,{isRefreshing:T,containerRef:c,indicatorRef:V,children:[i.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30 px-4 py-4 shadow-sm flex items-center justify-between transition-colors duration-300",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>b(-1),className:"w-10 h-10 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl flex items-center justify-center text-slate-600 dark:text-slate-400 transition-colors border border-slate-200 dark:border-slate-700",children:i.jsx(Xx,{size:24,className:"rotate-180"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:" "}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-medium",children:"   "})]})]})}),i.jsxs("main",{className:"px-4 py-4 space-y-6",children:[i.jsxs("div",{className:"relative rounded-3xl overflow-hidden shadow-premium animate-fade-in-up",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-800 to-teal-600 mix-blend-multiply opacity-90 dark:opacity-80"}),i.jsx("img",{src:"https://images.unsplash.com/photo-1559027615-cd4628902d4a?w=800&q=80",className:"w-full h-48 object-cover",alt:"Volunteer Hero"}),i.jsxs("div",{className:"absolute inset-0 p-6 flex flex-col justify-end text-white",children:[i.jsx("div",{className:"w-10 h-10 bg-white/20 dark:bg-slate-900/40 backdrop-blur-md rounded-xl flex items-center justify-center mb-3 border border-white/20",children:i.jsx(Yc,{className:"text-white fill-white",size:20})}),i.jsx("h2",{className:"text-2xl font-black mb-1",children:"  "}),i.jsx("p",{className:"text-sm text-emerald-100 opacity-90 max-w-[80%]",children:"   1500       ."})]})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-200 dark:border-slate-700 shadow-premium flex items-center justify-between animate-fade-in-up",style:{animationDelay:"100ms"},children:[i.jsxs("div",{className:"text-center flex-1 border-l border-slate-100 dark:border-slate-700 last:border-0 px-2",children:[i.jsx("div",{className:"text-xl font-bold text-slate-800 dark:text-slate-100",children:"125"}),i.jsx("div",{className:"text-[10px] font-medium text-slate-500 dark:text-slate-400",children:""})]}),i.jsxs("div",{className:"text-center flex-1 border-l border-slate-100 dark:border-slate-700 last:border-0 px-2",children:[i.jsx("div",{className:"text-xl font-bold text-emerald-600 dark:text-emerald-400",children:P.length}),i.jsx("div",{className:"text-[10px] font-medium text-slate-500 dark:text-slate-400",children:""})]}),i.jsxs("div",{className:"text-center flex-1 px-2",children:[i.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:"850"}),i.jsx("div",{className:"text-[10px] font-medium text-slate-500 dark:text-slate-400",children:""})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 text-sm px-1",children:"  "}),P.length===0&&!k&&i.jsx("div",{className:"text-center py-8 text-slate-500",children:"    "}),P.map((se,ee)=>i.jsx("button",{onClick:()=>b(`/volunteering/${se.id}`,{state:{opp:se}}),className:"w-full bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-premium overflow-hidden hover:border-emerald-200 dark:hover:border-emerald-800 transition-all group animate-fade-in-up active:scale-[0.99] text-right",style:{animationDelay:`${(ee+2)*100}ms`},children:i.jsxs("div",{className:"p-4",children:[i.jsxs("div",{className:"flex gap-4 items-start mb-3",children:[i.jsx("div",{className:"w-16 h-16 rounded-xl bg-slate-100 flex-shrink-0 flex items-center justify-center overflow-hidden border border-slate-100 relative group-hover:shadow-md transition-all",children:se.image?i.jsx("img",{src:se.image,alt:se.title,className:"w-full h-full object-cover"}):i.jsx("span",{className:"text-2xl",children:""})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex justify-between items-start mb-1",children:[i.jsx("h3",{className:"font-bold text-sm text-slate-800 dark:text-slate-100 line-clamp-2 group-hover:text-emerald-700 dark:group-hover:text-emerald-400 transition-colors leading-relaxed",children:se.title}),i.jsxs("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-full border ${se.spots_filled>=se.spots_total?"bg-rose-50 text-rose-500 border-rose-100":"bg-emerald-50 text-emerald-500 border-emerald-100"}`,children:[se.spots_filled,"/",se.spots_total]})]}),i.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1.5 font-medium mt-1",children:[i.jsx(Jn,{size:12,className:"text-slate-400 dark:text-slate-500"}),i.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:se.organization||""}),i.jsx("span",{className:"w-1 h-1 bg-slate-300 dark:bg-slate-600 rounded-full"}),i.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:new Date(se.start_date||Date.now()).toLocaleDateString("ar-EG")})]})]})]}),i.jsxs("div",{className:"flex items-center justify-between border-t border-slate-50 dark:border-slate-700/50 pt-3 mt-1",children:[i.jsx("div",{className:"flex items-center gap-2",children:se.tags&&se.tags.length>0&&se.tags.map(ne=>i.jsx("span",{className:"bg-slate-50 dark:bg-slate-900 text-slate-500 dark:text-slate-400 px-2 py-1 rounded-lg text-[10px] font-bold border border-slate-100 dark:border-slate-700",children:ne},ne))}),i.jsxs("div",{className:"flex items-center gap-1 text-slate-400 dark:text-slate-500 text-[10px] font-medium group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors",children:[i.jsx("span",{children:""}),i.jsx(Xx,{size:14,className:"rotate-180"})]})]})]})},se.id))]}),i.jsx("div",{className:"text-center py-8",children:i.jsx("button",{className:"text-emerald-600 dark:text-emerald-400 text-xs font-bold hover:underline bg-emerald-50 dark:bg-emerald-900/30 px-4 py-2 rounded-full border border-emerald-100 dark:border-emerald-800",children:"     "})})]})]})})}function oS(){const{id:b}=di(),k=dr(),w=yo(),[P,I]=K.useState(w.state?.opp||null),[R,T]=K.useState(!w.state?.opp),[c,V]=K.useState(!1),W=async()=>{P||T(!0);try{const re=await Lt.get(`/api/volunteering/${b}`);I(re.data)}catch(re){console.error(re),Kr("  ","error")}finally{T(!1)}},se=async()=>{if(!localStorage.getItem("token")){Kr("   ","error"),k("/login");return}const H=localStorage.getItem("user"),Ze=H?JSON.parse(H):{};V(!0);try{await Lt.post(`/api/volunteering/${b}/apply`,{full_name:Ze?.name||"Unknown",phone_number:Ze?.phone||"0000000000",availability:"Flexible"}),Kr("   !   ","success")}catch(Pe){console.error(Pe),Pe.response?.status===400&&Pe.response?.data?.message==="Already applied"?Kr("     ","info"):Kr(" .   ","error")}finally{V(!1)}},{isRefreshing:ee,containerRef:ne,indicatorRef:ke,handlers:je}=hi(W);return K.useEffect(()=>{W()},[b]),R?i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center transition-colors duration-300",children:i.jsx("div",{className:"w-10 h-10 border-4 border-emerald-200 dark:border-emerald-900/40 border-t-emerald-600 dark:border-t-emerald-400 rounded-full animate-spin"})}):P?i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-24 transition-colors duration-300",dir:"rtl",...je,children:i.jsxs(pi,{isRefreshing:ee,containerRef:ne,indicatorRef:ke,children:[i.jsxs("div",{className:"relative h-72 w-full",children:[i.jsx("img",{src:P.image,alt:P.title,className:"w-full h-full object-cover"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/40 to-transparent"}),i.jsxs("div",{className:"absolute top-0 w-full p-4 flex items-center justify-between z-10",children:[i.jsx("button",{onClick:()=>k(-1),className:"w-10 h-10 bg-black/20 dark:bg-slate-900/40 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/10 dark:border-white/5 hover:bg-black/30 transition shadow-lg",children:i.jsx(id,{size:24})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{className:"w-10 h-10 bg-black/20 dark:bg-slate-900/40 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/10 dark:border-white/5 hover:bg-black/30 transition shadow-lg",children:i.jsx(Yp,{size:20})}),i.jsx("button",{className:"w-10 h-10 bg-black/20 dark:bg-slate-900/40 backdrop-blur-md rounded-xl flex items-center justify-center text-white border border-white/10 dark:border-white/5 hover:bg-black/30 transition shadow-lg",children:i.jsx(Yc,{size:20})})]})]}),i.jsxs("div",{className:"absolute bottom-0 w-full p-6 text-white animate-slide-up",children:[i.jsx("div",{className:"flex items-center gap-2 mb-3",children:P.tags.map(re=>i.jsx("span",{className:"bg-emerald-500/20 backdrop-blur-md border border-emerald-500/30 text-emerald-100 px-3 py-1 rounded-lg text-[10px] font-bold",children:re},re))}),i.jsx("h1",{className:"text-2xl font-black leading-tight mb-2 drop-shadow-md",children:P.title}),i.jsxs("p",{className:"text-sm text-slate-300 font-medium flex items-center gap-2",children:[i.jsx(sh,{size:14,className:"text-emerald-400"}),": ",P.org]})]})]}),i.jsxs("main",{className:"px-4 -mt-6 relative z-10 space-y-6",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-premium border border-slate-100 dark:border-slate-700/50 flex items-center justify-between animate-fade-in-up",children:[i.jsxs("div",{className:"text-center flex-1 border-l border-slate-100 dark:border-slate-700 px-2",children:[i.jsx(hl,{size:20,className:"text-blue-500 dark:text-blue-400 mx-auto mb-1"}),i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold mb-0.5",children:""}),i.jsx("p",{className:"text-xs font-bold text-slate-800 dark:text-slate-100",children:P.date})]}),i.jsxs("div",{className:"text-center flex-1 border-l border-slate-100 dark:border-slate-700 px-2",children:[i.jsx(oi,{size:20,className:"text-amber-500 dark:text-amber-400 mx-auto mb-1"}),i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold mb-0.5",children:""}),i.jsx("p",{className:"text-xs font-bold text-slate-800 dark:text-slate-100",children:P.duration})]}),i.jsxs("div",{className:"text-center flex-1 px-2",children:[i.jsx(Jn,{size:20,className:"text-emerald-500 dark:text-emerald-400 mx-auto mb-1"}),i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold mb-0.5",children:""}),i.jsxs("p",{className:"text-xs font-bold text-slate-800 dark:text-slate-100",children:[P.filled,"/",P.spots]})]})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700/50 shadow-premium animate-fade-in-up",style:{animationDelay:"100ms"},children:[i.jsxs("h3",{className:"font-bold text-slate-900 dark:text-slate-100 mb-3 text-sm flex items-center gap-2",children:[i.jsx("div",{className:"w-1 h-4 bg-emerald-500 dark:bg-emerald-400 rounded-full"})," "]}),i.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed text-justify opacity-90",children:P.description}),i.jsx("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-slate-700/50",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-slate-100 dark:bg-slate-900 rounded-full flex items-center justify-center text-slate-400 dark:text-slate-500",children:i.jsx(qn,{size:20})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-bold text-slate-800 dark:text-slate-200",children:P.location}),i.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"   "})]})]})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 animate-fade-in-up",style:{animationDelay:"200ms"},children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-5 border border-slate-200 dark:border-slate-700/50 shadow-premium",children:[i.jsxs("h3",{className:"font-bold text-slate-900 dark:text-slate-100 mb-3 text-sm flex items-center gap-2",children:[i.jsx(lm,{size:16,className:"text-blue-500 dark:text-blue-400"}),""]}),i.jsx("ul",{className:"space-y-2",children:P.requirements.map((re,H)=>i.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-start gap-2 leading-relaxed",children:[i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-400 mt-1.5 shrink-0"}),re]},H))})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-5 border border-slate-200 dark:border-slate-700/50 shadow-premium",children:[i.jsxs("h3",{className:"font-bold text-slate-900 dark:text-slate-100 mb-3 text-sm flex items-center gap-2",children:[i.jsx(Kf,{size:16,className:"text-amber-500 dark:text-amber-400"}),""]}),i.jsx("ul",{className:"space-y-2",children:P.benefits.map((re,H)=>i.jsxs("li",{className:"text-xs text-slate-600 dark:text-slate-400 flex items-start gap-2 leading-relaxed",children:[i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-400 mt-1.5 shrink-0"}),re]},H))})]})]}),i.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/10 rounded-2xl p-4 border border-indigo-100 dark:border-indigo-900/30 flex items-center justify-between mb-20 animate-fade-in-up",style:{animationDelay:"300ms"},children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-white dark:bg-slate-800 rounded-full flex items-center justify-center text-indigo-500 dark:text-indigo-400 shadow-sm",children:i.jsx(tp,{size:20})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-indigo-400 dark:text-indigo-500 font-bold mb-0.5",children:" "}),i.jsx("p",{className:"text-xs font-bold text-indigo-900 dark:text-indigo-100",children:P.coordinator.name})]})]}),i.jsx("button",{className:"w-8 h-8 bg-indigo-100 dark:bg-indigo-900/40 text-indigo-600 dark:text-indigo-400 rounded-lg flex items-center justify-center hover:bg-indigo-200 dark:hover:bg-indigo-900 transition",children:i.jsx(tc,{size:16})})]})]}),i.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 p-4 pb-8 z-20 shadow-premium-reverse animate-slide-up transition-colors duration-300",children:i.jsxs("div",{className:"flex gap-3",children:[i.jsx("button",{onClick:se,disabled:c||P.spots_total&&P.spots_filled>=P.spots_total,className:"flex-1 bg-emerald-600 dark:bg-emerald-500 text-white py-3.5 rounded-xl font-bold flex items-center justify-center gap-2 shadow-lg shadow-emerald-500/20 active:scale-[0.98] transition-all disabled:opacity-50 disabled:grayscale",children:c?i.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"text-lg",children:""}),P.spots_total&&P.spots_filled>=P.spots_total?" ":" "]})}),i.jsxs("div",{className:"flex flex-col items-center justify-center px-4 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700",children:[i.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold",children:""}),i.jsx("span",{className:"text-sm font-black text-slate-800 dark:text-slate-100",children:P.spots_total?P.spots_total-P.spots_filled:"-"})]})]})})]})}):null}function lS(){const[b,k]=K.useState([]),[w,P]=K.useState({electricity:0,water:"0%"}),[I,R]=K.useState(null),[T,c]=K.useState(!0),[V,W]=K.useState(!1),se=dr(),[ee,ne]=K.useState({service_type:"",status:"available",arrival_time:"",departure_time:"",quality:"",notes:""}),ke=K.useCallback(async()=>{try{const lt=await Lt.get("/portal/service-logs/status");k(lt.data.userLogs||[]),P(lt.data.communityStats||{electricity:0,water:"0%"})}catch{P({electricity:67,water:"45%"})}finally{c(!1)}},[]);K.useEffect(()=>{ke()},[ke]);const{isRefreshing:je,pullMoveY:re,handlers:H}=hi(ke),Ze=async lt=>{W(!0);try{await Lt.post("/portal/service-logs",{...ee,service_type:lt}),k([...b,lt]),R(null),ne({service_type:"",status:"available",arrival_time:"",departure_time:"",quality:"",notes:""})}catch{k([...b,lt]),R(null)}finally{W(!1)}},Pe=b.includes("electricity"),ze=b.includes("water");return i.jsx("div",{className:"min-h-screen bg-slate-50 pb-20",dir:"rtl",...H,children:i.jsxs(pi,{isRefreshing:je,pullMoveY:re,children:[i.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-40 px-4 py-4 shadow-sm",children:i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>se(-1),className:"w-10 h-10 bg-slate-50 hover:bg-slate-100 rounded-xl flex items-center justify-center text-slate-600 transition-colors border border-slate-200",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800",children:" "}),i.jsx("p",{className:"text-[11px] text-slate-500 font-medium",children:"    "})]})]})})}),i.jsxs("main",{className:"px-4 py-6 space-y-6",children:[i.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-6 text-white relative overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16 blur-2xl"}),i.jsx("h2",{className:"text-lg font-bold mb-4",children:"   "}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 border border-white/10",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(pl,{size:18,className:"text-amber-400"}),i.jsx("span",{className:"text-xs text-white/70",children:""})]}),i.jsxs("p",{className:"text-2xl font-black text-amber-400",children:[w.electricity,"%"]}),i.jsx("p",{className:"text-[10px] text-white/50",children:" "})]}),i.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 border border-white/10",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(Vp,{size:18,className:"text-cyan-400"}),i.jsx("span",{className:"text-xs text-white/70",children:""})]}),i.jsx("p",{className:"text-2xl font-black text-cyan-400",children:w.water}),i.jsx("p",{className:"text-[10px] text-white/50",children:" "})]})]})]}),i.jsx("div",{className:"bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl border border-amber-200 overflow-hidden",children:i.jsxs("div",{className:"p-5",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-xl flex items-center justify-center border border-amber-200",children:i.jsx(pl,{size:24,className:"text-amber-600"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-800",children:""}),i.jsx("p",{className:"text-[11px] text-slate-500",children:"  "})]})]}),Pe&&i.jsx("span",{className:"bg-emerald-100 text-emerald-700 text-xs font-bold px-3 py-1 rounded-lg border border-emerald-200",children:"  "})]}),Pe?i.jsxs("div",{className:"bg-white/60 rounded-xl p-6 text-center border border-amber-100",children:[i.jsx("span",{className:"text-3xl block mb-2",children:""}),i.jsx("p",{className:"font-bold text-amber-800",children:" !"}),i.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"     "})]}):I==="electricity"?i.jsxs("div",{className:"space-y-4 bg-white rounded-xl p-4 border border-amber-100",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-xs font-bold text-slate-600 mb-2 block",children:" "}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsx("button",{onClick:()=>ne({...ee,status:"available"}),className:`py-3 rounded-xl text-sm font-bold border-2 transition ${ee.status==="available"?"bg-emerald-500 text-white border-emerald-600":"bg-white border-slate-200 text-slate-600"}`,children:" "}),i.jsx("button",{onClick:()=>ne({...ee,status:"cut_off"}),className:`py-3 rounded-xl text-sm font-bold border-2 transition ${ee.status==="cut_off"?"bg-rose-500 text-white border-rose-600":"bg-white border-slate-200 text-slate-600"}`,children:" "})]})]}),ee.status==="available"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-xs font-bold text-slate-600 mb-1 block",children:" "}),i.jsx("input",{type:"time",value:ee.arrival_time,onChange:lt=>ne({...ee,arrival_time:lt.target.value}),className:"w-full px-3 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-xs font-bold text-slate-600 mb-1 block",children:" "}),i.jsx("input",{type:"time",value:ee.departure_time,onChange:lt=>ne({...ee,departure_time:lt.target.value}),className:"w-full px-3 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-xs font-bold text-slate-600 mb-2 block",children:""}),i.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{key:"good",label:" ",color:"emerald"},{key:"weak",label:" ",color:"amber"},{key:"bad",label:" ",color:"rose"}].map(lt=>i.jsx("button",{onClick:()=>ne({...ee,quality:lt.key}),className:`py-2 rounded-lg text-[11px] font-bold border transition ${ee.quality===lt.key?`bg-${lt.color}-100 text-${lt.color}-700 border-${lt.color}-300`:"bg-white border-slate-200"}`,children:lt.label},lt.key))})]})]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[i.jsx("button",{onClick:()=>Ze("electricity"),disabled:V,className:"flex-1 bg-amber-600 text-white py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 shadow-lg shadow-amber-600/20",children:V?" ...":i.jsxs(i.Fragment,{children:[i.jsx(Gp,{size:16})," "]})}),i.jsx("button",{onClick:()=>R(null),className:"px-4 bg-slate-100 rounded-xl text-slate-600",children:""})]})]}):i.jsxs("button",{onClick:()=>R("electricity"),className:"w-full bg-white py-4 rounded-xl font-bold text-amber-700 border border-amber-200 hover:bg-amber-50 transition flex items-center justify-center gap-2",children:[i.jsx(pl,{size:18}),"   "]})]})}),i.jsx("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 rounded-2xl border border-cyan-200 overflow-hidden",children:i.jsxs("div",{className:"p-5",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-12 h-12 bg-cyan-100 rounded-xl flex items-center justify-center border border-cyan-200",children:i.jsx(Vp,{size:24,className:"text-cyan-600"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-bold text-slate-800",children:""}),i.jsx("p",{className:"text-[11px] text-slate-500",children:"  "})]})]}),ze&&i.jsx("span",{className:"bg-emerald-100 text-emerald-700 text-xs font-bold px-3 py-1 rounded-lg border border-emerald-200",children:"  "})]}),ze?i.jsxs("div",{className:"bg-white/60 rounded-xl p-6 text-center border border-cyan-100",children:[i.jsx("span",{className:"text-3xl block mb-2",children:""}),i.jsx("p",{className:"font-bold text-cyan-800",children:" !"}),i.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"     "})]}):I==="water"?i.jsxs("div",{className:"space-y-4 bg-white rounded-xl p-4 border border-cyan-100",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-xs font-bold text-slate-600 mb-2 block",children:" "}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsx("button",{onClick:()=>ne({...ee,status:"available"}),className:`py-3 rounded-xl text-sm font-bold border-2 transition ${ee.status==="available"?"bg-emerald-500 text-white border-emerald-600":"bg-white border-slate-200 text-slate-600"}`,children:" "}),i.jsx("button",{onClick:()=>ne({...ee,status:"cut_off"}),className:`py-3 rounded-xl text-sm font-bold border-2 transition ${ee.status==="cut_off"?"bg-rose-500 text-white border-rose-600":"bg-white border-slate-200 text-slate-600"}`,children:" "})]})]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[i.jsx("button",{onClick:()=>Ze("water"),disabled:V,className:"flex-1 bg-cyan-600 text-white py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 shadow-lg shadow-cyan-600/20",children:V?" ...":i.jsxs(i.Fragment,{children:[i.jsx(Gp,{size:16})," "]})}),i.jsx("button",{onClick:()=>R(null),className:"px-4 bg-slate-100 rounded-xl text-slate-600",children:""})]})]}):i.jsxs("button",{onClick:()=>R("water"),className:"w-full bg-white py-4 rounded-xl font-bold text-cyan-700 border border-cyan-200 hover:bg-cyan-50 transition flex items-center justify-center gap-2",children:[i.jsx(Vp,{size:18}),"   "]})]})}),i.jsx("div",{className:"bg-emerald-50 rounded-xl p-4 border border-emerald-100",children:i.jsx("p",{className:"text-xs text-emerald-800 leading-relaxed text-center",children:"           "})})]})]})})}function cS(){const[b,k]=K.useState([]),[w,P]=K.useState(!0),I=dr(),R=K.useCallback(async()=>{try{const ee=await Lt.get("/portal/posts");k(ee.data)}catch{k([{id:1,title:"      ",content:`                 .             .

    8   8    .              .`,summary:"        ",source:" ",source_icon:"",category:"",created_at:new Date().toISOString(),views:1523,likes:89},{id:2,title:"      ",content:`                .

       8   .             .

        .     .`,summary:"     -  ",source:"",source_icon:"",category:"",created_at:new Date(Date.now()-864e5).toISOString(),views:845,likes:156},{id:3,title:"      ",content:`             8     6 .

 :
-  6   10 
-  4   8 

       .`,summary:"    8  ",source:" ",source_icon:"",category:"",created_at:new Date(Date.now()-1728e5).toISOString(),views:2341,likes:234}])}finally{P(!1)}},[]);K.useEffect(()=>{R()},[R]);const{isRefreshing:T,pullMoveY:c,handlers:V}=hi(R),W=ee=>({:"emerald",:"blue",:"amber",:"slate"})[ee]||"slate",se=ee=>{const ne=new Date(ee),je=new Date().getTime()-ne.getTime(),re=Math.floor(je/(1e3*60*60));return re<1?" ":re<24?` ${re} `:re<48?"":ne.toLocaleDateString("ar-SY")};return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...V,children:i.jsxs(pi,{isRefreshing:T,pullMoveY:c,children:[i.jsx("header",{className:"bg-white dark:bg-slate-900 pb-14 pt-8 z-40 relative transition-colors duration-300",children:i.jsx("div",{className:"flex items-center justify-between px-5",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:()=>I(-1),className:"w-12 h-12 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-2xl flex items-center justify-center text-slate-600 dark:text-slate-400 transition-all border border-slate-200 dark:border-slate-800 active:scale-90 shadow-sm",children:i.jsx(Cr,{size:22,className:"rotate-180"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-black text-slate-800 dark:text-slate-100 tracking-tight",children:""}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium mt-0.5",children:"  "})]})]})})}),i.jsx("main",{className:"px-5 -mt-10 relative z-50 bg-slate-50 dark:bg-slate-900 rounded-t-[40px] pt-8 min-h-[calc(100vh-200px)] space-y-4 transition-colors duration-300",children:w?i.jsx("div",{className:"space-y-4",children:[1,2,3].map(ee=>i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-5 animate-pulse border border-slate-100 dark:border-slate-700",children:[i.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-3/4 mb-3"}),i.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-700/50 rounded w-full mb-2"}),i.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-700/50 rounded w-2/3"})]},ee))}):b.map((ee,ne)=>{const ke=W(ee.category);return i.jsx("button",{onClick:()=>I(`/news/${ee.id}`),className:"w-full bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-5 shadow-premium hover:border-emerald-200 dark:hover:border-emerald-800 transition-all text-right group animate-fade-in-up",style:{animationDelay:`${ne*100}ms`},children:i.jsx("div",{className:"flex items-start gap-4",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("span",{className:`bg-${ke}-50 dark:bg-${ke}-900/20 text-${ke}-600 dark:text-${ke}-400 text-[10px] font-bold px-2 py-1 rounded-lg border border-${ke}-100 dark:border-${ke}-800/50`,children:ee.category}),i.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-medium",children:se(ee.created_at)})]}),i.jsx("h3",{className:"font-bold text-slate-900 dark:text-slate-100 text-sm mb-2 leading-relaxed line-clamp-2 group-hover:text-emerald-700 dark:group-hover:text-emerald-400 transition-colors",children:ee.title}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 line-clamp-2 mb-3 leading-relaxed opacity-80",children:ee.summary}),i.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-slate-50 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-lg filter grayscale group-hover:grayscale-0 transition-all",children:ee.source_icon}),i.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-bold",children:ee.source})]}),i.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-slate-400 dark:text-slate-500 font-medium",children:[i.jsxs("span",{className:"flex items-center gap-1 bg-slate-50 dark:bg-slate-900 px-2 py-0.5 rounded-full",children:[i.jsx(Xy,{size:12})," ",ee.views]}),i.jsxs("span",{className:"flex items-center gap-1 bg-rose-50 dark:bg-rose-900/30 text-rose-500 dark:text-rose-400 px-2 py-0.5 rounded-full",children:[i.jsx(Yc,{size:12,className:"fill-rose-500"})," ",ee.likes]})]})]})]})})},ee.id)})})]})})}function uS(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0),[T,c]=K.useState(!1),[V,W]=K.useState(!1);K.useEffect(()=>{se()},[b]);const se=async()=>{try{const ne=await Lt.get(`/portal/posts/${b}`);P(ne.data)}catch{P({id:Number(b),title:"      ",content:`                 .

                .

    8   8    .              .

             .`,image:null,source:" ",source_icon:"",category:"",created_at:new Date().toISOString(),views:1523,likes:89})}finally{R(!1)}},ee=async()=>{try{await Lt.post(`/portal/posts/${b}/like`),c(!T),w&&P({...w,likes:w.likes+(T?-1:1)})}catch{c(!T)}};return I?i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center",children:i.jsx("div",{className:"animate-pulse",children:i.jsx("div",{className:"w-16 h-16 bg-slate-200 dark:bg-slate-800 rounded-full"})})}):w?i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30 shadow-sm transition-colors duration-300",children:i.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[i.jsx("button",{onClick:()=>k(-1),className:"w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-800",children:i.jsx(Cr,{size:20})}),i.jsx("h1",{className:"text-base font-bold text-slate-800 dark:text-slate-100",children:" "}),i.jsx("button",{onClick:()=>W(!V),className:"w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-slate-800 hover:bg-amber-50 dark:hover:bg-amber-900/20 rounded-xl transition border border-slate-200 dark:border-slate-800",children:i.jsx(Q1,{size:18,className:V?"fill-amber-500 text-amber-500":"text-slate-400 dark:text-slate-500"})})]})}),w.image&&i.jsx("div",{className:"w-full h-56 bg-slate-200 dark:bg-slate-800",children:i.jsx("img",{src:w.image,alt:w.title,className:"w-full h-full object-cover"})}),i.jsxs("main",{className:"px-4 py-6 space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[i.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-slate-800 px-3 py-1.5 rounded-lg border border-slate-100 dark:border-slate-700 shadow-sm",children:[i.jsx("span",{className:"text-xl",children:w.source_icon}),i.jsx("span",{className:"text-xs font-bold text-slate-700 dark:text-slate-200",children:w.source})]}),i.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 dark:text-slate-400 text-xs",children:[i.jsx(oi,{size:14}),i.jsx("span",{children:new Date(w.created_at).toLocaleDateString("ar-SY",{month:"long",day:"numeric"})})]}),i.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 dark:text-slate-400 text-xs text-xs",children:[i.jsx(Xy,{size:14}),i.jsxs("span",{children:[w.views.toLocaleString()," "]})]})]}),i.jsx("h1",{className:"text-2xl font-black text-slate-900 dark:text-slate-100 leading-tight",children:w.title}),i.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-100 dark:border-slate-700 shadow-premium",children:i.jsx("div",{className:"prose prose-slate dark:prose-invert max-w-none",children:w.content.split(`

`).map((ne,ke)=>i.jsx("p",{className:"text-base text-slate-700 dark:text-slate-300 leading-relaxed mb-4 last:mb-0",children:ne},ke))})}),i.jsxs("button",{onClick:ee,className:`w-full py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 transition shadow-sm ${T?"bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 border border-rose-200 dark:border-rose-800/50":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[i.jsx(Yc,{size:18,className:T?"fill-rose-600":""}),i.jsxs("span",{children:[w.likes," "]})]})]})]}):i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center p-4",dir:"rtl",children:i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-bold",children:"  "}),i.jsx("button",{onClick:()=>k(-1),className:"mt-4 px-6 py-2 bg-emerald-600 text-white rounded-lg text-sm font-bold",children:""})]})})}function dS(){const b=dr(),[k,w]=K.useState([]),[P,I]=K.useState(!0),R=async()=>{try{const ne=await Lt.get("/api/notifications"),ke=ne.data.data||ne.data;w(ke),await Lt.post("/api/notifications/read/all")}catch(ne){console.error("Failed to fetch notifications",ne)}finally{I(!1)}},{isRefreshing:T,containerRef:c,indicatorRef:V,handlers:W}=hi(R);K.useEffect(()=>{R()},[]);const se=ne=>{switch(ne){case"success":return i.jsx(Yh,{size:20,className:"text-emerald-500"});case"warning":return i.jsx(ec,{size:20,className:"text-amber-500"});case"error":return i.jsx(ec,{size:20,className:"text-red-500"});default:return i.jsx(J0,{size:20,className:"text-blue-500"})}},ee=ne=>{const ke=new Date(ne),re=Math.floor((new Date().getTime()-ke.getTime())/1e3);return re<60?"":re<3600?` ${Math.floor(re/60)} `:re<86400?` ${Math.floor(re/3600)} `:ke.toLocaleDateString("ar-SY")};return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20",dir:"rtl",...W,children:i.jsxs(pi,{isRefreshing:T,containerRef:c,indicatorRef:V,children:[i.jsxs("header",{className:"bg-white dark:bg-slate-900 sticky top-0 z-10 px-4 py-4 shadow-sm flex items-center gap-4",children:[i.jsx("button",{onClick:()=>b(-1),className:"w-10 h-10 rounded-full bg-slate-50 dark:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400",children:i.jsx(Cr,{size:20})}),i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:""})]}),i.jsx("div",{className:"p-4 space-y-3",children:P&&k.length===0?i.jsx("div",{className:"text-center py-10 text-slate-500",children:" ..."}):k.length>0?k.map(ne=>i.jsxs("div",{className:`bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 flex gap-4 ${ne.read_at?"":"bg-blue-50/50 dark:bg-blue-900/10 border-blue-100 dark:border-blue-800"}`,children:[i.jsx("div",{className:"shrink-0 pt-1",children:se(ne.data.type||"info")}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex justify-between items-start mb-1",children:[i.jsx("h3",{className:"font-bold text-slate-900 dark:text-slate-100 text-sm",children:ne.data.title}),i.jsx("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 whitespace-nowrap",children:ee(ne.created_at)})]}),i.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 leading-relaxed",children:ne.data.body})]})]},ne.id)):i.jsxs("div",{className:"text-center py-16",children:[i.jsx("div",{className:"w-20 h-20 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400",children:i.jsx(fm,{size:32})}),i.jsx("h3",{className:"font-bold text-slate-700 dark:text-slate-300",children:"  "}),i.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"    "})]})})]})})}function hS(){const[b,k]=K.useState([]),[w,P]=K.useState(!0),[I,R]=K.useState(null),[T,c]=K.useState(null),V=dr();K.useEffect(()=>{const re=localStorage.getItem("user");re&&c(JSON.parse(re))},[]);const W=K.useCallback(async()=>{try{const re=await Lt.get("/polls/active");if(!re.data){k([]);return}const Ze=(Array.isArray(re.data)?re.data:[re.data]).map(Pe=>{if(Pe.question&&Pe.options)return Pe;const ze=Pe.metadata?.options||[],lt=ze.reduce((Nt,zt)=>Nt+(zt.votes||0),0);return{id:Pe.id,question:Pe.title||" ",description:Pe.content,options:ze.map(Nt=>({id:Nt.id,text:Nt.text,votes:Nt.votes||0})),total_votes:lt,user_voted:Pe.user_vote_id,is_active:!0,created_at:Pe.created_at||new Date().toISOString()}}).filter(Pe=>Pe.options&&Pe.options.length>0);k(Ze)}catch(re){console.error("Failed to fetch polls",re),k([{id:1,question:"         ",description:"     ",options:[{id:1,text:"  ",votes:145},{id:2,text:"  ",votes:98},{id:3,text:"  ",votes:67},{id:4,text:"  ",votes:54}],total_votes:364,is_active:!0,created_at:new Date(Date.now()-864e5*2).toISOString()}])}finally{P(!1)}},[]);K.useEffect(()=>{W()},[W]);const{isRefreshing:se,pullMoveY:ee,handlers:ne}=hi(W),ke=async(re,H)=>{if(!T){V("/login");return}R(re),k(b.map(Ze=>Ze.id===re?{...Ze,user_voted:H,total_votes:Ze.total_votes+1,options:Ze.options.map(Pe=>Pe.id===H?{...Pe,votes:Pe.votes+1}:Pe)}:Ze));try{await Lt.post(`/polls/${re}/vote`,{option_id:H})}catch{console.log("Vote recorded locally")}finally{R(null)}},je=re=>{if(!re)return null;const H=new Date(re),Ze=new Date,Pe=H.getTime()-Ze.getTime(),ze=Math.floor(Pe/(1e3*60*60*24)),lt=Math.floor(Pe%(1e3*60*60*24)/(1e3*60*60));return ze>0?` ${ze} `:lt>0?` ${lt} `:" "};return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...ne,children:i.jsxs(pi,{isRefreshing:se,pullMoveY:ee,children:[i.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-40 px-4 py-4 shadow-sm transition-colors duration-300",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>V(-1),className:"w-10 h-10 bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl flex items-center justify-center text-slate-600 dark:text-slate-400 transition-colors border border-slate-200 dark:border-slate-700",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:""}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-medium",children:"    "})]})]}),i.jsxs("div",{className:"flex items-center gap-1 bg-emerald-50 dark:bg-emerald-900/20 px-3 py-1.5 rounded-lg border border-emerald-100 dark:border-emerald-800/50",children:[i.jsx(A0,{size:14,className:"text-emerald-600 dark:text-emerald-400"}),i.jsx("span",{className:"text-xs font-bold text-emerald-600 dark:text-emerald-400",children:b.length})]})]})}),i.jsxs("main",{className:"px-4 py-6 space-y-6",children:[i.jsxs("div",{className:"bg-gradient-to-br from-indigo-600 via-purple-600 to-violet-600 rounded-3xl p-6 text-white relative overflow-hidden shadow-lg shadow-indigo-500/20 animate-fade-in-up animate-gradient-x",children:[i.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl animate-pulse-slow"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-black/10 rounded-full -ml-12 -mb-12 blur-xl"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("h2",{className:"text-xl font-black mb-2 flex items-center gap-2",children:[i.jsx(A0,{size:24,className:"animate-float"})," "]}),i.jsx("p",{className:"text-purple-100 text-sm font-medium opacity-90",children:"       "})]})]}),w?i.jsx("div",{className:"space-y-4",children:[1,2].map(re=>i.jsxs("div",{className:"bg-white rounded-2xl p-6 animate-pulse",children:[i.jsx("div",{className:"h-5 bg-slate-200 rounded w-3/4 mb-4"}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"h-10 bg-slate-100 rounded-xl"}),i.jsx("div",{className:"h-10 bg-slate-100 rounded-xl"}),i.jsx("div",{className:"h-10 bg-slate-100 rounded-xl"})]})]},re))}):b.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("span",{className:"text-5xl opacity-30 block mb-4",children:""}),i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 mb-2",children:"   "}),i.jsx("p",{className:"text-slate-500 dark:text-slate-500 text-sm",children:"    "})]}):b.map((re,H)=>{const Ze=re.user_voted!==void 0,Pe=Math.max(...re.options.map(ze=>ze.votes));return i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700/50 shadow-premium overflow-hidden animate-fade-in-up",style:{animationDelay:`${(H+1)*150}ms`},children:[i.jsxs("div",{className:"p-5 border-b border-slate-100 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[i.jsx("h3",{className:"font-bold text-slate-900 dark:text-slate-100 text-base leading-relaxed",children:re.question}),re.is_active&&i.jsx("span",{className:"bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 text-[10px] font-bold px-2 py-1 rounded-lg border border-emerald-100 dark:border-emerald-800/50 whitespace-nowrap",children:""})]}),re.description&&i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:re.description})]}),i.jsx("div",{className:"p-5 space-y-3",children:re.options.map(ze=>{const lt=re.total_votes>0?Math.round(ze.votes/re.total_votes*100):0,Nt=ze.votes===Pe&&Ze,zt=re.user_voted===ze.id;return i.jsxs("button",{onClick:()=>!Ze&&ke(re.id,ze.id),disabled:Ze||I===re.id,className:`w-full relative rounded-xl border-2 p-4 text-right transition-all ${Ze?zt?"border-emerald-500 dark:border-emerald-600 bg-emerald-50 dark:bg-emerald-900/20":"border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/40":"border-slate-200 dark:border-slate-700 hover:border-emerald-300 dark:hover:border-emerald-700 hover:bg-emerald-50/30 dark:hover:bg-emerald-900/10 active:scale-[0.98]"}`,children:[Ze&&i.jsx("div",{className:`absolute inset-0 rounded-xl transition-all ${Nt?"bg-emerald-100 dark:bg-emerald-900/30":"bg-slate-100 dark:bg-slate-800/50"}`,style:{width:`${lt}%`}}),i.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[Ze&&zt&&i.jsx("div",{className:"w-6 h-6 bg-emerald-500 dark:bg-emerald-600 rounded-full flex items-center justify-center",children:i.jsx(D0,{size:14,className:"text-white"})}),i.jsx("span",{className:`font-medium text-sm ${zt?"text-emerald-700 dark:text-emerald-400":"text-slate-700 dark:text-slate-300"}`,children:ze.text})]}),Ze&&i.jsxs("span",{className:`text-sm font-bold ${Nt?"text-emerald-600 dark:text-emerald-400":"text-slate-500 dark:text-slate-500"}`,children:[lt,"%"]})]})]},ze.id)})}),i.jsxs("div",{className:"px-5 py-4 bg-slate-50 dark:bg-slate-900/50 border-t border-slate-100 dark:border-slate-700/50 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 dark:text-slate-500 font-medium",children:[i.jsx(Jn,{size:14,className:"text-slate-400 dark:text-slate-600"}),i.jsxs("span",{children:[re.total_votes," "]})]}),re.ends_at&&i.jsxs("div",{className:"flex items-center gap-2 text-xs text-amber-600 dark:text-amber-500 font-bold",children:[i.jsx(oi,{size:14}),i.jsx("span",{children:je(re.ends_at)})]})]})]},re.id)})]})]})})}function pS(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0),[T,c]=K.useState(null),[V,W]=K.useState(!1),[se,ee]=K.useState(null);K.useEffect(()=>{const re=localStorage.getItem("user");re&&ee(JSON.parse(re)),ne()},[b]);const ne=async()=>{try{const H=(await Lt.get(`/polls/${b}`)).data;P(H),H.user_voted&&(c(H.user_voted),W(!0))}catch{P({id:Number(b),question:"     ",description:"        ",options:[{id:1,text:"  ",votes:145},{id:2,text:"  ",votes:89},{id:3,text:"  ",votes:203},{id:4,text:"  ",votes:167}],total_votes:604,is_active:!0,created_at:new Date().toISOString()})}finally{R(!1)}},ke=async()=>{if(!T){Kr("   ","error");return}if(!se){Kr("   ","error"),k("/login");return}try{await Lt.post(`/polls/${b}/vote`,{option_id:T}),W(!0),Kr("   ! ","success"),await ne()}catch(re){re.response?.status===400?(Kr("     ","error"),W(!0)):Kr(" .   ","error")}};if(I)return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center transition-colors duration-300",children:i.jsx("div",{className:"animate-pulse",children:i.jsx("div",{className:"w-16 h-16 bg-slate-200 dark:bg-slate-800 rounded-full"})})});if(!w)return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center p-4 transition-colors duration-300",dir:"rtl",children:i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-bold",children:"  "}),i.jsx("button",{onClick:()=>k(-1),className:"mt-4 px-6 py-2 bg-emerald-600 text-white rounded-lg text-sm font-bold shadow-lg",children:""})]})});const je=re=>w.total_votes>0?Math.round(re/w.total_votes*100):0;return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30 shadow-sm transition-colors duration-300",children:i.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[i.jsx("button",{onClick:()=>k(-1),className:"w-10 h-10 flex items-center justify-center bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition-colors text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700",children:i.jsx(Cr,{size:20})}),i.jsx("h1",{className:"text-base font-bold text-slate-800 dark:text-slate-100",children:" "}),i.jsx("div",{className:"w-10"})]})}),i.jsxs("main",{className:"px-4 py-6 space-y-6",children:[i.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl p-7 text-white relative overflow-hidden shadow-xl",children:[i.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl"}),i.jsxs("div",{className:"relative z-10",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx(A0,{size:20}),i.jsx("span",{className:"text-xs font-bold bg-white/20 px-3 py-1 rounded-full",children:w.is_active?" ":""})]}),i.jsx("h1",{className:"text-2xl font-black mb-2 leading-tight",children:w.question}),w.description&&i.jsx("p",{className:"text-indigo-100 text-sm font-medium",children:w.description})]})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-100 dark:border-slate-700/50 text-center shadow-sm",children:[i.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[i.jsx(Jn,{size:16,className:"text-indigo-500"}),i.jsx("span",{className:"text-2xl font-black text-slate-800 dark:text-slate-100",children:w.total_votes})]}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-bold",children:""})]}),i.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-100 dark:border-slate-700/50 text-center shadow-sm",children:[i.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[i.jsx(oi,{size:16,className:"text-emerald-500"}),i.jsx("span",{className:"text-2xl font-black text-slate-800 dark:text-slate-100",children:w.options.length})]}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-bold",children:""})]})]}),i.jsx("div",{className:"space-y-3",children:w.options.map(re=>{const H=je(re.votes),Ze=T===re.id,Pe=re.votes===Math.max(...w.options.map(ze=>ze.votes))&&w.total_votes>0;return i.jsxs("button",{onClick:()=>!V&&c(re.id),disabled:V,className:`w-full text-right p-4 rounded-2xl border-2 transition-all ${V?Pe?"bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-700":"bg-white dark:bg-slate-800 border-slate-100 dark:border-slate-700/50":Ze?"bg-indigo-50 dark:bg-indigo-900/30 border-indigo-500 dark:border-indigo-400 shadow-premium":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:border-indigo-300 dark:hover:border-indigo-600 hover:bg-indigo-50/30 dark:hover:bg-indigo-900/20 shadow-sm"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:`text-sm font-bold ${V&&Pe?"text-emerald-700 dark:text-emerald-400":"text-slate-800 dark:text-slate-100"}`,children:re.text}),V&&i.jsxs("span",{className:"text-lg font-black text-indigo-600 dark:text-indigo-400",children:[H,"%"]}),Ze&&!V&&i.jsx(D0,{size:20,className:"text-indigo-600 dark:text-indigo-400"})]}),V&&i.jsx("div",{className:"h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:i.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${Pe?"bg-emerald-500":"bg-indigo-500"}`,style:{width:`${H}%`}})}),V&&i.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-2",children:[re.votes.toLocaleString()," "]})]},re.id)})}),!V&&w.is_active&&i.jsx("button",{onClick:ke,disabled:!T,className:`w-full py-4 rounded-xl font-bold text-base shadow-lg transition ${T?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:from-indigo-700 hover:to-purple-700 active:scale-[0.98]":"bg-slate-100 text-slate-400 cursor-not-allowed"}`,children:T?" ":"  "}),V&&i.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800/50 rounded-2xl p-4 text-center shadow-premium",children:[i.jsx(D0,{size:24,className:"text-emerald-600 dark:text-emerald-400 mx-auto mb-2"}),i.jsx("p",{className:"text-sm font-bold text-emerald-700 dark:text-emerald-300",children:" !   "})]})]})]})}const Op={documents:{icon:"",label:"",color:"blue"},phone:{icon:"",label:"",color:"purple"},keys:{icon:"",label:"",color:"amber"},bag:{icon:"",label:"",color:"pink"},wallet:{icon:"",label:"",color:"green"},jewelry:{icon:"",label:"",color:"yellow"},pet:{icon:"",label:" ",color:"orange"},other:{icon:"",label:"",color:"slate"}};function fS(){const[b,k]=K.useState([]),[w,P]=K.useState(!0),[I,R]=K.useState("all"),[T,c]=K.useState(!1),[V,W]=K.useState({category:"",location:"",search:""}),se=dr(),ee=K.useCallback(async()=>{try{P(!0);const H={};I!=="all"&&(H.type=I),V.category&&(H.category=V.category),V.location&&(H.location=V.location),V.search&&(H.search=V.search);const Ze=await Lt.get("/lost-found",{params:H});k(Ze.data.data||Ze.data)}catch(H){console.error(H)}finally{P(!1)}},[I,V]),{isRefreshing:ne,pullMoveY:ke,handlers:je}=hi(ee);K.useEffect(()=>{ee()},[ee]);const re=H=>{const Ze=new Date,Pe=new Date(H),ze=Math.floor((Ze.getTime()-Pe.getTime())/(1e3*60*60*24));return ze===0?"":ze===1?"":ze<7?` ${ze} `:ze<30?` ${Math.floor(ze/7)} `:` ${Math.floor(ze/30)} `};return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...je,children:i.jsxs(pi,{isRefreshing:ne,pullMoveY:ke,children:[i.jsx("header",{className:"bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 sticky top-0 z-30 shadow-sm transition-colors duration-300",children:i.jsxs("div",{className:"px-5 py-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-black text-slate-800 dark:text-slate-100",children:" "}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium mt-0.5",children:"    "})]}),i.jsx("button",{onClick:()=>se("/lost-found/add"),className:"w-12 h-12 bg-indigo-600 dark:bg-indigo-500 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-600/20 active:scale-95 transition-transform",children:i.jsx(qp,{size:24})})]}),i.jsxs("div",{className:"relative mb-3",children:[i.jsx(ch,{size:20,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500"}),i.jsx("input",{type:"text",placeholder:"  ...",value:V.search,onChange:H=>W({...V,search:H.target.value}),className:"w-full pr-11 pl-4 py-3 bg-slate-100 dark:bg-slate-800 border-none rounded-2xl text-sm placeholder:text-slate-400 dark:placeholder:text-slate-600 focus:ring-2 focus:ring-indigo-500 text-slate-800 dark:text-slate-100"})]}),i.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800/80 p-1.5 rounded-2xl flex border border-slate-200/50 dark:border-slate-700/50",children:[i.jsx("button",{onClick:()=>R("all"),className:`flex-1 py-2.5 rounded-xl text-xs font-bold transition ${I==="all"?"bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300"}`,children:""}),i.jsx("button",{onClick:()=>R("lost"),className:`flex-1 py-2.5 rounded-xl text-xs font-bold transition ${I==="lost"?"bg-white dark:bg-slate-700 text-rose-600 dark:text-rose-400 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300"}`,children:" "}),i.jsx("button",{onClick:()=>R("found"),className:`flex-1 py-2.5 rounded-xl text-xs font-bold transition ${I==="found"?"bg-white dark:bg-slate-700 text-emerald-600 dark:text-emerald-400 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-300"}`,children:" "})]})]})}),i.jsxs("main",{className:"px-5 py-6",children:[w?i.jsx("div",{className:"space-y-4",children:[1,2,3].map(H=>i.jsx(ui,{type:"card"},H))}):b.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx(s2,{size:64,className:"mx-auto text-slate-300 dark:text-slate-700 mb-4"}),i.jsx("h3",{className:"text-lg font-bold text-slate-700 dark:text-slate-300 mb-2",children:"  "}),i.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-500",children:"    "})]}):i.jsx("div",{className:"grid grid-cols-1 gap-4",children:b.map(H=>i.jsx("div",{onClick:()=>se(`/lost-found/${H.id}`),className:"bg-white dark:bg-slate-800 rounded-3xl p-4 shadow-premium border border-slate-200 dark:border-slate-700/50 active:scale-[0.98] transition-transform cursor-pointer",children:i.jsxs("div",{className:"flex gap-4",children:[i.jsx("div",{className:`w-20 h-20 rounded-2xl bg-${Op[H.category]?.color||"slate"}-50 dark:bg-${Op[H.category]?.color||"slate"}-900/20 flex items-center justify-center text-4xl shrink-0 border border-${Op[H.category]?.color||"slate"}-100 dark:border-${Op[H.category]?.color||"slate"}-800/50`,children:Op[H.category]?.icon||""}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-base line-clamp-1 flex-1",children:H.title}),i.jsx("span",{className:`px-2.5 py-1 rounded-lg text-[10px] font-black uppercase shrink-0 ${H.type==="lost"?"bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-400":"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400"}`,children:H.type==="lost"?"":""})]}),i.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 line-clamp-2 leading-relaxed mb-3",children:H.description}),i.jsxs("div",{className:"flex items-center gap-3 text-[11px] text-slate-500 dark:text-slate-500 font-medium",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(qn,{size:12,className:"text-slate-400 dark:text-slate-600"}),i.jsx("span",{children:H.location})]}),i.jsx("div",{className:"w-1 h-1 bg-slate-300 dark:bg-slate-700 rounded-full"}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(hl,{size:12,className:"text-slate-400 dark:text-slate-600"}),i.jsx("span",{children:re(H.created_at)})]})]})]})]})},H.id))}),!w&&b.length>0&&i.jsx("div",{className:"mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-900/30 rounded-2xl p-4 text-center",children:i.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 font-medium leading-relaxed",children:"          "})})]})]})})}const mS={documents:{icon:"",label:"",color:"blue"},phone:{icon:"",label:"",color:"purple"},keys:{icon:"",label:"",color:"amber"},bag:{icon:"",label:"",color:"pink"},wallet:{icon:"",label:"",color:"green"},jewelry:{icon:"",label:"",color:"yellow"},pet:{icon:"",label:" ",color:"orange"},other:{icon:"",label:"",color:"slate"}};function gS(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0);K.useEffect(()=>{(async()=>{try{const se=await Lt.get(`/lost-found/${b}`);P(se.data)}catch(se){console.error(se)}finally{R(!1)}})()},[b]);const T=async()=>{if(confirm('        " "'))try{await Lt.post(`/lost-found/${b}/resolve`),alert("   "),k("/lost-found")}catch(W){console.error(W),alert(" ")}};if(I)return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center transition-colors duration-300",children:i.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-slate-800 dark:border-slate-400 border-t-transparent rounded-full"})});if(!w)return null;const c=mS[w.category],V=w.type==="lost";return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:`relative h-64 ${V?"bg-gradient-to-br from-rose-500 to-red-600":"bg-gradient-to-br from-emerald-500 to-green-600"}`,children:[i.jsx("div",{className:"absolute inset-0 bg-black/20"}),i.jsx("button",{onClick:()=>k(-1),className:"absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 z-10",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 text-white",children:i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white/20 backdrop-blur-md flex items-center justify-center text-4xl border border-white/30",children:c?.icon||""}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("span",{className:`inline-block px-3 py-1 rounded-lg text-[10px] font-black uppercase mb-2 ${V?"bg-rose-100 dark:bg-rose-900/30 text-rose-700 dark:text-rose-400":"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400"}`,children:[V?"":"","  ",c?.label]}),i.jsx("h1",{className:"text-2xl font-black",children:w.title})]})]})})]}),i.jsxs("main",{className:"px-5 -mt-4 relative z-10 space-y-4",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-premium border border-slate-100 dark:border-slate-700/50",children:[i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 mb-2",children:""}),i.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:w.description})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-200 dark:border-slate-700/50 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(qn,{size:16,className:"text-indigo-600 dark:text-indigo-400"}),i.jsx("span",{className:"text-xs font-bold text-slate-500 dark:text-slate-500 uppercase",children:""})]}),i.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:w.location})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-4 border border-slate-200 dark:border-slate-700/50 shadow-sm",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(hl,{size:16,className:"text-indigo-600 dark:text-indigo-400"}),i.jsx("span",{className:"text-xs font-bold text-slate-500 dark:text-slate-500 uppercase",children:""})]}),i.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:new Date(w.date).toLocaleDateString("ar-SY")})]})]}),w.user&&i.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 rounded-3xl p-6 border border-indigo-100 dark:border-indigo-900/30",children:[i.jsxs("h3",{className:"font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2",children:[i.jsx(tp,{size:18,className:"text-indigo-600 dark:text-indigo-400"})," "]}),i.jsxs("div",{className:"space-y-3 text-right",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:""}),i.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-100",children:w.user.name})]}),w.user.phone&&i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:""}),i.jsxs("a",{href:`tel:${w.user.phone}`,className:"font-bold text-indigo-600 dark:text-indigo-400 flex items-center gap-1",children:[i.jsx(tc,{size:14}),w.user.phone]})]}),w.contact_info&&i.jsx("div",{className:"pt-3 border-t border-indigo-100 dark:border-indigo-900/30",children:i.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 leading-relaxed",children:w.contact_info})})]})]}),i.jsxs("div",{className:"space-y-3",children:[w.status==="active"&&i.jsxs("button",{onClick:T,className:`w-full py-4 ${V?"bg-emerald-600":"bg-indigo-600"} text-white rounded-2xl font-bold flex items-center justify-center gap-2 active:scale-95 transition-transform shadow-lg`,children:[i.jsx(lm,{size:20}),i.jsx("span",{children:V?"   ":"  "})]}),w.status==="resolved"&&i.jsxs("div",{className:"bg-green-50 dark:bg-emerald-900/20 border border-green-200 dark:border-emerald-800/50 rounded-2xl p-4 flex items-center gap-3 text-green-700 dark:text-emerald-400 shadow-sm",children:[i.jsx(lm,{size:24,className:"shrink-0"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-bold text-sm",children:"  "}),i.jsx("p",{className:"text-xs opacity-75",children:"    "})]})]})]}),i.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800/50 rounded-2xl p-4 flex gap-3 shadow-sm",children:[i.jsx(ec,{size:20,className:"text-amber-600 dark:text-amber-500 shrink-0 mt-0.5"}),i.jsx("p",{className:"text-xs text-amber-800 dark:text-amber-300 leading-relaxed",children:"      .    ."})]})]})]})}const _y={documents:{icon:"",label:""},phone:{icon:"",label:""},keys:{icon:"",label:""},bag:{icon:"",label:""},wallet:{icon:"",label:""},jewelry:{icon:"",label:""},pet:{icon:"",label:" "},other:{icon:"",label:""}};function xS(){const b=dr(),[k,w]=K.useState(!1),[P,I]=K.useState({type:"lost",category:"other",title:"",description:"",location:"",date:new Date().toISOString().split("T")[0],contact_info:""}),[R,T]=K.useState(!1);K.useEffect(()=>{P.title||P.description||P.location?T(!0):T(!1)},[P]),K.useEffect(()=>{const W=se=>{R&&(se.preventDefault(),se.returnValue="")};return window.addEventListener("beforeunload",W),()=>window.removeEventListener("beforeunload",W)},[R]);const c=()=>{R?window.confirm("       .")&&b(-1):b(-1)},V=async W=>{if(W.preventDefault(),!P.title||!P.description||!P.location){alert("    ");return}w(!0);try{await Lt.post("/lost-found",P),T(!1),alert("   !"),b("/lost-found")}catch(se){console.error(se),alert(se.response?.data?.message||"    ")}finally{w(!1)}};return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsx("header",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-30 px-4 py-4 shadow-sm",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:c,className:"w-10 h-10 bg-slate-50 dark:bg-slate-700 hover:bg-slate-100 dark:hover:bg-slate-600 rounded-xl flex items-center justify-center text-slate-800 dark:text-slate-100 transition-colors",children:i.jsx(Cr,{size:20,className:""})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:" "}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"   "})]})]})}),i.jsxs("form",{onSubmit:V,className:"px-5 py-6 space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-3",children:"  *"}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("button",{type:"button",onClick:()=>I({...P,type:"lost"}),className:`p-4 rounded-2xl border-2 transition-all active:scale-95 ${P.type==="lost"?"border-rose-500 bg-rose-50 dark:bg-rose-900/30":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800"}`,children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("p",{className:`font-bold text-sm ${P.type==="lost"?"text-rose-700 dark:text-rose-400":"text-slate-600 dark:text-slate-400"}`,children:""}),i.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 mt-1",children:"   "})]}),i.jsxs("button",{type:"button",onClick:()=>I({...P,type:"found"}),className:`p-4 rounded-2xl border-2 transition-all active:scale-95 ${P.type==="found"?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/30":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800"}`,children:[i.jsx("div",{className:"text-3xl mb-2",children:""}),i.jsx("p",{className:`font-bold text-sm ${P.type==="found"?"text-emerald-700 dark:text-emerald-400":"text-slate-600 dark:text-slate-400"}`,children:""}),i.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 mt-1",children:"   "})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-3",children:" *"}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{value:P.category,onChange:W=>I({...P,category:W.target.value}),className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-bold text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 dark:focus:border-indigo-500 appearance-none transition-all",required:!0,children:Object.entries(_y).map(([W,se])=>i.jsx("option",{value:W,children:se.label},W))}),i.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-xl",children:_y[P.category].icon})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-3",children:" *"}),i.jsx("input",{type:"text",value:P.title,onChange:W=>I({...P,title:W.target.value}),placeholder:":   ",className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 dark:focus:border-indigo-500 transition-all placeholder:text-slate-400 dark:placeholder:text-slate-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-3",children:"  *"}),i.jsx("textarea",{value:P.description,onChange:W=>I({...P,description:W.target.value}),placeholder:"    (   ...)",rows:4,className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 dark:focus:border-indigo-500 resize-none placeholder:text-slate-400 dark:placeholder:text-slate-500",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-3",children:[i.jsx(qn,{size:16,className:"inline mr-1"})," () *"]}),i.jsx("input",{type:"text",value:P.location,onChange:W=>I({...P,location:W.target.value}),placeholder:":    ...",className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 dark:focus:border-indigo-500 transition-all placeholder:text-slate-400 dark:placeholder:text-slate-500",required:!0})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-3",children:[i.jsx(hl,{size:16,className:"inline mr-1"}),P.type==="lost"?" ":" "," *"]}),i.jsx("input",{type:"date",value:P.date,onChange:W=>I({...P,date:W.target.value}),max:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 dark:focus:border-indigo-500 transition-all",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-3",children:"   ()"}),i.jsx("input",{type:"text",value:P.contact_info,onChange:W=>I({...P,contact_info:W.target.value}),placeholder:":    5   ...",className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 dark:focus:border-indigo-500 transition-all placeholder:text-slate-400 dark:placeholder:text-slate-500"})]}),i.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/50 rounded-2xl p-4 flex gap-3",children:[i.jsx(K0,{size:20,className:"text-blue-600 dark:text-blue-400 shrink-0 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-bold text-blue-800 dark:text-blue-300 mb-1",children:" "}),i.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-400 leading-relaxed opacity-90",children:"  (  )      "})]})]}),i.jsx("button",{type:"submit",disabled:k,className:`w-full py-4 bg-indigo-600 dark:bg-indigo-500 text-white rounded-2xl font-bold flex items-center justify-center gap-2 active:scale-95 transition-transform shadow-lg shadow-indigo-600/20 ${k?"opacity-50 cursor-not-allowed":""}`,children:k?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),i.jsx("span",{children:" ..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(F2,{size:20}),i.jsx("span",{children:" "})]})})]})]})}function yS(){const[b,k]=K.useState([]),[w,P]=K.useState(!0),[I,R]=K.useState({neighborhood:"",status:"",search:""}),T=dr(),c=K.useCallback(async()=>{try{P(!0);const ee={};I.neighborhood&&(ee.neighborhood=I.neighborhood),I.status&&(ee.status=I.status);const ne=await Lt.get("/generators",{params:ee});k(ne.data)}catch(ee){console.error(ee)}finally{P(!1)}},[I]),{isRefreshing:V,pullMoveY:W,handlers:se}=hi(c);return K.useEffect(()=>{c()},[c]),i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...se,children:i.jsxs(pi,{isRefreshing:V,pullMoveY:W,children:[i.jsxs("header",{className:"bg-gradient-to-br from-indigo-600 to-purple-700 text-white sticky top-0 z-30 shadow-xl overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl"}),i.jsxs("div",{className:"px-5 py-6 relative z-10",children:[i.jsx("div",{className:"flex items-center justify-between mb-4",children:i.jsxs("div",{children:[i.jsxs("h1",{className:"text-2xl font-black flex items-center gap-2 leading-none",children:[i.jsx(pl,{size:28,className:"text-yellow-300 animate-pulse"})," "]}),i.jsx("p",{className:"text-xs text-indigo-100 font-medium mt-1",children:"   "})]})}),i.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-3 border border-white/20 active:bg-white/20 transition-colors",children:i.jsxs("div",{className:"relative",children:[i.jsx(ch,{size:16,className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/60"}),i.jsx("input",{type:"text",placeholder:"    ...",value:I.neighborhood,onChange:ee=>R({...I,neighborhood:ee.target.value}),className:"w-full pr-10 pl-3 py-2 bg-white/20 border border-white/10 rounded-xl text-xs text-white placeholder:text-white/60 backdrop-blur-md outline-none focus:ring-1 focus:ring-white/40 transition-all"})]})})]})]}),i.jsxs("main",{className:"px-5 py-6",children:[w?i.jsx("div",{className:"space-y-4",children:[1,2,3].map(ee=>i.jsx(ui,{type:"card"},ee))}):b.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx(pl,{size:64,className:"mx-auto text-slate-300 dark:text-slate-700 mb-4"}),i.jsx("h3",{className:"text-lg font-bold text-slate-700 dark:text-slate-300 mb-2",children:"  "}),i.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-500 font-medium",children:"    "})]}):i.jsx("div",{className:"grid grid-cols-1 gap-4",children:b.map(ee=>i.jsxs("div",{onClick:()=>T(`/generators/${ee.id}`),className:"bg-white dark:bg-slate-800 rounded-[32px] p-6 shadow-premium border border-slate-100 dark:border-slate-700 active:scale-[0.98] transition-all relative overflow-hidden group",children:[i.jsx("div",{className:"absolute top-0 left-0 w-2 h-full bg-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity"}),i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-black text-slate-800 dark:text-slate-100 text-lg mb-1 leading-tight",children:ee.name}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400 font-medium",children:[i.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center",children:i.jsx(qn,{size:10,className:"text-slate-400"})}),i.jsx("span",{children:ee.neighborhood})]})]}),i.jsxs("div",{className:"text-left bg-indigo-50 dark:bg-indigo-900/30 px-3 py-2 rounded-2xl border border-indigo-100 dark:border-indigo-800/50",children:[i.jsx("div",{className:"text-xl font-black text-indigo-600 dark:text-indigo-400 leading-none",children:ee.ampere_price.toLocaleString()}),i.jsx("div",{className:"text-[10px] text-indigo-400 dark:text-indigo-500 font-black uppercase tracking-tighter mt-1 text-center",children:"./"})]})]}),i.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-slate-50 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 bg-yellow-50 dark:bg-yellow-900/20 rounded-xl border border-yellow-100 dark:border-yellow-800/50",children:[i.jsx(ah,{size:14,className:"text-yellow-500 fill-yellow-500"}),i.jsx("span",{className:"text-sm font-black text-slate-800 dark:text-slate-200",children:ee.average_rating||0}),i.jsxs("span",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold",children:["(",ee.ratings_count||0,")"]})]}),i.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-bold flex items-center gap-1",children:[i.jsx("span",{className:"opacity-60",children:""}),i.jsxs("span",{children:[ee.operating_hours,"h "]})]})]})]},ee.id))}),i.jsx("div",{className:"mt-6 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800/50 rounded-2xl p-4 text-center",children:i.jsx("p",{className:"text-xs text-indigo-700 dark:text-indigo-400 font-bold leading-relaxed",children:"             "})})]})]})})}function _S(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0),[T,c]=K.useState(!1);K.useEffect(()=>{(async()=>{try{const ne=await Lt.get(`/generators/${b}`);P(ne.data),c(ne.data.is_subscribed||!1)}catch(ne){console.error(ne)}finally{R(!1)}})()},[b]);const V=async()=>{try{T?(await Lt.delete(`/generators/${b}/subscribe`),c(!1),alert("  ")):(await Lt.post(`/generators/${b}/subscribe`),c(!0),alert("  "))}catch(ee){alert(ee.response?.data?.message||" ")}};if(I)return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center transition-colors duration-300",children:i.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-indigo-600 dark:border-indigo-400 border-t-transparent rounded-full"})});if(!w)return null;const se={active:{bg:"emerald",icon:"",text:""},down:{bg:"rose",icon:"",text:""},maintenance:{bg:"amber",icon:"",text:""}}[w.status];return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("div",{className:"relative h-72 bg-gradient-to-br from-indigo-600 to-purple-700 overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-black/20"}),i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl"}),i.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iZ3JpZCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj48cGF0aCBkPSJNIDQwIDAgTCAwIDAgMCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLW9wYWNpdHk9IjAuMSIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIi8+PC9zdmc+')] opacity-20"}),i.jsx("button",{onClick:()=>k(-1),className:"absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 z-10 active:scale-90 transition-transform",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 text-white relative z-10",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h1",{className:"text-3xl font-black mb-2 leading-tight",children:w.name}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/80 font-medium",children:[i.jsx(qn,{size:14}),i.jsx("span",{children:w.neighborhood})]})]}),i.jsxs("div",{className:"text-left bg-white/20 backdrop-blur-md rounded-3xl px-5 py-4 border border-white/30 shadow-2xl",children:[i.jsx("div",{className:"text-3xl font-black text-white leading-none",children:w.ampere_price.toLocaleString()}),i.jsx("div",{className:"text-[10px] text-white/70 font-black uppercase mt-1 tracking-widest text-center",children:"./"})]})]})})]}),i.jsxs("main",{className:"px-5 -mt-6 relative z-10 space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-5 shadow-premium border border-slate-100 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-50 dark:bg-yellow-900/20 flex items-center justify-center",children:i.jsx(ah,{size:16,className:"text-yellow-500 fill-yellow-500"})}),i.jsx("span",{className:"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider",children:""})]}),i.jsxs("div",{className:"text-2xl font-black text-slate-800 dark:text-slate-100",children:[w.average_rating||0," ",i.jsx("span",{className:"text-sm opacity-50",children:"/ 5"})]}),i.jsxs("div",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold mt-1 tracking-widest uppercase",children:[w.ratings_count||0," "]})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-5 shadow-premium border border-slate-100 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-50 dark:bg-indigo-900/20 flex items-center justify-center",children:i.jsx(oi,{size:16,className:"text-indigo-600 dark:text-indigo-400"})}),i.jsx("span",{className:"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider",children:" "})]}),i.jsxs("div",{className:"text-2xl font-black text-slate-800 dark:text-slate-100",children:[w.operating_hours,"h"]}),i.jsx("div",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold mt-1 tracking-widest uppercase",children:""})]})]}),w.phone&&i.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-3xl p-6 border border-indigo-100 dark:border-indigo-800/50 shadow-sm relative overflow-hidden group",children:[i.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 dark:bg-white/5 rounded-full -mr-16 -mt-16 blur-2xl"}),i.jsxs("h3",{className:"font-black text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-3 relative z-10",children:[i.jsx("div",{className:"w-10 h-10 rounded-2xl bg-indigo-100 dark:bg-indigo-800 flex items-center justify-center",children:i.jsx(tc,{size:18,className:"text-indigo-600 dark:text-indigo-400"})})," "]}),i.jsxs("a",{href:`tel:${w.phone}`,className:"inline-flex items-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-2xl font-black text-sm shadow-lg shadow-indigo-600/20 active:scale-95 transition-all relative z-10",children:[i.jsx(tc,{size:16})," : ",w.phone]})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-5 shadow-premium border border-slate-100 dark:border-slate-700/50 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:`w-3 h-3 rounded-full animate-pulse ${w.status==="active"?"bg-emerald-500":"bg-rose-500"}`}),i.jsx("span",{className:"font-black text-slate-800 dark:text-slate-100",children:se?.text})]}),i.jsx("button",{onClick:V,className:`p-3 rounded-2xl transition-all ${T?"bg-indigo-50 dark:bg-indigo-900/40 text-indigo-600 dark:text-indigo-400":"bg-slate-50 dark:bg-slate-900 text-slate-400"}`,children:T?i.jsx(fm,{size:20}):i.jsx(H1,{size:20})})]}),i.jsxs("button",{onClick:()=>k(`/generators/${b}/rate`),className:"w-full py-5 bg-gradient-to-r from-indigo-600 to-purple-700 text-white rounded-[32px] font-black flex items-center justify-center gap-3 active:scale-95 transition-all shadow-xl shadow-indigo-600/30",children:[i.jsx(ah,{size:24,className:"fill-yellow-400 text-yellow-400"}),i.jsx("span",{children:"  "})]})]})]})}function bS(){const{id:b}=di(),k=dr(),[w,P]=K.useState(!1),[I,R]=K.useState({overall_rating:0,service_quality:0,punctuality:0,power_stability:0,customer_service:0,comment:""}),T=async V=>{if(V.preventDefault(),I.overall_rating===0){alert("  ");return}P(!0);try{await Lt.post(`/generators/${b}/rate`,I),alert(" !"),k(`/generators/${b}`)}catch(W){alert(W.response?.data?.message||" ")}finally{P(!1)}},c=({value:V,onChange:W,label:se})=>i.jsxs("div",{className:"mb-5",children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:se}),i.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(ee=>i.jsx("button",{type:"button",onClick:()=>W(ee),className:"focus:outline-none active:scale-95 transition-transform",children:i.jsx(ah,{size:40,className:ee<=V?"text-yellow-500 fill-yellow-500":"text-slate-300"})},ee))})]});return i.jsxs("div",{className:"min-h-screen bg-slate-50 pb-20",dir:"rtl",children:[i.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-30 px-4 py-4 shadow-sm",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>k(-1),className:"w-10 h-10 bg-slate-50 hover:bg-slate-100 rounded-xl flex items-center justify-center",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800",children:" "}),i.jsx("p",{className:"text-[11px] text-slate-500",children:"   "})]})]})}),i.jsxs("form",{onSubmit:T,className:"px-5 py-6 space-y-6",children:[i.jsx("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 rounded-3xl p-6 border border-indigo-100",children:i.jsx(c,{label:"  *",value:I.overall_rating,onChange:V=>R({...I,overall_rating:V})})}),i.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-sm border border-slate-200 space-y-4",children:[i.jsx("h3",{className:"font-bold text-slate-800 mb-4",children:"  ()"}),i.jsx(c,{label:" ",value:I.service_quality,onChange:V=>R({...I,service_quality:V})}),i.jsx(c,{label:" ",value:I.punctuality,onChange:V=>R({...I,punctuality:V})}),i.jsx(c,{label:" ",value:I.power_stability,onChange:V=>R({...I,power_stability:V})}),i.jsx(c,{label:"",value:I.customer_service,onChange:V=>R({...I,customer_service:V})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-3",children:" ()"}),i.jsx("textarea",{value:I.comment,onChange:V=>R({...I,comment:V.target.value}),placeholder:" ...",rows:4,className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none",maxLength:500}),i.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[I.comment.length,"/500"]})]}),i.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-4 flex gap-3",children:[i.jsx("span",{className:"text-2xl",children:""}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs font-bold text-green-800 mb-1",children:" "}),i.jsx("p",{className:"text-xs text-green-700 leading-relaxed",children:"    .     ."})]})]}),i.jsx("button",{type:"submit",disabled:w,className:`w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold flex items-center justify-center gap-2 active:scale-95 transition-transform shadow-lg ${w?"opacity-50 cursor-not-allowed":""}`,children:w?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),i.jsx("span",{children:" ..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(ah,{size:20}),i.jsx("span",{children:" "})]})})]})]})}const by={novel:{icon:"",label:""},science:{icon:"",label:""},religious:{icon:"",label:""},history:{icon:"",label:""},children:{icon:"",label:""},cooking:{icon:"",label:""},self_development:{icon:"",label:" "},other:{icon:"",label:""}};function vS(){const[b,k]=K.useState([]),[w,P]=K.useState(!0),[I,R]=K.useState({category:"",language:"",search:""}),T=dr(),c=K.useCallback(async()=>{try{P(!0);const ee={};I.category&&(ee.category=I.category),I.language&&(ee.language=I.language),I.search&&(ee.search=I.search);const ne=await Lt.get("/books",{params:ee});k(ne.data)}catch(ee){console.error(ee)}finally{P(!1)}},[I]),{isRefreshing:V,pullMoveY:W,handlers:se}=hi(c);return K.useEffect(()=>{c()},[c]),i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",...se,children:i.jsxs(pi,{isRefreshing:V,pullMoveY:W,children:[i.jsxs("header",{className:"bg-gradient-to-br from-teal-600 to-emerald-700 text-white sticky top-0 z-30 shadow-xl overflow-hidden",children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl"}),i.jsxs("div",{className:"px-5 py-6 relative z-10",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{children:[i.jsxs("h1",{className:"text-2xl font-black flex items-center gap-2",children:[i.jsx(Jh,{size:28}),"  "]}),i.jsx("p",{className:"text-xs text-teal-100 font-medium mt-1",children:"  "})]}),i.jsx("button",{onClick:()=>T("/books/add"),className:"w-12 h-12 bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center border border-white/30 active:scale-95 transition-transform",children:i.jsx(qp,{size:24})})]}),i.jsxs("div",{className:"relative mb-3",children:[i.jsx(ch,{size:20,className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/60"}),i.jsx("input",{type:"text",placeholder:"  ...",value:I.search,onChange:ee=>R({...I,search:ee.target.value}),className:"w-full pr-11 pl-4 py-3 bg-white/20 backdrop-blur-md border border-white/30 rounded-2xl text-sm text-white placeholder:text-white/60 focus:bg-white/30 transition-all outline-none"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("select",{value:I.category,onChange:ee=>R({...I,category:ee.target.value}),className:"px-3 py-2 bg-white/20 backdrop-blur-md border border-white/30 rounded-xl text-xs text-white appearance-none outline-none",children:[i.jsx("option",{value:"",className:"text-slate-800",children:" "}),Object.entries(by).map(([ee,ne])=>i.jsxs("option",{value:ee,className:"text-slate-800",children:[ne.icon," ",ne.label]},ee))]}),i.jsxs("select",{value:I.language,onChange:ee=>R({...I,language:ee.target.value}),className:"px-3 py-2 bg-white/20 backdrop-blur-md border border-white/30 rounded-xl text-xs text-white appearance-none outline-none",children:[i.jsx("option",{value:"",className:"text-slate-800",children:" "}),i.jsx("option",{value:"arabic",className:"text-slate-800",children:""}),i.jsx("option",{value:"english",className:"text-slate-800",children:""}),i.jsx("option",{value:"french",className:"text-slate-800",children:""}),i.jsx("option",{value:"other",className:"text-slate-800",children:""})]})]})]})]}),i.jsxs("main",{className:"px-5 py-6",children:[w?i.jsx("div",{className:"grid grid-cols-2 gap-4",children:[1,2,3,4].map(ee=>i.jsx(ui,{type:"card"},ee))}):b.length===0?i.jsxs("div",{className:"text-center py-16",children:[i.jsx(Jh,{size:64,className:"mx-auto text-slate-300 dark:text-slate-700 mb-4"}),i.jsx("h3",{className:"text-lg font-bold text-slate-700 dark:text-slate-300 mb-2",children:"  "}),i.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-500",children:"    !"})]}):i.jsx("div",{className:"grid grid-cols-2 gap-4",children:b.map(ee=>{const ne=by[ee.category];return i.jsxs("div",{onClick:()=>T(`/books/${ee.id}`),className:"bg-white dark:bg-slate-800 rounded-3xl p-4 shadow-premium border border-slate-100 dark:border-slate-700 active:scale-95 transition-all",children:[i.jsx("div",{className:"aspect-[3/4] bg-gradient-to-br from-teal-100 to-emerald-100 dark:from-teal-900/40 dark:to-emerald-900/40 rounded-2xl mb-3 flex items-center justify-center text-5xl",children:ne?.icon||""}),i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm line-clamp-2 leading-tight mb-1",children:ee.title}),i.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 line-clamp-1 mb-2 font-medium",children:ee.author}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("span",{className:"px-2 py-1 bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400 rounded-lg font-bold text-[10px] w-fit",children:ne?.label}),i.jsx("span",{className:`px-2 py-1 rounded-lg font-bold text-[10px] w-fit ${ee.status==="available"?"bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"bg-rose-50 dark:bg-rose-900/30 text-rose-700 dark:text-rose-400"}`,children:ee.status==="available"?" ":" "})]})]},ee.id)})}),i.jsx("div",{className:"mt-6 bg-teal-50 dark:bg-teal-900/20 border border-teal-100 dark:border-teal-800 rounded-2xl p-4 text-center",children:i.jsx("p",{className:"text-xs text-teal-700 dark:text-teal-400 font-medium",children:"      -    "})})]})]})})}const wS={novel:{icon:"",label:""},science:{icon:"",label:""},religious:{icon:"",label:""},history:{icon:"",label:""},children:{icon:"",label:""},cooking:{icon:"",label:""},self_development:{icon:"",label:" "},other:{icon:"",label:""}};function kS(){const{id:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState(!0);K.useEffect(()=>{(async()=>{try{const W=await Lt.get(`/books/${b}`);P(W.data)}catch(W){console.error(W)}finally{R(!1)}})()},[b]);const T=async()=>{try{await Lt.post(`/books/${b}/request`),alert("   !"),k("/books/my-library")}catch(V){alert(V.response?.data?.message||" ")}};if(I)return i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center transition-colors duration-300",children:i.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-teal-600 dark:border-teal-400 border-t-transparent rounded-full"})});if(!w)return null;const c=wS[w.category];return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"bg-gradient-to-br from-teal-600 to-emerald-700 h-64 relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-black/20"}),i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl"}),i.jsx("button",{onClick:()=>k(-1),className:"absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 z-10 active:scale-90 transition-transform",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 text-white relative z-10",children:[i.jsx("div",{className:"text-6xl mb-3 text-center animate-float",children:c?.icon||""}),i.jsx("h1",{className:"text-2xl font-black text-center leading-tight",children:w.title}),i.jsx("p",{className:"text-sm text-teal-100 text-center mt-1 font-medium",children:w.author})]})]}),i.jsxs("main",{className:"px-5 -mt-6 relative z-10 space-y-4",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-premium border border-slate-100 dark:border-slate-700/50",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4 pb-4 border-b border-slate-100 dark:border-slate-700/50",children:[i.jsx("div",{className:"w-12 h-12 bg-teal-50 dark:bg-teal-900/30 rounded-2xl flex items-center justify-center text-2xl shadow-inner",children:c?.icon}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-black uppercase tracking-widest",children:""}),i.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100",children:c?.label})]})]}),w.description&&i.jsxs(i.Fragment,{children:[i.jsx("h3",{className:"font-black text-slate-800 dark:text-slate-100 mb-2 text-sm",children:""}),i.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-loose mb-4 font-medium opacity-90",children:w.description})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 border border-slate-100 dark:border-slate-700/30",children:[i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-black uppercase mb-1",children:""}),i.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm",children:w.language==="arabic"?"":w.language==="english"?"":w.language==="french"?"":""})]}),i.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-2xl p-4 border border-slate-100 dark:border-slate-700/30",children:[i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-black uppercase mb-1",children:""}),i.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm",children:w.condition==="new"?"":w.condition==="good"?"":""})]})]})]}),w.user&&i.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-emerald-50 dark:from-teal-900/20 dark:to-emerald-900/20 rounded-3xl p-5 border border-teal-100 dark:border-teal-800/50 shadow-sm relative overflow-hidden",children:[i.jsx("div",{className:"absolute bottom-0 right-0 w-32 h-32 bg-teal-500/5 rounded-full -mr-16 -mb-16 blur-2xl"}),i.jsxs("h3",{className:"font-black text-slate-800 dark:text-slate-100 mb-3 flex items-center gap-2 relative z-10",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-teal-100 dark:bg-teal-800 flex items-center justify-center",children:i.jsx(tp,{size:16,className:"text-teal-600 dark:text-teal-400"})})," "]}),i.jsx("p",{className:"text-sm font-black text-slate-800 dark:text-slate-100 mb-2 relative z-10",children:w.user.name}),w.user.neighborhood&&i.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500 dark:text-slate-400 font-medium relative z-10",children:[i.jsx(qn,{size:12}),i.jsx("span",{children:w.user.neighborhood})]})]}),w.status==="available"?i.jsxs("button",{onClick:T,className:"w-full py-5 bg-teal-600 dark:bg-teal-500 text-white rounded-2xl font-black flex items-center justify-center gap-2 active:scale-95 transition-all shadow-lg shadow-teal-500/20",children:[i.jsx(Jh,{size:20}),i.jsx("span",{children:"   "})]}):i.jsx("div",{className:"bg-rose-50 dark:bg-rose-900/20 border border-rose-100 dark:border-rose-800/50 rounded-2xl p-5 text-center shadow-sm",children:i.jsxs("p",{className:"text-sm font-black text-rose-700 dark:text-rose-400 flex items-center justify-center gap-2",children:[i.jsx("span",{className:"w-2 h-2 bg-rose-500 rounded-full animate-pulse"}),"  "]})})]})]})}const vy={novel:{icon:"",label:""},science:{icon:"",label:""},religious:{icon:"",label:""},history:{icon:"",label:""},children:{icon:"",label:""},cooking:{icon:"",label:""},self_development:{icon:"",label:" "},other:{icon:"",label:""}};function jS(){const b=dr(),[k,w]=K.useState(!1),[P,I]=K.useState({title:"",author:"",description:"",category:"novel",language:"arabic",condition:"good"}),[R,T]=K.useState(null),[c,V]=K.useState(null),[W,se]=K.useState(!1);K.useEffect(()=>{P.title||P.author||P.description||R?se(!0):se(!1)},[P,R]),K.useEffect(()=>{const re=H=>{W&&(H.preventDefault(),H.returnValue="")};return window.addEventListener("beforeunload",re),()=>window.removeEventListener("beforeunload",re)},[W]);const ee=()=>{W?window.confirm("       .")&&b(-1):b(-1)},ne=re=>{const H=re.target.files?.[0];if(H){T(H);const Ze=new FileReader;Ze.onloadend=()=>{V(Ze.result)},Ze.readAsDataURL(H)}},ke=()=>{T(null),V(null)},je=async re=>{if(re.preventDefault(),!P.title||!P.author){alert("   ");return}w(!0);try{const H=new FormData;H.append("title",P.title),H.append("author",P.author),H.append("description",P.description||""),H.append("category",P.category),H.append("language",P.language),H.append("condition",P.condition),R&&H.append("cover_image",R),await Lt.post("/books",H,{headers:{"Content-Type":"multipart/form-data"}}),se(!1),alert("   !"),b("/books")}catch(H){console.error("Add book error:",H),alert(H.response?.data?.message||"    ")}finally{w(!1)}};return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsx("header",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-30 px-4 py-4 shadow-sm",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:ee,className:"w-10 h-10 bg-slate-50 dark:bg-slate-700 hover:bg-slate-100 dark:hover:bg-slate-600 rounded-xl flex items-center justify-center text-slate-800 dark:text-slate-100 transition-colors",children:i.jsx(Cr,{size:20,className:""})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:" "}),i.jsx("p",{className:"text-[11px] text-slate-500 dark:text-slate-400",children:"   "})]})]})}),i.jsxs("form",{onSubmit:je,className:"px-5 py-6 space-y-5",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"  *"}),i.jsx("input",{type:"text",value:P.title,onChange:re=>I({...P,title:re.target.value}),placeholder:":  ",className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-teal-500 dark:focus:border-teal-500 transition-all placeholder:text-slate-400 dark:placeholder:text-slate-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"  *"}),i.jsx("input",{type:"text",value:P.author,onChange:re=>I({...P,author:re.target.value}),placeholder:":   ",className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-teal-500 dark:focus:border-teal-500 transition-all placeholder:text-slate-400 dark:placeholder:text-slate-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:" ()"}),i.jsx("textarea",{value:P.description,onChange:re=>I({...P,description:re.target.value}),placeholder:"   ...",rows:3,className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-teal-500 dark:focus:border-teal-500 transition-all resize-none placeholder:text-slate-400 dark:placeholder:text-slate-500"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:""}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{value:P.category,onChange:re=>I({...P,category:re.target.value}),className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-teal-500 dark:focus:border-teal-500 appearance-none transition-all",children:Object.entries(vy).map(([re,H])=>i.jsx("option",{value:re,children:H.label},re))}),i.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-xl",children:vy[P.category].icon})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:""}),i.jsxs("select",{value:P.language,onChange:re=>I({...P,language:re.target.value}),className:"w-full px-4 py-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-teal-500 dark:focus:border-teal-500 transition-all",children:[i.jsx("option",{value:"arabic",children:""}),i.jsx("option",{value:"english",children:""}),i.jsx("option",{value:"french",children:""}),i.jsx("option",{value:"other",children:""})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:" "}),i.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"new",label:"",emoji:""},{value:"good",label:"",emoji:""},{value:"acceptable",label:"",emoji:""}].map(re=>i.jsxs("button",{type:"button",onClick:()=>I({...P,condition:re.value}),className:`p-3 rounded-xl border-2 transition-all active:scale-95 ${P.condition===re.value?"border-teal-500 bg-teal-50 dark:bg-teal-900/30 dark:border-teal-400":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800"}`,children:[i.jsx("div",{className:"text-2xl mb-1",children:re.emoji}),i.jsx("p",{className:`text-xs font-bold ${P.condition===re.value?"text-teal-700 dark:text-teal-400":"text-slate-600 dark:text-slate-400"}`,children:re.label})]},re.value))})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 px-1",children:"   ()"}),i.jsx("input",{type:"file",id:"book-image-upload",accept:"image/*",className:"hidden",onChange:ne}),c?i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:c,alt:"Book Preview",className:"w-full h-48 object-cover rounded-2xl border border-slate-200 dark:border-slate-700 shadow-md"}),i.jsx("button",{type:"button",onClick:ke,className:"absolute top-3 right-3 w-10 h-10 bg-black/60 backdrop-blur-md text-white rounded-xl flex items-center justify-center hover:bg-black/80 transition-all border border-white/20",children:i.jsx(Cr,{className:"rotate-45",size:20})})]}):i.jsxs("label",{htmlFor:"book-image-upload",className:"w-full py-8 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-3xl text-slate-400 dark:text-slate-600 hover:text-teal-600 dark:hover:text-teal-400 hover:border-teal-200 dark:hover:border-teal-700 transition-all flex flex-col items-center gap-3 bg-white dark:bg-slate-800/50 cursor-pointer",children:[i.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700",children:i.jsx(Jh,{size:32,className:"text-teal-500"})}),i.jsxs("div",{className:"text-center",children:[i.jsx("span",{className:"text-xs font-bold block mb-1",children:"    "}),i.jsx("span",{className:"text-[10px] opacity-60",children:"      "})]})]})]}),i.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800/50 rounded-2xl p-4",children:i.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 font-medium leading-relaxed",children:"     .        ."})}),i.jsx("button",{type:"submit",disabled:k,className:`w-full py-4 bg-teal-600 dark:bg-teal-500 text-white rounded-2xl font-bold flex items-center justify-center gap-2 active:scale-95 transition-transform shadow-lg shadow-teal-600/20 ${k?"opacity-50 cursor-not-allowed":""}`,children:k?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),i.jsx("span",{children:" ..."})]}):i.jsxs(i.Fragment,{children:[i.jsx(Jh,{size:20}),i.jsx("span",{children:" "})]})})]})]})}const wy={emerald:"from-emerald-500 to-green-600",blue:"from-blue-500 to-indigo-600",amber:"from-amber-500 to-orange-600",yellow:"from-yellow-500 to-orange-500",purple:"from-purple-500 to-indigo-600",red:"from-red-500 to-rose-600"};function SS(){const b=dr(),[k,w]=K.useState([]),[P,I]=K.useState(!0);return K.useEffect(()=>{(async()=>{try{I(!0);const T=await Lt.get("/ai-studies?category=awareness"),c=T.data.data||T.data,V={};c.forEach(se=>{const ee=se.tags||"other";V[ee]||(V[ee]=[]),V[ee].push(se)});const W=Object.entries(V).map(([se,ee])=>{const ne=ee[0];return{id:se,title:se==="clean-daraya"?" ":se==="traffic-safety"?" ":ne.title,subtitle:se==="clean-daraya"?"Clean Daraya Initiative":se==="traffic-safety"?"Traffic Safety":"",icon:ne.icon||"",color:ne.color||"emerald",description:ne.summary||"",articles:ee}});w(W)}catch(T){console.error("Error fetching awareness campaigns:",T)}finally{I(!1)}})()},[]),i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"bg-gradient-to-br from-indigo-600 to-purple-700 text-white pb-14 pt-8 z-30 relative overflow-hidden shadow-xl",children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl"}),i.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-purple-500/20 rounded-full -ml-24 -mb-24 blur-2xl"}),i.jsx("div",{className:"px-5 relative z-10",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-4xl mb-3 animate-float",children:""}),i.jsx("h1",{className:"text-2xl font-black mb-1 leading-tight tracking-tight",children:" "}),i.jsx("p",{className:"text-xs text-indigo-100 font-medium",children:"    "})]})})]}),i.jsxs("main",{className:"px-5 -mt-10 relative z-40 bg-slate-50 dark:bg-slate-900 rounded-t-[40px] pt-8 min-h-[calc(100vh-200px)] transition-colors duration-300",children:[P?i.jsx("div",{className:"grid grid-cols-2 gap-4",children:[1,2,3,4].map(R=>i.jsx(ui,{type:"card"},R))}):i.jsx("div",{className:"grid grid-cols-2 gap-4",children:k.map(R=>i.jsxs("div",{onClick:()=>b(`/awareness/campaign/${R.id}`),className:`bg-gradient-to-br ${wy[R.color]||wy.emerald} p-5 rounded-3xl active:scale-95 transition-all cursor-pointer shadow-lg relative overflow-hidden group`,children:[i.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -mr-12 -mt-12 blur-2xl group-hover:bg-white/20 transition-colors"}),i.jsxs("div",{className:"relative z-10",children:[i.jsx("div",{className:"text-5xl mb-3 group-hover:scale-110 transition-transform origin-right",children:R.icon}),i.jsx("h3",{className:"font-black text-white text-base mb-1 leading-tight",children:R.title}),i.jsx("p",{className:"text-[10px] text-white/80 font-bold mb-2 uppercase tracking-wide",children:R.subtitle}),i.jsx("p",{className:"text-[10px] text-white/70 leading-relaxed line-clamp-2 font-medium",children:R.description}),i.jsxs("div",{className:"mt-4 flex items-center gap-1.5 text-[10px] text-white/90 bg-white/10 w-fit px-2 py-1 rounded-lg border border-white/10 font-black",children:[i.jsx(K1,{size:10}),i.jsxs("span",{children:[R.articles.length," "]})]})]})]},R.id))}),i.jsx("div",{className:"mt-8 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/10 dark:to-purple-900/10 border border-indigo-100 dark:border-indigo-800/50 rounded-2xl p-4 text-center",children:i.jsx("p",{className:"text-xs text-indigo-700 dark:text-indigo-400 font-black leading-relaxed",children:"            "})})]})]})}const Hf={emerald:"from-emerald-500 to-green-600",blue:"from-blue-500 to-indigo-600",amber:"from-amber-500 to-orange-600",yellow:"from-yellow-500 to-orange-500",purple:"from-purple-500 to-indigo-600",red:"from-red-500 to-rose-600"};function TS(){const{campaignId:b}=di(),k=dr(),[w,P]=K.useState(null),[I,R]=K.useState([]),[T,c]=K.useState(!0);return K.useEffect(()=>{(async()=>{try{c(!0);const W=await Lt.get(`/ai-studies?category=awareness&tags=${b}`),se=W.data.data||W.data;if(se.length>0){const ee=se[0];P({id:b||"",title:b==="clean-daraya"?" ":b==="traffic-safety"?" ":ee.title,subtitle:b==="clean-daraya"?"Clean Daraya Initiative":b==="traffic-safety"?"Traffic Safety":"",icon:ee.icon||"",color:ee.color||"emerald",description:ee.summary||""}),R(se)}}catch(W){console.error("Error fetching campaign detail:",W)}finally{c(!1)}})()},[b]),T?i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-5 space-y-4 transition-colors duration-300",dir:"rtl",children:[i.jsx(ui,{type:"card"}),i.jsx(ui,{type:"card"}),i.jsx(ui,{type:"card"})]}):w?i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:`bg-gradient-to-br ${Hf[w.color]||Hf.emerald} h-64 relative overflow-hidden shadow-xl`,children:[i.jsx("div",{className:"absolute inset-0 bg-black/10"}),i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl"}),i.jsx("button",{onClick:()=>k(-1),className:"absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 z-10 active:scale-90 transition-transform",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 text-white relative z-10",children:[i.jsx("div",{className:"text-6xl mb-3 animate-float",children:w.icon}),i.jsx("h1",{className:"text-3xl font-black mb-1 leading-tight",children:w.title}),i.jsx("p",{className:"text-sm text-white/80 font-medium tracking-wide uppercase",children:w.subtitle})]})]}),i.jsxs("main",{className:"px-5 -mt-6 relative z-10",children:[i.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-premium border border-slate-100 dark:border-slate-700/50 mb-6 group",children:i.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-loose text-center font-medium",children:w.description})}),i.jsxs("div",{className:"flex items-center justify-between mb-4 px-2",children:[i.jsx("h2",{className:"text-lg font-black text-slate-800 dark:text-slate-100",children:" "}),i.jsxs("span",{className:"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest",children:[I.length," "]})]}),i.jsx("div",{className:"space-y-3",children:I.map(V=>i.jsxs("div",{onClick:()=>k(`/awareness/campaign/${w.id}/${V.id}`),className:"bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-premium border border-slate-100 dark:border-slate-700/50 active:scale-[0.98] transition-all flex items-center gap-4 group",children:[i.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${Hf[w.color]||Hf.emerald} rounded-xl flex items-center justify-center text-white flex-shrink-0 shadow-lg group-hover:scale-105 transition-transform`,children:i.jsx(Yy,{size:22})}),i.jsx("div",{className:"flex-1",children:i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm leading-tight leading-snug",children:V.title})}),i.jsx(Cr,{size:18,className:"text-slate-300 group-hover:text-indigo-500 transition-colors"})]},V.id))}),i.jsx("div",{className:"mt-8 py-4 border-t border-slate-200 dark:border-slate-800 text-center",children:i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-500 font-bold uppercase tracking-[0.2em]",children:"  "})})]})]}):i.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center p-4",dir:"rtl",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h3",{className:"text-lg font-bold text-slate-700 dark:text-slate-300 mb-2",children:"  "}),i.jsx("button",{onClick:()=>k(-1),className:"text-sm text-indigo-600 dark:text-indigo-400 font-bold",children:""})]})})}const Wf={emerald:"from-emerald-500 to-green-600",blue:"from-blue-500 to-indigo-600",amber:"from-amber-500 to-orange-600",yellow:"from-yellow-500 to-orange-500",purple:"from-purple-500 to-indigo-600",red:"from-red-500 to-rose-600"};function NS(){const{campaignId:b,articleId:k}=di(),w=dr(),[P,I]=K.useState(null),[R,T]=K.useState(!0);K.useEffect(()=>{(async()=>{try{T(!0);const ne=await Lt.get(`/ai-studies/${k}`);I(ne.data)}catch(ne){console.error("Error fetching article:",ne)}finally{T(!1)}})()},[k]);const c=ee=>ee?ee.split(`
`).map((ne,ke)=>{if(ne.startsWith("## "))return i.jsx("h3",{className:"text-xl font-black text-slate-800 dark:text-slate-100 mt-6 mb-3 leading-tight tracking-tight",children:ne.substring(3)},ke);if(ne.startsWith("# "))return i.jsx("h2",{className:"text-2xl font-black text-slate-900 dark:text-white mt-8 mb-4 leading-none tracking-tighter",children:ne.substring(2)},ke);if(ne.startsWith("**")&&ne.endsWith("**"))return i.jsx("p",{className:"font-black text-slate-800 dark:text-slate-200 mt-4 mb-2 text-sm uppercase tracking-wide",children:ne.replace(/\*\*/g,"")},ke);if(ne.startsWith(""))return i.jsx("li",{className:"text-sm text-slate-600 dark:text-slate-300 leading-loose mr-5 mb-2 list-disc marker:text-indigo-500",children:ne.substring(1).trim()},ke);if(/^\d+/.test(ne))return i.jsx("li",{className:"text-sm text-slate-600 dark:text-slate-300 leading-loose mr-6 mb-3 list-none relative before:absolute before:-right-6 before:content-['']",children:ne},ke);if(ne.includes("")||ne.includes("")||ne.includes("")||ne.includes("")){const re=ne.includes("")||ne.includes("")||ne.includes("")?"bg-rose-50 dark:bg-rose-900/20 border-rose-100 dark:border-rose-800/50 text-rose-700 dark:text-rose-400":"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-100 dark:border-emerald-800/50 text-emerald-700 dark:text-emerald-400";return i.jsx("p",{className:`text-sm font-black py-4 px-5 rounded-2xl border shadow-sm ${re} my-4 leading-relaxed`,children:ne},ke)}return ne.includes("")||ne.includes("")||ne.includes("")||ne.includes("")?i.jsx("p",{className:"text-sm bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800/50 text-indigo-700 dark:text-indigo-400 font-bold py-4 px-5 rounded-2xl my-4 shadow-sm leading-relaxed",children:ne},ke):ne.trim()===""?i.jsx("div",{className:"h-4"},ke):i.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 leading-loose mb-3 font-medium opacity-90",children:ne},ke)}):null;if(R)return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-5 space-y-4 transition-colors duration-300",dir:"rtl",children:[i.jsx(ui,{type:"card"}),i.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-[40px] p-8 h-96 shadow-premium border border-slate-100 dark:border-slate-700/50 animate-pulse"})]});if(!P)return i.jsx("div",{className:"p-10 text-center text-slate-500 font-black tracking-widest uppercase",dir:"rtl",children:"  "});const V=P.color||"emerald",W=P.icon||"",se=b==="clean-daraya"?" ":b==="traffic-safety"?" ":P.tags||"";return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:`bg-gradient-to-br ${Wf[V]||Wf.emerald} relative shadow-xl overflow-hidden`,children:[i.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32 blur-3xl"}),i.jsxs("div",{className:"px-5 py-10 relative z-10",children:[i.jsx("button",{onClick:()=>w(-1),className:"w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/30 mb-6 active:scale-90 transition-transform",children:i.jsx(Cr,{size:20,className:"rotate-180"})}),i.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[i.jsx("div",{className:"text-5xl animate-float drop-shadow-lg",children:W}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[10px] text-white/70 font-black uppercase tracking-[0.2em] mb-0.5",children:se}),i.jsx("h1",{className:"text-2xl font-black text-white leading-tight tracking-tight shadow-text",children:P.title})]})]})]})]}),i.jsxs("main",{className:"px-5 -mt-6 relative z-20",children:[i.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-[40px] p-8 shadow-premium border border-slate-100 dark:border-slate-700/50 min-h-[400px]",children:c(P.content)}),i.jsxs("div",{className:`mt-8 bg-gradient-to-br ${Wf[V]||Wf.emerald} p-6 rounded-[32px] text-center shadow-lg relative overflow-hidden group`,children:[i.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12 blur-2xl group-hover:scale-150 transition-transform cursor-default"}),i.jsx("p",{className:"text-sm font-black text-white leading-relaxed relative z-10",children:"      "})]}),i.jsx("div",{className:"mt-10 py-6 text-center border-t border-slate-200 dark:border-slate-800",children:i.jsx("p",{className:"text-[10px] text-slate-400 dark:text-slate-600 font-black uppercase tracking-widest",children:"   "})})]})]})}function ES(){const b=dr(),{theme:k,toggleTheme:w}=ig(),[P,I]=K.useState(!0),R=({icon:c,title:V,subtitle:W,action:se,value:ee})=>i.jsxs("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm active:scale-[0.98] transition-all cursor-pointer",onClick:se,children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${k==="dark"?"bg-slate-700 text-slate-300":"bg-slate-100 text-slate-500"}`,children:i.jsx(c,{size:20})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-bold text-slate-800 dark:text-slate-100",children:V}),W&&i.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400 mt-0.5",children:W})]})]}),i.jsx("div",{className:"flex items-center gap-2",children:ee})]}),T=({checked:c,onChange:V})=>i.jsx("div",{className:`w-12 h-7 rounded-full p-1 transition-colors duration-300 flex items-center ${c?"bg-indigo-600":"bg-slate-300 dark:bg-slate-600"}`,onClick:W=>{W.stopPropagation(),V()},children:i.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-300 ${c?"-translate-x-5":"translate-x-0"}`})});return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"px-4 py-5 flex items-center gap-3 sticky top-0 z-30 bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-md",children:[i.jsx("button",{onClick:()=>b(-1),className:"w-10 h-10 flex items-center justify-center bg-white dark:bg-slate-800 rounded-xl text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 shadow-sm",children:i.jsx(Cr,{size:20})}),i.jsx("h1",{className:"text-xl font-black text-slate-800 dark:text-slate-100",children:""})]}),i.jsxs("main",{className:"px-4 space-y-6",children:[i.jsxs("section",{className:"space-y-3",children:[i.jsx("h2",{className:"px-1 text-xs font-black text-slate-400 uppercase tracking-wider",children:""}),i.jsx(R,{icon:k==="dark"?e_:r_,title:" ",subtitle:k==="dark"?"":"",action:w,value:i.jsx(T,{checked:k==="dark",onChange:w})}),i.jsx(R,{icon:rh,title:"",subtitle:" ()",action:()=>{},value:i.jsx("span",{className:"text-xs font-bold text-slate-500",children:""})}),i.jsx(R,{icon:fm,title:"",subtitle:"  ",action:()=>I(!P),value:i.jsx(T,{checked:P,onChange:()=>I(!P)})})]}),i.jsxs("section",{className:"space-y-3",children:[i.jsx("h2",{className:"px-1 text-xs font-black text-slate-400 uppercase tracking-wider",children:" "}),i.jsx(R,{icon:sh,title:" ",subtitle:"  ",action:()=>{},value:i.jsx(id,{size:16,className:"text-slate-400"})}),i.jsx(R,{icon:gm,title:" ",subtitle:"  ",action:()=>{},value:i.jsx(id,{size:16,className:"text-slate-400"})})]}),i.jsxs("div",{className:"pt-6 text-center",children:[i.jsx("p",{className:"text-xs font-medium text-slate-400",children:"Darayya App v1.0.0"}),i.jsx("p",{className:"text-[10px] text-slate-300 mt-1",children:"Designed with  for Darayya"})]})]})]})}function CS(){const b=dr(),[k,w]=K.useState(!1),[P,I]=K.useState({name:" ",email:"user@darayya.net",phone:"0912345678",bio:"   ."}),R=async T=>{T.preventDefault(),w(!0),setTimeout(()=>{w(!1),b(-1)},1500)};return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"px-4 py-5 flex items-center gap-3 sticky top-0 z-30 bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-md",children:[i.jsx("button",{onClick:()=>b(-1),className:"w-10 h-10 flex items-center justify-center bg-white dark:bg-slate-800 rounded-xl text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 shadow-sm",children:i.jsx(Cr,{size:20})}),i.jsx("h1",{className:"text-xl font-black text-slate-800 dark:text-slate-100",children:"  "})]}),i.jsx("main",{className:"px-4 py-6",children:i.jsxs("form",{onSubmit:R,className:"space-y-6",children:[i.jsxs("div",{className:"flex flex-col items-center justify-center mb-8",children:[i.jsxs("div",{className:"relative group",children:[i.jsx("div",{className:"w-28 h-28 rounded-full bg-slate-200 dark:bg-slate-800 overflow-hidden border-4 border-white dark:border-slate-700 shadow-lg",children:i.jsx("img",{src:"https://i.pravatar.cc/150?u=me",alt:"Profile",className:"w-full h-full object-cover"})}),i.jsx("button",{type:"button",className:"absolute bottom-0 right-0 w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-indigo-700 transition-colors",children:i.jsx(om,{size:16})})]}),i.jsx("p",{className:"mt-3 text-xs text-slate-500 font-medium",children:"  "})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-1.5",children:[i.jsx("label",{className:"text-xs font-bold text-slate-600 dark:text-slate-400 px-1",children:" "}),i.jsxs("div",{className:"relative",children:[i.jsx(tp,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),i.jsx("input",{type:"text",value:P.name,onChange:T=>I({...P,name:T.target.value}),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl py-3 pr-10 pl-4 text-sm font-bold text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all"})]})]}),i.jsxs("div",{className:"space-y-1.5",children:[i.jsx("label",{className:"text-xs font-bold text-slate-600 dark:text-slate-400 px-1",children:" "}),i.jsx("textarea",{rows:3,value:P.bio,onChange:T=>I({...P,bio:T.target.value}),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl py-3 px-4 text-sm font-medium text-slate-800 dark:text-slate-100 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all resize-none"})]}),i.jsxs("div",{className:"space-y-1.5",children:[i.jsx("label",{className:"text-xs font-bold text-slate-600 dark:text-slate-400 px-1",children:" "}),i.jsxs("div",{className:"relative",children:[i.jsx(Q0,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),i.jsx("input",{type:"email",value:P.email,onChange:T=>I({...P,email:T.target.value}),className:"w-full bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl py-3 pr-10 pl-4 text-sm font-bold text-slate-500 dark:text-slate-400 cursor-not-allowed",disabled:!0})]}),i.jsx("p",{className:"text-[10px] text-amber-500 px-1",children:"    "})]})]}),i.jsx("div",{className:"pt-4",children:i.jsx("button",{type:"submit",disabled:k,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-indigo-600/20 active:scale-[0.98] transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:k?i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx(_2,{size:20}),i.jsx("span",{children:" "})]})})})]})})]})}function PS(){const b=dr();return i.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 transition-colors duration-300",dir:"rtl",children:[i.jsxs("header",{className:"px-4 py-5 flex items-center gap-3 sticky top-0 z-30 bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-md",children:[i.jsx("button",{onClick:()=>b(-1),className:"w-10 h-10 flex items-center justify-center bg-white dark:bg-slate-800 rounded-xl text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 shadow-sm",children:i.jsx(Cr,{size:20})}),i.jsx("h1",{className:"text-xl font-black text-slate-800 dark:text-slate-100",children:" "})]}),i.jsxs("main",{className:"px-4 py-8 flex flex-col items-center text-center",children:[i.jsx("div",{className:"w-24 h-24 bg-white dark:bg-slate-800 rounded-3xl shadow-premium border border-slate-100 dark:border-slate-700 flex items-center justify-center mb-6",children:i.jsx("img",{src:"/logo.png",alt:"Darayya Logo",className:"w-16 h-16 object-contain",onError:k=>k.currentTarget.src="https://via.placeholder.com/64"})}),i.jsx("h2",{className:"text-2xl font-black text-slate-800 dark:text-slate-100 mb-2",children:""}),i.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 mb-8 max-w-xs",children:"             ."}),i.jsxs("div",{className:"w-full max-w-sm space-y-4",children:[i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm text-right",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx(J0,{size:20,className:"text-indigo-500"}),i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200",children:" "})]}),i.jsx("p",{className:"text-slate-500 text-sm",children:"v1.0.0 (Beta)"})]}),i.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm text-right",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx(Yc,{size:20,className:"text-red-500"}),i.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200",children:" "})]}),i.jsx("p",{className:"text-slate-500 text-sm leading-relaxed",children:"           ."})]})]}),i.jsxs("div",{className:"mt-12 flex gap-4",children:[i.jsx("a",{href:"#",className:"w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-600 dark:text-slate-400 flex items-center justify-center hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors",children:i.jsx(Pw,{size:20})}),i.jsx("a",{href:"#",className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-500 dark:text-blue-400 flex items-center justify-center hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:i.jsx(R2,{size:20})})]}),i.jsx("div",{className:"mt-8 text-[10px] text-slate-400",children:" 2026   "})]})]})}function MS(){const b=yo(),k=["/","/news","/discussions","/notifications","/profile","/initiatives","/awareness","/studies"],w=b.pathname.endsWith("/")&&b.pathname.length>1?b.pathname.slice(0,-1):b.pathname;if(!k.some(R=>w===R||R!=="/"&&w.startsWith(R+"/")))return null;const I=[{path:"/",icon:i.jsx(Dw,{size:22}),label:""},{path:"/studies",icon:i.jsx(rh,{size:22}),label:""},{path:"/discussions",icon:i.jsx(mm,{size:22}),label:""},{path:"/initiatives",icon:i.jsx(Jn,{size:22}),label:""},{path:"/profile",icon:i.jsx(tp,{size:22}),label:""}];return i.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white/95 dark:bg-slate-900/98 backdrop-blur-xl border-t border-slate-200/60 dark:border-slate-800/60 flex justify-around items-center z-[100] shadow-[0_-10px_30px_-15px_rgba(0,0,0,0.1)] safe-bottom transition-all duration-300",children:I.map(R=>{const T=b.pathname===R.path;return i.jsxs(qy,{to:R.path,onClick:()=>sm.lightImpact(),className:`flex flex-col items-center justify-center w-full h-16 transition-all relative ${T?"text-emerald-600":"text-slate-400"}`,children:[i.jsx("span",{className:`mb-1 transition-transform ${T?"scale-110 -translate-y-0.5":""}`,children:R.icon}),i.jsx("span",{className:`text-[10px] font-bold ${T?"opacity-100":"opacity-60"}`,children:R.label}),T&&i.jsx("div",{className:"absolute bottom-0 w-12 h-1 bg-emerald-600 rounded-t-full shadow-[0_-2px_6px_rgba(5,150,105,0.3)]"})]},R.path)})})}function IS(){const{pathname:b}=yo();return K.useEffect(()=>{window.scrollTo(0,0)},[b]),null}class zS extends K.Component{state={hasError:!1,error:null,errorInfo:null};static getDerivedStateFromError(k){return{hasError:!0,error:k,errorInfo:null}}componentDidCatch(k,w){console.error("Uncaught error:",k,w),this.setState({errorInfo:w})}render(){return this.state.hasError?i.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center p-6 text-center",dir:"rtl",children:[i.jsx("div",{className:"text-4xl mb-4",children:""}),i.jsx("h1",{className:"text-xl font-bold text-red-600 mb-2",children:"    "}),i.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"     "}),i.jsx("div",{className:"bg-gray-100 p-4 rounded-lg w-full text-left overflow-auto max-h-64 mb-6 shadow-inner border border-gray-200",children:i.jsxs("code",{className:"text-xs text-red-800 font-mono whitespace-pre-wrap break-all",children:[this.state.error&&this.state.error.toString(),i.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})}),i.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition",children:"  "})]}):this.props.children}}function AS(){const b=yo(),k=dr(),P=!["/login","/register","/splash","/skills","/add-report","/study"].some(I=>b.pathname.includes(I));return K.useEffect(()=>{const I=["/splash","/login","/register"],R=localStorage.getItem("token");if(!R&&!I.includes(b.pathname))k("/splash");else if(R&&b.pathname!=="/setup-location"&&!I.includes(b.pathname)){const V=localStorage.getItem("user");if(V)try{JSON.parse(V).location_verified_at||k("/setup-location")}catch(W){console.error("Error parsing user",W)}}const T=async()=>{try{(await nd.checkPermissions()).location!=="granted"&&await nd.requestPermissions();const W=await nd.getCurrentPosition();R&&await Lt.post("/api/user/location",{latitude:W.coords.latitude,longitude:W.coords.longitude},{headers:{Authorization:`Bearer ${R}`}})}catch(V){console.error("Location tracking failed",V)}};if(R){T();const V=setInterval(T,3e5);return()=>clearInterval(V)}const c=async()=>{navigator.onLine&&await Zp(()=>Promise.resolve().then(()=>wj),void 0,import.meta.url).then(V=>V.OfflineService.syncReports())};return window.addEventListener("online",c),c(),()=>window.removeEventListener("online",c)},[b.pathname]),i.jsxs("div",{className:`min-h-screen safe-top ${P?"pb-20":""}`,children:[i.jsxs(Uv,{children:[i.jsx(cr,{path:"/",element:i.jsx(Pj,{})}),i.jsx(cr,{path:"/studies",element:i.jsx(Mj,{})}),i.jsx(cr,{path:"/study/:id",element:i.jsx(Ij,{})}),i.jsx(cr,{path:"/awareness/:id",element:i.jsx(hy,{})}),i.jsx(cr,{path:"/profile",element:i.jsx(zj,{})}),i.jsx(cr,{path:"/services-status",element:i.jsx(Aj,{})}),i.jsx(cr,{path:"/water-status",element:i.jsx(Dj,{})}),i.jsx(cr,{path:"/events",element:i.jsx(Rj,{})}),i.jsx(cr,{path:"/events/:id",element:i.jsx(Lj,{})}),i.jsx(cr,{path:"/hashtag",element:i.jsx(Fj,{})}),i.jsx(cr,{path:"/skills",element:i.jsx(Bj,{})}),i.jsx(cr,{path:"/login",element:i.jsx(Vj,{})}),i.jsx(cr,{path:"/register",element:i.jsx($j,{})}),i.jsx(cr,{path:"/splash",element:i.jsx(Uj,{})}),i.jsx(cr,{path:"/setup-location",element:i.jsx(Hj,{})}),i.jsx(cr,{path:"/add-report",element:i.jsx(Xj,{})}),i.jsx(cr,{path:"/initiatives",element:i.jsx(Jj,{})}),i.jsx(cr,{path:"/initiatives/add",element:i.jsx(Qj,{})}),i.jsx(cr,{path:"/initiatives/:id",element:i.jsx(eS,{})}),i.jsx(cr,{path:"/discussions",element:i.jsx(tS,{})}),i.jsx(cr,{path:"/discussions/add",element:i.jsx(rS,{})}),i.jsx(cr,{path:"/discussions/:id",element:i.jsx(sS,{})}),i.jsx(cr,{path:"/directory",element:i.jsx(nS,{})}),i.jsx(cr,{path:"/map",element:i.jsx(aS,{})}),i.jsx(cr,{path:"/volunteering",element:i.jsx(iS,{})}),i.jsx(cr,{path:"/volunteering/:id",element:i.jsx(oS,{})}),i.jsx(cr,{path:"/service-log",element:i.jsx(lS,{})}),i.jsx(cr,{path:"/news",element:i.jsx(cS,{})}),i.jsx(cr,{path:"/news/:id",element:i.jsx(uS,{})}),i.jsx(cr,{path:"/notifications",element:i.jsx(dS,{})}),i.jsx(cr,{path:"/polls",element:i.jsx(hS,{})}),i.jsx(cr,{path:"/polls/:id",element:i.jsx(pS,{})}),i.jsx(cr,{path:"/lost-found",element:i.jsx(fS,{})}),i.jsx(cr,{path:"/lost-found/add",element:i.jsx(xS,{})}),i.jsx(cr,{path:"/lost-found/:id",element:i.jsx(gS,{})}),i.jsx(cr,{path:"/generators",element:i.jsx(yS,{})}),i.jsx(cr,{path:"/generators/:id",element:i.jsx(_S,{})}),i.jsx(cr,{path:"/generators/:id/rate",element:i.jsx(bS,{})}),i.jsx(cr,{path:"/books",element:i.jsx(vS,{})}),i.jsx(cr,{path:"/books/add",element:i.jsx(jS,{})}),i.jsx(cr,{path:"/books/:id",element:i.jsx(kS,{})}),i.jsx(cr,{path:"/awareness",element:i.jsx(SS,{})}),i.jsx(cr,{path:"/awareness/detail/:id",element:i.jsx(hy,{})}),i.jsx(cr,{path:"/awareness/campaign/:campaignId",element:i.jsx(TS,{})}),i.jsx(cr,{path:"/awareness/campaign/:campaignId/:articleId",element:i.jsx(NS,{})}),i.jsx(cr,{path:"/settings",element:i.jsx(ES,{})}),i.jsx(cr,{path:"/profile/edit",element:i.jsx(CS,{})}),i.jsx(cr,{path:"/about",element:i.jsx(PS,{})})]}),P&&i.jsx(MS,{}),i.jsx(Kj,{}),i.jsx(C_,{})]})}function DS(){return i.jsx(zS,{children:i.jsx(kj,{children:i.jsxs(p1,{children:[i.jsx(IS,{}),i.jsx(AS,{})]})})})}const ky=document.getElementById("app");ky&&qb.createRoot(ky).render(i.jsx(DS,{}));export{$p as I,dm as N,X0 as W};
